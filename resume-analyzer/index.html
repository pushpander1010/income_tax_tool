<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Adsense loads if available; ad slot below is pre-reserved to avoid CLS -->
  <script async src="https://pagead2.googleadservices.com/pagead/js/adsbygoogle.js?client=ca-pub-6216304334889617" crossorigin="anonymous"></script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>Free Resume ATS Checker (PDF/DOCX/TXT) + JD Match & AI Review | UpTools</title>
  <meta name="description" content="Free Resume ATS Analyzer. Upload PDF/DOCX/TXT to get ATS-friendliness score, section health, keyword coverage, and JD match. Optional AI deep review with Perplexity, Google Gemini 2.5, or Groq. No sign-ups." />
  <meta name="keywords" content="resume ats checker, resume analyzer, ats resume score, free resume checker, job description match, ats keywords, docx pdf resume" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:large" />
  <meta name="theme-color" content="#0b1020" />
  <link rel="canonical" href="https://www.uptools.in/resume-analyzer/" />

  <!-- Icons -->
  <link rel="icon" type="image/svg+xml" href="/assets/logo/uptools-logo.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/logo/uptools-logo.svg">

  <!-- Open Graph -->
  <meta property="og:title" content="Free Resume ATS Checker + JD Match | UpTools" />
  <meta property="og:description" content="Upload PDF/DOCX/TXT, get ATS score, keyword gaps, and JD match. Optional AI deep review." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.uptools.in/resume-analyzer/" />
  <meta property="og:site_name" content="UpTools" />
  <meta property="og:image" content="https://www.uptools.in/assets/og/resume-ats-checker.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- CSS -->
  <link rel="preload" href="/style.css" as="style">
  <link rel="stylesheet" href="/style.css">

  <!-- Utils -->
  <link rel="modulepreload" href="/scripts/utils.js">

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@graph":[
      {
        "@type":"SoftwareApplication",
        "name":"Resume ATS Analyzer",
        "applicationCategory":"BusinessApplication",
        "operatingSystem":"Web",
        "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
        "publisher":{"@type":"Organization","name":"UpTools","url":"https://www.uptools.in/"},
        "url":"https://www.uptools.in/resume-analyzer/",
        "featureList":[
          "ATS friendliness score",
          "JD keyword match",
          "Section health",
          "Action verbs & readability",
          "AI deep review (optional)"
        ]
      },
      {
        "@type":"BreadcrumbList",
        "itemListElement":[
          {"@type":"ListItem","position":1,"name":"Home","item":"https://www.uptools.in/"},
          {"@type":"ListItem","position":2,"name":"Resume ATS Analyzer","item":"https://www.uptools.in/resume-analyzer/"}
        ]
      },
      {
        "@type":"FAQPage",
        "mainEntity":[
          {"@type":"Question","name":"Which file types are supported?",
            "acceptedAnswer":{"@type":"Answer","text":"PDF, DOCX, and TXT are fully supported in-browser. Legacy DOC files are best saved as DOCX and re-uploaded."}},
          {"@type":"Question","name":"Do you store my resume?",
            "acceptedAnswer":{"@type":"Answer","text":"No. Parsing happens locally in your browser. The optional AI review routes via a server-side proxy; we do not store your text."}},
          {"@type":"Question","name":"What do ATS scores mean?",
            "acceptedAnswer":{"@type":"Answer","text":"Scores estimate machine readability and keyword alignment. Use them as guidance, not as a guarantee for a specific ATS vendor."}}
        ]
      }
    ]
  }
  </script>

  <!-- Lightweight extra styles specific to this page -->
  <style>
    :root { --panel-h: clamp(520px, 76dvh, 820px); --gap: 14px; }
    main.tool { max-width: 1200px; margin-inline: auto; padding: 12px var(--container-px, 12px); }

    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: var(--gap); align-items: stretch; }
    @media (max-width: 1024px) { .grid{ grid-template-columns: 1fr; } }

    .panel { display:flex; flex-direction:column; height:var(--panel-h); min-height:460px; }
    .panel-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 12px; }
    .panel-body{ flex:1; min-height:0; display:grid; grid-template-rows:auto 1fr auto; gap:10px; padding:10px 12px; }

    textarea.textarea { min-height:120px; }

    /* Custom "Choose File" control, matches theme */
    .file-picker{
      position:relative; display:inline-flex; align-items:center; gap:10px;
      border:1px solid var(--border); border-radius:10px; padding:8px 10px; background:#0a1224; box-shadow: var(--glow-soft);
    }
    .file-picker input[type="file"]{ position:absolute; inset:0; width:100%; height:100%; opacity:0; cursor:pointer; }
    .file-picker .btn-like{
      display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:8px; font-weight:900; cursor:pointer;
      background: linear-gradient(135deg, var(--accent), color-mix(in oklab, var(--accent-2) 70%, white));
      color:#071018; border:1px solid color-mix(in oklab, var(--accent) 65%, #223); box-shadow: inset 0 -1px 0 rgba(0,0,0,.25), var(--glow-soft);
    }
    .file-name{ color:var(--muted); font-size:12px; max-width:40ch; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .kpis{ display:grid; grid-template-columns: repeat(4, minmax(120px,1fr)); gap:10px; }
    @media (max-width:880px){ .kpis{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width:520px){ .kpis{ grid-template-columns: 1fr; } }
    .kpi{ padding:10px; border-radius:10px; background:#0a1224; border:1px solid var(--border); box-shadow: var(--glow-soft); }
    .kpi b{ font-size:18px; display:block; }
    .pill.warn{ background:transparent; color:#ffb4b4; border:1px solid color-mix(in oklab, red 60%, #223); }

    /* Reserve ad space to avoid CLS */
    .ad-wrap{ display:block; min-height:160px; margin:10px 0; position:relative; overflow:hidden; }
    @media (min-width:1024px){ .ad-wrap{ min-height:250px; } }
    .ad-wrap:empty::before{ content:""; display:block; width:100%; height:100%; }
  </style>

  <!-- Client-side parsers (small & cached by CDN) -->
  <!-- DOCX -> text via Mammoth (works in browser) -->
  <script defer src="https://cdn.jsdelivr.net/npm/mammoth@1.7.1/mammoth.browser.min.js"></script>
  <!-- PDF -> text via pdfjs-dist -->
  <script defer src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/build/pdf.min.js"></script>
</head>

<body>
  <header class="site" role="banner">
    <div class="header-inner">
      <a class="brand" href="/" aria-label="UpTools Home">
        <img src="/assets/logo/uptools-logo.svg" alt="UpTools logo" width="28" height="28" fetchpriority="high">
        <b>UpTools</b>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/#tools">Tools</a>
        <a href="/ai-writer/">AI Writer</a>
        <a href="/word-counter/">Word Counter</a>
        <a aria-current="page" href="/resume-analyzer/">Resume</a>
      </nav>
    </div>
  </header>

  <main class="tool container" id="top">
    <section class="card hero" aria-labelledby="title">
      <div>
        <h1 id="title">üßæüîç Resume ATS Analyzer (PDF/DOCX/TXT) + JD Match</h1>
        <p class="note" style="margin:0">
          Get an ATS-friendliness score, section health, and keyword coverage. Paste a Job Description to see match % and gaps.
          Optional: AI deep review with Perplexity, Google Gemini 2.5, or Groq.
        </p>
        <div class="chips" style="margin-top:8px">
          <span class="pill">‚ö° Local parsing</span>
          <span class="pill">üîí No sign-ups</span>
          <a class="chip" href="/sitemap.xml">Sitemap</a>
          <a class="chip" href="/about/">About</a>
          <a class="chip" href="/contact/">Contact</a>
        </div>
      </div>
    </section>

    <!-- Reserved ad slot -->
    <section id="adMount" class="ad-wrap" aria-label="Advertisement"></section>

    <section class="grid" aria-label="Workspace">
      <!-- INPUT -->
      <article class="panel card" aria-labelledby="input-title">
        <div class="panel-head">
          <h2 id="input-title" class="h4">Your Resume & JD</h2>
          <div class="toolbar" role="group" aria-label="Quick actions">
            <button id="clearBtn" class="btn sm secondary" type="button">Clear</button>
            <span class="tiny">Chars: <output id="charCount">0</output></span>
          </div>
        </div>

        <div class="panel-body">
          <div class="row" style="gap:8px; align-items:center;">
            <!-- Styled file input -->
            <label class="file-picker" title="Upload PDF, DOCX, DOC, or TXT">
              <span class="btn-like">Choose File</span>
              <span id="fileName" class="file-name">PDF, DOCX, DOC, or TXT</span>
              <input id="resumeFile" type="file" accept=".pdf,.doc,.docx,.txt" aria-label="Upload resume">
            </label>

            <button id="parseBtn" class="btn sm" type="button" title="Extract text from the uploaded file">Extract ‚ñ∂</button>

            <label class="inline">
              <span class="tiny">Or paste resume text</span>
            </label>
          </div>

          <textarea id="resumeTxt" class="textarea" placeholder="Paste your resume text here (or upload a file)‚Ä¶"></textarea>

          <div class="row" style="gap:8px;">
            <label class="inline" style="flex:1">
              <span class="tiny">Job Description (optional)</span>
              <textarea id="jdTxt" class="textarea" placeholder="Paste the JD here for a match analysis‚Ä¶"></textarea>
            </label>
          </div>

          <div class="toolbar" role="group" aria-label="Run + AI">
            <button id="analyzeBtn" class="btn" type="button">Run ATS Check ‚ñ∂</button>

            <span class="tiny" style="opacity:.9">AI Deep Review (optional)</span>
            <label class="inline" title="Provider">
              <span class="tiny">Provider</span>
              <select id="provider" class="select" style="width:160px">
                <option value="perplexity" selected>Perplexity</option>
                <option value="google">Google (Gemini)</option>
                <option value="groq">Groq</option>
              </select>
            </label>
            <label class="inline" title="Model">
              <span class="tiny">Model</span>
              <select id="modelSel" class="select" style="width:230px">
                <!-- populated by JS -->
              </select>
            </label>
            <button id="aiReviewBtn" class="btn sm secondary" type="button">AI Review</button>
            <button id="stopBtn" class="btn sm danger" type="button" disabled>Stop</button>
          </div>
        </div>
      </article>

      <!-- OUTPUT -->
      <article class="panel card" aria-labelledby="output-title">
        <div class="panel-head">
          <h2 id="output-title" class="h4">Results</h2>
          <div class="toolbar" role="group" aria-label="Result actions">
            <button id="copyBtn" class="btn sm" type="button">Copy</button>
            <button id="downloadBtn" class="btn sm" type="button">Download .txt</button>
          </div>
        </div>

        <div class="panel-body">
          <div class="kpis" id="kpis" aria-live="polite">
            <div class="kpi"><span class="tiny">ATS Friendliness</span><b id="kpiATS">‚Äî</b></div>
            <div class="kpi"><span class="tiny">JD Match</span><b id="kpiMatch">‚Äî</b></div>
            <div class="kpi"><span class="tiny">Readability (FRE)</span><b id="kpiFRE">‚Äî</b></div>
            <div class="kpi"><span class="tiny">Action Verbs</span><b id="kpiVerbs">‚Äî</b></div>
          </div>

          <div class="tiny" id="status" aria-live="polite" style="margin-top:2px"></div>

          <div class="result" id="report" aria-label="ATS report" style="white-space:pre-wrap"></div>

          <div class="tips-related" style="display:grid; gap:12px; grid-template-columns:1fr 1fr; align-items:start;">
            <div>
              <h3 class="h5">Tips</h3>
              <ul class="list compact">
                <li>Use standard headings: <b>Summary</b>, <b>Experience</b>, <b>Education</b>, <b>Skills</b>.</li>
                <li>Avoid tables, text boxes, headers/footers‚Äîsome ATS can‚Äôt read those well.</li>
                <li>Mirror key phrases from the JD where relevant and truthful.</li>
              </ul>
            </div>
            <div>
              <h3 class="h5">Related</h3>
              <ul class="list compact">
                <li><a href="/ai-writer/">AI Writer</a> ‚Äî summaries, rewrites, SEO meta.</li>
                <li><a href="/word-counter/">Word Counter</a> ‚Äî words, chars, reading time.</li>
                <li><a href="/plagiarism-checker/">Plagiarism Checker</a> ‚Äî originality & paraphrasing.</li>
              </ul>
            </div>
          </div>
        </div>
      </article>
    </section>

    <section class="spaced" aria-labelledby="more">
      <h2 id="more" class="h5">More from UpTools</h2>
      <div class="grid" style="grid-template-columns: repeat(4,1fr);">
        <a class="card tool-link accent-indigo" href="/json-formatter/"><span class="ico">üß©</span><span><b>JSON Formatter</b><br><span class="note">Prettify &amp; validate</span></span></a>
        <a class="card tool-link accent-emerald" href="/qr-generator/"><span class="ico">üî≥</span><span><b>QR Generator</b><br><span class="note">Create QR codes</span></span></a>
        <a class="card tool-link accent-cyan" href="/image-converter/"><span class="ico">üñºÔ∏è</span><span><b>Image Converter</b><br><span class="note">Resize &amp; format</span></span></a>
        <a class="card tool-link accent-violet" href="/bmi-calculator/"><span class="ico">‚öñÔ∏è</span><span><b>BMI Calculator</b><br><span class="note">Quick health check</span></span></a>
      </div>
    </section>

    <footer class="site-footer">
      <nav class="nav-links" aria-label="Footer">
        <a href="/about/"><span class="card-badge" aria-hidden="true">ABT</span> About</a>
        <a href="/contact/"><span class="card-badge" aria-hidden="true">CT</span> Contact</a>
        <a href="/privacy/"><span class="card-badge" aria-hidden="true">PP</span> Privacy</a>
      </nav>
      <p class="tiny">¬© <span id="y"></span> UpTools ¬∑ <a href="https://creativecommons.org/licenses/" target="_blank" rel="nofollow noopener">Creative Commons</a></p>
    </footer>
  </main>

  <script type="module">
    import { $, $$, debounce, persist, read } from '/scripts/utils.js';

    // Refs
    const byId = (id)=>document.getElementById(id);
    const fileIn = byId('resumeFile');
    const fileName = byId('fileName');
    const parseBtn = byId('parseBtn');
    const resumeTxt = byId('resumeTxt');
    const jdTxt = byId('jdTxt');
    const analyzeBtn = byId('analyzeBtn');
    const aiReviewBtn = byId('aiReviewBtn');
    const stopBtn = byId('stopBtn');
    const status = byId('status');
    const kpiATS = byId('kpiATS');
    const kpiMatch = byId('kpiMatch');
    const kpiFRE = byId('kpiFRE');
    const kpiVerbs = byId('kpiVerbs');
    const report = byId('report');
    const copyBtn = byId('copyBtn');
    const downloadBtn = byId('downloadBtn');
    const clearBtn = byId('clearBtn');
    const charCount = byId('charCount');
    const providerSel = byId('provider');
    const modelSel = byId('modelSel');

    // Footer year
    byId('y').textContent = new Date().getFullYear();

    // Provider + Models (like your AI Writer)
    const PROVIDER_MODELS = {
      perplexity: [
        { id: 'sonar', label: 'sonar' },
        { id: 'sonar-pro', label: 'sonar-pro' },
        { id: 'sonar-reasoning', label: 'sonar-reasoning' }
      ],
      google: [
        { id: 'gemini-2.5-flash', label: 'gemini-2.5-flash' },
        { id: 'gemini-2.5-pro', label: 'gemini-2.5-pro' }
      ],
      groq: [
        { id: 'llama-3.1-8b-instant', label: 'llama-3.1-8b-instant' },
        { id: 'llama-3.1-70b-versatile', label: 'llama-3.1-70b-versatile' },
        { id: 'mixtral-8x7b-32768', label: 'mixtral-8x7b-32768' },
        { id: 'gemma2-9b-it', label: 'gemma2-9b-it' }
      ]
    };
    const CFG_KEY = 'resume:cfg';
    const cfg = Object.assign({ provider:'perplexity', model:'sonar' }, read(CFG_KEY, {}));

    function populateModels(){
      const prov = providerSel.value || 'perplexity';
      modelSel.innerHTML = '';
      for (const m of (PROVIDER_MODELS[prov] || [])) {
        const o = document.createElement('option');
        o.value = m.id; o.textContent = m.label; modelSel.appendChild(o);
      }
      const ok = (PROVIDER_MODELS[prov]||[]).some(m=>m.id===cfg.model);
      modelSel.value = ok ? cfg.model : (PROVIDER_MODELS[prov]?.[0]?.id || '');
    }
    providerSel.value = cfg.provider; populateModels(); if (cfg.model) modelSel.value = cfg.model;
    providerSel.addEventListener('change', ()=>{ cfg.provider = providerSel.value; populateModels(); persist(CFG_KEY, { provider:providerSel.value, model:modelSel.value }); });
    modelSel.addEventListener('change', ()=>persist(CFG_KEY, { provider:providerSel.value, model:modelSel.value }));

    // Character count
    const updateCounts = ()=>{ charCount.textContent = (resumeTxt.value.length || 0).toLocaleString(); };
    resumeTxt.addEventListener('input', debounce(updateCounts, 80)); updateCounts();

    // Clear
    clearBtn.addEventListener('click', ()=>{
      resumeTxt.value = ''; jdTxt.value = ''; report.textContent = ''; status.textContent = '';
      kpiATS.textContent = '‚Äî'; kpiMatch.textContent = '‚Äî'; kpiFRE.textContent = '‚Äî'; kpiVerbs.textContent = '‚Äî';
      charCount.textContent = '0'; fileIn.value = ''; fileName.textContent = 'PDF, DOCX, DOC, or TXT';
    });

    // File UI updates
    fileIn.addEventListener('change', (e)=>{
      const f = e.target.files?.[0];
      fileName.textContent = f ? `${f.name} (${Math.round((f.size||0)/1024)} KB)` : 'PDF, DOCX, DOC, or TXT';
    });

    // ----------- Parsing (local) -----------
    async function readAsText(file){
      const ext = (file.name.split('.').pop()||'').toLowerCase();
      if (ext === 'txt') return await file.text();
      if (ext === 'docx') return await parseDocx(file);
      if (ext === 'pdf')  return await parsePdf(file);
      if (ext === 'doc')  return 'Legacy .doc detected. Please re-save as DOCX (Word > Save As > .docx) for accurate parsing.';
      return await file.text(); // fallback
    }

    async function parseDocx(file){
      if (!window.mammoth) throw new Error('DOCX parser not loaded');
      const arrayBuffer = await file.arrayBuffer();
      const { value } = await window.mammoth.extractRawText({ arrayBuffer });
      return (value || '').trim();
    }

    async function parsePdf(file){
      if (!window.pdfjsLib) throw new Error('PDF parser not loaded');
      const data = new Uint8Array(await file.arrayBuffer());
      const pdf = await window.pdfjsLib.getDocument({ data }).promise;
      const maxPages = Math.min(pdf.numPages, 12); // keep it light
      let text = '';
      for (let i=1;i<=maxPages;i++){
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        const strings = content.items.map(it => (it.str||''));
        text += strings.join(' ') + '\n';
      }
      return text.replace(/\s+\n/g,'\n').trim();
    }

    parseBtn.addEventListener('click', async ()=>{
      const f = fileIn.files?.[0];
      if (!f) { toast('Pick a file first'); return; }
      status.textContent = 'Reading‚Ä¶';
      try{
        const text = await readAsText(f);
        if (!text || text.length < 30){
          toast('Could not read resume. Try DOCX/TXT or copy-paste text.');
        }
        resumeTxt.value = text || '';
        updateCounts();
        status.textContent = 'File extracted.';
      }catch(e){
        status.textContent = 'Parse error. See console.';
        console.error(e);
        toast('Could not read resume. Try DOCX/TXT or copy-paste text.');
      }
    });

    // ----------- ATS Heuristics -----------
    const ACTION_VERBS = ['led','managed','built','created','delivered','owned','shipped','implemented','designed','architected','migrated','optimized','improved','increased','reduced','launched','scaled','automated','mentored','collaborated','analyzed','developed','deployed','debugged','refactored','integrated','tested','documented'];

    function sentences(t){ return (t.trim().match(/[^.!?]+[.!?]*/g) || []).map(s=>s.trim()).filter(Boolean); }
    function words(t){ return (t.toLowerCase().match(/\b[\w‚Äô'-]+\b/gu) || []); }
    function uniq(a){ return [...new Set(a)]; }
    function syllables(w){ return ((w.toLowerCase().match(/[aeiouy]+/g) || []).length)||1; }
    function fleschReadingEase(text){
      const W = words(text);
      const S = sentences(text).length || 1;
      const SYL = W.reduce((s,w)=>s+syllables(w),0);
      const score = 206.835 - 1.015*(W.length/Math.max(1,S)) - 84.6*(SYL/Math.max(1,W.length));
      return Math.max(0, Math.min(100, Math.round(score)));
    }

    function sectionHealth(text){
      const headers = ['summary','experience','work experience','professional experience','projects','skills','education','certifications','achievements','awards','publications'];
      const found = headers.filter(h => new RegExp(`\\b${h}\\b`, 'i').test(text));
      return { found, coverage: Math.round((found.length / 6) * 100) }; // out of a core 6
    }

    function keywordMatch(resume, jd){
      if(!jd) return { match: '‚Äî', covered: [], missing: [] };
      const rws = words(resume);
      const jws = words(jd).filter(w => w.length > 3);
      const top = uniq(jws).slice(0, 120);
      const covered = top.filter(k => rws.includes(k));
      const missing = top.filter(k => !rws.includes(k));
      const pct = Math.round((covered.length / Math.max(1, top.length)) * 100);
      return { match: `${pct}%`, covered: covered.slice(0, 40), missing: missing.slice(0, 40) };
    }

    function actionVerbCount(text){
      const w = words(text);
      return w.filter(x => ACTION_VERBS.includes(x)).length;
    }

    function atsScore(text){
      // Simple blend: structure (sections), readability, bullet/action signals, length range
      const { coverage } = sectionHealth(text);
      const fre = fleschReadingEase(text);
      const acts = Math.min(15, actionVerbCount(text)) / 15; // cap
      const len = words(text).length;
      let lenScore = 0;
      if (len >= 250 && len <= 1100) lenScore = 1;
      else if (len >= 160 && len < 250) lenScore = 0.8;
      else if (len > 1100 && len <= 1600) lenScore = 0.8;
      else lenScore = 0.5;

      // weights
      const score = 0.4*(coverage/100) + 0.25*(fre/100) + 0.2*(acts) + 0.15*(lenScore);
      return Math.round(score * 100);
    }

    analyzeBtn.addEventListener('click', ()=>{
      const resume = (resumeTxt.value||'').trim();
      const jd = (jdTxt.value||'').trim();
      if (!resume || resume.length < 30){ toast('Add resume text or extract from file first.'); return; }

      status.textContent = 'Analyzing‚Ä¶';
      const fre = fleschReadingEase(resume);
      const sect = sectionHealth(resume);
      const verbs = actionVerbCount(resume);
      const ats = atsScore(resume);
      const km = keywordMatch(resume, jd);

      kpiATS.textContent = ats + '%';
      kpiFRE.textContent = fre.toString();
      kpiVerbs.textContent = verbs.toString();
      kpiMatch.textContent = km.match;

      const lines = [];
      lines.push(`ATS Friendliness: ${ats}%`);
      lines.push(`Readability (Flesch): ${fre}`);
      lines.push(`Sections found (${sect.found.length}): ${sect.found.join(', ') || '‚Äî'}`);
      if (jd){
        lines.push(`JD Match: ${km.match}`);
        lines.push(`Top Covered Keywords (${km.covered.length}): ${km.covered.join(', ')}`);
        lines.push(`Missing Keywords (${km.missing.length}): ${km.missing.join(', ')}`);
      }
      lines.push('');
      lines.push('Suggestions:');
      if (sect.coverage < 70) lines.push('- Add/standardize headings like Summary, Experience, Skills, Education.');
      if (fre < 45) lines.push('- Shorten sentences and prefer plain language to improve readability.');
      if (verbs < 6) lines.push('- Start bullets with strong action verbs (e.g., Led, Built, Delivered).');
      if (jd && km.match !== '‚Äî' && parseInt(km.match) < 65) lines.push('- Mirror key phrases from the JD where relevant and accurate.');
      lines.push('- Avoid tables, images, and headers/footers; export clean PDF or DOCX.');

      report.textContent = lines.join('\n');
      status.textContent = 'Done.';
    });

    // ----------- Optional: AI Deep Review (stream via /ai) -----------
    let aborter = null;
    async function streamAI({ provider, model, prompt }){
      const res = await fetch('/ai', {
        method:'POST',
        signal: (aborter=new AbortController()).signal,
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          provider, model, stream:true, temperature:0.3,
          messages: [
            { role:'system', content:'You are a precise resume reviewer. Be concise and actionable.' },
            { role:'user', content: prompt }
          ]
        })
      });
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      const reader = res.body.getReader(); const dec = new TextDecoder();
      report.textContent = '';
      for(;;){
        const {value, done} = await reader.read(); if(done) break;
        const chunk = dec.decode(value);
        for (const raw of chunk.split('\n')){
          const line = raw.trim(); if(!line || !line.startsWith('data:')) continue;
          const payload = line.slice(5).trim(); if (payload==='[DONE]'){ aborter=null; return; }
          try{
            const json = JSON.parse(payload);
            const delta = json.choices?.[0]?.delta?.content ?? '';
            if (delta) { report.append(document.createTextNode(delta)); report.scrollTop = report.scrollHeight; }
          }catch{}
        }
      }
      aborter=null;
    }

    aiReviewBtn.addEventListener('click', async ()=>{
      const resume = (resumeTxt.value||'').trim();
      if (!resume || resume.length < 30){ toast('Add resume text first.'); return; }
      const jd = (jdTxt.value||'').trim();
      const prompt = [
        'Review this resume for ATS clarity and JD alignment.',
        'Return: 1) brief verdict (score /10), 2) top 6 fixes (bullets), 3) keyword gaps (if JD present), 4) a polished 3-line summary.',
        jd ? '\nJob Description:\n' + jd : '',
        '\n--- Resume ---\n',
        resume
      ].join('\n');

      stopBtn.disabled = false;
      status.textContent = 'AI reviewing‚Ä¶';
      try{
        await streamAI({ provider: providerSel.value, model: modelSel.value, prompt });
        status.textContent = 'AI review complete.';
      }catch(e){
        console.error(e);
        status.textContent = 'AI review failed.';
        toast('AI request failed. Check provider/model or quotas.');
      }finally{
        stopBtn.disabled = true;
      }
    });

    stopBtn.addEventListener('click', ()=>{
      if (aborter){ aborter.abort(); aborter=null; stopBtn.disabled=true; status.textContent='Stopped.'; }
    });

    // Copy / Download
    copyBtn.addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(report.textContent||''); toast('Copied'); }
      catch{ toast('Copy blocked by browser'); }
    });
    downloadBtn.addEventListener('click', ()=>{
      const blob = new Blob([report.textContent||''], {type:'text/plain;charset=utf-8'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='ats-report.txt'; a.click();
      URL.revokeObjectURL(a.href);
    });

    function toast(msg){ status.textContent = msg; setTimeout(()=>{ if(status.textContent===msg) status.textContent=''; }, 1800); }

    // Mount AdSense without CLS (slot already reserved)
    (function mountAd(){
      if(!('adsbygoogle' in window)) return;
      const mount=byId('adMount');
      const ins=document.createElement('ins');
      ins.className='adsbygoogle';
      ins.setAttribute('data-ad-client','ca-pub-6216304334889617');
      ins.setAttribute('data-ad-slot','auto');
      ins.setAttribute('data-ad-format','auto');
      ins.setAttribute('data-full-width-responsive','true');
      ins.style.display='block'; ins.style.minHeight='160px';
      mount.appendChild(ins);
      try{ (window.adsbygoogle = window.adsbygoogle || []).push({}); }catch{}
    })();
  </script>
</body>
</html>
