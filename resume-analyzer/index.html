<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Connection hints (ads only) -->
  <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
  <link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
  <link rel="preconnect" href="https://googleads.g.doubleclick.net" crossorigin>
  <link rel="dns-prefetch" href="//googleads.g.doubleclick.net">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>ATS Resume Checker — PDF/DOCX/TXT + JD Match (AI Suggestions) | UpTools</title>
  <meta name="description"
    content="Upload PDF, DOCX, or TXT to check ATS readiness: sections, contact info, formatting, and keywords. Paste or upload a Job Description to get match %, missing keywords, and optional AI suggestions (Perplexity, Google Gemini 2.5, Groq).">
  <meta name="keywords"
    content="ATS resume checker, resume analyzer, resume vs job description, resume keyword match, PDF DOCX TXT resume check, free ats resume scan">
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:large" />
  <meta name="theme-color" content="#0b1020" />
  <link rel="canonical" href="https://www.uptools.in/resume-ats-checker/" />

  <!-- Icons -->
  <link rel="icon" type="image/svg+xml" href="/assets/logo/uptools-logo.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="ATS Resume Checker — PDF/DOCX/TXT + JD Match (AI Suggestions) | UpTools" />
  <meta property="og:description"
    content="Analyze your resume for ATS and match it to a Job Description. Optional AI suggestions via Perplexity, Gemini 2.5, or Groq. No sign-ups." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.uptools.in/resume-ats-checker/" />
  <meta property="og:site_name" content="UpTools" />
  <meta property="og:image" content="https://www.uptools.in/assets/og/ats-resume-checker.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Shared CSS (load normally to avoid CLS) -->
  <link rel="preload" href="/style.css" as="style">
  <link rel="stylesheet" href="/style.css">

  <!-- Utils -->
  <link rel="modulepreload" href="/scripts/utils.js">

  <!-- Schema -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@graph":[
      {
        "@type":"SoftwareApplication",
        "name":"ATS Resume Checker",
        "applicationCategory":"BusinessApplication",
        "operatingSystem":"Web",
        "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
        "publisher":{"@type":"Organization","name":"UpTools","url":"https://www.uptools.in/"},
        "url":"https://www.uptools.in/resume-ats-checker/",
        "featureList":["PDF/DOCX/TXT support","General ATS scan","Resume vs Job Description match","Keyword coverage & gaps","Optional AI suggestions"]
      },
      {
        "@type":"BreadcrumbList",
        "itemListElement":[
          {"@type":"ListItem","position":1,"name":"Home","item":"https://www.uptools.in/"},
          {"@type":"ListItem","position":2,"name":"ATS Resume Checker","item":"https://www.uptools.in/resume-ats-checker/"}
        ]
      },
      {
        "@type":"FAQPage",
        "mainEntity":[
          {"@type":"Question","name":"Which file types are supported?","acceptedAnswer":{"@type":"Answer","text":"PDF, DOCX (Word), and TXT for both resume and job description."}},
          {"@type":"Question","name":"Do you store my files?","acceptedAnswer":{"@type":"Answer","text":"No. Parsing and analysis run in your browser. If you use AI suggestions, text is proxied server-side to your chosen provider."}},
          {"@type":"Question","name":"Does this guarantee ATS selection?","acceptedAnswer":{"@type":"Answer","text":"No tool can guarantee selection. We provide heuristic checks and suggestions to improve parsing and relevance."}}
        ]
      }
    ]
  }
  </script>

  <!-- Page styles (small, layout-only) -->
  <style>
    :root {
      --panel-h: clamp(560px, 78dvh, 860px);
      --gap: 14px;
    }

    main.tool {
      max-width: 1200px;
      margin-inline: auto;
      padding: 12px var(--container-px, 12px);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
      align-items: stretch;
    }

    @media (max-width: 1024px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: 10px;
      min-height: 420px;
    }

    .panel-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 10px 12px;
    }

    .panel-body {
      display: grid;
      gap: 10px;
      padding: 10px 12px;
      grid-template-rows: auto auto 1fr auto;
      min-height: 0;
    }

    .kgrid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
    }

    .meter-wrap {
      background: #0b1326;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px;
    }

    .meter {
      height: 10px;
      border-radius: 8px;
      background: #0a1122;
      overflow: hidden;
    }

    .bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      transition: width .35s ease;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      border: 1px solid var(--border);
      border-radius: 999px;
      font-size: 12px;
    }

    .row {
      display: grid;
      gap: 8px;
      grid-template-columns: 1fr 1fr;
    }

    @media (max-width:720px) {
      .row {
        grid-template-columns: 1fr;
      }
    }

    .drop {
      border: 1px dashed color-mix(in oklab, var(--accent) 45%, #314);
      padding: 12px;
      border-radius: 12px;
    }

    .drop.over {
      outline: 3px solid color-mix(in oklab, var(--accent) 55%, white);
    }

    .fileline {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filename {
      font-size: 12px;
      opacity: .85;
    }

    .ad-wrap {
      display: block;
      min-height: 160px;
      margin: 10px 0;
      position: relative;
      overflow: hidden;
    }

    @media (min-width:1024px) {
      .ad-wrap {
        min-height: 250px;
      }
    }

    .ad-wrap:empty::before {
      content: "";
      display: block;
      width: 100%;
      height: 100%;
    }

    .ad-wrap ins.adsbygoogle {
      display: block !important;
      width: 100% !important;
      min-height: 160px !important;
    }

    @media (min-width:1024px) {
      .ad-wrap ins.adsbygoogle {
        min-height: 250px !important;
      }
    }

    /* Themed file button (uses your .btn styles) */
    .file-input {
      position: relative;
      display: inline-flex;
    }

    .file-input input[type=file] {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }

    .muted {
      opacity: .85
    }
  </style>
</head>

<body>
  <header class="site" role="banner">
    <div class="header-inner">
      <a class="brand" href="/" aria-label="UpTools Home">
        <img src="/assets/logo/uptools-logo.svg" alt="UpTools logo" width="28" height="28" fetchpriority="high">
        <b>UpTools</b>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/#tools">Tools</a>
        <a href="/ai-writer/">AI Writer</a>
        <a href="/word-counter/">Word Counter</a>
        <a aria-current="page" href="/resume-ats-checker/">Resume ATS</a>
      </nav>
    </div>
  </header>

  <main class="tool container" id="top">
    <!-- Hero -->
    <section class="card hero" aria-labelledby="title">
      <div>
        <h1 id="title">📄🔎 ATS Resume Checker (PDF • DOCX • TXT)</h1>
        <p class="note" style="margin:0">
          Check ATS readiness (sections, contacts, formatting, keywords). Paste or upload a Job Description to get match
          %, missing keywords, and <b>optional AI suggestions</b> (Perplexity, Google Gemini 2.5, Groq).
        </p>
        <div class="chips" style="margin-top:8px">
          <span class="pill">🔒 Browser‑only parsing</span>
          <span class="pill">⚡ No sign‑ups</span>
          <a class="chip" href="/sitemap.xml">Sitemap</a>
          <a class="chip" href="/about/">About</a>
          <a class="chip" href="/contact/">Contact</a>
        </div>
      </div>
    </section>

    <!-- Reserved Ad slot (prevents CLS) -->
    <section id="adMount" class="ad-wrap" aria-label="Advertisement"></section>

    <section class="grid-2" aria-label="Workspace">
      <!-- LEFT: Inputs -->
      <article class="panel card" aria-labelledby="input-title">
        <div class="panel-head">
          <h2 id="input-title" class="h4">Resume &amp; Job Description</h2>
          <div class="tiny-note">Supported: <b>PDF</b>, <b>DOCX</b>, <b>TXT</b></div>
        </div>

        <div class="panel-body">
          <!-- Upload rows -->
          <div class="drop" id="dropZone" aria-label="Drag & drop files">
            <div class="row">
              <div>
                <label class="label">Resume file</label>
                <div class="fileline">
                  <label class="btn secondary sm file-input" title="Upload resume file">
                    📄 Choose File
                    <input id="resumeFile" type="file" accept=".pdf,.docx,.txt,.doc" aria-label="Upload resume file">
                  </label>
                  <span id="resumeFileName" class="filename">No file chosen</span>
                </div>
                <details class="muted" style="margin-top:6px">
                  <summary class="tiny">Or paste resume text</summary>
                  <textarea id="resumeText" class="input"
                    placeholder="Paste resume text here (useful for scanned PDFs or .doc files)"></textarea>
                </details>
              </div>

              <div>
                <label class="label">Job Description file (optional)</label>
                <div class="fileline">
                  <label class="btn secondary sm file-input" title="Upload JD file">
                    📄 Choose File
                    <input id="jdFile" type="file" accept=".pdf,.docx,.txt,.doc"
                      aria-label="Upload job description file">
                  </label>
                  <span id="jdFileName" class="filename">No file chosen</span>
                </div>
              </div>
            </div>

            <div class="row" style="grid-template-columns:1fr;">
              <div>
                <label class="label">Job Description (paste text, optional)</label>
                <textarea id="jdText" class="input" placeholder="Paste JD here for matching…"
                  spellcheck="false"></textarea>
              </div>
            </div>
          </div>

          <!-- Provider / Model -->
          <div class="toolbar" role="group" aria-label="AI settings"
            style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
            <label class="inline">
              <span class="tiny">Provider</span>
              <select id="provider" class="select" style="width:170px" aria-label="AI provider">
                <option value="perplexity" selected>Perplexity</option>
                <option value="google">Google (Gemini)</option>
                <option value="groq">Groq</option>
              </select>
            </label>
            <label class="inline">
              <span class="tiny">Model</span>
              <select id="modelSel" class="select" style="width:230px" aria-label="AI model">
                <option value="sonar" selected>sonar</option>
                <option value="sonar-pro">sonar-pro</option>
                <option value="sonar-reasoning">sonar-reasoning</option>
              </select>
            </label>
            <button id="saveCfg" class="btn sm secondary" type="button" title="Save provider & model">Save</button>
          </div>

          <!-- Controls -->
          <div class="toolbar" role="group" aria-label="Run actions"
            style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:flex-end">
            <button id="analyzeBtn" class="btn" type="button">Analyze ▶</button>
            <button id="aiBtn" class="btn secondary" type="button"
              title="Get AI Suggestions aligned to your resume/JD">Get AI Suggestions</button>
            <button id="clearBtn" class="btn sm secondary" type="button">Clear</button>
          </div>
        </div>
      </article>

      <!-- RIGHT: Results -->
      <article class="panel card" aria-labelledby="output-title">
        <div class="panel-head">
          <h2 id="output-title" class="h4">Results</h2>
          <div class="tiny" id="status" aria-live="polite"></div>
        </div>

        <div class="panel-body" style="grid-template-rows:auto auto 1fr auto;">
          <!-- Meters -->
          <div class="meter-wrap">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
              <div><b>ATS Readability</b> <span class="note">(sections & formatting)</span></div>
              <div class="badge mono" id="atsScoreLbl">0%</div>
            </div>
            <div class="meter">
              <div class="bar" id="atsBar"></div>
            </div>
          </div>

          <div class="meter-wrap" id="jdWrap" hidden>
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
              <div><b>JD Match</b> <span class="note">(keyword coverage)</span></div>
              <div class="badge mono" id="matchLbl">0%</div>
            </div>
            <div class="meter">
              <div class="bar" id="matchBar"></div>
            </div>
          </div>

          <!-- Findings -->
          <div class="result">
            <h3 class="h5">Findings</h3>
            <div class="kgrid">
              <div><b>Sections found:</b>
                <div id="sectionsFound" class="note">—</div>
              </div>
              <div><b>Contact info:</b>
                <div id="contactFound" class="note">—</div>
              </div>
              <div><b>Words / Pages:</b>
                <div id="lengthFound" class="note">—</div>
              </div>
              <div><b>Formatting flags:</b>
                <div id="formatFlags" class="note">—</div>
              </div>
            </div>
          </div>

          <!-- Keywords -->
          <div class="result">
            <h3 class="h5">Keywords</h3>
            <div class="kgrid">
              <div><b>Resume keywords</b>
                <div id="resumeTop" class="note">—</div>
              </div>
              <div id="jdCol" hidden><b>JD keywords</b>
                <div id="jdTop" class="note">—</div>
              </div>
              <div id="missingCol" hidden><b>Missing (from JD)</b>
                <div id="missingKeys" class="note">—</div>
              </div>
            </div>
          </div>

          <!-- Suggestions -->
          <div class="result">
            <h3 class="h5">Actionable Suggestions</h3>
            <ul id="suggestions" class="list compact"></ul>
          </div>

          <details class="result">
            <summary><b>Preview Extracted Text (debug)</b></summary>
            <pre id="debugText" class="mono" style="white-space:pre-wrap; max-height:240px; overflow:auto"></pre>
          </details>

          <div style="display:flex;gap:8px;justify-content:flex-end">
            <button id="copyBtn" class="btn sm secondary" type="button">Copy Suggestions</button>
            <button id="dlBtn" class="btn sm secondary" type="button">Download Report (.txt)</button>
          </div>
        </div>
      </article>
    </section>

    <!-- Backlinks -->
    <section class="spaced" aria-labelledby="related">
      <h2 id="related" class="h5">More from UpTools</h2>
      <div class="grid-2" style="grid-template-columns:repeat(4,1fr);">
        <a class="card tool-link accent-indigo" href="/ai-writer/"><span class="ico"
            aria-hidden="true">✍️</span><span><b>AI Writer</b><br><span class="note">Summarize &
              rewrite</span></span></a>
        <a class="card tool-link accent-emerald" href="/word-counter/"><span class="ico"
            aria-hidden="true">📝</span><span><b>Word Counter</b><br><span class="note">Words &
              characters</span></span></a>
        <a class="card tool-link accent-cyan" href="/json-formatter/"><span class="ico"
            aria-hidden="true">🧩</span><span><b>JSON Formatter</b><br><span class="note">Prettify &
              validate</span></span></a>
        <a class="card tool-link accent-violet" href="/qr-generator/"><span class="ico"
            aria-hidden="true">🔳</span><span><b>QR Generator</b><br><span class="note">Create QR
              codes</span></span></a>
      </div>
    </section>

    <footer class="site-footer">
      <nav class="nav-links" aria-label="Footer">
        <a href="/about/"><span class="card-badge" aria-hidden="true">ABT</span> About</a>
        <a href="/contact/"><span class="card-badge" aria-hidden="true">CT</span> Contact</a>
        <a href="/privacy/"><span class="card-badge" aria-hidden="true">PP</span> Privacy</a>
      </nav>
      <p class="tiny">© <span id="y"></span> UpTools · <a href="https://creativecommons.org/licenses/" target="_blank"
          rel="nofollow noopener">Creative Commons</a></p>
    </footer>
  </main>

  <!-- Page Script -->
  <script type="module">
    import { $, $$, debounce, persist, read } from '/scripts/utils.js';

    // Year + Ad
    document.getElementById('y').textContent = new Date().getFullYear();
    (function mountAd() {
      if (!('adsbygoogle' in window)) return;
      const mount = document.getElementById('adMount');
      const ins = document.createElement('ins');
      ins.className = 'adsbygoogle';
      ins.setAttribute('data-ad-client', 'ca-pub-6216304334889617');
      ins.setAttribute('data-ad-slot', '1234567890'); // replace with your real unit
      ins.setAttribute('data-ad-format', 'auto');
      ins.setAttribute('data-full-width-responsive', 'true');
      ins.setAttribute('data-adtest', 'on'); // safe during review
      mount.appendChild(ins);
      try { (window.adsbygoogle = window.adsbygoogle || []).push({}); } catch { }
    })();

    // DOM
    const resumeFile = $('#resumeFile');
    const jdFile = $('#jdFile');
    const resumeFileName = $('#resumeFileName');
    const jdFileName = $('#jdFileName');
    const resumeText = $('#resumeText');
    const jdText = $('#jdText');

    const analyzeBtn = $('#analyzeBtn');
    const aiBtn = $('#aiBtn');
    const clearBtn = $('#clearBtn');

    const atsBar = $('#atsBar'), atsLbl = $('#atsScoreLbl');
    const matchBar = $('#matchBar'), matchLbl = $('#matchLbl');
    const jdWrap = $('#jdWrap');
    const sectionsFound = $('#sectionsFound');
    const contactFound = $('#contactFound');
    const lengthFound = $('#lengthFound');
    const formatFlags = $('#formatFlags');
    const resumeTop = $('#resumeTop');
    const jdTop = $('#jdTop');
    const missingKeys = $('#missingKeys');
    const jdCol = $('#jdCol');
    const missingCol = $('#missingCol');
    const suggestions = $('#suggestions');
    const debugText = $('#debugText');
    const status = $('#status');
    const copyBtn = $('#copyBtn');
    const dlBtn = $('#dlBtn');

    // Provider & Models (like plagiarism tool)
    const providerSel = $('#provider');
    const modelSel = $('#modelSel');
    const saveCfg = $('#saveCfg');
    const PROVIDER_MODELS = {
      perplexity: [
        { id: 'sonar', label: 'sonar' },
        { id: 'sonar-pro', label: 'sonar-pro' },
        { id: 'sonar-reasoning', label: 'sonar-reasoning' }
      ],
      google: [
        { id: 'gemini-2.5-flash', label: 'gemini-2.5-flash' },
        { id: 'gemini-2.5-pro', label: 'gemini-2.5-pro' }
      ],
      groq: [
        { id: 'llama-3.1-8b-instant', label: 'llama-3.1-8b-instant' },
        { id: 'llama-3.1-70b-versatile', label: 'llama-3.1-70b-versatile' },
        { id: 'mixtral-8x7b-32768', label: 'mixtral-8x7b-32768' },
        { id: 'gemma2-9b-it', label: 'gemma2-9b-it' }
      ]
    };
    const GOOGLE_MODEL_FALLBACKS = {
      'gemini-2.5-flash': ['gemini-2.0-flash', 'gemini-1.5-flash'],
      'gemini-2.5-pro': ['gemini-2.0-pro', 'gemini-1.5-pro']
    };
    const CFG_KEY = 'resume-ats:cfg';
    const cfg = Object.assign({ provider: 'perplexity', model: 'sonar' }, read(CFG_KEY, {}));
    providerSel.value = cfg.provider;
    (function populateModelsInitial() {
      const prov = providerSel.value;
      const models = PROVIDER_MODELS[prov] || [];
      const desired = cfg.model || (models[0]?.id || '');
      modelSel.innerHTML = '';
      for (const m of models) {
        const opt = document.createElement('option');
        opt.value = m.id; opt.textContent = m.label; modelSel.appendChild(opt);
      }
      modelSel.value = desired || models[0]?.id || '';
    })();
    function populateModels() {
      const prov = providerSel.value;
      const models = PROVIDER_MODELS[prov] || [];
      modelSel.innerHTML = '';
      for (const m of models) {
        const opt = document.createElement('option');
        opt.value = m.id; opt.textContent = m.label; modelSel.appendChild(opt);
      }
      const ok = models.some(m => m.id === cfg.model);
      modelSel.value = ok ? cfg.model : (models[0]?.id || '');
    }
    providerSel.addEventListener('change', () => { cfg.provider = providerSel.value; populateModels(); });
    saveCfg.addEventListener('click', () => { persist(CFG_KEY, { provider: providerSel.value, model: modelSel.value }); toast('Settings saved'); });

    // File UI
    resumeFile.addEventListener('change', (e) => { resumeFileName.textContent = e.target.files?.[0]?.name || 'No file chosen'; });
    jdFile.addEventListener('change', (e) => { jdFileName.textContent = e.target.files?.[0]?.name || 'No file chosen'; });

    // Drag-drop
    const dropZone = $('#dropZone');
    ['dragenter', 'dragover'].forEach(ev => dropZone.addEventListener(ev, e => { e.preventDefault(); dropZone.classList.add('over'); }));
    ;['dragleave', 'drop'].forEach(ev => dropZone.addEventListener(ev, e => { e.preventDefault(); dropZone.classList.remove('over'); }));
    dropZone.addEventListener('drop', (e) => {
      const files = [...e.dataTransfer.files];
      if (files[0]) { const dt1 = new DataTransfer(); dt1.items.add(files[0]); resumeFile.files = dt1.files; resumeFile.dispatchEvent(new Event('change')); }
      if (files[1]) { const dt2 = new DataTransfer(); dt2.items.add(files[1]); jdFile.files = dt2.files; jdFile.dispatchEvent(new Event('change')); }
    });

    // Helpers
    const STOP = new Set('a,an,and,are,as,at,be,by,for,from,has,have,in,is,it,its,of,on,or,that,the,this,to,with,your,our,was,were,will,shall,can,may,not,than,then,if,into,via,over,under,per,using,used,us,them,they,he,she,him,her,who,whom,which,what,when,where,why,how,am,i,me,my,we,ours,ourself,their,themself,there,here'.split(','));
    const clean = (t) => (t || '').replace(/\u0000/g, ' ').replace(/\s+/g, ' ').trim();
    const toWords = (t) => clean(t).toLowerCase().match(/[a-z][a-z\-\+\.#0-9]{1,}/g) || [];
    function topKeywords(text, n = 25) {
      const words = toWords(text).filter(w => w.length > 2 && !STOP.has(w));
      const freq = new Map();
      for (const w of words) { freq.set(w, (freq.get(w) || 0) + 1); }
      return [...freq.entries()].sort((a, b) => b[1] - a[1]).slice(0, n).map(([k]) => k);
    }
    const has = (t, p) => new RegExp(p, 'i').test(t || '');
    function sectionPresence(t) {
      const s = (k) => has(t, `\\b${k}\\b`);
      return {
        summary: s('summary|profile|objective'),
        experience: s('experience|work history|employment'),
        education: s('education|academics|degree|bachelor|master'),
        skills: s('skills|technologies|tooling|competencies'),
        projects: s('projects|portfolio|case studies'),
        certifications: s('certification|certifications|licenses'),
        achievements: s('achievements|awards|recognition')
      };
    }
    function contactChecks(t) {
      const email = /\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}\b/i.test(t);
      const phone = /(\+?\d[\d\-\s()]{7,}\d)/.test(t);
      const links = /(linkedin\.com\/in\/|github\.com\/|portfolio|behance\.net|dribbble\.com)/i.test(t);
      const address = /(india|usa|uk|canada|australia|address:|location)/i.test(t);
      return { email, phone, links, address };
    }
    function formattingFlags(t) {
      const flags = [];
      if ((t.match(/[•▪■\-\*]\s/g) || []).length > 200) flags.push('Excessive bullet density');
      if (/table|column/i.test(t) && /│|┆|┊|┋|┇|┃|┏|┓|┗|┛/.test(t)) flags.push('Possible tables/columns (can confuse parsers)');
      if (/[^\x09\x0A\x0D\x20-\x7E\u00A0-\u024F]/.test(t)) flags.push('Non-ASCII/unicode artifacts');
      if (t.length > 18000) flags.push('Document very long (>18k chars)');
      return flags.length ? flags : ['None'];
    }
    function scoreATS(t) {
      const sec = sectionPresence(t);
      const contact = contactChecks(t);
      const base = 40;
      const secScore = Object.values(sec).filter(Boolean).length / 7 * 40;
      const contactScore = (contact.email ? 1 : 0) + (contact.phone ? 1 : 0) + (contact.links ? 0.5 : 0) + (contact.address ? 0.3 : 0);
      const capped = Math.min(contactScore / 2.8 * 20, 20);
      return Math.round(Math.min(100, base + secScore + capped));
    }
    function matchScore(resume, jd) {
      const R = new Set(topKeywords(resume, 80));
      const J = topKeywords(jd, 60);
      const covered = J.filter(k => R.has(k));
      const missing = J.filter(k => !R.has(k));
      const score = Math.round((covered.length / Math.max(1, J.length)) * 100);
      return { score, covered, missing, rTop: [...R].slice(0, 30), jTop: J.slice(0, 30) };
    }
    function setMeter(bar, lbl, v) { bar.style.width = Math.max(0, Math.min(100, v)) + '%'; lbl.textContent = v + '%'; }
    function toast(msg) { status.textContent = msg; setTimeout(() => { if (status.textContent === msg) status.textContent = ''; }, 2000); }
    function resetUI() {
      suggestions.innerHTML = ''; setMeter(atsBar, atsLbl, 0); setMeter(matchBar, matchLbl, 0);
      jdWrap.hidden = true; jdCol.hidden = true; missingCol.hidden = true;
      sectionsFound.textContent = contactFound.textContent = lengthFound.textContent = formatFlags.textContent = '—';
      resumeTop.textContent = jdTop.textContent = missingKeys.textContent = '—';
      debugText.textContent = ''; status.textContent = '';
    }

    // Robust parsers (lazy-load)
    async function parseFileToText(file) {
      if (!file) return '';
      const ext = (file.name.split('.').pop() || '').toLowerCase();

      // Plain text
      if (ext === 'txt') return await file.text();

      // DOCX (browser build)
      if (ext === 'docx') {
        try {
          const mammoth = await import('https://cdn.jsdelivr.net/npm/mammoth/mammoth.browser.min.js');
          const ab = await file.arrayBuffer();
          const { value } = await mammoth.extractRawText({ arrayBuffer: ab });
          return value || '';
        } catch (e) {
          console.warn('DOCX parse failed', e);
          return '';
        }
      }

      // Legacy .doc — not reliable in-browser
      if (ext === 'doc') {
        return ''; // we'll show guidance below
      }

      // PDF
      if (ext === 'pdf') {
        try {
          const pdfjs = await import('https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.4.168/pdf.min.mjs');
          pdfjs.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.4.168/pdf.worker.min.js';
          const data = new Uint8Array(await file.arrayBuffer());
          const doc = await pdfjs.getDocument({ data }).promise;
          let text = ''; let chars = 0;
          for (let p = 1; p <= doc.numPages; p++) {
            const page = await doc.getPage(p);
            const content = await page.getTextContent();
            const pageText = content.items.map(i => i.str).join(' ');
            text += pageText + '\n';
            chars += pageText.replace(/\s+/g, '').length;
          }
          // If it's likely a scanned PDF (no selectable text)
          if (chars < 30) return '';
          return text;
        } catch (e) {
          console.warn('PDF parse failed', e);
          return '';
        }
      }

      return '';
    }

    function addSuggestion(t) { const li = document.createElement('li'); li.textContent = t; suggestions.appendChild(li); }

    clearBtn.addEventListener('click', () => {
      resumeFile.value = ''; resumeFileName.textContent = 'No file chosen';
      jdFile.value = ''; jdFileName.textContent = 'No file chosen';
      resumeText.value = ''; jdText.value = '';
      resetUI();
    });

    analyzeBtn.addEventListener('click', async () => {
      resetUI(); status.textContent = 'Parsing files…';

      const pastedResume = resumeText.value.trim();
      const parsedResume = await parseFileToText(resumeFile.files?.[0]);
      const resumeAll = clean((pastedResume || parsedResume || ''));

      const jdTxtFile = await parseFileToText(jdFile.files?.[0]);
      const jdAll = clean((jdTxtFile || jdText.value || ''));

      if (!resumeAll) {
        const name = resumeFile.files?.[0]?.name || '';
        const ext = (name.split('.').pop() || '').toLowerCase();
        let hint = 'Could not read resume. ';
        if (ext === 'pdf') {
          hint += 'This looks like a scanned PDF (no selectable text). Please use a text-based PDF, DOCX/TXT, or paste the text.';
        } else if (ext === 'doc') {
          hint += 'Legacy .doc is not supported in-browser. Please convert to .docx, .pdf (text-based), or paste the text.';
        } else {
          hint += 'Try DOCX/TXT, a different PDF, or paste the text below.';
        }
        status.textContent = hint;
        return;
      }

      // Show debug
      debugText.textContent = resumeAll.slice(0, 120000);

      // Basics
      const words = toWords(resumeAll).length;
      const pagesGuess = Math.max(1, Math.round(resumeAll.length / 3500));
      const secs = sectionPresence(resumeAll);
      const contacts = contactChecks(resumeAll);
      const flags = formattingFlags(resumeAll);
      const ats = scoreATS(resumeAll);

      setMeter(atsBar, atsLbl, ats);
      sectionsFound.textContent = Object.entries(secs).filter(([, v]) => v).map(([k]) => k).join(', ') || '—';
      contactFound.textContent = ['email', 'phone', 'links', 'address'].map(k => contacts[k] ? k + ' ✓' : k + ' ✗').join(', ');
      lengthFound.textContent = `${words.toLocaleString()} words • ~${pagesGuess} page(s)`;
      formatFlags.textContent = flags.join('; ');

      const rTop = topKeywords(resumeAll, 25); resumeTop.textContent = rTop.join(', ') || '—';

      if (jdAll.length > 10) {
        const { score, missing, jTop: jt } = matchScore(resumeAll, jdAll);
        jdWrap.hidden = false; jdCol.hidden = false; missingCol.hidden = false;
        setMeter(matchBar, matchLbl, score);
        jdTop.textContent = jt.join(', ') || '—';
        missingKeys.textContent = missing.slice(0, 30).join(', ') || '—';
      }

      // Suggestions
      const fname = resumeFile.files?.[0]?.name || '';
      if (/\s/.test(fname)) addSuggestion('Rename file to avoid spaces (e.g., firstname_lastname_resume.pdf).');
      if (!secs.summary) addSuggestion('Add a concise “Summary” at the top (2–3 impact lines).');
      if (!secs.skills) addSuggestion('Include a dedicated “Skills” section grouped by category.');
      if (!contacts.email || !contacts.phone) addSuggestion('Ensure both email and phone are present in the header.');
      if (words < 250) addSuggestion('Resume is short — add measurable achievements & context.');
      if (words > 1200) addSuggestion('Resume seems long — trim to 1–2 pages for most roles.');
      if (flags[0] !== 'None') addSuggestion('Reduce complex formatting (tables/columns/unicode) for better ATS parsing.');
      if (jdAll.length > 10) addSuggestion('Incorporate missing JD keywords naturally in Experience bullets.');
      addSuggestion('Start bullets with strong verbs; quantify outcomes (%, ₹, time saved, users, latency).');

      status.textContent = 'Done.';
    });

    copyBtn.addEventListener('click', async () => {
      const list = [...$$('#suggestions li')].map(li => '• ' + li.textContent).join('\n');
      try { await navigator.clipboard.writeText(list || ''); toast('Suggestions copied'); } catch { toast('Copy blocked by browser'); }
    });
    dlBtn.addEventListener('click', () => {
      const list = [...$$('#suggestions li')].map(li => '- ' + li.textContent).join('\n');
      const blob = new Blob([list || ''], { type: 'text/plain;charset=utf-8' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'ats-resume-report.txt'; a.click();
      URL.revokeObjectURL(a.href);
    });

    // Optional AI Suggestions (resume + optional JD)
    async function aiSuggest(resumeAll, jdAll) {
      let provider = providerSel.value || 'perplexity';
      let model = modelSel.value || (PROVIDER_MODELS[provider]?.[0]?.id ?? '');
      const body = {
        provider, model, stream: true, temperature: 0.35,
        messages: [
          { role: 'system', content: 'You are an expert ATS resume coach. Be specific, bulleted, and concise.' },
          {
            role: 'user', content:
              `Analyze the resume for ATS readiness and tailor it to the JD (if provided).
Return:
- Estimated match % (1 line)
- Top 15 missing or weak keywords (grouped by Skills / Tools / Responsibilities / Domain)
- 6 rewritten impact bullets aligned to the JD (quantified)
- A 2–3 line professional summary tailored to the role
${jdAll ? '\nJOB DESCRIPTION:\n"""' + jdAll + '"""' : '(No JD provided)'}
\nRESUME:\n"""${resumeAll}"""`
          }
        ]
      };

      // Output holder
      const out = document.createElement('pre');
      out.className = 'output';
      out.style.whiteSpace = 'pre-wrap';
      out.style.maxHeight = '40vh';
      out.style.overflow = 'auto';
      const holder = document.createElement('div');
      holder.className = 'card';
      holder.style.padding = '8px 10px';
      holder.style.marginTop = '8px';
      holder.appendChild(out);
      suggestions.parentElement.appendChild(holder);

      status.textContent = 'Contacting AI…';
      try {
        const res = await fetch('/ai', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
        if (!res.ok) throw new Error('AI HTTP ' + res.status);
        const reader = res.body.getReader(); const dec = new TextDecoder(); let acc = '';
        for (; ;) {
          const { value, done } = await reader.read(); if (done) break;
          const chunk = dec.decode(value);
          for (const raw of chunk.split('\n')) {
            const line = raw.trim(); if (!line || !line.startsWith('data:')) continue;
            const payload = line.slice(5).trim();
            if (payload === '[DONE]') { status.textContent = 'AI suggestions ready.'; return; }
            try {
              const json = JSON.parse(payload);
              const delta = json.choices?.[0]?.delta?.content ?? '';
              if (delta) { acc += delta; out.append(document.createTextNode(delta)); out.scrollTop = out.scrollHeight; }
              // Gemini streaming (fallback)
              const parts = json.candidates?.[0]?.delta?.parts || json.candidates?.[0]?.content?.parts || [];
              if (parts.length) { const txt = parts.map(p => p.text || '').join(''); if (txt) { acc += txt; out.append(document.createTextNode(txt)); out.scrollTop = out.scrollHeight; } }
            } catch { }
          }
        }
      } catch (e) {
        status.textContent = 'AI not available; please try again.';
        out.textContent = '\n(AI helper is not available right now.)';
      }
    }

    aiBtn.addEventListener('click', async () => {
      status.textContent = '';
      // Prefer pasted text if provided
      const pastedResume = resumeText.value.trim();
      const parsedResume = await parseFileToText(resumeFile.files?.[0]);
      const resumeAll = clean((pastedResume || parsedResume || ''));
      if (!resumeAll) { toast('Upload or paste your resume first'); return; }

      const jdTxtFile = await parseFileToText(jdFile.files?.[0]);
      const jdAll = clean((jdTxtFile || jdText.value || ''));
      await aiSuggest(resumeAll, jdAll);
    });

  </script>

  <!-- AdSense (async, end of body keeps TBT low) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6216304334889617"
    crossorigin="anonymous"></script>
</body>

</html>