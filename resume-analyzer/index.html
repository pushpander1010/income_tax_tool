<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Google Ads (reserved space; no CLS) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6216304334889617"
    crossorigin="anonymous"></script>
  <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
  <link rel="dns-prefetch" href="//pagead2.googlesyndication.com">

  <!-- Perf hints for CDN modules -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>AI Resume Analyzer & Job Matcher (Free ATS Resume Checker) | UpTools</title>

  <!-- SEO -->
  <meta name="description"
    content="Free AI Resume Analyzer ‚Äî get ATS score, missing skills, and bullet improvements. Paste resume + job description for match %, or run a standalone resume ATS check. Works with Perplexity, Google Gemini 2.5, and Groq via secure proxy." />
  <meta name="keywords"
    content="AI resume analyzer, ATS resume checker, free resume score, job match, resume optimization, missing skills, CV analyzer, parse resume pdf, pdf to text resume, applicant tracking system" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:large" />
  <meta name="theme-color" content="#0b1020" />

  <!-- Canonical / OG -->
  <link rel="canonical" href="https://www.uptools.in/resume-analyzer/" />
  <meta property="og:title" content="AI Resume Analyzer & Job Matcher ‚Äî Free ATS Resume Checker" />
  <meta property="og:description"
    content="Paste your resume & (optionally) job description. Get ATS score, missing keywords, and improvement tips instantly." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.uptools.in/resume-analyzer/" />
  <meta property="og:image" content="https://www.uptools.in/assets/og/ai-resume.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Favicons -->
  <link rel="icon" sizes="50x50" type="image/svg+xml" href="/assets/logo/uptools-logo.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/logo/uptools-logo.svg">

  <!-- Common CSS -->
  <link rel="preload" href="/style.css" as="style">
  <link rel="stylesheet" href="/style.css" media="print" onload="this.media='all'">
  <noscript>
    <link rel="stylesheet" href="/style.css">
  </noscript>

  <!-- Page-specific: MOBILE-SAFE, NO OVERLAP -->
  <style>
    :root {
      --gap: 14px;
      --rail-w: 1060px;
      --panel-h-desktop: min(72svh, 760px);
      --field-min-h: 160px;
      --output-min-h: 220px;
    }

    /* Rail & grid */
    main.ra {
      max-width: var(--rail-w);
      margin-inline: auto;
      padding: 12px var(--container-px, 12px)
    }

    .ra-grid {
      display: grid;
      grid-template-columns: 1.05fr .95fr;
      gap: var(--gap);
      align-items: start
    }

    /* Panels */
    .panel {
      display: flex;
      flex-direction: column;
      min-height: 420px
    }

    .panel-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 10px 12px
    }

    .panel-body {
      flex: 1;
      min-height: 0;
      /* allows children to size without overflow */
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: 10px;
      padding: 10px 12px
    }

    /* Common UI */
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px
    }

    .tiny {
      font-size: 12px;
      opacity: .85
    }

    .score {
      font-size: 2rem;
      font-weight: 900;
      color: var(--accent)
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
      height: 36px;
      border-radius: 9px;
      font-weight: 800
    }

    .hint {
      display: flex;
      gap: 8px;
      align-items: center
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--gap)
    }

    /* Inputs / outputs */
    textarea.input,
    pre.output {
      width: 100%;
      height: auto;
      /* avoid forced stretch that can cause overlap */
      min-height: var(--field-min-h);
      resize: vertical;
      padding: 10px 12px;
      line-height: 1.45;
      border-radius: 12px;
      overflow: auto;
      /* scroll instead of spilling over */
    }

    pre.output {
      white-space: pre-wrap;
      word-wrap: break-word;
      min-height: var(--output-min-h)
    }

    input.input,
    select.select {
      min-height: 40px
    }

    /* Clear Upload UX */
    .uploader {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px
    }

    .dz-col {
      display: grid;
      gap: 8px
    }

    .big-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      min-height: 48px
    }

    .dropzone {
      border: 1px dashed var(--card-border, #2b3340);
      border-radius: 12px;
      padding: 12px;
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: center;
      min-height: 68px
    }

    .dropzone[data-active="1"] {
      outline: 2px solid var(--accent);
      background: color-mix(in oklab, var(--accent) 12%, transparent)
    }

    /* Ad slot (no layout shift) */
    .ad-wrap {
      display: block;
      width: 100%;
      height: 100px;
      margin: 10px 0
    }

    .ad-empty {
      height: 100%;
      border-radius: 10px;
      background: var(--card-bg, #121821);
      display: flex;
      align-items: center;
      justify-content: center
    }

    .ad-empty .tiny {
      opacity: .55
    }

    /* Video: fixed box for CLS-free embed */
    .video-box {
      position: relative;
      width: 100%;
      max-width: var(--rail-w);
      height: 280px;
      border-radius: 12px;
      overflow: hidden
    }

    .video-box iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0
    }

    /* Help strip */
    .help-strip {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: center
    }

    .help-strip .points {
      display: flex;
      flex-wrap: wrap;
      gap: 6px
    }

    .help-strip .points .pill {
      white-space: nowrap
    }

    /* ====== MOBILE / SMALL TABLETS ====== */
    @media (max-width:1060px) {
      .ra-grid {
        grid-template-columns: 1fr
      }

      /* Let panels grow naturally to content to prevent overlap */
      .panel {
        min-height: unset
      }

      .panel-body {
        grid-template-rows: auto auto auto
      }
    }

    @media (max-width:820px) {
      .uploader {
        grid-template-columns: 1fr
      }

      .cards {
        grid-template-columns: repeat(2, 1fr)
      }

      .video-box {
        height: 220px
      }

      .ad-wrap {
        height: 90px
      }

      .row {
        grid-template-columns: 1fr
      }

      textarea.input,
      pre.output {
        min-height: 180px
      }

      .toolbar .select,
      .toolbar label {
        min-width: min(100%, 280px)
      }
    }

    @media (max-width:480px) {

      /* Compact controls; never overlap */
      .panel-head {
        flex-wrap: wrap
      }

      .toolbar {
        gap: 6px
      }

      .big-btn {
        min-height: 44px
      }

      .ad-wrap {
        height: 80px
      }

      .video-box {
        height: 200px
      }

      textarea.input,
      pre.output {
        min-height: 200px
      }

      .cards {
        grid-template-columns: 1fr
      }
    }

    /* ====== DESKTOP ONLY TWEAKS ====== */
    @media (min-width:1061px) {

      /* On desktop we provide a comfortable bounded height that still scrolls if needed */
      .panel {
        max-height: var(--panel-h-desktop)
      }

      .panel-body {
        overflow: auto
      }
    }
  </style>

  <!-- Structured data -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"SoftwareApplication","name":"UpTools AI Resume Analyzer","applicationCategory":"BusinessApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},"publisher":{"@type":"Organization","name":"UpTools","url":"https://www.uptools.in/"}}
  </script>
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[
    {"@type":"Question","name":"Is the resume analyzer free?","acceptedAnswer":{"@type":"Answer","text":"Yes. Free to use with generous limits. No sign-ups."}},
    {"@type":"Question","name":"Do you store my resume?","acceptedAnswer":{"@type":"Answer","text":"No. Text is processed via a server-side proxy; nothing is saved."}},
    {"@type":"Question","name":"Which AI models are supported?","acceptedAnswer":{"@type":"Answer","text":"Perplexity Sonar, Google Gemini 2.5 (Flash/Pro), and Groq (Llama/Mixtral/Gemma)."}},
    {"@type":"Question","name":"Can I upload a PDF resume?","acceptedAnswer":{"@type":"Answer","text":"Yes. Upload PDF and we extract text on-device using a lightweight PDF parser; then analyze."}},
    {"@type":"Question","name":"Can I analyze without a job description?","acceptedAnswer":{"@type":"Answer","text":"Yes. Leave the JD empty to run a standalone ATS-style quality check of your resume."}}
  ]}
  </script>
</head>

<body>
  <!-- Header -->
  <header class="site" role="banner">
    <div class="header-inner">
      <a class="brand" href="/" aria-label="UpTools Home">
        <img src="/assets/logo/uptools-logo.svg" alt="UpTools logo" width="28" height="28" loading="eager">
        <b>UpTools</b>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/#tools">Tools</a>
        <a href="/ai-writer/">AI Writer</a>
        <a aria-current="page" href="/resume-analyzer/">Resume Analyzer</a>
        <a href="/contact/">Contact</a>
      </nav>
    </div>
  </header>

  <main class="ra container" id="top">
    <section class="card hero" aria-labelledby="title">
      <div>
        <h1 id="title">AI Resume Analyzer (ATS Score) + Job Matcher</h1>
        <div class="help-strip">
          <p class="note">Upload your <b>Resume (PDF/TXT)</b> and <i class="tiny">(optional)</i> <b>Job Description</b>.
            If JD is empty, we‚Äôll run a resume-only ATS check with <b>ATS score</b>, <b>missing skills</b>, and
            <b>bullet fixes</b>.</p>
          <a class="chip" href="/sitemap.xml" aria-label="Sitemap">Sitemap</a>
        </div>
        <div class="points" style="margin-top:8px">
          <span class="pill">‚ö° ATS Score</span>
          <span class="pill">üìã Missing Skills</span>
          <span class="pill">üìù Better Bullets</span>
          <span class="pill">üîí Private</span>
        </div>
      </div>
    </section>

    <!-- Ad slot (no layout shift) -->
    <div id="ad-mount" class="ad-wrap">
      <div class="ad-empty"><span class="tiny">Ad space</span></div>
    </div>

    <section class="ra-grid" aria-label="Workspace">
      <!-- LEFT: INPUT -->
      <article class="panel card" aria-labelledby="left-title">
        <div class="panel-head">
          <h2 id="left-title" class="h4">Resume &amp; (Optional) Job Description</h2>
          <div class="toolbar">
            <label class="inline tiny">Chars: <output id="charCount">0</output></label>
            <button id="pasteBtn" class="btn sm" type="button" title="Paste clipboard">Paste</button>
            <button id="clearBtn" class="btn sm secondary" type="button">Clear</button>
          </div>
        </div>

        <div class="panel-body">
          <!-- CLEAR UPLOAD UX -->
          <div class="uploader" aria-label="Upload your resume">
            <div class="dz-col">
              <button class="btn big-btn" type="button" id="uploadResumeBtn" title="Upload Resume (PDF/TXT)">
                üìÑ Upload Resume (PDF / TXT)
              </button>
              <div id="drop" class="dropzone" aria-label="Or drag & drop resume here">
                <span class="tiny">Drag &amp; drop <b>resume.pdf</b> or <b>.txt</b> here</span>
              </div>
              <input id="fileIn" type="file" accept=".txt,.md,.pdf,application/pdf" hidden>
            </div>
            <div class="dz-col">
              <button class="btn big-btn secondary" type="button" id="uploadJDBtn"
                title="Upload Job Description (optional)">
                üìå Upload Job Description (Optional)
              </button>
              <input id="jdIn" type="file" accept=".txt,.md,.pdf,application/pdf" hidden>
              <div class="hint tiny" aria-hidden="true">Tip: Leave JD empty for a general ATS check.</div>
            </div>
          </div>

          <div class="progress" aria-hidden="true" style="display:none" id="pdfProgWrap">
            <div class="bar" id="pdfBar"></div>
          </div>

          <div class="row">
            <label class="inline">
              <span class="tiny">Target Role (optional)</span>
              <input id="role" class="input" placeholder="e.g., Data Scientist, Backend Engineer" />
            </label>
            <label class="inline">
              <span class="tiny">Years Experience (optional)</span>
              <input id="yoe" class="input" inputmode="numeric" placeholder="e.g., 3" />
            </label>
          </div>

          <div class="row">
            <label class="inline">
              <span class="tiny">Resume (required)</span>
              <textarea id="resume" class="input" placeholder="Paste your resume text here‚Ä¶"></textarea>
            </label>
            <label class="inline">
              <span class="tiny">Job Description (optional)</span>
              <textarea id="jd" class="input" placeholder="Paste job description here‚Ä¶ (or leave empty)"></textarea>
            </label>
          </div>

          <div class="toolbar">
            <button id="runBtn" class="btn" type="button">Analyze ‚ñ∂</button>

            <!-- Provider + Model selectors (wired like AI Writer) -->
            <label class="inline">
              <span class="tiny">Provider</span>
              <select id="provider" class="select" style="width:160px">
                <option value="perplexity">Perplexity</option>
                <option value="google">Google (Gemini)</option>
                <option value="groq">Groq</option>
              </select>
            </label>

            <label class="inline">
              <span class="tiny">Model</span>
              <select id="modelSel" class="select" style="width:220px"></select>
            </label>

            <button id="saveCfg" class="btn sm secondary" type="button" title="Save provider/model">Save</button>
          </div>
        </div>
      </article>

      <!-- RIGHT: OUTPUT -->
      <article class="panel card" aria-labelledby="right-title">
        <div class="panel-head">
          <h2 id="right-title" class="h4">Results</h2>
          <div class="toolbar">
            <button id="copyBtn" class="btn sm" type="button">Copy</button>
            <button id="downloadBtn" class="btn sm" type="button">Download .txt</button>
            <button id="permBtn" class="btn sm secondary" type="button" title="Create shareable link">Permalink</button>
            <button id="stopBtn" class="btn sm secondary" type="button" disabled>Stop</button>
          </div>
        </div>

        <div class="panel-body">
          <div class="row">
            <div>
              <div class="tiny">ATS Match Score</div>
              <div class="score" id="score">--%</div>
            </div>
            <div>
              <div class="tiny">Status</div>
              <div id="status" class="tiny" aria-live="polite"></div>
            </div>
          </div>

          <pre id="output" class="output" tabindex="0" aria-label="Analyzer output"></pre>

          <div class="row">
            <div>
              <h3 class="h5">What you get</h3>
              <ul class="list compact">
                <li><b>ATS %</b> extracted from analysis.</li>
                <li><b>Missing/weak keywords</b> (skills, tools, certs).</li>
                <li><b>Top 5 bullet improvements</b> with action & impact.</li>
              </ul>
            </div>
            <div class="card" style="display:flex;align-items:center;justify-content:space-between;gap:10px;">
              <span>Need rewrites? Try our <a class="chip" href="/ai-writer/">AI Writer</a>.</span>
              <span class="badge" aria-hidden="true">‚úçÔ∏è</span>
            </div>
          </div>
        </div>
      </article>
    </section>

    <!-- Helpful video (fixed box, CLS-safe) -->
    <section class="spaced" aria-labelledby="video-help">
      <h2 id="video-help" class="h5">How to tailor your resume for ATS</h2>
      <div class="video-box" role="region" aria-label="Video: resume tailoring for ATS">
        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/M5sNp-7bvx4?si=PyJ2Dp-enr9u_bJp"
          title="YouTube video player" frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
      </div>
    </section>

    <!-- Internal links (SEO) -->
    <section class="spaced" aria-labelledby="related">
      <h2 id="related" class="h5">More from UpTools</h2>
      <div class="cards">
        <a class="card card-link" href="/qr-generator/" aria-label="QR Code Generator">
          <span>QR Code Generator</span><span class="badge" aria-hidden="true">QR</span>
        </a>
        <a class="card card-link" href="/image-converter/" aria-label="Image Converter">
          <span>Image Converter</span><span class="badge" aria-hidden="true">IC</span>
        </a>
        <a class="card card-link" href="/bmi-calculator/" aria-label="BMI Calculator">
          <span>BMI Calculator</span><span class="badge" aria-hidden="true">BMI</span>
        </a>
        <a class="card card-link" href="/ifsc-finder/" aria-label="IFSC Finder">
          <span>IFSC Finder</span><span class="badge" aria-hidden="true">IF</span>
        </a>
      </div>
    </section>

    <footer class="site-footer" style="text-align:center">
      <p class="tiny">¬© <span id="y"></span> UpTools ¬∑ <a href="/privacy/">Privacy</a> ¬∑ <a href="/about/">About</a></p>
    </footer>
  </main>

  <!-- Static import of shared utils (COMMON ACROSS SITE) -->
  <script type="module">
    /*
      This page uses a STATIC ES import for project utilities.
      Absolute path ensures Vite + Cloudflare consistency.
    */
    import { $, $$, debounce, setText, persist, read } from '/scripts/utils.js';

    // Lazy PDF.js (only when needed)
    let pdfjsLib = null;
    async function ensurePdfLib() {
      if (pdfjsLib) return pdfjsLib;
      pdfjsLib = await import('https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/build/pdf.mjs');
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@4.6.82/build/pdf.worker.mjs';
      return pdfjsLib;
    }

    // DOM refs
    const score = $('#score'), output = $('#output'), status = $('#status');
    const resume = $('#resume'), jd = $('#jd'), role = $('#role'), yoe = $('#yoe');

    const runBtn = $('#runBtn'), stopBtn = $('#stopBtn');
    const pasteBtn = $('#pasteBtn'), clearBtn = $('#clearBtn');
    const fileIn = $('#fileIn'), jdIn = $('#jdIn');
    const drop = $('#drop'), uploadResumeBtn = $('#uploadResumeBtn'), uploadJDBtn = $('#uploadJDBtn');
    const progWrap = $('#pdfProgWrap'), progBar = $('#pdfBar');

    const copyBtn = $('#copyBtn'), downloadBtn = $('#downloadBtn'), permBtn = $('#permBtn');
    const saveCfg = $('#saveCfg'), charCount = $('#charCount');

    const providerSel = $('#provider'), modelSel = $('#modelSel');

    $('#y').textContent = new Date().getFullYear();

    // Provider + Models
    const PROVIDER_MODELS = {
      perplexity: [
        { id: 'sonar', label: 'sonar' },
        { id: 'sonar-pro', label: 'sonar-pro' },
        { id: 'sonar-reasoning', label: 'sonar-reasoning' }
      ],
      google: [
        { id: 'gemini-2.5-flash', label: 'gemini-2.5-flash' },
        { id: 'gemini-2.5-pro', label: 'gemini-2.5-pro' }
      ],
      groq: [
        { id: 'llama-3.1-8b-instant', label: 'llama-3.1-8b-instant' },
        { id: 'llama-3.1-70b-versatile', label: 'llama-3.1-70b-versatile' },
        { id: 'mixtral-8x7b-32768', label: 'mixtral-8x7b-32768' },
        { id: 'gemma2-9b-it', label: 'gemma2-9b-it' }
      ]
    };

    // Config (persist locally)
    const CFG_KEY = 'resume-analyzer:cfg';
    const cfg = Object.assign({ provider: 'google', model: 'gemini-2.5-flash' }, read(CFG_KEY, {}));
    providerSel.value = cfg.provider;
    populateModels();
    if (cfg.model) modelSel.value = cfg.model;

    function populateModels() {
      const prov = providerSel.value || 'google';
      const models = PROVIDER_MODELS[prov] || [];
      modelSel.innerHTML = '';
      for (const m of models) {
        const opt = document.createElement('option');
        opt.value = m.id; opt.textContent = m.label;
        modelSel.appendChild(opt);
      }
      if (!models.some(m => m.id === cfg.model)) modelSel.value = models[0]?.id || '';
    }
    providerSel.addEventListener('change', () => { cfg.provider = providerSel.value; populateModels(); });
    saveCfg.addEventListener('click', () => {
      const next = { provider: providerSel.value, model: modelSel.value };
      persist(CFG_KEY, next);
      toast('Settings saved');
    });

    // Character counter
    const updateCount = () => {
      const len = (resume.value + jd.value).length;
      setText(charCount, len.toLocaleString());
    };
    resume.addEventListener('input', debounce(updateCount, 80));
    jd.addEventListener('input', debounce(updateCount, 80));
    updateCount();

    // Clipboard paste
    pasteBtn.addEventListener('click', async () => {
      try {
        const txt = await navigator.clipboard.readText();
        if (!resume.value) resume.value = txt; else jd.value = txt;
        updateCount();
      } catch { toast('Clipboard blocked'); }
    });

    clearBtn.addEventListener('click', () => {
      resume.value = ''; jd.value = ''; role.value = ''; yoe.value = '';
      setText(score, '--%'); setText(output, ''); setText(status, '');
      updateCount();
    });

    // Upload buttons
    uploadResumeBtn.addEventListener('click', () => fileIn.click());
    uploadJDBtn.addEventListener('click', () => jdIn.click());

    // File inputs
    fileIn.addEventListener('change', (e) => handleFiles(e.target.files, 'resume'));
    jdIn.addEventListener('change', (e) => handleFiles(e.target.files, 'jd'));

    // Drag & drop
    ['dragenter', 'dragover'].forEach(ev => drop.addEventListener(ev, (e) => { e.preventDefault(); drop.dataset.active = '1' }));
    ['dragleave', 'drop'].forEach(ev => drop.addEventListener(ev, (e) => { e.preventDefault(); drop.dataset.active = '0' }));
    drop.addEventListener('drop', (e) => handleFiles(e.dataTransfer?.files, 'resume'));

    async function handleFiles(fileList, target) {
      const f = fileList?.[0]; if (!f) return;
      const ext = (f.name.split('.').pop() || '').toLowerCase();
      const targetEl = target === 'jd' ? jd : resume;
      if (ext === 'pdf' || f.type === 'application/pdf') {
        await importPdfIntoTextarea(f, targetEl);
      } else {
        const txt = await f.text();
        targetEl.value = (targetEl.value ? (targetEl.value.trim() + '\n\n') : '') + txt.trim();
        updateCount();
      }
      // Auto focus the filled field for clarity on mobile
      targetEl.focus();
    }

    // PDF -> text (lazy)
    async function importPdfIntoTextarea(file, targetEl) {
      try {
        setText(status, `Reading ${file.name}‚Ä¶`);
        progWrap.style.display = 'block'; setProgress(8);
        const { getDocument } = await ensurePdfLib();
        const data = await file.arrayBuffer(); setProgress(18);
        const task = getDocument({ data });
        const pdf = await task.promise; setProgress(24);
        let full = '';
        for (let p = 1; p <= pdf.numPages; p++) {
          const page = await pdf.getPage(p);
          const content = await page.getTextContent();
          const text = content.items.map(i => i.str).join(' ');
          full += text + '\n\n';
          setProgress(Math.min(24 + Math.floor((p / pdf.numPages) * 72), 96));
          await new Promise(r => setTimeout(r, 0));
        }
        targetEl.value = (targetEl.value ? (targetEl.value.trim() + '\n\n') : '') + full.trim();
        updateCount();
        setProgress(100);
        setText(status, `Imported ${pdf.numPages} page(s) from PDF.`);
      } catch (err) {
        console.error(err);
        setText(status, 'PDF read failed. Try another file or copy-paste text.');
      } finally {
        setTimeout(() => { progWrap.style.display = 'none'; setProgress(0); }, 500);
      }
    }
    function setProgress(pct) { progBar.style.width = (pct || 0) + '%'; }

    // Streaming via /ai
    let aborter = null;
    async function streamChat({ provider, model, messages }) {
      aborter = new AbortController();
      const res = await fetch('/ai', {
        method: 'POST',
        signal: aborter.signal,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ provider, model, stream: true, temperature: 0.35, messages })
      });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const reader = res.body.getReader();
      const dec = new TextDecoder();
      let acc = '';
      for (; ;) {
        const { value, done } = await reader.read();
        if (done) break;
        const chunk = dec.decode(value);
        for (const line of chunk.split('\n')) {
          const t = line.trim();
          if (!t || !t.startsWith('data:')) continue;
          const payload = t.slice(5).trim();
          if (payload === '[DONE]') { aborter = null; return acc; }
          try {
            const json = JSON.parse(payload);
            const delta = json.choices?.[0]?.delta?.content ?? '';
            if (delta) { acc += delta; output.textContent += delta; }
          } catch { }
        }
      }
      aborter = null;
      return acc;
    }

    stopBtn.addEventListener('click', () => {
      if (aborter) { aborter.abort(); aborter = null; stopBtn.disabled = true; setText(status, 'Stopped.'); }
    });

    // Prompts (JD optional)
    function buildPromptWithJD(r, j, targ, years) {
      return `Compare the following resume with the job description and return:
1) ATS Match % (a number followed by % on its own line)
2) Missing/weak keywords (comma-separated)
3) Top 5 resume bullet improvements (concise; action, impact, metrics)
4) Optional: a 1‚Äì2 line tailored summary sentence

${targ ? `Target Role: ${targ}\n` : ''}${years ? `Years Experience: ${years}\n` : ''}---
RESUME:
${r}

---
JOB DESCRIPTION:
${j}
`;
    }
    function buildPromptResumeOnly(r, targ, years) {
      return `Perform a standalone ATS-style review of this resume. Output strictly in the format below:
1) ATS Match % (estimated vs common requirements for the target role or typical job in the field)
2) Missing/weak keywords (comma-separated, prioritize high-signal skills, tools, certifications)
3) Top 5 bullet improvements (each: action + impact + metric if possible)
4) A 1‚Äì2 line professional summary tailored to the role

${targ ? `Target Role: ${targ}\n` : ''}${years ? `Years Experience: ${years}\n` : ''}---
RESUME:
${r}
`;
    }

    // Run
    runBtn.addEventListener('click', async () => {
      const r = resume.value.trim();
      const j = jd.value.trim();
      if (!r) { toast('Please add your resume first'); return; }

      const provider = providerSel.value || 'google';
      const model = modelSel.value || 'gemini-2.5-flash';
      if (!model) { toast('Pick a model'); return; }

      output.textContent = '';
      stopBtn.disabled = false; setText(status, 'Analyzing‚Ä¶'); setText(score, '‚Ä¶');

      try {
        const withJD = !!j;
        const sys = withJD
          ? 'You are an experienced ATS resume analyzer. Be precise, structured, and concise.'
          : 'You are an experienced ATS resume analyzer. When no JD is provided, infer typical expectations for the target role and provide a credible ATS-style score and advice.';

        const userPrompt = withJD
          ? buildPromptWithJD(r, j, (role.value || '').trim(), (yoe.value || '').trim())
          : buildPromptResumeOnly(r, (role.value || '').trim(), (yoe.value || '').trim());

        const full = await streamChat({
          provider, model,
          messages: [
            { role: 'system', content: sys },
            { role: 'user', content: userPrompt }
          ]
        });

        const m = full.match(/(\b\d{2,3})\s*%/);
        setText(score, (m ? m[1] : 72) + '%');
        setText(status, withJD ? 'Done (JD match).' : 'Done (resume-only ATS).');
      } catch (e) {
        console.error(e);
        setText(status, 'Error. Check console & settings.');
        setText(score, '--%');
      } finally {
        stopBtn.disabled = true;
      }
    });

    // Copy / Download / Permalink
    copyBtn.addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(output.textContent || ''); toast('Copied'); }
      catch { toast('Copy blocked'); }
    });
    downloadBtn.addEventListener('click', () => {
      const blob = new Blob([output.textContent || ''], { type: 'text/plain;charset=utf-8' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = 'resume-analysis.txt'; a.click();
      URL.revokeObjectURL(a.href);
    });
    permBtn.addEventListener('click', async () => {
      const o = { p: providerSel.value, m: modelSel.value };
      const url = new URL(location.href); url.hash = encodeURIComponent(btoa(JSON.stringify(o)));
      try { await navigator.clipboard.writeText(url.toString()); toast('Permalink copied'); }
      catch { history.replaceState({}, '', url); toast('Permalink ready in address bar'); }
    });

    // Restore settings from hash
    (function restoreFromHash() {
      if (!location.hash) return;
      try {
        const o = JSON.parse(atob(decodeURIComponent(location.hash.slice(1))));
        if (o?.p) providerSel.value = o.p;
        populateModels();
        if (o?.m) modelSel.value = o.m;
      } catch { }
    })();

    // Mount ad (no layout jump)
    (function mountAd() {
      if (!('adsbygoogle' in window)) return;
      const mount = document.getElementById('ad-mount');
      mount.innerHTML = `
        <ins class="adsbygoogle"
             style="display:block;width:100%;height:100%"
             data-ad-client="ca-pub-6216304334889617"
             data-ad-slot="auto"
             data-full-width-responsive="true"></ins>`;
      try { (window.adsbygoogle = window.adsbygoogle || []).push({}); } catch { }
    })();

    // Tiny toast
    function toast(msg) { setText(status, msg); setTimeout(() => { if (status.textContent === msg) setText(status, ''); }, 1600); }
  </script>
</body>

</html>