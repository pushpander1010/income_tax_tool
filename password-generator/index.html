<!doctype html>
<html lang="en">

<head>
  <!-- Ads (async to avoid CLS) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6216304334889617" crossorigin="anonymous"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Password Generator (Strong & Memorable) - UpTools</title>
  <meta name="description" content="Create strong passwords and memorable passphrases. Local encrypted Vault with PIN, labels, search, export/import. Entropy meter, batch generator, copy, mask, and more. Free & privacy-first." />
  <meta name="keywords" content="password generator, strong password, passphrase, entropy, secure password, AES-GCM, local vault, offline password tool, UpTools" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:large" />
  <meta name="theme-color" content="#0b1020" />
  <link rel="canonical" href="https://www.uptools.in/password-generator/" />

  <!-- Favicons -->
  <link rel="icon" sizes="50x50" type="image/svg+xml" href="/assets/logo/uptools-logo.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/logo/uptools-logo.svg">

  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="Password Generator (Strong & Memorable) - UpTools" />
  <meta property="og:description" content="Generate strong passwords and passphrases. Save locally in an encrypted Vault with your PIN. Copy, mask, batch, entropy & crack-time estimate. No tracking." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.uptools.in/password-generator/" />
  <meta property="og:site_name" content="UpTools" />
  <meta property="og:image" content="/assets/og/password-generator.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Performance hints -->
  <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
  <link rel="dns-prefetch" href="//pagead2.googlesyndication.com">

  <!-- Common CSS -->
  <link rel="preload" href="/style.css?v=1.2.1" as="style">
  <link rel="stylesheet" href="/style.css?v=1.2.1" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="/style.css?v=1.2.1"></noscript>

  <!-- Page-scoped styles -->
  <style>
    .tool-grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width: 920px){.tool-grid{grid-template-columns:1.15fr .85fr}}
    .stack{display:grid;gap:10px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .grow{flex:1 1 auto}
    .result-wrap{display:grid;gap:8px}
    .result{font:600 16px/1.4 ui-monospace,Menlo,Consolas,monospace;letter-spacing:.2px;padding:10px 12px;border-radius:10px;user-select:all;overflow-wrap:anywhere;min-height:42px}
    .meter{height:8px;border-radius:999px;overflow:hidden;background:var(--bg2,#1a1f2e)}
    .meter>i{display:block;height:100%;width:0%;transition:width .25s ease}
    .hint{font-size:.9rem;opacity:.85}
    .options-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media (min-width:720px){.options-grid{grid-template-columns:repeat(4,minmax(0,1fr))}}
    .yt-wrap{aspect-ratio:16/9;width:100%;max-width:720px;border-radius:12px;overflow:hidden;margin-inline:auto}
    .yt-wrap iframe{width:100%;height:100%;display:block}
    .kbd{padding:2px 6px;border-radius:6px;border:1px solid var(--line,#2b3142);font:600 12px/1 ui-monospace,monospace}
    .two-col{display:grid;gap:12px;grid-template-columns:1fr}
    @media (min-width: 720px){.two-col{grid-template-columns:1fr 1fr}}
    .badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line,#2b3142);padding:6px 10px;border-radius:999px}
    .notice{padding:8px 10px;border-radius:8px;border:1px dashed var(--line,#2b3142)}
    /* Vault */
    .vault-grid{display:grid;gap:10px}
    .vault-row{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center}
    .vault-row .mono{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:45vw}
    @media (min-width: 920px){.vault-row .mono{max-width:28vw}}
    .pill.sec{background:#0b1326;border:1px solid var(--border)}
    .btn.icon{min-width:36px;padding:6px 8px}
    .btn.sm{padding:6px 10px}
    .sr{position:absolute;left:-9999px}
    dialog.vault-modal{border:1px solid var(--border);border-radius:12px;max-width:520px;width:min(92vw,520px);background:color-mix(in oklab,var(--card) 95%,transparent);box-shadow:var(--shadow),var(--glow-soft)}
    dialog.vault-modal::backdrop{background:rgba(0,0,0,.45)}
    .hr{height:1px;background:color-mix(in oklab,var(--accent) 25%, #243);margin:10px 0}
    .micro-links{display:inline-flex;gap:8px;margin-left:8px}
    .linkbtn{background:none;border:none;padding:0;color:var(--link,#8ab4ff);cursor:pointer;font:600 12px/1.2 ui-sans-serif,system-ui}
    .linkbtn:focus{outline:2px dashed var(--line,#2b3142);outline-offset:2px;border-radius:4px}
  </style>

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"UpTools Password Generator",
    "applicationCategory":"SecurityApplication",
    "operatingSystem":"Any",
    "url":"https://www.uptools.in/password-generator/",
    "description":"Create strong passwords and memorable passphrases. Save locally in an encrypted Vault with your PIN. Copy, entropy meter, batch generate.",
    "publisher":{"@type":"Organization","name":"UpTools","url":"https://www.uptools.in"},
    "offers":{"@type":"Offer","price":"0","priceCurrency":"INR"}
  }
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"Is this password generator secure?","acceptedAnswer":{"@type":"Answer","text":"Yes. It uses the browser's cryptographically secure random generator (window.crypto.getRandomValues). Nothing is sent to any server. The optional Vault encrypts entries locally with AES-GCM using a PIN-derived key (PBKDF2)."}},
      {"@type":"Question","name":"What password length is recommended?","acceptedAnswer":{"@type":"Answer","text":"We suggest 16-24 characters with upper+lower+digits+symbols, or a 4-6 word passphrase with a separator and a number."}},
      {"@type":"Question","name":"Where are saved passwords stored?","acceptedAnswer":{"@type":"Answer","text":"Only in your browser's local storage, encrypted with AES-GCM using your Vault PIN. You can export or clear them anytime."}}
    ]
  }
  </script>

</head>

<body>
  <!-- Header -->
  <header class="site" role="banner">
    <div class="header-inner">
      <a class="brand" href="/" aria-label="UpTools Home">
        <img src="/assets/logo/uptools-logo.svg" alt="UpTools logo" width="28" height="28" loading="eager">
        <b>UpTools</b>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/#tools">Tools</a>
        <a href="/income-tax-tool/">Income Tax</a>
        <a href="/emi-calculator/">EMI</a>
        <a href="/gst-calculator/">GST</a>
      </nav>
    </div>
  </header>

  <main class="wrap" id="main">
    <!-- Hero -->
    <section class="card hero" aria-labelledby="pg-title">
      <div class="two-col">
        <div>
          <h1 id="pg-title">Password Generator + Local Encrypted Vault</h1>
        <p class="note">Create <strong>strong passwords</strong> and <strong>memorable passphrases</strong>. Save them locally in an <b>encrypted Vault</b> protected by your PIN. Nothing leaves your browser.</p>
          <div class="chips" style="margin-top:8px">
            <span class="pill">üîê Secure RNG</span>
            <span class="pill">üß† Entropy & crack-time</span>
            <span class="pill">üì¶ Batch list</span>
            <span class="pill">üóÑÔ∏è Encrypted Vault</span>
            <a class="chip" href="/uuid-generator/">UUID</a>
            <a class="chip" href="/base64-encoder/">Base64</a>
          </div>
        </div>
        <div class="yt-wrap" aria-label="How to make strong passwords (video)">
          <iframe width="100%" height="100%" src="https://www.youtube.com/embed/3f0u-vw58A0?rel=0"
            title="Create strong passwords & passphrases" frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin" loading="lazy" allowfullscreen></iframe>
        </div>
      </div>
    </section>

    <!-- Tool -->
    <section class="tool-grid" aria-label="Password and passphrase generator">
      <!-- Left: Strong password -->
      <div class="card" id="password-card">
        <h2 class="h3">Strong Password</h2>
        <div class="stack">
          <div class="row">
            <label for="len" class="label">Length</label>
            <input id="len" class="input" type="number" min="6" max="64" value="16" inputmode="numeric" style="max-width:110px">
            <input id="lenRange" class="range grow" type="range" min="6" max="64" value="16" aria-label="Length slider">
          </div>

          <div class="options-grid">
            <label class="check"><input id="lc" type="checkbox" checked> <span>Lowercase</span></label>
            <label class="check"><input id="uc" type="checkbox" checked> <span>Uppercase</span></label>
            <label class="check"><input id="dg" type="checkbox" checked> <span>Digits</span></label>
            <label class="check"><input id="sc" type="checkbox"> <span>Symbols</span></label>
            <label class="check"><input id="ns" type="checkbox"> <span>Exclude similar (O0l1I)</span></label>
            <label class="check"><input id="reqAll" type="checkbox" checked> <span>Require all selected types</span></label>
            <label class="check"><input id="amb" type="checkbox"> <span>Only unambiguous symbols</span></label>
            <label class="check"><input id="startL" type="checkbox"> <span>Start with a letter</span></label>
          </div>

          <div class="row">
            <button id="gen" class="btn">Generate</button>
            <button id="shuffle" class="btn ghost">Regenerate</button>
            <button id="copy" class="btn">Copy</button>
            <button id="toggle" class="btn ghost" aria-pressed="false" aria-controls="out">Show</button>
            <button id="savePwd" class="btn secondary">Save to Vault</button>
          </div>

          <div class="result-wrap">
            <output id="out" class="result card tone-mono" aria-live="polite" aria-label="Generated password"></output>
            <div class="meter" aria-hidden="true"><i id="meterFill"></i></div>
            <div class="row">
              <div id="entropy" class="hint mono">Entropy: -</div>
              <div id="est" class="hint">Crack time: -</div>
            </div>
          </div>

          <details>
            <summary class="hint">Batch generate</summary>
            <div class="row" style="margin-top:8px">
              <label for="batchCount" class="label">Count</label>
              <input id="batchCount" class="input" type="number" min="2" max="50" value="10" style="max-width:100px">
              <button id="batchGen" class="btn">Generate List</button>
              <button id="batchCopy" class="btn ghost">Copy List</button>
              <button id="batchSave" class="btn secondary">Save List to Vault</button>
            </div>
            <textarea id="batchOut" class="input mono" rows="6" readonly placeholder="Generated passwords will appear here"></textarea>
          </details>

          <label class="check">
            <input id="rememberLast" type="checkbox"> <span>Save last password on this device</span>
          </label>
          <div id="saveNotice" class="notice hint" hidden>
            Saved locally. You can clear it anytime.
            <span class="micro-links" aria-live="polite" id="localLinks" hidden>
              <button id="localReveal" class="linkbtn" type="button">Reveal</button>
              <button id="localCopy" class="linkbtn" type="button">Copy</button>
              <button id="localClear" class="linkbtn" type="button">Clear</button>
            </span>
          </div>
        </div>
      </div>

      <!-- Right: Passphrase -->
      <div class="card" id="phrase-card">
        <h2 class="h3">Memorable Passphrase</h2>
        <div class="stack">
          <div class="row">
            <label for="words" class="label">Words</label>
            <input id="words" class="input" type="number" min="3" max="12" value="4" style="max-width:100px">
            <label for="sep" class="label">Separator</label>
            <input id="sep" class="input" type="text" value="-" maxlength="3" style="max-width:70px">
            <label class="check"><input id="capWords" type="checkbox"> <span>Capitalize</span></label>
            <label class="check"><input id="addNum" type="checkbox" checked> <span>Add number</span></label>
          </div>

          <div class="row">
            <button id="phraseGen" class="btn">Generate Passphrase</button>
            <button id="phraseCopy" class="btn">Copy</button>
            <button id="savePhrase" class="btn secondary">Save to Vault</button>
          </div>

          <output id="phraseOut" class="result card tone-mono" aria-live="polite" aria-label="Generated passphrase"></output>
          <div class="meter" aria-hidden="true"><i id="meterFill2"></i></div>
          <div class="hint mono" id="phraseEntropy">Entropy: -</div>
        </div>
      </div>
    </section>

    <!-- Vault -->
    <section id="vault" class="card" aria-labelledby="vault-title">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2 id="vault-title" class="h4" style="margin:0">üîí Encrypted Vault (Local)</h2>
        <div class="row">
          <button id="vaultLock" class="btn ghost sm">Lock</button>
          <button id="vaultUnlock" class="btn ghost sm">Unlock</button>
          <button id="vaultSetPin" class="btn ghost sm">Set/Change PIN</button>
          <button id="vaultExport" class="btn ghost sm">Export</button>
          <label class="btn ghost sm" style="cursor:pointer">
            Import <input id="vaultImport" type="file" accept="application/json" class="sr">
          </label>
          <!-- NEW: Delete Vault -->
          <button id="vaultDelete" class="btn ghost sm" aria-describedby="delHelp">Delete Vault</button>
          <span id="delHelp" class="sr">Deletes all saved items from this browser.</span>
        </div>
      </div>

      <div class="row" style="margin-top:8px">
        <input id="vaultSearch" class="input grow" type="search" placeholder="Search by site/label‚Ä¶">
        <span class="badge pill sec">Stored: <b id="vaultCount">0</b></span>
      </div>

      <div id="vaultList" class="vault-grid" role="list" aria-live="polite">
        <p class="note" id="vaultEmpty">Your Vault is empty (or locked). Generate a password and click <b>Save to Vault</b>.</p>
      </div>
    </section>

    <!-- Helpful links -->
    <section class="card" aria-labelledby="tips-title">
      <h2 id="tips-title" class="h4">Tips</h2>
      <ul class="list">
        <li>Use at least <b>16+ characters</b> or a <b>4-6 word</b> passphrase.</li>
        <li>Prefer a <span class="kbd">Password Manager</span> for long-term storage; avoid reuse across sites.</li>
        <li>Enable <b>2-factor authentication</b> wherever possible.</li>
      </ul>
      <div class="chips" style="margin-top:8px">
        <a class="chip" href="/random-string/">Random String</a>
        <a class="chip" href="/uuid-generator/">UUID Generator</a>
        <a class="chip" href="/json-formatter/">JSON Formatter</a>
        <a class="chip" href="/ifsc-finder/">IFSC Finder</a>
      </div>
    </section>

    <!-- Google Ad slot (stable space to avoid CLS) -->
    <section class="card">
      <ins class="adsbygoogle"
           style="display:block;min-height:120px"
           data-ad-client="ca-pub-6216304334889617"
           data-ad-slot="9651757525"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
    </section>

    <footer class="site-foot">
      <nav class="nav-links small">
        <a href="/">UpTools</a> ¬∑
        <a href="/sitemap.xml">Sitemap</a> ¬∑
        <a href="/about/">ABT</a> ¬∑
        <a href="/contact/">CT</a>
      </nav>
      <div class="note small">Made with care. Privacy-first, no sign-ups.</div>
    </footer>

  </main>

  <!-- Modal: Save to Vault -->
  <dialog id="saveModal" class="vault-modal">
    <form id="svForm" method="dialog" class="card" style="margin:0">
      <h3 style="margin:0 0 6px">Save to Vault</h3>
      <p class="note" style="margin:0 0 8px">Entry is encrypted locally with your Vault PIN.</p>
      <label class="label" for="svSite">Site / Label</label>
      <input id="svSite" class="input" placeholder="e.g., email / example.com" required>
      <label class="label" for="svUser">Username (optional)</label>
      <input id="svUser" class="input" placeholder="e.g., you@email.com">
      <label class="label" for="svValue">Value</label>
      <input id="svValue" class="input mono" required>
      <div class="hr"></div>
      <div class="row" style="justify-content:flex-end">
        <button value="cancel" class="btn secondary" type="button" id="svCancel">Cancel</button>
        <button id="svSubmit" class="btn" type="submit">Save</button>
      </div>
    </form>
  </dialog>

  <!-- Modal: Unlock / Set PIN -->
  <dialog id="pinModal" class="vault-modal" aria-labelledby="pinTitle">
    <form id="pinForm" method="dialog" class="card" style="margin:0">
      <h3 id="pinTitle" style="margin:0 0 6px">Unlock Vault</h3>
      <p id="pinMsg" class="note" style="margin:0 0 8px">Enter your Vault PIN to decrypt saved items.</p>
      <label class="label" for="pinInput">Vault PIN</label>
      <input id="pinInput" class="input" type="password" inputmode="numeric" autocomplete="current-password" placeholder="4-32 characters" required>
      <div class="hr"></div>
      <div class="row" style="justify-content:flex-end">
        <button class="btn secondary" type="button" id="pinCancel">Cancel</button>
        <button id="pinSubmit" class="btn" type="submit">Continue</button>
      </div>
    </form>
  </dialog>

  <!-- Shared helpers + page script -->
  <script type="module" src="/scripts/utils.js"></script>

  <script type="module">
    // ====== Utilities ======
    const cryptoObj = (window.crypto || window.msCrypto);
    const U = {
      copy: async (text) => { try { await navigator.clipboard.writeText(text); toast('Copied'); } catch { fallbackCopy(text); toast('Copied'); } },
      saveLocal: (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} },
      readLocal: (k) => { try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : null; } catch { return null } },
      rmLocal: (k) => { try { localStorage.removeItem(k); } catch {} }
    };
    function fallbackCopy(text){ const t=document.createElement('textarea'); t.value=text; t.style.position='fixed'; t.style.top='-2000px'; document.body.appendChild(t); t.select(); try{document.execCommand('copy');}finally{t.remove();} }
    function toast(msg){
      const n=document.createElement('div');
      n.className='toast';
      Object.assign(n.style,{position:'fixed',left:'50%',bottom:'16px',transform:'translateX(-50%)',padding:'8px 12px',borderRadius:'999px',backdropFilter:'blur(3px)',border:'1px solid var(--line,#2b3142)',zIndex:'9999',opacity:'0',transition:'opacity .2s ease'});
      n.textContent=msg; document.body.appendChild(n);
      requestAnimationFrame(()=>n.style.opacity='1'); setTimeout(()=>{n.style.opacity='0'; setTimeout(()=>n.remove(),250);},1200);
    }
    const clamp = (v,min,max)=>Math.min(max,Math.max(min,v));
    const q = (s, r=document)=> r.querySelector(s);

    // ====== DOM ======
    const els = {
      len: q('#len'), lenRange:q('#lenRange'),
      lc:q('#lc'), uc:q('#uc'), dg:q('#dg'), sc:q('#sc'),
      ns:q('#ns'), reqAll:q('#reqAll'), amb:q('#amb'), startL:q('#startL'),
      out:q('#out'), gen:q('#gen'), shuffle:q('#shuffle'), copy:q('#copy'), toggle:q('#toggle'),
      meterFill:q('#meterFill'), entropy:q('#entropy'), est:q('#est'),
      batchCount:q('#batchCount'), batchGen:q('#batchGen'), batchCopy:q('#batchCopy'), batchOut:q('#batchOut'), batchSave:q('#batchSave'),
      rememberLast:q('#rememberLast'), saveNotice:q('#saveNotice'), localLinks:q('#localLinks'),
      localReveal:q('#localReveal'), localCopy:q('#localCopy'), localClear:q('#localClear'),
      // passphrase
      words:q('#words'), sep:q('#sep'), capWords:q('#capWords'), addNum:q('#addNum'),
      phraseGen:q('#phraseGen'), phraseCopy:q('#phraseCopy'), phraseOut:q('#phraseOut'), meterFill2:q('#meterFill2'), phraseEntropy:q('#phraseEntropy'),
      // vault
      savePwd:q('#savePwd'), savePhrase:q('#savePhrase'),
      vault:q('#vault'), vaultList:q('#vaultList'), vaultCount:q('#vaultCount'), vaultSearch:q('#vaultSearch'), vaultEmpty:q('#vaultEmpty'),
      vaultExport:q('#vaultExport'), vaultImport:q('#vaultImport'), vaultLock:q('#vaultLock'), vaultSetPin:q('#vaultSetPin'),
      vaultUnlock:q('#vaultUnlock'), vaultDelete:q('#vaultDelete'),
      // modals
      saveModal:q('#saveModal'), svForm:q('#svForm'), svSite:q('#svSite'), svUser:q('#svUser'), svValue:q('#svValue'), svSubmit:q('#svSubmit'), svCancel:q('#svCancel'),
      pinModal:q('#pinModal'), pinForm:q('#pinForm'), pinTitle:q('#pinTitle'), pinMsg:q('#pinMsg'), pinInput:q('#pinInput'), pinSubmit:q('#pinSubmit'), pinCancel:q('#pinCancel')
    };

    // ====== Character pools ======
    const POOLS = {
      lc:'abcdefghijklmnopqrstuvwxyz',
      uc:'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
      dg:'0123456789',
      symAll:`!@#$%^&*()-_=+[]{};:,.<>?/\\|~\`'"`,
      symUnamb:'!@#$%^&*+=?.-_',
      similarRX:/[O0l1I]/g
    };

    // ====== RNG helpers ======
    function secureInts(n, max){ const out=new Uint32Array(n); cryptoObj.getRandomValues(out); if(max){ for(let i=0;i<n;i++) out[i]=out[i]%max; } return out; }
    function shuffleArray(arr){ for(let i=arr.length-1;i>0;i--){ const j=secureInts(1,i+1)[0]; [arr[i],arr[j]]=[arr[j],arr[i]] } return arr; }

    // ====== Password generation ======
    function getPool(opts){
      let pool=''; if(opts.lc) pool+=POOLS.lc; if(opts.uc) pool+=POOLS.uc; if(opts.dg) pool+=POOLS.dg; if(opts.sc) pool+=(opts.amb?POOLS.symUnamb:POOLS.symAll);
      if(opts.ns) pool=pool.replace(POOLS.similarRX,''); return pool;
    }
    function genPassword(){
      const length=clamp(Number(els.len.value||16),6,64);
      const opts={lc:els.lc.checked,uc:els.uc.checked,dg:els.dg.checked,sc:els.sc.checked,ns:els.ns.checked,amb:els.amb.checked,reqAll:els.reqAll.checked,startL:els.startL.checked};
      let pool=getPool(opts);
      if(!pool){ els.out.textContent='Select at least one character set'; return ''; }
      const buckets=[];
      if(opts.reqAll){ if(opts.lc) buckets.push(POOLS.lc); if(opts.uc) buckets.push(POOLS.uc); if(opts.dg) buckets.push(POOLS.dg); if(opts.sc) buckets.push(opts.amb?POOLS.symUnamb:POOLS.symAll); }
      if(opts.ns){ pool=pool.replace(POOLS.similarRX,''); for(let i=0;i<buckets.length;i++) buckets[i]=buckets[i].replace(POOLS.similarRX,''); }
      const chars=[];
      for(const b of buckets){ if(b.length) chars.push(b[secureInts(1,b.length)[0]]); }
      const remain=length-chars.length; const idxs=secureInts(remain,pool.length); for(let i=0;i<remain;i++) chars.push(pool[idxs[i]]);
      shuffleArray(chars);
      if(opts.startL){
        const letters=(opts.lc?POOLS.lc:'')+(opts.uc?POOLS.uc:'');
        if(letters && !letters.includes(chars[0])){
          const k=chars.findIndex((c,i)=>i>0 && letters.includes(c));
          if(k>0){ [chars[0],chars[k]]=[chars[k],chars[0]]; } else { chars[0]=letters[secureInts(1,letters.length)[0]]; }
        }
      }
      const pass=chars.join(''); els.out.textContent=pass; updateStrength(pass,pool.length); updateSaved(pass); return pass;
    }
    function updateStrength(pass,poolSize){
      const len=pass.length; const entropyBits=Math.round(len*Math.log2(poolSize||1));
      els.entropy.textContent=`Entropy: ${entropyBits} bits`;
      const pct=clamp((entropyBits/128)*100,0,100);
      els.meterFill.style.width=pct+'%';
      els.meterFill.style.background=pct<35?'var(--danger,#ff4d4f)':pct<70?'var(--warn,#f5a623)':'var(--ok,#2ecc71)';
      els.est.textContent=`Crack time: ${estimateTime(entropyBits)}`;
    }
    function estimateTime(bits){ const sec=Math.pow(2,Math.max(bits-1,0))/1e12; if(sec<1) return '<1s'; const units=[['s',60],['min',60],['h',24],['days',365],['yrs',1000]]; let v=sec,i=0; while(i<units.length-1 && v>=units[i][1]){ v/=units[i][1]; i++; } return `${v.toFixed(1)} ${units[i][0]}`; }
    function toMask(on){ els.out.style.filter=on?'blur(6px)':'none'; els.toggle.textContent=on?'Show':'Hide'; els.toggle.setAttribute('aria-pressed', String(!on)); }

    // ====== Passphrase ======
    const WORDS=[ 'able','ace','acorn','adapt','agent','alpha','amber','angle','apple','arch','area','armor','arrow','artist','atlas','audio','azure','badge','basil','basic','batch','beacon','bench','berry','beta','biker','bird','bliss','block','bloom','bolt','bonus','brave','brick','brush','buddy','cabin','cafe','calm','canal','candy','canoe','carbon','carve','cedar','cell','chalk','charm','cheap','chess','chief','chili','chip','citrus','civic','cliff','clip','clock','cloud','clover','cobalt','cobra','cocoa','comet','comic','coral','craft','crane','cream','crest','crisp','crown','cruise','cubic','cult','cumin','curve','cypress','daisy','delta','denim','diner','disco','draft','drama','dream','drift','drum','eagle','early','earth','ebony','echo','eden','ember','fair','faith','family','fancy','feast','felix','field','film','flame','flash','flora','flute','focus','foggy','forest','fox','friday','frost','fruit','galaxy','gamer','garden','garlic','gator','gem','giant','ginger','glacier','glide','glow','gold','grace','grain','grand','graph','green','grid','grill','groove','grove','guard','habit','halo','harbor','harp','hazel','heart','helium','hero','honey','horizon','hotel','hours','humble','ice','icing','icon','idea','idle','igloo','image','iris','iron','island','ivory','jacket','jade','jazz','jeans','jelly','jet','jolly','jungle','juniper','kettle','key','kiwi','kudos','lake','laser','lemon','level','linen','lion','lizard','logic','lotus','lucky','lunar','magic','mango','maple','marble','marine','marvel','matrix','meadow','melon','metro','mint','mirror','mist','model','monk','moon','moss','mount','mouse','movie','muffin','music','navy','nectar','neon','noble','north','nova','nugget','oak','oasis','ocean','olive','omega','onion','opal','orbit','orange','orchid','owl','oxide','oyster','panda','panel','paper','parrot','peach','pearl','pepper','petal','photon','piano','pilot','pixel','plasma','plum','pocket','polar','pollen','pond','poppy','portal','prairie','prime','prism','pulsar','puma','punch','purple','puzzle','quartz','queen','quick','quiet','radar','radio','raven','react','reef','ribbon','rider','river','robot','rocket','rose','ruby','sable','sage','salsa','saturn','scout','sea','season','seed','shadow','shark','shell','shift','shine','short','silk','silver','sky','slate','smile','smoke','snack','solar','sonic','sound','south','space','spark','spice','spider','spike','spoon','sport','spring','square','stage','star','steam','steel','stone','storm','story','straw','stream','street','stripe','studio','sugar','summer','sun','surf','swirl','taco','tango','tartan','tiger','timber','titan','toast','tomato','topaz','torch','trace','trail','tree','trick','tulip','tundra','twist','ultra','union','urban','vacay','valley','velvet','violet','viper','vivid','vocal','volta','voyage','waltz','wave','wheat','whisper','willow','win','wind','winter','wizard','wolf','world','xenon','yacht','yoga','yukon','zebra','zero','zinc','zorro' ];
    function genPhrase(){
      const w=clamp(Number(els.words.value||4),3,12), cap=els.capWords.checked, add=els.addNum.checked, sep=(els.sep.value||'-').slice(0,3);
      const idxs=secureInts(w,WORDS.length); let chosen=Array.from({length:w},(_,i)=>WORDS[idxs[i]]); if(cap) chosen=chosen.map(s=>s[0].toUpperCase()+s.slice(1));
      let phrase=chosen.join(sep); if(add) phrase+=sep+String(secureInts(1,100)[0]);
      els.phraseOut.textContent=phrase;
      let bits=Math.round(w*Math.log2(WORDS.length)+(add?Math.log2(100):0));
      els.phraseEntropy.textContent=`Entropy: ${bits} bits`; const pct=clamp((bits/128)*100,0,100); els.meterFill2.style.width=pct+'%'; els.meterFill2.style.background=pct<35?'var(--danger,#ff4d4f)':pct<70?'var(--warn,#f5a623)':'var(--ok,#2ecc71)';
    }

    // ====== Save last (simple) ======
    function updateSaved(pass){
      if(!els.rememberLast.checked) return;
      U.saveLocal('uptools.password-generator.last',{v:pass,t:Date.now()});
      els.saveNotice.hidden=false;
      els.localLinks.hidden=false;
    }
    function loadSaved(){
      const saved=U.readLocal('uptools.password-generator.last');
      if(saved?.v){
        els.out.textContent=saved.v;
        updateStrength(saved.v, getPool({lc:els.lc.checked,uc:els.uc.checked,dg:els.dg.checked,sc:els.sc.checked,ns:els.ns.checked,amb:els.amb.checked}).length);
        els.saveNotice.hidden=false;
        els.localLinks.hidden=false;
      }
    }

    // ====== Vault (AES-GCM with PIN via PBKDF2) ======
    const VAULT_K='uptools.pw.vault'; // { salt, verifier, items:[{site,user,iv,cipher,ts}] }
    let vault=null, key=null, unlocked=false;

    async function pbkdf2Key(pin, salt){
      const enc=new TextEncoder(); const base=await cryptoObj.subtle.importKey('raw', enc.encode(pin), 'PBKDF2', false, ['deriveKey','deriveBits']);
      return cryptoObj.subtle.deriveKey({name:'PBKDF2',salt,iterations:120000,hash:'SHA-256'}, base, {name:'AES-GCM',length:256}, false, ['encrypt','decrypt']);
    }
    async function makeVerifier(aesKey){
      const iv=cryptoObj.getRandomValues(new Uint8Array(12));
      const ct = await cryptoObj.subtle.encrypt({name:'AES-GCM',iv}, aesKey, new TextEncoder().encode('verifier'));
      return {iv: Array.from(iv), ct:Array.from(new Uint8Array(ct))};
    }
    async function encryptText(text){
      const iv=cryptoObj.getRandomValues(new Uint8Array(12));
      const ct=await cryptoObj.subtle.encrypt({name:'AES-GCM',iv}, key, new TextEncoder().encode(text));
      return {iv:Array.from(iv), cipher:Array.from(new Uint8Array(ct))};
    }
    async function decryptText(ivArr,cipherArr){
      const iv=new Uint8Array(ivArr); const ct=new Uint8Array(cipherArr);
      const pt=await cryptoObj.subtle.decrypt({name:'AES-GCM',iv}, key, ct);
      return new TextDecoder().decode(pt);
    }
    const loadVaultRaw = ()=> U.readLocal(VAULT_K) || null;
    const saveVaultRaw = (v)=> U.saveLocal(VAULT_K, v);

    async function verifyKey(){
      try{
        const {iv, ct}=vault.verifier;
        const dec=await cryptoObj.subtle.decrypt({name:'AES-GCM',iv:new Uint8Array(iv)}, key, new Uint8Array(ct));
        return new TextDecoder().decode(dec)==='verifier';
      }catch{ return false; }
    }

    async function ensureVault(){
      const existing = loadVaultRaw();
      if(!existing){
        // No vault yet: prompt to set a PIN and initialize
        const ok = await openPinModal(true);
        vault = loadVaultRaw();
        unlocked = !!ok;
      }else{
        vault = existing;
        if(!unlocked){
          const ok = await openPinModal(false);
          unlocked = !!ok;
        }
      }
    }

    // ====== Dialogs (robust submit handling to avoid premature close) ======
    function openSaveModal(defaultValue=''){
      els.svSite.value=''; els.svUser.value=''; els.svValue.value=defaultValue;
      els.saveModal.showModal();
      return new Promise((resolve)=>{
        const onSubmit = async (e)=>{ e.preventDefault(); resolve('save'); cleanup(); };
        const onCancel = ()=>{ resolve('cancel'); cleanup(); els.saveModal.close(); };
        const onClose  = ()=>{ resolve('cancel'); cleanup(); };
        function cleanup(){
          els.svForm.removeEventListener('submit', onSubmit);
          els.svCancel.removeEventListener('click', onCancel);
          els.saveModal.removeEventListener('close', onClose);
        }
        els.svForm.addEventListener('submit', onSubmit);
        els.svCancel.addEventListener('click', onCancel);
        els.saveModal.addEventListener('close', onClose, {once:true});
      });
    }

    async function openPinModal(isSetup){
      els.pinTitle.textContent = isSetup ? 'Set Vault PIN' : 'Unlock Vault';
      els.pinMsg.textContent   = isSetup ? 'Create a PIN (4-32 chars). Keep it safe; we cannot recover it.' : 'Enter your Vault PIN to decrypt items.';
      els.pinInput.value='';
      els.pinModal.showModal();
      return new Promise((resolve)=>{
        const onSubmit = async (e)=>{
          e.preventDefault(); // prevent auto-close on method="dialog"
          const pin=els.pinInput.value.trim();
          if(pin.length<4){ toast('PIN too short'); return; }

          if(isSetup){
            const saltBytes = cryptoObj.getRandomValues(new Uint8Array(16));
            key = await pbkdf2Key(pin, saltBytes);
            const verifier = await makeVerifier(key);
            saveVaultRaw({salt:Array.from(saltBytes), verifier, items:[]});
            vault=loadVaultRaw(); unlocked=true;
            els.pinModal.close(); cleanup(); toast('Vault ready'); resolve(true);
          }else{
            if(!vault){ toast('No vault found'); return; }
            const saltBytes = new Uint8Array(vault.salt);
            key = await pbkdf2Key(pin, saltBytes);
            const ok = await verifyKey();
            if(ok){ unlocked=true; els.pinModal.close(); cleanup(); toast('Vault unlocked'); resolve(true); }
            else { key=null; toast('Wrong PIN'); }
          }
        };
        const onCancel = ()=>{ cleanup(); els.pinModal.close(); resolve(false); };
        const onClose  = ()=>{ cleanup(); resolve(false); };
        function cleanup(){
          els.pinForm.removeEventListener('submit', onSubmit);
          els.pinCancel.removeEventListener('click', onCancel);
          els.pinModal.removeEventListener('close', onClose);
        }
        els.pinForm.addEventListener('submit', onSubmit);
        els.pinCancel.addEventListener('click', onCancel);
        els.pinModal.addEventListener('close', onClose, {once:true});
      });
    }

    // ====== Vault UI ======
    function renderVault(list=null){
      const items = Array.isArray(list) ? list : (vault?.items ?? []);
      els.vaultCount.textContent = items.length;
      const wrap = els.vaultList;
      wrap.innerHTML = '';
      if(!unlocked){ wrap.append(emptyP('Vault is locked.')); return; }
      if(items.length===0){ wrap.append(emptyP('Your Vault is empty.')); return; }
      for(const it of items){
        const row=document.createElement('div'); row.className='vault-row'; row.role='listitem';
        const left=document.createElement('div');
        left.innerHTML = `<div class="mono"><b>${escapeHTML(it.site||'-')}</b> ¬∑ <span class="note">${escapeHTML(it.user||'')}</span></div>
                          <div class="note">${new Date(it.ts).toLocaleString()}</div>`;
        const btns=document.createElement('div');
        const btns2=document.createElement('div');
        const bReveal=btn('Reveal','üëÅÔ∏è','icon'); const bCopy=btn('Copy','üìã','icon'); const bDel=btn('Delete','üóëÔ∏è','icon');
        bReveal.addEventListener('click', async()=>{ try{ const t=await decryptText(it.iv,it.cipher); modalView(it.site, it.user, t);}catch{ toast('Unlock first or wrong PIN'); } });
        bCopy.addEventListener('click', async()=>{ try{ const t=await decryptText(it.iv,it.cipher); await U.copy(t);}catch{ toast('Unlock first'); } });
        bDel.addEventListener('click', ()=>{ if(confirm('Delete this entry?')){ vault.items = vault.items.filter(x=>x!==it); saveVaultRaw(vault); renderVault(); } });
        btns.append(bReveal); btns2.append(bCopy); btns2.append(bDel);
        row.append(left); row.append(btns); row.append(btns2); wrap.append(row);
      }
      function btn(label,icon,cls){ const b=document.createElement('button'); b.className=`btn ${cls}`; b.title=label; b.setAttribute('aria-label',label); b.textContent=icon; return b; }
      function emptyP(txt){ const p=document.createElement('p'); p.className='note'; p.textContent=txt; return p; }
      function escapeHTML(s){ return String(s??'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }
    }
    function modalView(site,user,value){
      const d=document.createElement('dialog'); d.className='vault-modal';
      d.innerHTML = `<form method="dialog" class="card" style="margin:0">
        <h3 style="margin:0 0 6px">${site ? 'Entry' : 'Reveal'}</h3>
        <div class="note" style="margin:0 0 8px">${site?escape(site):''} ${user?('¬∑ '+escape(user)) : ''}</div>
        <input class="input mono" value="${escape(value)}" readonly>
        <div class="hr"></div>
        <div class="row" style="justify-content:flex-end"><button class="btn" type="submit">Close</button></div>
      </form>`;
      document.body.appendChild(d); d.showModal(); d.addEventListener('close',()=>d.remove());
      function escape(s){ return String(s??'').replace(/"/g,'&quot;'); }
    }

    // Save dialog submit
    els.svForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      await ensureVault();
      if(!unlocked){ toast('Vault locked'); return; }
      const site=els.svSite.value.trim(); const user=els.svUser.value.trim(); const val=els.svValue.value;
      if(!site || !val){ toast('Fill Site and Value'); return; }
      const enc=await encryptText(val);
      vault.items.unshift({site,user,iv:enc.iv,cipher:enc.cipher,ts:Date.now()});
      saveVaultRaw(vault); els.saveModal.close(); renderVault(); toast('Saved');
    });
    els.svCancel.addEventListener('click', ()=> els.saveModal.close());

    // ====== Export / Import / Lock / Unlock / Delete ======
    function exportVault(){
      if(!vault){ toast('Nothing to export'); return; }
      const blob=new Blob([JSON.stringify(vault)],{type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='uptools-vault.json'; a.click(); URL.revokeObjectURL(a.href);
    }
    function filterVault(qs){
      if(!vault) return [];
      const ql=qs.trim().toLowerCase();
      if(!ql) return vault.items;
      return vault.items.filter(it=>(it.site||'').toLowerCase().includes(ql)||(it.user||'').toLowerCase().includes(ql));
    }

    els.vaultExport.addEventListener('click', exportVault);
    els.vaultImport.addEventListener('change', async (e)=>{
      const f=e.target.files?.[0]; if(!f) return;
      try{
        const txt=await f.text(); const data=JSON.parse(txt);
        if(!data?.salt || !data?.verifier || !Array.isArray(data?.items)) throw new Error('Bad file');
        saveVaultRaw(data); vault=loadVaultRaw(); unlocked=false; key=null;
        toast('Imported. Unlock with the file PIN.'); renderVault();
      }catch{ toast('Invalid file'); }
      e.target.value='';
    });
    els.vaultLock.addEventListener('click', ()=>{ key=null; unlocked=false; renderVault(); toast('Vault locked'); });
    els.vaultUnlock.addEventListener('click', async ()=>{
      vault = loadVaultRaw();
      if(!vault){
        // Initialize new vault
        const ok = await openPinModal(true);
        if(ok){ renderVault(); }
        return;
      }
      const ok = await openPinModal(false);
      if(ok){ renderVault(); }
    });
    els.vaultDelete.addEventListener('click', ()=>{
      if(confirm('Delete the entire vault from this browser? This cannot be undone.')){
        U.rmLocal(VAULT_K);
        vault=null; key=null; unlocked=false;
        renderVault();
        toast('Vault deleted');
      }
    });

    // Search
    els.vaultSearch.addEventListener('input', ()=>{
      if(!vault || !unlocked){ renderVault(); return; }
      const filtered = filterVault(els.vaultSearch.value);
      renderVault(filtered);
    });

    // ====== Batch / Phrase / Last Saved ======
    let masked=true;
    const regen=()=>genPassword();
    els.gen.addEventListener('click', regen);
    els.shuffle.addEventListener('click', regen);
    els.copy.addEventListener('click', ()=>{ const t=els.out.textContent.trim(); if(t){ U.copy(t); } });
    els.toggle.addEventListener('click', ()=>{ masked=!masked; toMask(masked); });

    const syncLen = (e)=>{ const v=clamp(Number(e.target.value||16),6,64); els.len.value=v; els.lenRange.value=v; };
    els.len.addEventListener('input', syncLen); els.lenRange.addEventListener('input', syncLen);

    let tId; [els.lc,els.uc,els.dg,els.sc,els.ns,els.reqAll,els.amb,els.startL,els.len,els.lenRange]
      .forEach(el=>el.addEventListener('input',()=>{ clearTimeout(tId); tId=setTimeout(regen,80); }));

    function genBatch(){ const n=clamp(Number(els.batchCount.value||10),2,50); const list=Array.from({length:n},()=>genPassword()); els.batchOut.value=list.join('\n'); toast('Batch ready'); }
    els.batchGen.addEventListener('click', genBatch);
    els.batchCopy.addEventListener('click', ()=>{ const t=els.batchOut.value.trim(); if(t) U.copy(t); });

    els.phraseGen.addEventListener('click', genPhrase);
    els.phraseCopy.addEventListener('click', ()=>{ const t=els.phraseOut.textContent.trim(); if(t) U.copy(t); });

    els.rememberLast.addEventListener('change', ()=>{
      if(!els.rememberLast.checked){
        U.rmLocal('uptools.password-generator.last');
        els.saveNotice.hidden=true; els.localLinks.hidden=true;
      }else{
        const t=els.out.textContent.trim(); if(t) updateSaved(t);
      }
    });
    els.localReveal.addEventListener('click', ()=>{
      const saved=U.readLocal('uptools.password-generator.last');
      if(saved?.v){ modalView('Local Save','', saved.v); } else { toast('Nothing saved'); }
    });
    els.localCopy.addEventListener('click', ()=>{
      const saved=U.readLocal('uptools.password-generator.last');
      if(saved?.v){ U.copy(saved.v); } else { toast('Nothing saved'); }
    });
    els.localClear.addEventListener('click', ()=>{
      U.rmLocal('uptools.password-generator.last');
      els.saveNotice.hidden=false; els.localLinks.hidden=true; toast('Cleared');
    });

    els.savePwd.addEventListener('click', async()=>{
      const val=els.out.textContent.trim(); if(!val){ toast('Generate first'); return; }
      await ensureVault(); if(!unlocked) return;
      const act = await openSaveModal(val);
      if(act==='save'){ els.svForm.requestSubmit(); }
    });
    els.savePhrase.addEventListener('click', async()=>{
      const val=els.phraseOut.textContent.trim(); if(!val){ toast('Generate first'); return; }
      await ensureVault(); if(!unlocked) return;
      const act = await openSaveModal(val);
      if(act==='save'){ els.svForm.requestSubmit(); }
    });
    els.batchSave.addEventListener('click', async()=>{
      const list=els.batchOut.value.trim().split('\n').filter(Boolean);
      if(list.length===0){ toast('Generate a list first'); return; }
      await ensureVault(); if(!unlocked) return;
      const act = await openSaveModal(list.join('\n'));
      if(act==='save'){ els.svForm.requestSubmit(); }
    });

    // ====== Init ======
    let maskedInit=true; toMask(maskedInit);
    loadSaved();
    if(!els.out.textContent) genPassword();
    if(!els.phraseOut.textContent) genPhrase();
    vault=loadVaultRaw(); renderVault();
  </script>

</body>
</html>
