<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Instagram Auditor - Find Non-Followers, Fans & Mutuals | UpTools</title>
  <meta name="description"
    content="Privacy-first Instagram follower audit tool. Upload your Instagram data export to find who doesn't follow you back, fans, and mutual followers. Client-side processing, no data upload." />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <meta name="theme-color" content="#0f1419" />
  <meta name="keywords"
    content="instagram auditor,instagram followers,instagram analytics,non followers,instagram fans,mutual followers,instagram data export,privacy first,client side" />

  <!-- Canonical & Icons -->
  <link rel="canonical" href="https://www.uptools.in/instagram-auditor/" />
  <link rel="icon" sizes="50x50" type="image/svg+xml" href="/assets/logo/uptools-logo.svg" />
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/logo/uptools-logo.svg" />

  <!-- Open Graph -->
  <meta property="og:title" content="Instagram Auditor - Find Non-Followers, Fans & Mutuals" />
  <meta property="og:description"
    content="Privacy-first Instagram follower audit tool. Upload your Instagram data export to find who doesn't follow you back, fans, and mutual followers." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.uptools.in/instagram-auditor/" />
  <meta property="og:site_name" content="UpTools" />
  <meta property="og:image" content="https://www.uptools.in/assets/og/instagram-auditor.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Preconnects -->
  <link rel="preconnect" href="https://www.youtube-nocookie.com" crossorigin>
  <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>

  <!-- Global CSS -->
  <link rel="preload" href="/style.css?v=1.3.0" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="/style.css?v=1.3.0">
  </noscript>
  <script src="/scripts/utils.js?v=1.3.0" type="module"></script>

  <!-- Critical CSS -->
  <style>
    :root {
      --bg: #0f1419;
      --surface: #121826;
      --text: #e6edf3;
      --muted: #9aa4b2;
      --brand: #7aa2ff;
      --radius: .75rem;
      --border: #212a3a
    }

    * {
      box-sizing: border-box
    }

    html {
      color-scheme: dark light;
      -webkit-text-size-adjust: 100%
    }

    body {
      margin: 0;
      font: 400 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Noto Sans", sans-serif;
      background: var(--bg);
      color: var(--text)
    }

    .wrap {
      width: min(100% - 24px, 1120px);
      margin: 24px auto
    }

    .card {
      background: #121826;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1rem
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      padding: .6rem .9rem;
      border-radius: var(--radius);
      background: var(--brand);
      color: #0b1020;
      border: 0;
      font-weight: 800;
      text-decoration: none;
      cursor: pointer
    }

    .btn.secondary {
      background: #1a2436;
      color: var(--text);
      border: 1px solid var(--border)
    }

    .btn.ghost {
      background: transparent;
      color: var(--muted);
      border: 1px solid var(--border)
    }

    .btn.sm {
      padding: .45rem .7rem;
      font-weight: 700;
      font-size: .9rem
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: .35rem;
      padding: .25rem .6rem;
      border-radius: 999px;
      background: #182033;
      border: 1px solid var(--border);
      font-size: .85rem;
      color: var(--muted)
    }

    .note {
      color: var(--muted)
    }

    .note.small {
      font-size: .9rem
    }

    /* Header */
    .site {
      position: sticky;
      top: 0;
      z-index: 20;
      background: linear-gradient(180deg, #0f1419, #0f1419f2 70%, transparent);
      backdrop-filter: saturate(140%) blur(6px);
      border-bottom: 1px solid #0f1a2a
    }

    .header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      width: min(100% - 24px, 1120px);
      margin: 0 auto;
      min-height: 56px;
      padding: 8px 0
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: .6rem;
      color: var(--text);
      text-decoration: none;
      font-weight: 900
    }

    .nav-links {
      display: flex;
      flex-wrap: wrap;
      gap: .75rem
    }

    .nav-links a {
      color: var(--text);
      opacity: .9;
      text-decoration: none;
      padding: .25rem .4rem;
      border-radius: .5rem
    }

    .nav-links a[aria-current="page"] {
      background: #182033;
      border: 1px solid var(--border)
    }

    /* Tool specific styles */
    .tool-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem
    }

    .tool-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius);
      background: linear-gradient(135deg, #e91e63, #9c27b0);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 900;
      color: white;
      flex-shrink: 0
    }

    @media (max-width: 768px) {
      .tool-header {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
      }

      .tool-icon {
        width: 60px;
        height: 60px;
        font-size: 1.8rem;
      }

      .tool-header h1 {
        font-size: 1.3rem !important;
      }

      .tool-header .note {
        font-size: 0.9rem;
      }

      .tool-header div[style*="flex"] {
        justify-content: center !important;
      }
    }

    .split {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      align-items: start
    }

    @media (max-width: 768px) {
      .split {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      /* Reorder sections on mobile */
      .split>div:first-child {
        order: 1;
      }

      .split>div:last-child {
        order: 2;
      }
    }

    .dropzone {
      border: 2px dashed var(--border);
      padding: 1rem;
      border-radius: var(--radius);
      background: rgba(255, 255, 255, .01);
      transition: all .2s ease
    }

    .dropzone:hover {
      border-color: var(--brand);
      background: rgba(122, 162, 255, .05)
    }

    @media (max-width: 768px) {
      .dropzone {
        padding: 1rem 0.75rem;
        text-align: center;
      }

      .dropzone>div[style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
        gap: 0.75rem !important;
      }

      .dropzone input[type="file"] {
        width: 100%;
        padding: 0.75rem;
        border: 2px dashed var(--border);
        border-radius: 0.5rem;
        background: rgba(255, 255, 255, 0.02);
        text-align: center;
        font-size: 0.9rem;
        margin-top: 0.5rem;
      }

      .dropzone .textarea {
        min-height: 100px;
        font-size: 0.9rem;
      }

      .dropzone h2 {
        font-size: 1.1rem;
      }

      .dropzone h3 {
        font-size: 1rem;
      }
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: .75rem;
      margin: 1rem 0
    }

    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: .75rem;
      }

      .stat {
        padding: 0.75rem 0.5rem;
        text-align: center;
      }

      .stat-value {
        font-size: 1.2rem;
      }

      .stat-label {
        font-size: 0.8rem;
      }
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
        gap: .5rem;
      }

      .stat {
        padding: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        text-align: left;
      }

      .stat-value {
        font-size: 1.3rem;
        font-weight: 800;
      }

      .stat-label {
        font-size: 0.9rem;
      }
    }

    .stat {
      background: rgba(255, 255, 255, .02);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: .75rem;
      text-align: center
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--brand)
    }

    .stat-label {
      font-size: .85rem;
      color: var(--muted);
      margin-top: .25rem
    }

    .result-list {
      max-height: 60vh;
      overflow: auto;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: rgba(0, 0, 0, .2)
    }

    .user-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: .75rem;
      border-bottom: 1px solid rgba(255, 255, 255, .05)
    }

    .user-row:last-child {
      border-bottom: none
    }

    @media (max-width: 768px) {
      .user-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
        padding: 1rem 0.75rem;
      }

      .user-info {
        width: 100%;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .user-row>div:last-child {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: .75rem
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--brand), #9c27b0);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      color: white
    }

    .username {
      font-weight: 700;
      color: var(--text)
    }

    .user-handle {
      font-size: .85rem;
      color: var(--muted)
    }

    .controls {
      display: flex;
      gap: .5rem;
      flex-wrap: wrap;
      align-items: center
    }

    @media (max-width: 768px) {
      .controls {
        justify-content: center;
        gap: .75rem;
      }

      .controls .btn {
        min-width: 120px;
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      .controls {
        flex-direction: column;
        align-items: stretch;
      }

      .controls .btn {
        width: 100%;
      }
    }

    .input,
    .textarea {
      background: rgba(255, 255, 255, .05);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: .6rem;
      color: var(--text);
      font-size: .9rem;
      width: 100%
    }

    .input:focus,
    .textarea:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 2px rgba(122, 162, 255, .2)
    }

    .textarea {
      resize: vertical;
      min-height: 120px
    }

    .sr-only {
      position: absolute;
      left: -9999px
    }

    /* Additional mobile improvements */
    @media (max-width: 768px) {

      /* Center all content on mobile */
      .card h2,
      .card h3 {
        text-align: center;
      }

      /* Better file input styling */
      .file-inputs {
        grid-template-columns: 1fr !important;
        gap: 1rem !important;
      }

      .file-inputs input[type="file"] {
        width: 100%;
        padding: 0.75rem;
        border: 2px dashed var(--border);
        border-radius: 0.5rem;
        background: rgba(255, 255, 255, 0.02);
        text-align: center;
        font-size: 0.9rem;
      }

      /* Better textarea */
      .textarea {
        min-height: 120px;
        font-size: 0.9rem;
      }

      /* Responsive pills */
      .pill {
        font-size: 0.8rem;
        padding: 0.2rem 0.5rem;
      }

      /* Center content in cards */
      .card>div[style*="text-align: center"] {
        margin-bottom: 1rem;
      }
    }

    @media (max-width: 480px) {

      /* Smaller text on very small screens */
      .card h2 {
        font-size: 1.1rem;
      }

      .card h3 {
        font-size: 1rem;
      }

      .note {
        font-size: 0.85rem;
      }

      .note.small {
        font-size: 0.8rem;
      }

      /* Hide extra pills on very small screens */
      .pill:nth-child(n+3) {
        display: none;
      }

      /* Compact dropzone */
      .dropzone {
        padding: 0.75rem 0.5rem;
      }

      .dropzone>div {
        padding: 0.75rem !important;
      }
    }
  </style>

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Instagram Auditor",
    "url": "https://www.uptools.in/instagram-auditor/",
    "description": "Privacy-first Instagram follower audit tool. Upload your Instagram data export to find who doesn't follow you back, fans, and mutual followers. Client-side processing, no data upload.",
    "applicationCategory": "SocialNetworkingApplication",
    "operatingSystem": "Any",
    "browserRequirements": "Requires JavaScript. Requires HTML5.",
    "softwareVersion": "1.0",
    "author": {
      "@type": "Organization",
      "name": "UpTools"
    },
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    }
  }
  </script>
</head>

<body>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6216304334889617"
    crossorigin="anonymous"></script>
  <!-- Advertisement -->
  <ins class="adsbygoogle" style="display:inline-block;width:500px;height:50px" data-ad-client="ca-pub-6216304334889617"
    data-ad-slot="9810172647"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>

  <a href="#main" class="sr-only">Skip to content</a>

  <!-- Header -->
  <header class="site" role="banner">
    <div class="header-inner">
      <a class="brand" href="/" aria-label="UpTools Home">
        <img src="/assets/logo/uptools-logo.svg" alt="UpTools logo" width="28" height="28" loading="eager">
        <b>UpTools</b>
      </a>

      <!-- Mobile menu toggle -->
      <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
        <span class="menu-icon">â˜°</span>
      </button>

      <nav class="nav-links" aria-label="Primary">
        <a href="/#tools">Tools</a>
        <a href="/income-tax-tool/">Income Tax</a>
        <a href="/emi-calculator/">EMI</a>
        <a href="/gst-calculator/">GST</a>
        <a href="/games/">Games</a>
        <a href="/about/">About</a>
        <a href="/contact/">Contact</a>
        <a href="/instagram-auditor/" aria-current="page">IG Audit</a>
      </nav>
    </div>
  </header>

  <main id="main" class="wrap" role="main">
    <!-- Tool Header -->
    <section class="card tool-header">
      <div class="tool-icon" aria-hidden="true">ğŸ“Š</div>
      <div style="flex: 1">
        <h1 style="margin: 0; font-size: 1.5rem; font-weight: 800">Instagram Auditor</h1>
        <p class="note" style="margin: .5rem 0 0">Find who doesn't follow you back, discover your fans, and analyze your
          mutual followers. Privacy-first tool that processes your data locally.</p>
        <div style="margin-top: .75rem; display: flex; gap: .5rem; flex-wrap: wrap">
          <span class="pill">ğŸ”’ Privacy-first</span>
          <span class="pill">ğŸ“± Client-side only</span>
          <span class="pill">ğŸ“Š Multiple formats</span>
          <span class="pill">ğŸ” Encrypted export</span>
        </div>
      </div>
    </section>

    <!-- Upload Section -->
    <section class="card">
      <h2 style="margin-top: 0; text-align: center">ğŸ“¤ Upload Your Instagram Data</h2>
      <p class="note" style="text-align: center; margin-bottom: 1.5rem">Upload your Instagram export files or paste your
        data to analyze your followers</p>

      <div id="dropzone" class="dropzone" tabindex="0" aria-label="Drop Instagram export files here">
        <div style="text-align: center; padding: 1rem">
          <div style="font-size: 2rem; margin-bottom: .5rem">ğŸ“</div>
          <p class="note">Drag & drop your Instagram export files here</p>
          <p class="note small">Supports: followers.json, following.json, CSV files, or plain text lists</p>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: .75rem; margin-top: 1rem">
          <div>
            <label class="note small" for="fileFollowers">Followers file:</label>
            <input id="fileFollowers" type="file" accept=".json,.csv,.txt,text/*" aria-label="Followers file"
              style="margin-top: .25rem" />
          </div>
          <div>
            <label class="note small" for="fileFollowing">Following file:</label>
            <input id="fileFollowing" type="file" accept=".json,.csv,.txt,text/*" aria-label="Following file"
              style="margin-top: .25rem" />
          </div>
        </div>

        <div style="margin-top: 1rem">
          <label class="note small" for="pasteArea">Or paste your data here:</label>
          <textarea id="pasteArea" class="textarea"
            placeholder="Paste JSON, CSV, or username list (one per line)&#10;&#10;Example:&#10;user1&#10;user2&#10;user3"
            rows="6" aria-label="Paste your Instagram data here" style="margin-top: .25rem"></textarea>
        </div>

        <div class="controls" style="margin-top: 1rem">
          <button id="parseBtn" class="btn">ğŸ” Analyze Data</button>
          <button id="clearBtn" class="btn secondary">ğŸ—‘ï¸ Clear</button>
          <button id="demoBtn" class="btn ghost" title="Load test sample">ğŸ§ª Demo</button>
        </div>

        <div style="margin-top: 1rem">
          <label class="note small">
            <input type="checkbox" id="caseSensitive" style="margin-right: .5rem">
            Case sensitive usernames
          </label>
        </div>

        <div style="margin-top: 1rem">
          <a href="#" id="howItWorks" class="note small" style="color: var(--brand)">
            ğŸ“– How to get your Instagram data export
          </a>
        </div>
      </div>

      <div class="card"
        style="margin-top: 1rem; background: rgba(122, 162, 255, .05); border-color: rgba(122, 162, 255, .2)">
        <h3 style="margin-top: 0; color: var(--brand)">ğŸ”’ Privacy & Security</h3>
        <ul class="note" style="margin: .5rem 0 0 1.5rem; line-height: 1.6">
          <li>All processing happens in your browser - no data is uploaded to servers</li>
          <li>Export results as CSV or encrypted files with password protection</li>
          <li>Optional local storage - use "Forget Data" to clear everything</li>
          <li>Works with official Instagram data exports and custom formats</li>
        </ul>
      </div>
      </div>

      <!-- Right: Results Section -->
      <div>
        <h2 style="margin-top: 0">ğŸ“Š Analysis Results</h2>

        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="stat">
            <div class="stat-value" id="statFollowing">â€”</div>
            <div class="stat-label">Following</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="statFollowers">â€”</div>
            <div class="stat-label">Followers</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="statNon">â€”</div>
            <div class="stat-label">Non-followers</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="statMutual">â€”</div>
            <div class="stat-label">Mutuals</div>
          </div>
        </div>

        <!-- Export Controls -->
        <div class="controls" style="margin-bottom: 1rem">
          <button id="exportCsvBtn" class="btn">ğŸ“„ Export CSV</button>
          <button id="exportEncBtn" class="btn secondary">ğŸ” Export Encrypted</button>
          <button id="forgetBtn" class="btn ghost">ğŸ—‘ï¸ Forget Data</button>
        </div>

        <!-- Search -->
        <div style="margin-bottom: 1rem">
          <label class="note small" for="search">Search usernames:</label>
          <input id="search" class="input" placeholder="Type to filter results..." style="margin-top: .25rem" />
        </div>

        <!-- View Mode Buttons -->
        <div class="controls" style="margin-bottom: 1rem">
          <button id="showNonBtn" class="btn">ğŸ‘¥ Non-followers</button>
          <button id="showFansBtn" class="btn secondary">â­ Fans</button>
          <button id="showMutualBtn" class="btn ghost">ğŸ¤ Mutuals</button>
        </div>

        <!-- Results List -->
        <div class="result-list" id="resultList" role="region" aria-live="polite">
          <div class="note" style="padding: 2rem; text-align: center">
            <div style="font-size: 2rem; margin-bottom: .5rem">ğŸ“‹</div>
            <p>Results will appear here after analyzing your data</p>
          </div>
        </div>

        <div class="card"
          style="margin-top: 1rem; background: rgba(255, 193, 7, .05); border-color: rgba(255, 193, 7, .2)">
          <h3 style="margin-top: 0; color: #ffc107">âš ï¸ Important Notes</h3>
          <ul class="note" style="margin: .5rem 0 0 1.5rem; line-height: 1.6">
            <li>This tool only analyzes data - it doesn't perform any Instagram actions</li>
            <li>To unfollow accounts, use Instagram's official app or website</li>
            <li>Results are based on the data you provide - ensure it's up to date</li>
            <li>Select multiple accounts and use copy/export features for batch processing</li>
          </ul>
        </div>
      </div>
      </div>
    </section>

    <!-- How to Guide -->
    <section class="card">
      <h2 style="margin-top: 0">ğŸ“– How to Get Your Instagram Data</h2>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; align-items: start">
        <div>
          <h3 style="margin-top: 0; color: var(--brand)">Step-by-step guide:</h3>
          <ol class="note" style="line-height: 1.6; padding-left: 1.5rem">
            <li>Open Instagram app or website</li>
            <li>Go to Settings â†’ Privacy and Security</li>
            <li>Select "Download Your Information"</li>
            <li>Choose "Some of your information"</li>
            <li>Select "Followers and following"</li>
            <li>Choose JSON format and request download</li>
            <li>Wait for email with download link</li>
            <li>Extract and upload the files here</li>
          </ol>
        </div>
        <div>
          <div
            style="aspect-ratio: 16/9; border-radius: var(--radius); overflow: hidden; background: rgba(0,0,0,.2); border: 1px solid var(--border)">
            <iframe width="100%" height="100%" src="https://www.youtube-nocookie.com/embed/181231772500920"
              title="How to export Instagram data" frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen loading="lazy" style="border: 0">
            </iframe>
          </div>
          <p class="note small" style="margin-top: .5rem; text-align: center">
            Official guide on requesting your Instagram data export
          </p>
        </div>
      </div>
    </section>

    <!-- Features Section -->
    <section class="card">
      <h2 style="margin-top: 0">âœ¨ Features</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem">
        <div class="card" style="background: rgba(255,255,255,.02)">
          <h3 style="margin-top: 0">ğŸ” Smart Analysis</h3>
          <p class="note">Automatically detects and parses multiple file formats including JSON, CSV, and plain text
            lists.</p>
        </div>
        <div class="card" style="background: rgba(255,255,255,.02)">
          <h3 style="margin-top: 0">ğŸ”’ Privacy First</h3>
          <p class="note">All processing happens locally in your browser. Your data never leaves your device.</p>
        </div>
        <div class="card" style="background: rgba(255,255,255,.02)">
          <h3 style="margin-top: 0">ğŸ“Š Detailed Results</h3>
          <p class="note">Find non-followers, fans, and mutual connections with search and filter capabilities.</p>
        </div>
        <div class="card" style="background: rgba(255,255,255,.02)">
          <h3 style="margin-top: 0">ğŸ’¾ Export Options</h3>
          <p class="note">Export results as CSV or encrypted files with password protection for security.</p>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="note small site-footer" role="contentinfo"
      style="margin-top: 2rem; text-align: center; padding: 1rem; border-top: 1px solid var(--border)">
      Â© <span id="y"></span> UpTools Â·
      <a href="/about/">About</a> Â·
      <a href="/contact/">Contact</a> Â·
      <a href="/sitemap.xml">Sitemap</a> Â·
      <a href="/robots.txt">Robots</a> Â·
      <a href="/privacy-policy/">Privacy Policy</a>
    </footer>
  </main>

  <!-- load shared utilities (project-level) -->
  <script type="module" src="/scripts/utils.js"></script>

  <!-- Main app script (self-contained, no network calls) -->
  <script type="module">
    // Safe fallbacks if shared utils not loaded
    const $ = window.$ || ((s, r = document) => r.querySelector(s));
    const $$ = window.$$ || ((s, r = document) => Array.from(r.querySelectorAll(s)));
    const debounce = window.debounce || ((fn, d = 150) => { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), d); }; });
    const persist = window.persist || ((k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch { } });
    const read = window.read || ((k, d = null) => { try { return JSON.parse(localStorage.getItem(k)) ?? d; } catch { return d } });

    // Helpers
    const el = id => document.getElementById(id);
    const rs = n => (n == null ? 'â€”' : new Intl.NumberFormat('en-IN', { maximumFractionDigits: 0 }).format(Math.round(n)));
    const sanitizeUsername = (u, caseSensitive = false) => {
      if (!u) return '';
      u = String(u).trim();
      // remove leading @ if present
      if (u.startsWith('@')) u = u.slice(1);
      return caseSensitive ? u : u.toLowerCase();
    };

    // Parse possible inputs:
    // - JSON array of strings: ["user1","user2"]
    // - JSON array of objects with 'username' or 'user' keys
    // - Instagram's exported JSON objects with nested arrays (try to find username fields)
    // - CSV where first column contains username (or header 'username')
    // - Plain newline list
    async function parseTextContent(text) {
      text = (text || '').trim();
      if (!text) return [];

      // Try JSON first (Instagram's official export format)
      try {
        const j = JSON.parse(text);

        // Handle array of strings (simple format)
        if (Array.isArray(j)) {
          return j.flatMap(x => {
            if (typeof x === 'string') return sanitizeUsername(x);
            if (x && typeof x === 'object') {
              // Instagram export formats - try multiple field names
              const candidate = x.username || x.value || x.string_list_data?.[0]?.value ||
                x.handle || x.user || x.user_name || x.field_username ||
                x.name || x.title || x.href?.split('/').pop();
              if (candidate) return sanitizeUsername(candidate);

              // Deep search for username in nested objects
              for (const k of Object.keys(x)) {
                if (typeof x[k] === 'string' && x[k].match(/^[a-zA-Z0-9._]+$/)) {
                  return sanitizeUsername(x[k]);
                }
                if (x[k] && typeof x[k] === 'object' && x[k].value) {
                  return sanitizeUsername(x[k].value);
                }
              }
            }
            return [];
          }).filter(Boolean);
        }

        // Handle Instagram's nested object format
        else if (typeof j === 'object') {
          const candidates = [];

          function extractFromInstagramFormat(obj, path = '') {
            if (!obj) return;

            // Instagram export specific patterns
            if (obj.string_list_data && Array.isArray(obj.string_list_data)) {
              obj.string_list_data.forEach(item => {
                if (item.value) candidates.push(sanitizeUsername(item.value));
              });
            }

            // Handle relationships_following and relationships_followers
            if (obj.relationships_following || obj.relationships_followers) {
              [obj.relationships_following, obj.relationships_followers].forEach(rel => {
                if (rel && Array.isArray(rel)) {
                  rel.forEach(item => {
                    if (item.string_list_data) {
                      item.string_list_data.forEach(data => {
                        if (data.value) candidates.push(sanitizeUsername(data.value));
                      });
                    }
                  });
                }
              });
            }

            // Generic array and object traversal
            if (Array.isArray(obj)) {
              obj.forEach(item => extractFromInstagramFormat(item, path));
            } else if (typeof obj === 'object') {
              Object.keys(obj).forEach(key => {
                if (key.toLowerCase().includes('follow') || key.toLowerCase().includes('user')) {
                  extractFromInstagramFormat(obj[key], `${path}.${key}`);
                }
              });
            }
          }

          extractFromInstagramFormat(j);
          if (candidates.length) return [...new Set(candidates)]; // Remove duplicates

          // Fallback: generic object traversal
          function walk(o) {
            if (!o) return;
            if (Array.isArray(o)) {
              const a = o.flatMap(item => {
                if (typeof item === 'string') return sanitizeUsername(item);
                if (item && typeof item === 'object') {
                  return sanitizeUsername(item.username || item.handle || item.user ||
                    item.name || item.title || item.value);
                }
                return [];
              }).filter(Boolean);
              if (a.length > 0) candidates.push(...a);
            } else if (typeof o === 'object') {
              for (const k of Object.keys(o)) walk(o[k]);
            }
          }
          walk(j);
          if (candidates.length) return [...new Set(candidates)];
        }
      } catch (e) {
        // Not valid JSON, continue to other formats
      }

      // Try CSV format
      const lines = text.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
      if (lines.length > 0 && lines[0].includes(',')) {
        const rows = lines.map(l => {
          // Handle quoted CSV values
          const result = [];
          let current = '';
          let inQuotes = false;

          for (let i = 0; i < l.length; i++) {
            const char = l[i];
            if (char === '"') {
              inQuotes = !inQuotes;
            } else if (char === ',' && !inQuotes) {
              result.push(current.trim().replace(/^"|"$/g, ''));
              current = '';
            } else {
              current += char;
            }
          }
          result.push(current.trim().replace(/^"|"$/g, ''));
          return result;
        });

        const headers = rows[0].map(h => h.toLowerCase());
        let usernameCol = -1;

        // Look for username column
        for (let i = 0; i < headers.length; i++) {
          if (['username', 'user', 'handle', 'screen_name', 'account', 'profile'].includes(headers[i])) {
            usernameCol = i;
            break;
          }
        }

        if (usernameCol === -1) {
          // Find column with most username-like values
          for (let col = 0; col < headers.length; col++) {
            const sample = rows.slice(1, 6).map(r => r[col] || '');
            const usernameCount = sample.filter(val =>
              val && /^[a-zA-Z0-9._]+$/.test(val.replace('@', ''))
            ).length;
            if (usernameCount >= sample.length * 0.6) {
              usernameCol = col;
              break;
            }
          }
        }

        if (usernameCol === -1) usernameCol = 0; // Default to first column

        const hasHeaders = headers.some(h =>
          ['username', 'user', 'handle', 'screen_name', 'account', 'profile'].includes(h)
        );

        return rows.slice(hasHeaders ? 1 : 0)
          .map(r => sanitizeUsername(r[usernameCol] || ''))
          .filter(Boolean);
      }

      // Try tab-separated values
      if (lines.length > 0 && lines[0].includes('\t')) {
        const rows = lines.map(l => l.split('\t').map(c => c.trim()));
        return rows.map(r => sanitizeUsername(r[0] || '')).filter(Boolean);
      }

      // Try space-separated (if consistent spacing)
      if (lines.length > 0 && lines[0].includes(' ') &&
        lines.every(l => l.split(/\s+/).length === lines[0].split(/\s+/).length)) {
        const rows = lines.map(l => l.split(/\s+/));
        return rows.map(r => sanitizeUsername(r[0] || '')).filter(Boolean);
      }

      // Handle Instagram URLs (extract username from profile URLs)
      const urlPattern = /(?:https?:\/\/)?(?:www\.)?instagram\.com\/([a-zA-Z0-9._]+)/g;
      const urlMatches = [];
      let match;
      while ((match = urlPattern.exec(text)) !== null) {
        urlMatches.push(sanitizeUsername(match[1]));
      }
      if (urlMatches.length > 0) return [...new Set(urlMatches)];

      // Handle @mentions format
      const mentionPattern = /@([a-zA-Z0-9._]+)/g;
      const mentions = [];
      while ((match = mentionPattern.exec(text)) !== null) {
        mentions.push(sanitizeUsername(match[1]));
      }
      if (mentions.length > 0) return [...new Set(mentions)];

      // Fallback: treat as newline list (username per line)
      return lines.map(s => sanitizeUsername(s)).filter(Boolean);
    }

    // File reader helper
    async function fileToText(file) {
      return await file.text();
    }

    // Main analyze
    async function analyze({ followersList = [], followingList = [], caseSensitive = false }) {
      const map = (arr) => {
        const set = new Set();
        for (const u of arr) {
          const s = sanitizeUsername(u, caseSensitive);
          if (s) set.add(s);
        }
        return set;
      };
      const followers = map(followersList);
      const following = map(followingList);

      const nonFollowers = [...following].filter(u => !followers.has(u));
      const fans = [...followers].filter(u => !following.has(u));
      const mutuals = [...following].filter(u => followers.has(u));

      return { followersCount: followers.size, followingCount: following.size, nonFollowers, fans, mutuals, followers: [...followers], following: [...following] };
    }

    // Render results list (compact)
    function renderList(arr, kind = 'non', filterText = '') {
      const container = el('resultList');
      container.innerHTML = '';
      const term = (filterText || '').toLowerCase();

      if (!arr || arr.length === 0) {
        container.innerHTML = `
        <div style="padding: 2rem; text-align: center">
          <div style="font-size: 2rem; margin-bottom: .5rem">ğŸ“­</div>
          <p class="note">No ${kind === 'non' ? 'non-followers' : kind === 'fans' ? 'fans' : 'mutuals'} found</p>
        </div>`;
        return;
      }

      const filteredArr = arr.filter(u => !term || u.toLowerCase().includes(term));
      const kindLabels = {
        'non': 'non-followers',
        'fans': 'fans',
        'mutual': 'mutuals'
      };
      const kindIcons = {
        'non': 'ğŸ‘¥',
        'fans': 'â­',
        'mutual': 'ğŸ¤'
      };

      // Header with stats and bulk actions
      const header = document.createElement('div');
      header.style.cssText = 'display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: .75rem; background: rgba(255,255,255,.02); border-radius: var(--radius); border: 1px solid var(--border)';
      header.innerHTML = `
      <div style="display: flex; align-items: center; gap: .5rem">
        <span style="font-size: 1.2rem">${kindIcons[kind]}</span>
        <div>
          <div style="font-weight: 800; font-size: 1.1rem">${filteredArr.length.toLocaleString()} ${kindLabels[kind]}</div>
          ${term ? `<div class="note small">Filtered from ${arr.length.toLocaleString()} total</div>` : ''}
        </div>
      </div>
      <div style="display: flex; gap: .5rem; flex-wrap: wrap">
        <button id="selectAllBtn" class="btn sm secondary">âœ“ Select All</button>
        <button id="selectNoneBtn" class="btn sm ghost">âœ— Select None</button>
        <button id="copySelectedBtn" class="btn sm">ğŸ“‹ Copy Selected</button>
        <button id="copyAllBtn" class="btn sm ghost">ğŸ“‹ Copy All</button>
      </div>
    `;
      container.appendChild(header);

      // List container
      const list = document.createElement('div');
      list.style.cssText = 'display: grid; gap: .5rem';

      const checkboxMap = new Map();
      let selectedCount = 0;

      // Update selected count display
      const updateSelectedCount = () => {
        const selected = [...checkboxMap.values()].filter(cb => cb.checked).length;
        const selectedInfo = container.querySelector('#selectedInfo');
        if (selectedInfo) {
          selectedInfo.textContent = selected > 0 ? `${selected} selected` : '';
          selectedInfo.style.display = selected > 0 ? 'block' : 'none';
        }
      };

      // Create selected count indicator
      const selectedInfo = document.createElement('div');
      selectedInfo.id = 'selectedInfo';
      selectedInfo.style.cssText = 'font-size: .85rem; color: var(--brand); margin-bottom: .5rem; display: none';
      container.appendChild(selectedInfo);

      // Render user rows
      filteredArr.forEach((u, index) => {
        const row = document.createElement('div');
        row.className = 'user-row';
        row.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: .75rem; border: 1px solid var(--border); border-radius: var(--radius); background: rgba(255,255,255,.01); transition: all .2s ease';

        // Left side - checkbox, avatar, username
        const left = document.createElement('div');
        left.style.cssText = 'display: flex; align-items: center; gap: .75rem; flex: 1';

        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.className = 'row-check';
        cb.style.cssText = 'width: 16px; height: 16px; accent-color: var(--brand)';
        cb.addEventListener('change', updateSelectedCount);
        checkboxMap.set(u, cb);

        const avatar = document.createElement('div');
        avatar.className = 'user-avatar';
        avatar.textContent = u[0]?.toUpperCase() || 'U';

        const userInfo = document.createElement('div');
        userInfo.className = 'user-info';
        userInfo.innerHTML = `
        <div class="username">${u}</div>
        <div class="user-handle">@${u}</div>
      `;

        left.appendChild(cb);
        left.appendChild(avatar);
        left.appendChild(userInfo);

        // Right side - actions
        const right = document.createElement('div');
        right.style.cssText = 'display: flex; gap: .5rem; align-items: center';

        const copyBtn = document.createElement('button');
        copyBtn.className = 'btn sm ghost';
        copyBtn.innerHTML = 'ğŸ“‹';
        copyBtn.title = 'Copy username';
        copyBtn.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(u);
            copyBtn.innerHTML = 'âœ“';
            setTimeout(() => copyBtn.innerHTML = 'ğŸ“‹', 1000);
          } catch (e) {
            alert('Failed to copy username');
          }
        });

        const profileBtn = document.createElement('a');
        profileBtn.className = 'btn sm ghost';
        profileBtn.innerHTML = 'ğŸ”—';
        profileBtn.title = 'View Instagram profile';
        profileBtn.href = `https://instagram.com/${u}`;
        profileBtn.target = '_blank';
        profileBtn.rel = 'noopener noreferrer';

        right.appendChild(copyBtn);
        right.appendChild(profileBtn);

        row.appendChild(left);
        row.appendChild(right);

        // Hover effects
        row.addEventListener('mouseenter', () => {
          row.style.background = 'rgba(122, 162, 255, .05)';
          row.style.borderColor = 'rgba(122, 162, 255, .2)';
        });
        row.addEventListener('mouseleave', () => {
          row.style.background = 'rgba(255,255,255,.01)';
          row.style.borderColor = 'var(--border)';
        });

        list.appendChild(row);
      });

      container.appendChild(list);

      // Bind header button events
      el('selectAllBtn')?.addEventListener('click', () => {
        checkboxMap.forEach(cb => cb.checked = true);
        updateSelectedCount();
      });

      el('selectNoneBtn')?.addEventListener('click', () => {
        checkboxMap.forEach(cb => cb.checked = false);
        updateSelectedCount();
      });

      el('copySelectedBtn')?.addEventListener('click', async () => {
        const selected = [...checkboxMap.keys()].filter(u => checkboxMap.get(u).checked);
        if (selected.length === 0) {
          alert('No users selected');
          return;
        }
        try {
          await navigator.clipboard.writeText(selected.join('\n'));
          alert(`Copied ${selected.length} usernames`);
        } catch (e) {
          alert('Failed to copy usernames');
        }
      });

      el('copyAllBtn')?.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(filteredArr.join('\n'));
          alert(`Copied all ${filteredArr.length} usernames`);
        } catch (e) {
          alert('Failed to copy usernames');
        }
      });
    }

    // Persistent memory keys (optional)
    const MEM_KEY = 'ig-audit:last';

    // Wire up UI
    document.addEventListener('DOMContentLoaded', () => {
      el('y').textContent = new Date().getFullYear();

      // drag & drop support
      const dz = el('dropzone');
      dz.addEventListener('dragover', (e) => { e.preventDefault(); dz.style.opacity = '0.9'; });
      dz.addEventListener('dragleave', () => dz.style.opacity = '1');
      dz.addEventListener('drop', async (e) => {
        e.preventDefault(); dz.style.opacity = '1';
        const files = Array.from(e.dataTransfer.files || []);
        // fill file inputs (if applicable)
        if (files.length >= 1) el('fileFollowers').files = createFileList(files[0] ? files : []);
        if (files.length >= 2) el('fileFollowing').files = createFileList(files.slice(1, 2));
        // attempt to parse and analyze automatically
        await doParse();
      });

      // helper to create a FileList-like object (small polyfill)
      function createFileList(arr) {
        const b = new DataTransfer();
        arr.forEach(f => b.items.add(f));
        return b.files;
      }

      // Read files and paste area to build lists
      async function gatherInputs() {
        const caseSensitive = el('caseSensitive').checked;
        const followersFiles = el('fileFollowers').files;
        const followingFiles = el('fileFollowing').files;
        const paste = el('pasteArea').value.trim();

        let followersList = [], followingList = [];

        // If both files present, assume first is followers, second is following OR autodetect by filename
        if (followersFiles && followersFiles.length) {
          // try all provided files; detect by name keywords
          for (const f of followersFiles) {
            const txt = await fileToText(f);
            // Heuristics: if filename contains 'followers' treat as followers
            if (f.name.toLowerCase().includes('followers')) {
              followersList = followersList.concat(await parseTextContent(txt));
            } else if (f.name.toLowerCase().includes('following') || f.name.toLowerCase().includes('friends')) {
              followingList = followingList.concat(await parseTextContent(txt));
            } else {
              // try to parse and decide by size later
              const parsed = await parseTextContent(txt);
              // naive: if parsed seems large put into followers
              if (parsed.length > 0) followersList = followersList.concat(parsed);
            }
          }
        }
        if (followingFiles && followingFiles.length) {
          for (const f of followingFiles) {
            const txt = await fileToText(f);
            if (f.name.toLowerCase().includes('following')) {
              followingList = followingList.concat(await parseTextContent(txt));
            } else if (f.name.toLowerCase().includes('followers')) {
              followersList = followersList.concat(await parseTextContent(txt));
            } else {
              const parsed = await parseTextContent(txt);
              if (parsed.length > 0 && followingList.length === 0) followingList = followingList.concat(parsed);
            }
          }
        }

        if (paste) {
          // If paste contains two sections separated by "---" or "FOLLOWERS" headings, try to split
          // Otherwise treat as combined and attempt to detect which is which by count heuristic
          const headingMatch = paste.match(/(^|\\n)\\s*(followers|following)\\s*[:\\-\\n]/i);
          if (headingMatch) {
            // crude split: find 'followers' block and 'following' block
            const lower = paste.toLowerCase();
            const idxFollowers = lower.indexOf('followers');
            const idxFollowing = lower.indexOf('following');
            if (idxFollowers !== -1 && idxFollowing !== -1) {
              const first = Math.min(idxFollowers, idxFollowing);
              const last = Math.max(idxFollowers, idxFollowing);
              const blockA = paste.slice(first, last);
              const blockB = paste.slice(last);
              const a = await parseTextContent(blockA);
              const b = await parseTextContent(blockB);
              // assign by name
              if (blockA.toLowerCase().includes('followers')) followersList = followersList.concat(a);
              else followingList = followingList.concat(a);
              if (blockB.toLowerCase().includes('followers')) followersList = followersList.concat(b);
              else followingList = followingList.concat(b);
            } else {
              // fallback: parse entire paste into both lists (dedupe later)
              const parsed = await parseTextContent(paste);
              if (parsed.length) { followersList = followersList.concat(parsed); followingList = followingList.concat(parsed); }
            }
          } else {
            // single list: try to detect whether it's followers or following by size heuristic vs any parsed files
            const parsed = await parseTextContent(paste);
            if (parsed.length) {
              // if one of lists is empty, fill it
              if (!followersList.length) followersList = followersList.concat(parsed);
              else if (!followingList.length) followingList = followingList.concat(parsed);
              else {
                // both exist, merge into both; later dedupe
                followersList = followersList.concat(parsed);
                followingList = followingList.concat(parsed);
              }
            }
          }
        }

        // final dedupe
        followersList = Array.from(new Set(followersList.map(u => sanitizeUsername(u, el('caseSensitive').checked))));
        followingList = Array.from(new Set(followingList.map(u => sanitizeUsername(u, el('caseSensitive').checked))));

        // If one side is empty but both files present, try swapping if heuristic suggests
        return { followersList, followingList, caseSensitive: el('caseSensitive').checked };
      }

      // parse button
      el('parseBtn').addEventListener('click', async () => {
        await doParse();
      });

      async function doParse() {
        try {
          const raw = await gatherInputs();
          const out = await analyze(raw);
          // update stats
          el('statFollowing').textContent = rs(out.followingCount);
          el('statFollowers').textContent = rs(out.followersCount);
          el('statNon').textContent = rs(out.nonFollowers.length);
          el('statMutual').textContent = rs(out.mutuals.length);
          // default show non-followers
          window.__IG_AUDIT = out; // keep in memory for export
          renderList(out.nonFollowers, 'non', el('search').value);
          // persist to localStorage if user closes accidentally (encrypted later if desired)
          persist(MEM_KEY, { meta: { when: Date.now() }, data: out });
        } catch (e) {
          alert('Could not parse input: ' + (e && e.message ? e.message : e));
        }
      }

      // search debounce
      el('search').addEventListener('input', debounce((ev) => {
        const q = ev.target.value.trim();
        const out = window.__IG_AUDIT;
        if (!out) return;
        // determine currently visible set by last viewed mode (for simplicity prefer nonFollowers)
        // We will pick which button was last used by tracking a mode
        const mode = window.__IG_MODE || 'non';
        if (mode === 'non') renderList(out.nonFollowers, 'non', q);
        if (mode === 'fans') renderList(out.fans, 'fans', q);
        if (mode === 'mutual') renderList(out.mutuals, 'mutual', q);
      }, 180));

      // mode buttons
      el('showNonBtn').addEventListener('click', () => { window.__IG_MODE = 'non'; if (window.__IG_AUDIT) renderList(window.__IG_AUDIT.nonFollowers, 'non', el('search').value); });
      el('showFansBtn').addEventListener('click', () => { window.__IG_MODE = 'fans'; if (window.__IG_AUDIT) renderList(window.__IG_AUDIT.fans, 'fans', el('search').value); });
      el('showMutualBtn').addEventListener('click', () => { window.__IG_MODE = 'mutual'; if (window.__IG_AUDIT) renderList(window.__IG_AUDIT.mutuals, 'mutual', el('search').value); });

      // export CSV
      el('exportCsvBtn').addEventListener('click', () => {
        const out = window.__IG_AUDIT;
        if (!out) return alert('No data to export. Parse first.');
        const rows = [
          ['type', 'username']
        ];
        out.nonFollowers.forEach(u => rows.push(['non-follower', u]));
        out.fans.forEach(u => rows.push(['fan', u]));
        out.mutuals.forEach(u => rows.push(['mutual', u]));
        const csv = rows.map(r => r.map(c => '"' + String(c).replace(/"/g, '""') + '"').join(',')).join('\\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'ig-audit-' + (new Date()).toISOString().slice(0, 10) + '.csv';
        a.click();
        URL.revokeObjectURL(a.href);
      });

      // encrypted export (AES-GCM)
      el('exportEncBtn').addEventListener('click', async () => {
        const out = window.__IG_AUDIT;
        if (!out) return alert('No data to export. Parse first.');

        const pass = prompt('Enter a passphrase to encrypt the export (you will need this to decrypt):');
        if (!pass) return alert('Encryption cancelled.');

        // derive key
        try {
          const enc = new TextEncoder();
          const salt = crypto.getRandomValues(new Uint8Array(16));
          const iv = crypto.getRandomValues(new Uint8Array(12));
          const baseKey = await crypto.subtle.importKey('raw', enc.encode(pass), 'PBKDF2', false, ['deriveKey']);
          const key = await crypto.subtle.deriveKey(
            { name: 'PBKDF2', salt, iterations: 200000, hash: 'SHA-256' },
            baseKey,
            { name: 'AES-GCM', length: 256 },
            true,
            ['encrypt']
          );
          const payload = JSON.stringify(out);
          const ct = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, enc.encode(payload));
          // package as JSON with salt/iv (base64)
          const packaged = {
            meta: { created: (new Date()).toISOString() },
            salt: btoa(String.fromCharCode(...new Uint8Array(salt))),
            iv: btoa(String.fromCharCode(...new Uint8Array(iv))),
            ct: btoa(String.fromCharCode(...new Uint8Array(ct)))
          };
          const blob = new Blob([JSON.stringify(packaged)], { type: 'application/json' });
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = 'ig-audit-encrypted-' + (new Date()).toISOString().slice(0, 10) + '.json';
          a.click();
          URL.revokeObjectURL(a.href);
        } catch (e) {
          console.error(e);
          alert('Encryption failed: ' + (e && e.message ? e.message : e));
        }
      });

      // forget (wipe local storage and memory)
      el('forgetBtn').addEventListener('click', () => {
        if (!confirm('Forget all stored audit data from this browser? This removes the locally stored snapshot.')) return;
        localStorage.removeItem(MEM_KEY);
        window.__IG_AUDIT = null;
        el('resultList').innerHTML = '<div class="small-note">Data cleared. Upload/parse again.</div>';
        el('statFollowing').textContent = 'â€”'; el('statFollowers').textContent = 'â€”'; el('statNon').textContent = 'â€”'; el('statMutual').textContent = 'â€”';
        el('pasteArea').value = '';
        el('fileFollowers').value = ''; el('fileFollowing').value = '';
        alert('Local data cleared.');
      });

      // clear button
      el('clearBtn').addEventListener('click', () => {
        el('pasteArea').value = '';
        el('fileFollowers').value = ''; el('fileFollowing').value = '';
        el('resultList').innerHTML = '<div class="small-note">Cleared input. Paste or upload again.</div>';
      });

      // demo sample loader
      el('demoBtn').addEventListener('click', async () => {
        // Realistic sample data for testing
        el('pasteArea').value = JSON.stringify({
          "followers": [
            { "username": "alice_wonder", "timestamp": "2024-01-15T10:30:00Z" },
            { "username": "bob_builder", "timestamp": "2024-01-14T15:45:00Z" },
            { "username": "carol_singer", "timestamp": "2024-01-13T09:20:00Z" },
            { "username": "david_photographer", "timestamp": "2024-01-12T18:10:00Z" },
            { "username": "eve_artist", "timestamp": "2024-01-11T12:00:00Z" },
            { "username": "frank_chef", "timestamp": "2024-01-10T20:30:00Z" },
            { "username": "grace_dancer", "timestamp": "2024-01-09T14:15:00Z" },
            { "username": "henry_writer", "timestamp": "2024-01-08T11:45:00Z" }
          ],
          "following": [
            { "username": "alice_wonder", "timestamp": "2024-01-15T10:30:00Z" },
            { "username": "bob_builder", "timestamp": "2024-01-14T15:45:00Z" },
            { "username": "charlie_musician", "timestamp": "2024-01-13T16:20:00Z" },
            { "username": "diana_fitness", "timestamp": "2024-01-12T13:30:00Z" },
            { "username": "ethan_tech", "timestamp": "2024-01-11T19:45:00Z" },
            { "username": "fiona_travel", "timestamp": "2024-01-10T08:15:00Z" },
            { "username": "george_food", "timestamp": "2024-01-09T21:00:00Z" },
            { "username": "hannah_fashion", "timestamp": "2024-01-08T17:30:00Z" },
            { "username": "ian_sports", "timestamp": "2024-01-07T10:45:00Z" },
            { "username": "julia_books", "timestamp": "2024-01-06T14:20:00Z" }
          ]
        }, null, 2);
        await doParse();
      });

      // try load memory
      const mem = read(MEM_KEY, null);
      if (mem && mem.data) {
        window.__IG_AUDIT = mem.data;
        el('statFollowing').textContent = rs(mem.data.following.length || mem.data.followingCount);
        el('statFollowers').textContent = rs(mem.data.followers.length || mem.data.followersCount);
        el('statNon').textContent = rs((mem.data.nonFollowers || []).length);
        el('statMutual').textContent = rs((mem.data.mutuals || []).length);
        renderList(mem.data.nonFollowers || [], 'non', '');
      }

      // helper to expose parse functionality for tests
      window.__ig_audit_tools = { analyze, parseTextContent };

      // link for "how it works" (open new tab to official instagram help)
      el('howItWorks').addEventListener('click', (ev) => {
        ev.preventDefault();
        window.open('https://help.instagram.com/181231772500920', '_blank', 'noopener');
      });

      // Mobile menu toggle functionality
      const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
      const navLinks = document.querySelector('.nav-links');

      if (mobileMenuToggle && navLinks) {
        mobileMenuToggle.addEventListener('click', () => {
          const isActive = navLinks.classList.contains('active');
          navLinks.classList.toggle('active');
          mobileMenuToggle.setAttribute('aria-expanded', !isActive);

          // Update menu icon
          const menuIcon = mobileMenuToggle.querySelector('.menu-icon');
          if (menuIcon) {
            menuIcon.textContent = isActive ? 'â˜°' : 'âœ•';
          }
        });

        // Close menu when clicking on a link
        navLinks.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', () => {
            navLinks.classList.remove('active');
            mobileMenuToggle.setAttribute('aria-expanded', 'false');
            const menuIcon = mobileMenuToggle.querySelector('.menu-icon');
            if (menuIcon) {
              menuIcon.textContent = 'â˜°';
            }
          });
        });

        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
          if (!mobileMenuToggle.contains(e.target) && !navLinks.contains(e.target)) {
            navLinks.classList.remove('active');
            mobileMenuToggle.setAttribute('aria-expanded', 'false');
            const menuIcon = mobileMenuToggle.querySelector('.menu-icon');
            if (menuIcon) {
              menuIcon.textContent = 'â˜°';
            }
          }
        });
      }

    }); // DOMContentLoaded
  </script>
</body>

</html>