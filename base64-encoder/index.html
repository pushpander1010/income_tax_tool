<!doctype html>
<html lang="en">

<head>
  <!-- Google Ads (async, single loader only) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6216304334889617"
    crossorigin="anonymous"></script>

  <!-- Perf / basics -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="x-ua-compatible" content="IE=edge" />
  <meta name="color-scheme" content="dark light" />

  <title>Base64 Encoder & Decoder (Text/File, Data URL, URL‚ÄëSafe, Wrap) ‚Äì UpTools</title>
  <meta name="description"
    content="Free, privacy‚Äëfirst Base64 encoder/decoder that runs 100% in your browser. Encode text or files (images, PDFs) and optionally output as a Data URL. Decode Base64 or Data URLs to text/bytes, detect MIME type, preview images, and download bytes. Supports URL‚Äësafe Base64, padding restore/strip, MIME line‚Äëwrap (76 chars), drag‚Äëand‚Äëdrop, SHA‚Äë256 checksum, copy, permalink, and quick examples. No uploads." />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <meta name="theme-color" content="#0b1020" />
  <link rel="canonical" href="https://www.uptools.in/base64-encoder/" />

  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="Base64 Encoder & Decoder ‚Äì Text/File, Data URL, URL‚ÄëSafe, Wrap" />
  <meta property="og:description"
    content="Encode/decode Base64 or Data URLs with UTF‚Äë8, URL‚Äësafe, padding, wrap, drag‚Äëdrop, preview, SHA‚Äë256 checksum, and downloads. All in your browser." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.uptools.in/base64-encoder/" />
  <meta property="og:site_name" content="UpTools" />
  <meta property="og:image" content="https://www.uptools.in/assets/og/base64.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Critical (tiny only) -->
  <style>
    :root {
      --bg: #0f1419;
      --surface: #121826;
      --text: #e6edf3;
      --muted: #9aa4b2;
      --brand: #7aa2ff;
      --radius: .75rem
    }

    * {
      box-sizing: border-box
    }

    html {
      color-scheme: dark light;
      -webkit-text-size-adjust: 100%
    }

    body {
      margin: 0;
      font: 400 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Noto Sans", sans-serif;
      background: var(--bg);
      color: var(--text)
    }

    img,
    svg,
    video {
      max-width: 100%;
      height: auto
    }

    .container {
      width: min(100% - 24px, 1120px);
      margin-inline: auto
    }

    a {
      color: var(--brand);
      text-decoration-thickness: .08em;
      text-underline-offset: .18em
    }

    .card {
      background: var(--surface);
      border: 1px solid #212a3a;
      border-radius: var(--radius);
      padding: 1rem
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: .65rem .9rem;
      border-radius: var(--radius);
      background: var(--brand);
      color: #0b1020;
      border: 0;
      font-weight: 700;
      cursor: pointer
    }

    .btn.secondary {
      background: transparent;
      color: var(--text);
      border: 1px solid #2a3550
    }

    .sr-only {
      position: absolute !important;
      height: 1px;
      width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px)
    }
  </style>

  <!-- Common CSS (non‚Äëblocking) -->
  <link rel="preload" href="/style.css?v=1.1.0" as="style">
  <link rel="stylesheet" href="/style.css?v=1.1.0" media="print" onload="this.media='all'">
  <noscript>
    <link rel="stylesheet" href="/style.css?v=1.1.0">
  </noscript>

  <!-- Structured data (Breadcrumb + HowTo + App + FAQ) -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"https://www.uptools.in/"},
    {"@type":"ListItem","position":2,"name":"Developer Tools","item":"https://www.uptools.in/#tools"},
    {"@type":"ListItem","position":3,"name":"Base64 Encoder/Decoder","item":"https://www.uptools.in/base64-encoder/"}
  ]}
  </script>
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"SoftwareApplication","name":"Base64 Encoder & Decoder","applicationCategory":"DeveloperApplication","operatingSystem":"Any","url":"https://www.uptools.in/base64-encoder/","description":"Encode/decode Base64 or Data URLs in‚Äëbrowser. URL‚Äësafe, padding, wrap, drag‚Äëdrop, preview, and SHA‚Äë256 checksum.","offers":{"@type":"Offer","price":"0","priceCurrency":"INR"},"publisher":{"@type":"Organization","name":"UpTools","url":"https://www.uptools.in/","logo":{"@type":"ImageObject","url":"https://www.uptools.in/assets/logo/uptools-logo.svg"}}}
  </script>
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"HowTo","name":"How to encode/decode Base64 online","description":"Encode text or files to Base64 and decode Base64 back to text/bytes in your browser.","step":[
    {"@type":"HowToStep","name":"Enter or drop input","text":"Type/paste text or drag a file into the drop zone."},
    {"@type":"HowToStep","name":"Choose options","text":"Toggle URL‚Äësafe, padding, and line wrap as needed."},
    {"@type":"HowToStep","name":"Encode or Decode","text":"Click Run. For files you can also output a Data URL."},
    {"@type":"HowToStep","name":"Copy or Download","text":"Copy the result, copy a permalink, or download decoded bytes."}
  ],"tool":[{"@type":"HowToTool","name":"Base64 Encoder/Decoder"}],"url":"https://www.uptools.in/base64-encoder/"}
  </script>
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[
    {"@type":"Question","name":"What is URL‚Äësafe Base64?","acceptedAnswer":{"@type":"Answer","text":"A variant that replaces '+' with '-' and '/' with '_' so values are safe in URLs and filenames. Padding '=' may be omitted."}},
    {"@type":"Question","name":"Can I paste a Data URL directly?","acceptedAnswer":{"@type":"Answer","text":"Yes. Paste strings like data:image/png;base64,iVBOR‚Ä¶ ‚Äî the tool detects and decodes them, infers MIME type, and lets you download the bytes."}},
    {"@type":"Question","name":"Is my data uploaded anywhere?","acceptedAnswer":{"@type":"Answer","text":"No. Everything runs locally in your browser. Nothing is sent to a server."}}
  ]}
  </script>
</head>

<body>
  <a class="sr-only" href="#main">Skip to content</a>

  <!-- Header (uses common classes & main logo) -->
  <header class="site" role="banner">
    <div class="header-inner container">
      <a class="brand" href="/" aria-label="UpTools Home">
        <img src="/assets/logo/uptools-logo.svg" alt="UpTools logo" width="28" height="28" loading="eager">
        <b>UpTools</b>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/#tools">Tools</a>
        <a href="/json-formatter/">JSON</a>
        <a href="/text-case-converter/">Text</a>
        <a href="/qr-generator/">QR</a>
        <a href="/contact/">Contact</a>
      </nav>
    </div>
  </header>

  <main id="main" class="wrap container" role="main">
    <!-- Hero -->
    <section class="card hero" aria-labelledby="title">
      <div class="tool-icon" aria-hidden="true">64</div>
      <div>
        <h1 id="title">Base64 Encoder/Decoder</h1>
        <div class="chips" aria-label="Highlights">
          <span class="pill">üîí Offline</span>
          <span class="pill">üß∞ Text & File</span>
          <span class="pill">üßæ Data URL</span>
          <span class="pill">üåê URL‚Äësafe</span>
          <span class="pill">‚úÇ Wrap 76</span>
        </div>
      </div>
      <!-- CLS‚Äësafe art (optional, fixed size) -->
      <img src="/assets/ui/base64-illustration.png" alt="Illustration: Base64 blocks" width="96" height="96"
        loading="lazy" style="margin-left:auto;border-radius:12px;border:1px solid var(--border)">
    </section>

    <!-- Top ad (fixed height to avoid CLS) -->
    <section class="card ad-wrap" aria-label="Sponsored" style="min-height:120px">
      <ins class="adsbygoogle" style="display:block;min-height:120px" data-ad-client="ca-pub-6216304334889617"
        data-ad-slot="b64-top-01" data-ad-format="auto" data-full-width-responsive="true"></ins>
    </section>

    <section class="layout" style="display:grid;gap:12px;grid-template-columns:1fr 360px">
      <!-- Left column: controls -->
      <div>
        <article class="card" aria-labelledby="work-head">
          <h2 id="work-head">Encode or Decode</h2>

          <!-- Options -->
          <div class="grid">
            <div>
              <label class="label" for="mode">Mode</label>
              <select id="mode" class="input" aria-label="Choose encode or decode">
                <option value="encode">Encode (text/file ‚Üí Base64)</option>
                <option value="decode">Decode (Base64/Data URL ‚Üí text/bytes)</option>
              </select>
            </div>

            <div>
              <label class="label" for="urlsafe">URL‚Äësafe Variant</label>
              <select id="urlsafe" class="input">
                <option value="off">Off (RFC 4648 standard)</option>
                <option value="on">On (use - and _)</option>
              </select>
            </div>

            <div>
              <label class="label" for="padding">Padding ‚Äú=‚Äù</label>
              <select id="padding" class="input">
                <option value="keep">Keep/restore padding</option>
                <option value="strip">Strip padding</option>
              </select>
            </div>

            <div>
              <label class="label" for="wrap">Line Wrap</label>
              <select id="wrap" class="input">
                <option value="none">No wrap</option>
                <option value="76">MIME 76 chars</option>
                <option value="64">64 chars</option>
              </select>
            </div>

            <div>
              <label class="label" for="asDataURL">Output as Data URL</label>
              <select id="asDataURL" class="input" aria-label="When encoding files">
                <option value="auto">Auto for files</option>
                <option value="always">Always</option>
                <option value="never">Never</option>
              </select>
            </div>

            <div class="full">
              <label class="label" for="input">Input</label>
              <textarea id="input" class="textarea" rows="6"
                placeholder="Type/paste Base64 or text here‚Ä¶&#10;Tip: You can paste a Data URL like data:image/png;base64,iVBORw0‚Ä¶"></textarea>
              <div class="note">Tip: Drag &amp; drop a file below to encode it, or paste a Data URL to decode.</div>
            </div>

            <div class="full">
              <label class="label" for="drop">Drop a file (optional)</label>
              <div id="drop" class="result center" style="min-height:84px;text-align:center"
                aria-label="Drag and drop file here">
                <div class="muted">üìÅ Drop file here or <label class="chip" style="cursor:pointer">choose<input
                      id="file" type="file" class="sr-only"></label></div>
              </div>
            </div>

            <div class="full toolbar" style="display:flex;gap:8px;flex-wrap:wrap">
              <button id="btnGo" class="btn">Run</button>
              <button id="btnSwap" class="btn secondary">Swap</button>
              <button id="btnClean" class="btn secondary">Clean</button>

              <div class="menu" id="moreMenu">
                <button type="button" class="btn ghost menu-btn" aria-haspopup="true" aria-expanded="false"
                  aria-controls="moreList">More ‚ñæ</button>
                <div class="menu-list card" id="moreList" role="menu" aria-label="More actions"
                  style="display:none;position:relative;z-index:2">
                  <button type="button" role="menuitem" id="btnCopyOut">Copy output</button>
                  <button type="button" role="menuitem" id="btnCopyDataURL">Copy as Data URL</button>
                  <button type="button" role="menuitem" id="btnPermalink">Copy permalink</button>
                  <button type="button" role="menuitem" id="btnDownload">Download decoded bytes</button>
                  <button type="button" role="menuitem" id="btnClearFile">Clear loaded file</button>
                  <div class="divider" role="separator"></div>
                  <button type="button" role="menuitem" id="btnExampleTxt">Example: ‚Äú‡§®‡§Æ‡§∏‡•ç‡§§‡•á world üëã‚Äù</button>
                  <button type="button" role="menuitem" id="btnExampleImg">Example: Tiny PNG</button>
                </div>
              </div>
            </div>
          </div>
        </article>

        <section class="card" aria-labelledby="learn">
          <h2 id="learn">What is Base64?</h2>
          <p>Base64 encodes binary data as text using 64 symbols (A‚ÄìZ, a‚Äìz, 0‚Äì9, +, /). It‚Äôs common in data URLs, email
            (MIME), JSON embedding, and URL tokens. Use URL‚Äësafe when embedding in URLs.</p>
          <p class="note">Spec: <a href="https://datatracker.ietf.org/doc/html/rfc4648" rel="nofollow"
              target="_blank">RFC&nbsp;4648</a>. For email/MIME wrapping guidance, see <a
              href="https://www.rfc-editor.org/rfc/rfc2045" rel="nofollow" target="_blank">RFC&nbsp;2045</a>.</p>
        </section>

        <aside class="card" aria-labelledby="related">
          <h2 id="related">Related tools</h2>
          <ul class="tool-list">
            <li><a class="tool-link accent-violet" href="/json-formatter/"><span class="ico"
                  aria-hidden="true">üß©</span><span>JSON Formatter</span></a></li>
            <li><a class="tool-link accent-lime" href="/uuid-generator/"><span class="ico"
                  aria-hidden="true">üÜî</span><span>UUID Generator</span></a></li>
            <li><a class="tool-link accent-sky" href="/qr-generator/"><span class="ico"
                  aria-hidden="true">üî≥</span><span>QR Code Generator</span></a></li>
            <li><a class="tool-link accent-orange" href="/word-counter/"><span class="ico"
                  aria-hidden="true">üìù</span><span>Word Counter</span></a></li>
            <li><a class="tool-link accent-indigo" href="/ip-address/"><span class="ico"
                  aria-hidden="true">üåê</span><span>Your IP Address</span></a></li>
          </ul>
        </aside>

        <section class="card" aria-labelledby="vid">
          <h2 id="vid">60‚Äësecond explainer üé•</h2>
          <!-- Fixed size to avoid CLS -->
          <iframe class="embed" width="560" height="315"
            src="https://www.youtube-nocookie.com/embed/MI0W6FdDjTY?rel=0&modestbranding=1"
            title="What are Base64 Encoded Images and Why They're Used?" loading="lazy"
            referrerpolicy="strict-origin-when-cross-origin"
            allow="accelerometer; clipboard-write; encrypted-media; picture-in-picture; web-share" allowfullscreen>
          </iframe>


        </section>
      </div>

      <!-- Right column: sticky result panel -->
      <aside class="sticky">
        <div class="card result" aria-live="polite" aria-atomic="true">
          <h2 style="margin-bottom:6px;">Output</h2>
          <div class="badge" id="status">‚Äî</div>
          <div class="divider"></div>

          <div class="kvi"><span>Bytes in</span><span id="statIn" class="amount">0</span></div>
          <div class="kvi"><span>Bytes out</span><span id="statOut" class="amount">0</span></div>
          <div class="kvi"><span>Estimated size change</span><span id="statChange" class="amount">‚Äî</span></div>
          <div class="kvi"><span>MIME</span><span id="mime" class="amount">‚Äî</span></div>
          <div class="kvi"><span>SHA‚Äë256</span><span id="sha256" class="amount">‚Äî</span></div>

          <div class="divider"></div>
          <textarea id="output" class="textarea" rows="10" aria-label="Output"></textarea>

          <div class="btn-group" style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
            <button id="copy" class="btn secondary">Copy</button>
            <button id="copyDataURL" class="btn secondary">Copy Data URL</button>
            <button id="download" class="btn secondary">Download</button>
            <button id="clearOut" class="btn secondary">Clear</button>
          </div>

          <div id="preview" class="note small" style="margin-top:10px;"></div>
        </div>
      </aside>
    </section>

    <!-- Bottom ad -->
    <section class="card ad-wrap" aria-label="Sponsored" style="min-height:120px;margin-top:12px">
      <ins class="adsbygoogle" style="display:block;min-height:120px" data-ad-client="ca-pub-6216304334889617"
        data-ad-slot="b64-bottom-02" data-ad-format="auto" data-full-width-responsive="true"></ins>
    </section>

    <footer class="note small site-footer" role="contentinfo">
      ¬© <span id="y"></span> UpTools ¬∑ <a href="/about/">About</a> ¬∑ <a href="/contact/">Contact</a> ¬∑ <a
        href="/sitemap.xml">Sitemap</a> ¬∑ <a href="/robots.txt">Robots</a>
    </footer>
  </main>

  <!-- Logic (module, uses shared utils.js) -->
  <script type="module">
    import { $, $$, debounce, setText, persist, read } from '/scripts/utils.js';

    // Footer, ads
    setText($('#y'), new Date().getFullYear());
    try { (window.adsbygoogle = window.adsbygoogle || []).push({}); } catch { }
    try { (window.adsbygoogle = window.adsbygoogle || []).push({}); } catch { }

    // UTF‚Äë8 helpers
    const enc = new TextEncoder();
    const dec = new TextDecoder();

    // Bytes <-> Base64 (binary-safe)
    const bytesToBase64 = (bytes) => {
      let bin = '';
      const chunk = 0x8000;
      for (let i = 0; i < bytes.length; i += chunk) {
        bin += String.fromCharCode.apply(null, bytes.subarray(i, i + chunk));
      }
      return btoa(bin);
    };
    const base64ToBytes = (b64) => {
      const bin = atob(b64);
      const bytes = new Uint8Array(bin.length);
      for (let i = 0; i < bin.length; i++) bytes[i] = bin.charCodeAt(i);
      return bytes;
    };

    // Variants
    const makeUrlSafe = (s) => s.replace(/\+/g, '-').replace(/\//g, '_');
    const undoUrlSafe = (s) => s.replace(/-/g, '+').replace(/_/g, '/');
    const addPadding = (s) => { const m = s.length % 4; return m ? s + '='.repeat(4 - m) : s; };
    const stripPadding = (s) => s.replace(/=+$/, '');
    const wrapAt = (s, n) => n === 0 ? s : s.replace(new RegExp(`(.{1,${n}})`, 'g'), '$1\n').trim();
    const cleanBase64 = (s) => s.replace(/\s+/g, '').replace(/[^A-Za-z0-9+/_=-]/g, '');

    // Data URL parsing
    const parseDataURL = (txt) => {
      const m = /^data:([^;,]+)?(?:;charset=[^;,]+)?(;base64)?,(.*)$/i.exec(txt.trim());
      if (!m) return null;
      return { mime: m[1] || 'application/octet-stream', isB64: !!m[2], data: m[3] };
    };

    // SHA‚Äë256 checksum (hex)
    async function sha256Hex(bytes) {
      try {
        const buf = await crypto.subtle.digest('SHA-256', bytes);
        return [...new Uint8Array(buf)].map(b => b.toString(16).padStart(2, '0')).join('');
      } catch { return '‚Äî'; }
    }

    // UI els
    const els = {
      mode: $('#mode'), urlsafe: $('#urlsafe'), padding: $('#padding'), wrap: $('#wrap'), asDataURL: $('#asDataURL'),
      input: $('#input'), file: $('#file'), drop: $('#drop'),
      output: $('#output'), status: $('#status'), statIn: $('#statIn'), statOut: $('#statOut'),
      statChange: $('#statChange'), mime: $('#mime'), sha256: $('#sha256'),
      copy: $('#copy'), copyDataURL: $('#copyDataURL'), download: $('#download'), clearOut: $('#clearOut'),
      btnGo: $('#btnGo'), btnSwap: $('#btnSwap'), btnClean: $('#btnClean'),
      moreMenu: $('#moreMenu'), moreBtn: $('#moreMenu .menu-btn'), moreList: $('#moreList'),
      btnCopyOut: $('#btnCopyOut'), btnCopyDataURL: $('#btnCopyDataURL'), btnPermalink: $('#btnPermalink'),
      btnDownload: $('#btnDownload'), btnClearFile: $('#btnClearFile'),
      btnExampleTxt: $('#btnExampleTxt'), btnExampleImg: $('#btnExampleImg'),
      preview: $('#preview')
    };

    // Status helpers
    const setStatus = (t, cls = '') => { els.status.className = 'badge ' + (cls || ''); els.status.textContent = t; };
    const setStats = (inB, outB) => {
      setText(els.statIn, String(inB || 0));
      setText(els.statOut, String(outB || 0));
      if (!inB && !outB) return setText(els.statChange, '‚Äî');
      const ch = outB && inB ? ((outB / inB - 1) * 100) : 0;
      setText(els.statChange, isFinite(ch) ? (ch >= 0 ? '+' : '') + ch.toFixed(1) + '%' : '‚Äî');
    };
    const setMime = (v) => setText(els.mime, v || '‚Äî');
    const setHash = (v) => setText(els.sha256, v || '‚Äî');

    // Render preview for common image types
    const renderPreview = (bytes, mime = 'application/octet-stream') => {
      const box = els.preview;
      if (!bytes) { box.innerHTML = ''; return; }
      const isImg = /^image\//.test(mime);
      if (isImg) {
        const blob = new Blob([bytes], { type: mime });
        const url = URL.createObjectURL(blob);
        box.innerHTML = `<div class="note">Preview:</div><img src="${url}" alt="Decoded image preview" width="320" height="200" style="max-width:100%;border-radius:8px;border:1px solid var(--border)"/>`;
        setTimeout(() => URL.revokeObjectURL(url), 8000);
      } else {
        box.innerHTML = `<div class="note">Decoded ${bytes.length} bytes (${mime}). No preview available.</div>`;
      }
    };

    // Buttons / actions
    const copy = async (val) => { try { await navigator.clipboard.writeText(val); alert('Copied!'); } catch { alert('Copy failed'); } };
    const downloadBytes = (bytes, fname = 'decoded.bin', mime = 'application/octet-stream') => {
      if (!bytes) return alert('No decoded bytes available yet.');
      const blob = new Blob([bytes], { type: mime });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = fname; a.click();
      URL.revokeObjectURL(a.href);
    };

    // File handling
    const handleFile = (file) => {
      const fr = new FileReader();
      fr.onload = e => {
        const bytes = new Uint8Array(e.target.result);
        persist('b64:fileState', { name: file.name, type: file.type || 'application/octet-stream', bytes: Array.from(bytes) });
        setStatus(`Loaded file: ${file.name}`, 'ok');
        setStats(bytes.length, 0);
        setMime(file.type || 'application/octet-stream');
      };
      fr.readAsArrayBuffer(file);
    };
    els.drop.addEventListener('dragover', (e) => { e.preventDefault(); els.drop.classList.add('skeleton'); });
    els.drop.addEventListener('dragleave', () => els.drop.classList.remove('skeleton'));
    els.drop.addEventListener('drop', (e) => { e.preventDefault(); els.drop.classList.remove('skeleton'); const f = e.dataTransfer.files?.[0]; if (f) handleFile(f); });
    els.file.addEventListener('change', (e) => { const f = e.target.files?.[0]; if (f) handleFile(f); });

    // Core ops
    async function runEncode() {
      const fileState = read('b64:fileState', null);
      let bytes, mime = 'text/plain;charset=utf-8';
      if (fileState?.bytes) { bytes = new Uint8Array(fileState.bytes); mime = fileState.type || 'application/octet-stream'; }
      else { bytes = enc.encode(els.input.value || ''); }

      let b64 = bytesToBase64(bytes);
      if (els.urlsafe.value === 'on') b64 = makeUrlSafe(b64);
      if (els.padding.value === 'strip') b64 = stripPadding(b64);
      if (els.wrap.value !== 'none') b64 = wrapAt(b64, parseInt(els.wrap.value, 10));

      // Data URL output (auto for files / or always)
      const wantDataURL = (els.asDataURL.value === 'always') || (els.asDataURL.value === 'auto' && fileState?.bytes);
      const dataURL = wantDataURL ? `data:${mime};base64,${b64.replace(/\n/g, '')}` : '';

      els.output.value = wantDataURL ? dataURL : b64;
      setStatus('Encoded ‚úì', 'ok');
      setStats(bytes.length, (wantDataURL ? dataURL.length : b64.length));
      setMime(wantDataURL ? mime : '‚Äî');
      setHash(await sha256Hex(bytes));
      renderPreview(wantDataURL ? bytes : null, mime);
    }

    async function runDecode() {
      let raw = els.input.value.trim();
      let mime = 'application/octet-stream';

      // If it's a Data URL, parse it
      const du = parseDataURL(raw);
      if (du) {
        mime = du.mime || mime;
        raw = du.isB64 ? du.data : btoa(decodeURIComponent(du.data));
      } else {
        // normalize URL‚Äësafe and whitespace for plain Base64
        if (els.urlsafe.value === 'on' || (/[-_]/.test(raw) && !/[+/]/.test(raw))) raw = undoUrlSafe(raw);
        raw = cleanBase64(raw);
        if (els.padding.value === 'keep') raw = addPadding(raw);
      }

      try {
        const bytes = base64ToBytes(raw);
        let text = '';
        try { text = dec.decode(bytes); } catch { }
        els.output.value = text || `[${bytes.length} bytes decoded ‚Äî use ‚ÄúDownload‚Äù to save]`;
        setStatus('Decoded ‚úì', 'ok');
        setStats(raw.length, text ? text.length : bytes.length);
        setMime(mime);
        setHash(await sha256Hex(bytes));
        persist('b64:lastBytes', Array.from(bytes));
        renderPreview(bytes, mime);
      } catch {
        setStatus('Invalid Base64', 'err');
        setStats(0, 0); setMime('‚Äî'); setHash('‚Äî'); renderPreview(null);
      }
    }

    const go = () => {
      persist('b64:ui', { mode: els.mode.value, urlsafe: els.urlsafe.value, padding: els.padding.value, wrap: els.wrap.value, asDataURL: els.asDataURL.value });
      if (els.mode.value === 'encode') runEncode(); else runDecode();
      updatePermalink();
    };

    const swap = () => { const t = els.input.value; els.input.value = els.output.value; els.output.value = t; setStatus('Swapped', 'warn'); };
    const clean = () => {
      if (els.mode.value === 'decode') {
        let v = els.input.value.trim();
        const likelyUrl = /[-_]/.test(v) && !/[+/]/.test(v);
        if (likelyUrl) v = undoUrlSafe(v);
        els.input.value = cleanBase64(v);
        setStatus('Cleaned (A‚ÄìZ, a‚Äìz, 0‚Äì9, +, /)', 'ok');
      } else {
        els.input.value = els.input.value.replace(/\r/g, '');
        setStatus('Whitespace cleaned', 'ok');
      }
    };

    // Menu toggle
    const toggleMenu = (open) => { els.moreList.style.display = open ? 'block' : 'none'; els.moreBtn.setAttribute('aria-expanded', open ? 'true' : 'false'); };
    els.moreBtn.addEventListener('click', () => toggleMenu(els.moreList.style.display !== 'block'));
    document.addEventListener('click', (e) => { if (!els.moreMenu.contains(e.target)) toggleMenu(false); });

    // Clipboard & downloads
    els.copy.addEventListener('click', () => copy(els.output.value));
    els.copyDataURL.addEventListener('click', () => {
      const v = els.output.value.trim();
      const val = v.startsWith('data:') ? v : `data:text/plain;base64,${cleanBase64(v).replace(/\n/g, '')}`;
      copy(val);
    });
    els.download.addEventListener('click', () => {
      const arr = read('b64:lastBytes', null); if (!arr) return alert('No decoded bytes available yet.');
      downloadBytes(new Uint8Array(arr), 'decoded.bin', $('#mime').textContent || 'application/octet-stream');
    });
    els.clearOut.addEventListener('click', () => { els.output.value = ''; setStatus('Cleared', 'warn'); });
    $('#copyDataURL').addEventListener('click', () => els.copyDataURL.click());
    $('#btnCopyOut').addEventListener('click', () => els.copy.click());
    $('#btnCopyDataURL').addEventListener('click', () => els.copyDataURL.click());
    $('#btnDownload').addEventListener('click', () => els.download.click());
    $('#btnClearFile').addEventListener('click', () => { persist('b64:fileState', null); setStatus('File state cleared', 'warn'); setMime('‚Äî'); });

    // Primary actions
    els.btnGo.addEventListener('click', go);
    els.btnSwap.addEventListener('click', swap);
    els.btnClean.addEventListener('click', clean);

    // Examples
    els.btnExampleTxt.addEventListener('click', () => { els.mode.value = 'encode'; els.input.value = '‡§®‡§Æ‡§∏‡•ç‡§§‡•á world üëã'; go(); });
    els.btnExampleImg.addEventListener('click', () => { // 1x1 transparent PNG
      const tiny = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==';
      els.mode.value = 'decode'; els.urlsafe.value = 'off'; els.padding.value = 'keep'; els.wrap.value = 'none'; els.input.value = tiny; go();
    });

    // Keyboard: Ctrl/Cmd+Enter
    document.addEventListener('keydown', (e) => { if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); go(); } });

    // Permalinks
    const updatePermalink = () => {
      const u = new URL(location.href);
      u.searchParams.set('m', els.mode.value);
      u.searchParams.set('u', els.urlsafe.value);
      u.searchParams.set('p', els.padding.value);
      u.searchParams.set('w', els.wrap.value);
      u.searchParams.set('d', els.asDataURL.value);
      const txt = els.input.value;
      if (txt && txt.length <= 800) u.searchParams.set('in', encodeURIComponent(txt)); else u.searchParams.delete('in');
      history.replaceState(null, '', u);
    };
    $('#btnPermalink').addEventListener('click', () => { updatePermalink(); copy(location.href); });

    const applyPermalink = () => {
      const u = new URL(location.href);
      const gv = (k, d) => u.searchParams.get(k) ?? d;
      els.mode.value = gv('m', 'encode');
      els.urlsafe.value = gv('u', 'off');
      els.padding.value = gv('p', 'keep');
      els.wrap.value = gv('w', 'none');
      els.asDataURL.value = gv('d', 'auto');
      const _in = u.searchParams.get('in'); if (_in) els.input.value = decodeURIComponent(_in);
    };

    // Restore UI prefs
    const restoreUI = () => {
      const ui = read('b64:ui', null); if (!ui) return;
      els.mode.value = ui.mode ?? els.mode.value;
      els.urlsafe.value = ui.urlsafe ?? els.urlsafe.value;
      els.padding.value = ui.padding ?? els.padding.value;
      els.wrap.value = ui.wrap ?? els.wrap.value;
      els.asDataURL.value = ui.asDataURL ?? els.asDataURL.value;
    };

    // Init
    applyPermalink();
    restoreUI();
    setStatus('Ready', 'warn');
  </script>
</body>

</html>