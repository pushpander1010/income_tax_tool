<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Ads (only renders if available) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6216304334889617" crossorigin="anonymous"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>AI Top 10 Stocks for Tomorrow ‚Äî Entry, Targets, Stop, Reasons | UpTools</title>

  <!-- Canonical & Favicons -->
  <link rel="canonical" href="https://www.uptools.in/ai-top10-stocks/" />
  <link rel="icon" sizes="50x50" type="image/svg+xml" href="/assets/logo/uptools-logo.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/logo/uptools-logo.svg">

  <!-- SEO -->
  <meta name="description" content="Free AI tool that predicts the Top 10 stocks to consider for tomorrow across NSE, BSE, NASDAQ, NYSE, LSE, TSX, TSE, SSE, HKEX. Uses live quotes, chart patterns, support/resistance, moving averages, RSI, valuation, dividend and latest news sentiment to give BUY ideas with entry price, targets and stop-loss." />
  <meta name="keywords" content="top 10 stocks for tomorrow,stock picks,tomorrow share market prediction,NSE picks,NASDAQ picks,AI stock screener,buy levels,targets,stop loss,news sentiment,technical analysis,fundamentals" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:large" />
  <meta name="theme-color" content="#0b1020" />

  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="AI Top 10 Stocks for Tomorrow ‚Äî Entry, Targets & Stop" />
  <meta property="og:description" content="Multi-market AI screener that ranks 10 stocks for tomorrow using TA + FA + news. Get entries, targets, stops and the why ‚Äî free, fast, no sign-up." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.uptools.in/ai-top10-stocks/" />
  <meta property="og:image" content="https://www.uptools.in/assets/og/ai-top10-stocks.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- CSS (shared) -->
  <link rel="preload" href="/style.css" as="style">
  <link rel="stylesheet" href="/style.css" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="/style.css"></noscript>

  <!-- Structured Data: Software + FAQ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"AI Top 10 Stocks for Tomorrow",
    "applicationCategory":"FinancialApplication",
    "operatingSystem":"Web",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"},
    "publisher":{"@type":"Organization","name":"UpTools","url":"https://www.uptools.in/"}
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {
        "@type":"Question",
        "name":"How are picks chosen?",
        "acceptedAnswer":{"@type":"Answer","text":"We rank candidates using technical trend (SMA50/200, RSI), pattern context (near support/breakout), basic valuation (PE, dividend), and news sentiment from Google News RSS, then combine into a transparent score."}
      },
      {
        "@type":"Question",
        "name":"Which markets are supported?",
        "acceptedAnswer":{"@type":"Answer","text":"NSE, BSE, NASDAQ, NYSE, LSE, TSX, TSE, SSE, HKEX, and XETRA/Frankfurt via Yahoo Finance symbol suffix mapping."}
      },
      {
        "@type":"Question",
        "name":"Is this investment advice?",
        "acceptedAnswer":{"@type":"Answer","text":"No. This is educational screening. Always do your own research and consider your risk tolerance before trading."}
      }
    ]
  }
  </script>

  <style>
    /* Tiny local tweaks; most styling inherits from your shared style.css */
    .hero { align-items:center; gap:12px }
    .grid-2 { display:grid; grid-template-columns:1.1fr .9fr; gap:12px }
    @media (max-width: 980px){ .grid-2 { grid-template-columns:1fr; } }
    .panel { display:grid; gap:10px }
    .mini { font-size:12px; color:var(--muted) }
    .badge { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:#0b1326; border:1px solid var(--border); box-shadow: var(--glow-soft); font-size:12px }
    .ad-slot { display:none }
    .table { width:100%; border-collapse:collapse; }
    .table th, .table td { border:1px solid var(--border); padding:8px; text-align:left; }
    .table th { background:#0c1430; position:sticky; top:0; z-index:1 }
    .pill-buy { color:#22c55e } .pill-sell { color:#ef4444 } .pill-neu { color:#a8b3cf }
    .level { font-variant-numeric: tabular-nums }
    .cards { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px }
    @media (max-width: 880px){ .cards { grid-template-columns:1fr; } }
    .cardpick { border:1px solid var(--border); border-radius:12px; padding:10px; background:#0b1326 }
    .reason { font-size:12px; color:#cdd7e5; margin-top:6px; line-height:1.45 }
    .chip-sm { display:inline-block; padding:4px 8px; border:1px solid var(--border); border-radius:999px; font-size:12px; margin-right:6px }
    .row-inline{ display:flex; gap:8px; flex-wrap:wrap; align-items:center }
  </style>
</head>

<body style="--accent:#22D3EE;--bg1:#0b0f1a;--bg2:#121a2f">
  <!-- Header -->
  <header class="site" role="banner">
    <div class="header-inner">
      <a class="brand" href="/" aria-label="UpTools Home">
        <img src="/assets/logo/uptools-logo.svg" alt="UpTools logo" width="28" height="28" loading="eager">
        <b>UpTools</b>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/#tools">Tools</a>
        <a href="/ai-stock-analyzer/">AI Stock Analyzer</a>
        <a href="/income-tax-tool/">Income Tax</a>
        <a href="/emi-calculator/">EMI</a>
        <a href="/gst-calculator/">GST</a>
      </nav>
    </div>
  </header>

  <main class="container" id="top">
    <!-- HERO -->
    <section class="card hero" aria-labelledby="title">
      <div class="tool-icon" aria-hidden="true">üìà</div>
      <div>
        <h1 id="title">AI Top 10 Stocks for Tomorrow</h1>
        <p class="note">Multi-market screener combining <b>technical</b> + <b>fundamental</b> + <b>news sentiment</b>. Get <u>entry</u>, <u>targets</u> & <u>stop-loss</u> with clear ‚Äúwhy‚Äù. <span class="mini">Free ‚Ä¢ Fast ‚Ä¢ No sign-ups</span></p>
        <div class="chips" style="margin-top:8px">
          <span class="pill">NSE ‚Ä¢ BSE ‚Ä¢ NASDAQ ‚Ä¢ NYSE ‚Ä¢ LSE ‚Ä¢ TSX ‚Ä¢ TSE ‚Ä¢ SSE ‚Ä¢ HKEX ‚Ä¢ XETRA</span>
          <a class="chip" href="/sitemap.xml">Sitemap</a>
        </div>
      </div>
    </section>

    <!-- Ad -->
    <div id="ad-mount" aria-hidden="true"></div>

    <!-- Controls -->
    <section class="card" aria-label="Controls">
      <div class="row-inline" style="justify-content:space-between;gap:12px">
        <div class="row-inline" style="flex:1;gap:10px">
          <label class="inline">
            <span class="mini">Market</span>
            <select id="market" class="select">
              <option value="NSE" selected>NSE (India)</option>
              <option value="BSE">BSE (India)</option>
              <option value="NASDAQ">NASDAQ (US)</option>
              <option value="NYSE">NYSE (US)</option>
              <option value="LSE">LSE (UK)</option>
              <option value="TSX">TSX (Canada)</option>
              <option value="TSE">TSE (Tokyo)</option>
              <option value="SSE">SSE (Shanghai)</option>
              <option value="HKEX">HKEX (Hong Kong)</option>
              <option value="FWB">XETRA/Frankfurt (DE)</option>
            </select>
          </label>
          <label class="inline">
            <span class="mini">Universe</span>
            <select id="universe" class="select" title="Which pool to scan first">
              <option value="actives" selected>Most Active</option>
              <option value="gainers">Day Gainers</option>
              <option value="mixed">Mixed (Active+Gainers)</option>
              <option value="manual">Manual (paste tickers)</option>
            </select>
          </label>
          <label class="inline" style="min-width:240px;flex:1">
            <span class="mini">Manual tickers (optional)</span>
            <input id="manual" class="input" placeholder="AAPL, TSLA, TCS, RELIANCE, 7203 ..." />
          </label>
          <label class="inline">
            <span class="mini">Picks</span>
            <select id="count" class="select">
              <option>5</option>
              <option selected>10</option>
              <option>15</option>
            </select>
          </label>
          <button id="go" class="btn" type="button">Predict ‚ñ∂</button>
        </div>
        <div class="row-inline" style="gap:8px">
          <button id="exportCsv" class="btn secondary sm" type="button">Export CSV</button>
          <button id="copySummary" class="btn secondary sm" type="button">Copy Summary</button>
        </div>
      </div>
      <div class="mini" id="status" role="status" aria-live="polite">Ready.</div>
      <p class="mini">Tip: You can paste your own watchlist and set Universe = Manual. The tool still pulls live quotes, charts and news for scoring.</p>
    </section>

    <!-- Results -->
    <section class="grid-2" aria-label="Results">
      <article class="panel">
        <section class="card" aria-labelledby="topListTitle">
          <h2 id="topListTitle" class="h5">Top 10 ‚Äî Table</h2>
          <div class="mini">Decision is computed from price trend (SMA50/200, RSI), pattern (support/resistance), basic valuation (PE, dividend) and net news tone.</div>
          <div style="overflow:auto; max-height:520px; margin-top:8px">
            <table class="table" id="tbl">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Symbol</th>
                  <th>Name</th>
                  <th>Price</th>
                  <th>Entry</th>
                  <th>Targets</th>
                  <th>Stop</th>
                  <th>TA</th>
                  <th>FA</th>
                  <th>News</th>
                  <th>Score</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>
        </section>

        <section class="card" aria-labelledby="sourcesTitle">
          <h2 id="sourcesTitle" class="h5">Data Sources</h2>
          <ul class="list compact">
            <li><a href="https://finance.yahoo.com/" rel="noopener nofollow">Yahoo Finance (quotes, charts)</a></li>
            <li><a href="https://news.google.com/" rel="noopener nofollow">Google News (RSS for headlines)</a></li>
            <li><a href="https://www.investopedia.com/terms/s/support.asp" rel="noopener">Support & Resistance ‚Äî Investopedia</a></li>
            <li><a href="/ai-stock-analyzer/">Related tool: AI Stock Analyzer</a></li>
          </ul>
        </section>
      </article>

      <article class="panel">
        <section class="card" aria-labelledby="cardsTitle">
          <h2 id="cardsTitle" class="h5">Picks ‚Äî Cards (Why & How)</h2>
          <div id="cards" class="cards"></div>
        </section>

        <section class="card" aria-labelledby="methodTitle">
          <h2 id="methodTitle" class="h5">Method (Transparent)</h2>
          <p class="mini">
            TA score: +1 price&gt;SMA50, +1 SMA50&gt;SMA200, +1 RSI in 45‚Äì65, +1 breakout above resistance, ‚àí1 RSI&gt;70, ‚àí1 price&lt;support.<br/>
            FA score: +1 PE 8‚Äì25, ‚àí1 PE&gt;35, +1 dividend ‚â•1%. News score: headline tone from Google News keywords (¬±2 cap).<br/>
            Entry: <i>breakout retest</i> (near old resistance) or <i>support bounce</i>. Stop: 1.5‚Äì2.5% below support. Targets: 1.5√ó and 2.5√ó R:R or next resistance.
          </p>
          <p class="mini">This tool is educational and not investment advice. Markets carry risk.</p>
        </section>
      </article>
    </section>

    <footer class="site-footer">
      <nav class="nav-links" aria-label="Footer">
        <a href="/about/"><span class="card-badge">ABT</span> About</a>
        <a href="/contact/"><span class="card-badge">CT</span> Contact</a>
        <a href="/sitemap.xml"><span class="card-badge">MAP</span> Sitemap</a>
        <a href="/privacy/"><span class="card-badge">PP</span> Privacy</a>
      </nav>
      <p class="tiny-note">¬© <span id="y"></span> UpTools. Educational ‚Äî not investment advice.</p>
    </footer>
  </main>

  <!-- Page Script -->
  <script type="module">
    // Use your common utils if available; fallback to /scripts
    let Utils = {};
    try { Utils = (await import('/scripts/utils.js'))?.default || (await import('/scripts/utils.js')) || {}; } catch { Utils = window || {}; }

    const $  = (s, r=document)=>r.querySelector(s);
    const $$ = (s, r=document)=>[...r.querySelectorAll(s)];
    const fmt = (v,o={}) => new Intl.NumberFormat('en-IN',{maximumFractionDigits:2, ...o}).format(v ?? 0);
    const cur = (v,c='INR') => new Intl.NumberFormat('en-IN',{style:'currency', currency:c, maximumFractionDigits:2}).format(v ?? 0);

    const yearEl = $('#y'); if(yearEl) yearEl.textContent = new Date().getFullYear();

    // AdSense mount
    (function mountAd(){
      if(!('adsbygoogle' in window)) return;
      const mount = document.getElementById('ad-mount');
      if(!mount) return;
      const wrap = document.createElement('div');
      wrap.className='ad-slot'; wrap.style.display='block'; wrap.style.margin='10px 0';
      wrap.innerHTML = '<ins class="adsbygoogle" style="display:block;width:100%;height:100px" data-ad-client="ca-pub-6216304334889617" data-full-width-responsive="true"></ins>';
      mount.appendChild(wrap);
      try { (window.adsbygoogle = window.adsbygoogle || []).push({}); } catch {}
    })();

    // Controls
    const market = $('#market'), universe = $('#universe'), manual = $('#manual'), countSel = $('#count');
    const goBtn = $('#go'), statusEl = $('#status'), tblBody = $('#tbody'), cardsEl = $('#cards');
    const exportCsvBtn = $('#exportCsv'), copySummaryBtn = $('#copySummary');

    const setStatus = (m)=>{ if(statusEl) statusEl.textContent = m; };

    // Market suffix mapping for Yahoo
    const suffixByMarket = { NSE:'.NS', BSE:'.BO', NASDAQ:'', NYSE:'', LSE:'.L', TSX:'.TO', TSE:'.T', SSE:'.SS', HKEX:'.HK', FWB:'.F' };
    const regionByMarket = { NSE:'IN', BSE:'IN', NASDAQ:'US', NYSE:'US', LSE:'GB', TSX:'CA', TSE:'JP', SSE:'CN', HKEX:'HK', FWB:'DE' };
    const buildSymbol = (t, m) => (t||'').trim().toUpperCase() + (suffixByMarket[m] ?? '');

    // Proxy fetch via Cloudflare Worker
    const api = async (url) => {
      const res = await fetch('/api?url='+encodeURIComponent(url));
      if(!res.ok) throw new Error('HTTP '+res.status);
      const ct = res.headers.get('content-type')||'';
      return ct.includes('application/json') ? res.json() : res.text();
    };

    // Yahoo quote & chart
    async function getQuote(symbol){
      const j = await api(`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbol}`);
      return j?.quoteResponse?.result?.[0] || null;
    }
    async function getChart(symbol, rangeV='6mo', intervalV='1d'){
      const j = await api(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?range=${rangeV}&interval=${intervalV}`);
      const r = j?.chart?.result?.[0];
      return { t: (r?.timestamp||[]).map(x=>x*1000), c: r?.indicators?.quote?.[0]?.close || [], meta: r?.meta||{} };
    }

    // Yahoo predefined screener (best-effort)
    async function getCandidates(market, mode='actives'){
      // fallbacks: actives / day_gainers
      const scr = mode==='gainers' ? 'day_gainers' : 'most_actives';
      const region = regionByMarket[market] || 'US';
      // Note: Yahoo may not always respect region, but /api proxy avoids CORS.
      const j = await api(`https://query1.finance.yahoo.com/v1/finance/screener/predefined/saved?scrIds=${scr}&count=60&start=0&lang=en-US&region=${region}`);
      const items = j?.finance?.result?.[0]?.quotes || [];
      // Map to symbols with suffix if needed
      const suf = suffixByMarket[market] ?? '';
      const symbols = items.map(q => {
        const s = (q?.symbol || '').toUpperCase();
        // If symbol already has suffix (e.g., RELIANCE.NS), keep as is; else add.
        return s.endsWith(suf) || suf==='' ? s : (s + suf);
      });
      return [...new Set(symbols)].slice(0, 40); // limit
    }

    // Google News (RSS)
    async function getNews(q){
      const rss = await api(`https://news.google.com/rss/search?q=${encodeURIComponent(q+' stock OR shares')}&hl=en-IN&gl=IN&ceid=IN:en`);
      return [...rss.matchAll(/<item>([\s\S]*?)<\/item>/g)].slice(0,6).map(m=>{
        const b=m[1];
        const title=(b.match(/<title><!\[CDATA\[(.*?)\]\]><\/title>/)||[])[1]||(b.match(/<title>(.*?)<\/title>/)||[])[1]||'';
        return { title };
      });
    }
    const POS=['beats','surge','record','profit','upgrade','outperform','gain','buy','rally','soars','strong','approval','order win','deal','guidance raise','dividend'];
    const NEG=['miss','plunge','loss','downgrade','underperform','fall','sell','lawsuit','probe','delay','weak','recall','fraud','ban','strike'];
    const scoreHeadline = (t)=>{ const s=(t||'').toLowerCase(); let p=0,n=0; POS.forEach(w=>{ if(s.includes(w)) p++; }); NEG.forEach(w=>{ if(s.includes(w)) n++; }); return p-n; };

    // Indicators & helpers
    const SMA=(arr,n)=> arr.map((_,i)=> i+1<n ? null : (arr.slice(i-n+1,i+1).reduce((a,b)=>a+(b??0),0)/n));
    const RSI=(closes,n=14)=>{
      let gains=0, losses=0; const out=new Array(closes.length).fill(null);
      for(let i=1;i<closes.length;i++){
        const cur=closes[i]??closes[i-1]??0, prev=closes[i-1]??closes[i]??0;
        const ch=cur-prev, g=Math.max(ch,0), l=Math.max(-ch,0);
        if(i<=n){ gains+=g; losses+=l; if(i===n){ const rs=gains/Math.max(1e-9,losses); out[i]=100-(100/(1+rs)); } }
        else{ gains=(gains*(n-1)+g)/n; losses=(losses*(n-1)+l)/n; const rs=gains/Math.max(1e-9,losses); out[i]=100-(100/(1+rs)); }
      }
      return out;
    };
    const supportResistance=(closes,look=30)=>{
      const f=closes.filter(v=>v!=null); if(!f.length) return {support:null, resistance:null};
      const s=f.slice(-look); let hi=-Infinity, lo=Infinity; s.forEach(v=>{ if(v>hi)hi=v; if(v<lo)lo=v; });
      return { support: Number.isFinite(lo)?lo:null, resistance: Number.isFinite(hi)?hi:null };
    };

    // Scoring & plan
    function makeScores({closes, quote, name, newsList}){
      const last = closes.filter(v=>v!=null).at(-1);
      const sma50 = SMA(closes,50), sma200 = SMA(closes,200), rsi = RSI(closes,14), sr = supportResistance(closes,30);
      const s50 = sma50.at(-1), s200 = sma200.at(-1), r = rsi.at(-1);
      let ta=0;
      if(last!=null && s50!=null) ta += last>s50 ? 1 : -1;          // trend vs 50
      if(s50!=null && s200!=null) ta += s50>s200 ? 1 : -1;          // golden/death cross bias
      if(r!=null && r>=45 && r<=65) ta += 1;                         // healthy momentum zone
      if(r!=null && r>70) ta -= 1;                                  // overbought
      if(sr?.resistance!=null && last!=null && last>sr.resistance) ta += 1; // possible breakout
      if(sr?.support!=null && last!=null && last<sr.support) ta -= 1;

      // FA simple
      let fa=0; const pe=quote?.trailingPE, dy=quote?.trailingAnnualDividendYield;
      if(pe && pe>=8 && pe<=25) fa += 1;
      if(pe && pe>35) fa -= 1;
      if(dy && dy*100 >= 1) fa += 1;

      // News
      let ns = 0;
      const net = (newsList||[]).reduce((a,it)=>a+scoreHeadline(it.title),0);
      ns = Math.max(-2, Math.min(2, net));

      // Plan: entries/exits
      let entry=null, stop=null, t1=null, t2=null, planNote='';
      if(sr.support!=null && sr.resistance!=null && last!=null){
        const breakout = last > sr.resistance;
        if(breakout){
          entry = sr.resistance * 1.005;               // retest +0.5%
          stop  = sr.resistance * 0.98;                // ~2% below old resistance
          const risk = entry - stop;
          t1    = entry + 1.5*risk;
          t2    = entry + 2.5*risk;
          planNote='Breakout retest setup';
        } else {
          entry = sr.support * 1.01;                   // buy slightly above support
          stop  = sr.support * 0.985;                  // ~1.5% below support
          const risk = entry - stop;
          t1    = entry + 1.5*risk;
          t2    = entry + 2.5*risk;
          planNote='Support bounce setup';
        }
      }

      const total = ta + fa + ns;
      const why = [
        last!=null&&s50!=null?`Price ${last>s50?'above':'below'} SMA50` : null,
        s50!=null&&s200!=null?`SMA50 ${s50>s200?'>':'<'} SMA200` : null,
        r!=null?`RSI ${fmt(r,{maximumFractionDigits:1})}`:null,
        sr.support!=null?`Support ${fmt(sr.support)}`:null,
        sr.resistance!=null?`Resistance ${fmt(sr.resistance)}`:null,
        pe?`PE ${fmt(pe)}`:null,
        dy?`Div ${fmt(dy*100,{maximumFractionDigits:1})}%`:null,
        net?`News ${net>=0?'+':''}${net}`:null
      ].filter(Boolean).join(' ‚Ä¢ ');

      return {
        scores:{ta,fa,ns,total},
        tech:{rsi:r, sma50:s50, sma200:s200, support:sr.support, resistance:sr.resistance},
        plan:{entry, stop, t1, t2, note:planNote},
        why
      };
    }

    // Runner
    async function run(){
      try{
        goBtn.disabled = true;
        tblBody.innerHTML=''; cardsEl.innerHTML='';
        setStatus('Building universe‚Ä¶');

        let syms = [];
        const mode = universe.value;
        if(mode==='manual'){
          syms = (manual.value||'').split(/[, \n\r\t]+/).map(s=>s.trim()).filter(Boolean).map(s=>buildSymbol(s, market.value));
        } else if(mode==='mixed'){
          const [a,g] = await Promise.all([getCandidates(market.value,'actives'), getCandidates(market.value,'gainers')]);
          syms = [...new Set([...a, ...g])].slice(0, 60);
        } else {
          syms = await getCandidates(market.value, mode);
        }
        if(!syms.length){ setStatus('No candidates found. Try manual tickers.'); return; }

        setStatus(`Scanning ${syms.length} candidates‚Ä¶`);

        // Concurrency limiter
        const limit = 5;
        const picks = [];
        let i=0;

        async function scanOne(symbol){
          try{
            const [q, ch] = await Promise.all([
              getQuote(symbol),
              getChart(symbol, '6mo', '1d')
            ]);
            const closes = ch.c || [];
            if(!closes.filter(v=>v!=null).length) return null;
            const name = q?.shortName || q?.longName || symbol;
            let news=[];
            try{ news = await getNews(name); }catch{}
            const result = makeScores({closes, quote:q, name, newsList:news});
            return {
              symbol, name, currency: q?.currency || '',
              price: q?.regularMarketPrice ?? closes.filter(v=>v!=null).at(-1) ?? null,
              newsNet: (news||[]).reduce((a,it)=>a+scoreHeadline(it.title),0),
              quote:q, ...result
            };
          }catch{return null;}
        }

        async function worker(){
          while(i<syms.length){
            const idx=i++; const res = await scanOne(syms[idx]);
            if(res) picks.push(res);
            setStatus(`Scanning ${Math.min(syms.length, idx+1)} / ${syms.length}‚Ä¶`);
          }
        }
        await Promise.all(Array.from({length:limit}, worker));

        // Rank & slice
        picks.sort((a,b)=> b.scores.total - a.scores.total);
        const topN = picks.slice(0, Number(countSel.value));

        if(!topN.length){ setStatus('No qualified picks. Try different universe.'); return; }

        // Render table
        const rows = topN.map((p,idx)=>{
          const t = p.scores;
          const plan = p.plan;
          const ent = plan.entry? fmt(plan.entry):'‚Äì';
          const tgt = plan.t1 && plan.t2 ? `${fmt(plan.t1)} / ${fmt(plan.t2)}` : '‚Äì';
          const stp = plan.stop? fmt(plan.stop) : '‚Äì';
          return `<tr>
            <td>${idx+1}</td>
            <td><b>${p.symbol}</b></td>
            <td>${p.name}</td>
            <td class="level">${p.price!=null ? (p.currency?cur(p.price,p.currency):fmt(p.price)) : '‚Äì'}</td>
            <td class="level">${ent}</td>
            <td class="level">${tgt}</td>
            <td class="level">${stp}</td>
            <td>${t.ta>=0?`+${t.ta}`:t.ta}</td>
            <td>${t.fa>=0?`+${t.fa}`:t.fa}</td>
            <td>${p.newsNet>=0?`+${p.newsNet}`:p.newsNet}</td>
            <td><b>${t.total>=0?`+${t.total}`:t.total}</b></td>
          </tr>`;
        }).join('');
        tblBody.innerHTML = rows;

        // Render cards
        cardsEl.innerHTML = topN.map(p=>{
          const pl = p.plan, t=p.scores;
          const entry = pl.entry? fmt(pl.entry) : '‚Äì';
          const t1 = pl.t1? fmt(pl.t1) : '‚Äì';
          const t2 = pl.t2? fmt(pl.t2) : '‚Äì';
          const stop = pl.stop? fmt(pl.stop) : '‚Äì';
          return `<div class="cardpick">
            <div class="row-inline" style="justify-content:space-between">
              <div>
                <div class="h6"><b>${p.symbol}</b> ¬∑ <span class="mini">${p.name}</span></div>
                <div class="mini">Price: <b>${p.price!=null ? (p.currency?cur(p.price,p.currency):fmt(p.price)) : '‚Äì'}</b></div>
              </div>
              <div>
                <span class="chip-sm">TA ${t.ta>=0?`+${t.ta}`:t.ta}</span>
                <span class="chip-sm">FA ${t.fa>=0?`+${t.fa}`:t.fa}</span>
                <span class="chip-sm">News ${p.newsNet>=0?`+${p.newsNet}`:p.newsNet}</span>
                <span class="chip-sm"><b>Total ${t.total>=0?`+${t.total}`:t.total}</b></span>
              </div>
            </div>
            <div class="row-inline" style="margin-top:6px">
              <div class="chip-sm">Entry: <b class="level">${entry}</b></div>
              <div class="chip-sm">Targets: <b class="level">${t1}</b> / <b class="level">${t2}</b></div>
              <div class="chip-sm">Stop: <b class="level">${stop}</b></div>
              <div class="chip-sm">${pl.note||'Plan n/a'}</div>
            </div>
            <div class="reason">Why: ${p.why}</div>
          </div>`;
        }).join('');

        // Export/Copy helpers
        window.__lastPicks = topN;
        setStatus(`Done. ${topN.length} picks ready.`);
      }catch(err){
        console.error(err);
        setStatus('Failed to compute picks. Try again or change universe.');
      }finally{
        goBtn.disabled = false;
      }
    }

    goBtn.addEventListener('click', run);

    // Export CSV
    exportCsvBtn.addEventListener('click', ()=>{
      const data = (window.__lastPicks||[]).map((p,idx)=>({
        rank: idx+1,
        symbol: p.symbol,
        name: p.name,
        price: p.price??'',
        currency: p.currency||'',
        entry: p.plan.entry??'',
        target1: p.plan.t1??'',
        target2: p.plan.t2??'',
        stop: p.plan.stop??'',
        ta: p.scores.ta,
        fa: p.scores.fa,
        news: p.newsNet,
        total: p.scores.total,
        why: p.why
      }));
      if(!data.length){ setStatus('Nothing to export.'); return; }
      const headers = Object.keys(data[0]);
      const rows = [headers.join(','), ...data.map(r=> headers.map(h=>{
        const v = r[h];
        const s = (''+v).replace(/"/g,'""');
        return /[",\n]/.test(s) ? `"${s}"` : s;
      }).join(','))].join('\n');
      const blob = new Blob([rows], {type:'text/csv;charset=utf-8'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'ai-top10-stocks.csv';
      a.click();
      URL.revokeObjectURL(a.href);
    });

    // Copy summary
    copySummaryBtn.addEventListener('click', async ()=>{
      const picks = window.__lastPicks||[];
      if(!picks.length){ setStatus('Nothing to copy.'); return; }
      const text = picks.map((p,i)=>{
        const pl=p.plan;
        return `${i+1}. ${p.symbol} ‚Äî ${p.name}
Price: ${p.price!=null?(p.currency?cur(p.price,p.currency):fmt(p.price)):'‚Äì'}
Entry: ${pl.entry?fmt(pl.entry):'‚Äì'} | T1: ${pl.t1?fmt(pl.t1):'‚Äì'} | T2: ${pl.t2?fmt(pl.t2):'‚Äì'} | Stop: ${pl.stop?fmt(pl.stop):'‚Äì'}
Scores: TA ${p.scores.ta>=0?`+${p.scores.ta}`:p.scores.ta}, FA ${p.scores.fa>=0?`+${p.scores.fa}`:p.scores.fa}, News ${p.newsNet>=0?`+${p.newsNet}`:p.newsNet} ‚áí Total ${p.scores.total>=0?`+${p.scores.total}`:p.scores.total}
Why: ${p.why}
`;
      }).join('\n');
      try{
        await navigator.clipboard.writeText(text);
        setStatus('Summary copied to clipboard.');
      }catch{ setStatus('Copy blocked by browser.'); }
    });

    // Run once on load
    run();
  </script>
</body>
</html>
