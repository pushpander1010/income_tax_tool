<!doctype html>
<html lang="en">
<head>
  <!-- Google AdSense (load once, globally) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6216304334889617" crossorigin="anonymous"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UpTools - Free Online Calculators, Converters & Mini Games</title>
  <meta name="description" content="Fast, privacy-first tools for everyday tasks: Income Tax, GST, EMI, SIP, Currency Converter, IFSC Finder, JSON Formatter, and mini games. No sign-ups, no bloat." />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <meta name="theme-color" content="#0f1419" />
  <meta name="keywords" content="income tax calculator,gst calculator,emi calculator,currency converter,ifsc finder,json formatter,age calculator,indian tools,uptools" />

  <!-- Canonical & Icons -->
  <link rel="canonical" href="https://www.uptools.in/"/>
  <link rel="icon" sizes="50x50" type="image/svg+xml" href="/assets/logo/uptools-logo.svg"/>
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/logo/uptools-logo.svg"/>

  <!-- Open Graph -->
  <meta property="og:title" content="UpTools - Free Online Calculators, Converters & Mini Games"/>
  <meta property="og:description" content="Fast, lightweight tools for everyday tasks. Privacy-first. No sign-ups."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://www.uptools.in/"/>
  <meta property="og:site_name" content="UpTools"/>
  <meta property="og:image" content="https://www.uptools.in/assets/og/home.png"/>
  <meta property="og:image:width" content="1200"/>
  <meta property="og:image:height" content="630"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <!-- Preconnects -->
  <link rel="preconnect" href="https://www.youtube-nocookie.com" crossorigin>
  <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>

  <!-- Critical CSS -->
  <style>
    :root{--bg:#0f1419;--surface:#121826;--text:#e6edf3;--muted:#9aa4b2;--brand:#7aa2ff;--radius:.75rem;--card:var(--surface);--border:#212a3a}
    *{box-sizing:border-box}
    html{color-scheme:dark light;-webkit-text-size-adjust:100%}
    body{margin:0;font:400 16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Noto Sans",sans-serif;background:var(--bg);color:var(--text)}
    img,svg,video{max-width:100%;height:auto;display:block}
    a{color:var(--brand);text-decoration-thickness:.08em;text-underline-offset:.18em}
    .wrap{width:min(100% - 24px,1120px);margin:24px auto}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1rem}
    .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.6rem .9rem;border-radius:var(--radius);background:var(--brand);color:#0b1020;border:0;font-weight:800;text-decoration:none;cursor:pointer}
    .btn.secondary{background:#1a2436;color:var(--text);border:1px solid var(--border)}
    .btn.secondary.sm{padding:.45rem .7rem;font-weight:700}
    .pill,.chip{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .55rem;border-radius:999px;background:#182033;border:1px solid var(--border);font-size:.85rem;color:var(--muted)}
    .badge{font-size:.75rem;background:#0d1628;color:#9fb5ff;border-color:#2a3a5a}
    .note{color:var(--muted)} .note.small{font-size:.9rem}
    .sr-only{position:absolute;left:-9999px}

    /* Header (stable) */
    .site{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,#0f1419,#0f1419f2 70%,transparent);backdrop-filter:saturate(140%) blur(6px);border-bottom:1px solid #0f1a2a}
    .header-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;width:min(100% - 24px,1120px);margin:0 auto;min-height:56px;padding:8px 0}
    .brand{display:inline-flex;align-items:center;gap:.6rem;color:var(--text);text-decoration:none;font-weight:900}
    .nav-links{display:flex;flex-wrap:wrap;gap:.75rem}
    .nav-links a{color:var(--text);opacity:.9;text-decoration:none;padding:.25rem .4rem;border-radius:.5rem}
    .nav-links a[aria-current="page"]{background:#182033;border:1px solid var(--border)}

    /* Hero */
    .hero{display:grid;grid-template-columns:auto 1fr;gap:12px;align-items:center;min-height:128px}
    .hero-logo{width:48px;height:48px}
    h1{margin:.1rem 0 .25rem 0;line-height:1.25}

    /* Grids + cards */
    .tools-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
    .tool-card{min-height:200px}
    .tool-title{display:inline-block}
    .tool-desc{min-height:2.3em}

    /* Video reserved via aspect-ratio */
    .video-shell{position:relative;width:100%;aspect-ratio:16/9;border-radius:var(--radius);overflow:hidden;background:#0b1220;border:1px solid var(--border)}
    .video-shell iframe{position:absolute;inset:0;width:100%;height:100%;border:0}

    /* Ad wrapper: reserve space to avoid CLS; keep visible */
    #adWrap{min-height:120px}
    #adWrap > .adsbygoogle{display:block;min-height:120px}

    /* Show/Hide reserved sections without popping layout */
    .reserved{min-height:var(--reserve,0)}
    .is-invisible{visibility:hidden}

    /* Skeletons */
    .skeleton{position:relative;overflow:hidden;background:#0f1627;border:1px solid var(--border);border-radius:var(--radius)}
    .s1{height:20px;width:40%;margin:.3rem 0;border-radius:.35rem}
    .s2{height:14px;width:70%;margin:.25rem 0;border-radius:.35rem}
    .s3{height:14px;width:55%;margin:.25rem 0;border-radius:.35rem}
    .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);background:linear-gradient(90deg,transparent,rgba(255,255,255,.06),transparent);animation:sh .9s infinite}
    @keyframes sh{to{transform:translateX(100%)}}

    @media (prefers-reduced-motion:no-preference){
      .tool-card,.card{transition:transform .12s ease, box-shadow .12s ease}
      .tool-card:hover{transform:translateY(-1px)}
    }
  </style>

  <!-- Promote CSS without media-swap -->
  <link rel="preload" href="/style.css?v=1.3.0" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/style.css?v=1.3.0"></noscript>

  <!-- Structured Data -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"WebSite","name":"UpTools","url":"https://www.uptools.in/","publisher":{"@type":"Organization","name":"UpTools","logo":{"@type":"ImageObject","url":"https://www.uptools.in/assets/logo/uptools-logo.svg","width":256,"height":256}},"potentialAction":{"@type":"SearchAction","target":"https://www.uptools.in/?q={search_term_string}","query-input":"required name=search_term_string"}}
  </script>
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"ItemList","name":"Featured Tools","itemListElement":[
    {"@type":"ListItem","position":1,"url":"https://www.uptools.in/income-tax-tool/"},
    {"@type":"ListItem","position":2,"url":"https://www.uptools.in/gst-calculator/"},
    {"@type":"ListItem","position":3,"url":"https://www.uptools.in/emi-calculator/"},
    {"@type":"ListItem","position":4,"url":"https://www.uptools.in/currency-converter/"},
    {"@type":"ListItem","position":5,"url":"https://www.uptools.in/ifsc-finder/"}
  ]}
  </script>
</head>
<body style="--accent:#60A5FA;--bg1:#0f1419;--bg2:#182033">
  <a href="#main" class="sr-only">Skip to content</a>

  <header class="site" role="banner">
    <div class="header-inner">
      <a class="brand" href="/" aria-label="UpTools Home">
        <img src="/assets/logo/uptools-logo.svg" alt="UpTools logo" width="28" height="28" loading="eager">
        <b>UpTools</b>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/#tools" aria-current="page">Tools</a>
        <a href="/income-tax-tool/">Income Tax</a>
        <a href="/emi-calculator/">EMI</a>
        <a href="/gst-calculator/">GST</a>
        <a href="/games/">Games</a>
        <a href="/about/">About</a>
        <a href="/contact/">Contact</a>
      </nav>
    </div>
  </header>

  <main id="main" class="wrap" role="main">
    <!-- Hero -->
    <section class="card hero" aria-labelledby="hero-title">
      <img class="hero-logo" src="/assets/logo/uptools-logo.svg" alt="UpTools compact logo" width="48" height="48" loading="eager">
      <div>
        <h1 id="hero-title">Your everyday toolkit.</h1>
        <p class="note" style="margin:0">Calculators, converters, formatters &amp; games - fast, privacy-first, no sign-ups.</p>
        <div class="chips" style="margin-top:10px">
          <span class="pill">‚ö° Loads fast</span>
          <span class="pill">üïµÔ∏è Privacy-first</span>
          <a class="chip" href="/sitemap.xml" title="Explore everything">Sitemap</a>
        </div>
      </div>
    </section>

    <!-- Search + filters -->
    <section class="controls" aria-label="Search and filters" style="display:grid;grid-template-columns:1fr;gap:.75rem;margin:16px 0 8px">
      <div class="search" role="search">
        <span aria-hidden="true">üîé</span>
        <input id="q" class="input" type="search" inputmode="search" placeholder="Search tools (e.g., tax, gst, currency, json)‚Ä¶" aria-label="Search tools">
        <button class="btn secondary" id="clearBtn" aria-label="Clear search" title="Clear">Clear</button>
      </div>
      <div class="filters" aria-label="Tags">
        <label class="chip"><input type="checkbox" value="tax"> Tax</label>
        <label class="chip"><input type="checkbox" value="finance"> Finance</label>
        <label class="chip"><input type="checkbox" value="banking"> Banking</label>
        <label class="chip"><input type="checkbox" value="text"> Text</label>
        <label class="chip"><input type="checkbox" value="dev"> Dev</label>
        <label class="chip"><input type="checkbox" value="security"> Security</label>
        <label class="chip"><input type="checkbox" value="images"> Images</label>
        <label class="chip"><input type="checkbox" value="identity"> Identity</label>
        <label class="chip"><input type="checkbox" value="canada"> Canada</label>
        <label class="chip"><input type="checkbox" value="networking"> Networking</label>
      </div>
    </section>

    <!-- Ad slot (visible + reserved; official markup) -->
    <section id="adWrap" class="section" aria-label="Advertisement">
      <!-- horizontal_ad -->
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-6216304334889617"
           data-ad-slot="9651757525"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>try{(adsbygoogle=window.adsbygoogle||[]).push({});}catch(e){}</script>
    </section>

    <!-- Recently used (start hidden; unhide when we have items) -->
    <section class="section reserved is-invisible" id="recentSec" style="--reserve:280px">
      <h2>‚è±Ô∏è Continue</h2>
      <div class="tools-grid" id="recentGrid" role="region" aria-live="polite">
        <div class="skeleton" style="height:200px"></div>
        <div class="skeleton" style="height:200px"></div>
        <div class="skeleton" style="height:200px"></div>
      </div>
      <p class="note small">Tip: recent tools are saved on this device only.</p>
    </section>

    <!-- Favourites (start hidden; unhide when we have items) -->
    <section class="section reserved is-invisible" id="favSec" style="--reserve:280px">
      <h2>‚≠ê Your favourites</h2>
      <div class="tools-grid" id="favGrid" role="region" aria-live="polite">
        <div class="skeleton" style="height:200px"></div>
        <div class="skeleton" style="height:200px"></div>
      </div>
    </section>

    <!-- Featured -->
    <section class="section" aria-labelledby="featured">
      <h2 id="featured">üî• Featured</h2>
      <div id="featuredGrid" class="tools-grid">
        <article class="card skeleton" style="height:200px;padding:1rem"><div class="s1"></div><div class="s2"></div><div class="s3"></div></article>
        <article class="card skeleton" style="height:200px;padding:1rem"><div class="s1"></div><div class="s2"></div><div class="s3"></div></article>
        <article class="card skeleton" style="height:200px;padding:1rem"><div class="s1"></div><div class="s2"></div><div class="s3"></div></article>
        <article class="card skeleton" style="height:200px;padding:1rem"><div class="s1"></div><div class="s2"></div><div class="s3"></div></article>
      </div>

      <!-- All tools -->
      <section class="section" id="tools" aria-labelledby="tools-heading">
        <h2 id="tools-heading">üß∞ All tools</h2>
        <div class="tools-grid" id="grid" role="region" aria-live="polite">
          <!-- placeholders to lock grid height; keep as-is -->
          <article class="card skeleton" style="height:200px;padding:1rem"><div class="s1"></div><div class="s2"></div><div class="s3"></div></article>
          <article class="card skeleton" style="height:200px;padding:1rem"><div class="s1"></div><div class="s2"></div><div class="s3"></div></article>
          <article class="card skeleton" style="height:200px;padding:1rem"><div class="s1"></div><div class="s2"></div><div class="s3"></div></article>
          <article class="card skeleton" style="height:200px;padding:1rem"><div class="s1"></div><div class="s2"></div><div class="s3"></div></article>
          <!-- ...you can keep the rest of your placeholders... -->
        </div>
      </section>

      <!-- Video -->
      <section class="section" aria-labelledby="video-learn">
        <h2 id="video-learn">üé• Learn: Using calculators smartly</h2>
        <div class="card">
          <div class="video-shell" aria-label="Tutorial video">
            <iframe
              src="https://www.youtube-nocookie.com/embed/WjfAsX8fQ3U"
              title="12 AI Tools You Won't Believe Are FREE!"
              loading="lazy"
              referrerpolicy="strict-origin-when-cross-origin"
              allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen>
            </iframe>
          </div>
          <p class="note small" style="margin-top:8px">
            A curated video showcasing free web tools - great inspiration aligned with UpTools' privacy-first, no-sign-up ethos.
          </p>
        </div>
      </section>

      <!-- Footer -->
      <footer class="note small site-footer" role="contentinfo">
        ¬© <span id="y"></span> UpTools ¬∑ <a href="/about/">About</a> ¬∑ <a href="/contact/">Contact</a> ¬∑
        <a href="/sitemap.xml">Sitemap</a> ¬∑ <a href="/robots.txt">Robots</a>
      </footer>
    </section>

    <!-- BELOW-FOLD RESERVE: holds page height through first paint, then collapses -->
    <div id="belowFoldReserve" style="height:1800px"></div>
  </main>

  <script>
    // --- Data ---
    const TOOLS = [
      { slug:"income-tax-tool", title:"Income Tax Calculator", icon:"üßÆ", desc:"Estimate income tax quickly.", href:"/income-tax-tool/", tags:["tax","finance"] },
      { slug:"gst-calculator", title:"GST Calculator", icon:"üßæ", desc:"Add/remove GST from amounts.", href:"/gst-calculator/", tags:["tax","finance"] },
      { slug:"emi-calculator", title:"EMI Calculator", icon:"üí≥", desc:"Monthly loan repayment planner.", href:"/emi-calculator/", tags:["finance"] },
      { slug:"fd-calculator", title:"FD Calculator", icon:"üè¶", desc:"Fixed deposit maturity calculator.", href:"/fd-calculator/", tags:["finance"] },
      { slug:"sip-calculator", title:"SIP Calculator", icon:"üìà", desc:"Plan SIP returns with ease.", href:"/sip-calculator/", tags:["finance"] },
      { slug:"age-calculator", title:"Age Calculator", icon:"üéÇ", desc:"Find exact age by date.", href:"/age-calculator/", tags:["identity"] },
      { slug:"currency-converter", title:"Currency Converter (live)", icon:"üí±", desc:"Convert FX with live rates.", href:"/currency-converter/", tags:["finance","networking"] },
      { slug:"pan-validator", title:"PAN Format Validator", icon:"ü™™", desc:"Check PAN format validity.", href:"/pan-validator/", tags:["identity","text"] },
      { slug:"ifsc-finder", title:"IFSC Finder (live)", icon:"üèß", desc:"Search bank IFSC codes.", href:"/ifsc-finder/", tags:["banking","networking"] },
      { slug:"canada-crs-tool", title:"Canada CRS Calculator", icon:"üçÅ", desc:"Estimate Express Entry CRS.", href:"/canada-crs-tool/", tags:["canada","identity"] },
      { slug:"canada-hst-tool", title:"Canada GST/HST Calculator", icon:"üçÅ", desc:"Sales tax for provinces.", href:"/canada-hst-tool/", tags:["canada","tax"] },
      { slug:"password-generator", title:"Password Generator", icon:"üîê", desc:"Strong, random passwords.", href:"/password-generator/", tags:["security"] },
      { slug:"qr-generator", title:"QR Code Generator", icon:"üî≥", desc:"Create QR codes instantly.", href:"/qr-generator/", tags:["images","dev"] },
      { slug:"text-case-converter", title:"Text Case Converter", icon:"üî§", desc:"Upper, lower, title case.", href:"/text-case-converter/", tags:["text"] },
      { slug:"word-counter", title:"Word Counter", icon:"üìù", desc:"Count words & characters.", href:"/word-counter/", tags:["text"] },
      { slug:"json-formatter", title:"JSON Formatter", icon:"üß©", desc:"Prettify & validate JSON.", href:"/json-formatter/", tags:["dev"] },
      { slug:"base64-encoder", title:"Base64 Encoder/Decoder", icon:"üß™", desc:"Encode/decode Base64.", href:"/base64-encoder/", tags:["dev"] },
      { slug:"ip-address", title:"Your IP Address", icon:"üåê", desc:"Public IP & user agent.", href:"/ip-address/", tags:["networking"] },
      { slug:"uuid-generator", title:"UUID Generator", icon:"üÜî", desc:"Generate V4 UUIDs.", href:"/uuid-generator/", tags:["dev"] },
      { slug:"color-picker", title:"Color Picker", icon:"üé®", desc:"Pick, copy, convert colors.", href:"/color-picker/", tags:["images","dev"] },
      { slug:"games", title:"Free Online Games", icon:"üéÆ", desc:"Snake, 2048, Tic Tac Toe & more.", href:"/games/", tags:["fun"] },
      { slug:"image-tool", title:"Image Tool", icon:"üñºÔ∏è", desc:"Remove backgrounds, crop, resize, convert formats, and apply effects.", href:"/image-tool/", tags:["images","dev"] },
      { slug:"image-converter", title:"Image Converter", icon:"üñºÔ∏è", desc:"Resize, crop, and change image formats instantly.", href:"/image-converter/", tags:["images","dev"] },
      { slug:"bmi-calculator", title:"BMI Calculator", icon:"‚öñÔ∏è", desc:"Check BMI with metric & US units. Shows category, healthy range, body fat %, WHtR.", href:"/bmi-calculator/", tags:["health","identity"] },
      { slug:"ai-writer", title:"AI Writer", icon:"‚úçÔ∏è", desc:"Generate text using AI assistance.", href:"/ai-writer/", tags:["text","dev","ai"] },
      { slug:"resume-analyzer", title:"AI Resume Analyzer", icon:"üìÑ", desc:"Check ATS score, missing skills & job match.", href:"/resume-analyzer/", tags:["text","identity","dev","ai"] },
      { slug:"qr-reader", title:"QR Code Reader", icon:"üì∑", desc:"Scan and decode QR codes instantly using your camera.", href:"/qr-reader/", tags:["images","security","qr"] },
      { slug:"ai-plagiarism", title:"AI Plagiarism Checker", icon:"üìö", desc:"Check text for plagiarism instantly with AI.", href:"/ai-plagiarism/", tags:["text","dev","ai"] }
    ];

    // Robust helpers around localStorage (never throw)
    const $  = (s,r=document)=>r.querySelector(s);
    const $$ = (s,r=document)=>[...r.querySelectorAll(s)];
    const safeGet = (k, d=null) => {
      try {
        const v = localStorage.getItem(k);
        return v ? JSON.parse(v) : d;
      } catch { return d; }
    };
    const safeSet = (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} };

    const grid=$("#grid"), favSec=$("#favSec"), recentSec=$("#recentSec"), q=$("#q");
    $("#y").textContent = new Date().getFullYear();

    const FAV_KEY="uptools-tool-favs";
    const RECENT_KEY="uptools-tool-recent";

    const getFavs = () => new Set(safeGet(FAV_KEY, []));
    const setFavs = (set) => safeSet(FAV_KEY, [...set]);
    const getRecent = () => safeGet(RECENT_KEY, []);
    const pushRecent = (slug) => {
      const now = Date.now();
      const list = getRecent().filter(x => x.slug !== slug);
      list.unshift({ slug, ts: now });
      safeSet(RECENT_KEY, list.slice(0, 10));
    };

    function cardHTML(t,favs){
      const isFav=favs.has(t.slug);
      const tags=(t.tags||[]).slice(0,4).map(x=>`<span class="tag">${x}</span>`).join("");
      const badge=t.tags?.includes("finance")?"Finance":
        t.tags?.includes("tax")?"Tax":
        t.tags?.includes("dev")?"Dev":
        t.tags?.includes("banking")?"Banking":
        t.tags?.includes("security")?"Security":
        t.tags?.includes("images")?"Images":
        t.tags?.includes("text")?"Text":
        t.tags?.includes("canada")?"Canada":
        t.tags?.includes("networking")?"Networking":"Tool";
      return `
      <article class="tool-card card" data-tags="${(t.tags||[]).join(',')}" data-title="${t.title.toLowerCase()}" style="display:grid;grid-template-rows:auto auto 1fr auto;gap:.4rem">
        <div class="tool-top" style="display:flex;align-items:center;justify-content:space-between;gap:.6rem">
          <div class="tool-ico" aria-hidden="true" style="font-size:20px">${t.icon}</div>
          <span class="badge pill">${badge}</span>
        </div>
        <a class="tool-title" href="${t.href}" aria-label="${t.title}" style="font-size:1.05rem;font-weight:800;text-decoration:none;color:var(--text)">${t.title}</a>
        <p class="tool-desc note">${t.desc}</p>
        <div class="tags" style="display:flex;gap:.35rem;flex-wrap:wrap">${tags}</div>
        <div class="card-cta" style="display:flex;align-items:center;justify-content:space-between;gap:.5rem;margin-top:.35rem">
          <a class="btn" href="${t.href}">Open</a>
          <button class="fav btn secondary sm ${isFav?'active':''}" data-fav="${t.slug}" aria-label="Favourite ${t.title}" title="Favourite">
            ${isFav?'‚òÖ Favourited':'‚òÜ Favourite'}
          </button>
        </div>
      </article>`;
    }

    function bindInteractions(scope){
      scope.querySelectorAll("[data-fav]").forEach(btn=>{
        btn.addEventListener("click",(ev)=>{
          ev.preventDefault();
          const slug=btn.getAttribute("data-fav");
          const favs=getFavs();
          favs.has(slug)?favs.delete(slug):favs.add(slug);
          setFavs(favs);
          // reflect across all cards
          document.querySelectorAll(`[data-fav="${slug}"]`).forEach(b=>{
            const active=favs.has(slug);
            b.classList.toggle("active", active);
            b.textContent=active?"‚òÖ Favourited":"‚òÜ Favourite";
          });
          renderFavs();
        }, {passive:true});
      });

      // Track recents on open (synchronous before navigation)
      scope.querySelectorAll("a.btn, a.tool-title").forEach(a=>{
        a.addEventListener("click", ()=>{
          const slug=a.closest(".tool-card").querySelector("[data-fav]").getAttribute("data-fav");
          pushRecent(slug);
        }, {passive:true});
      });
    }

    function mount(container,list){
      const favs=getFavs();
      container.innerHTML=list.map(t=>cardHTML(t,favs)).join("");
      bindInteractions(container);
    }

    function renderAll(list){ mount(grid, list) }

    function renderFavs(){
      const favs=getFavs();
      const list=TOOLS.filter(t=>favs.has(t.slug));
      const has=list.length>0;
      favSec.classList.toggle('is-invisible', !has);
      if(has) mount(document.getElementById("favGrid"), list);
    }

    function renderRecent(){
      const rec=getRecent().slice(0,8);
      const list=rec.map(r=>TOOLS.find(t=>t.slug===r.slug)).filter(Boolean);
      const has=list.length>0;
      recentSec.classList.toggle('is-invisible', !has);
      if(has) mount(document.getElementById("recentGrid"), list);
    }

    // Filters
    const filtersEl=document.querySelector('.filters');
    const currentFilters=()=>[...filtersEl.querySelectorAll('input:checked')].map(i=>i.value);
    function applyFilters(){
      const text=q.value.trim().toLowerCase();
      const filters=currentFilters();
      const cards=[...document.querySelectorAll(".tool-card")];
      for(const c of cards){
        const title=c.dataset.title;
        const tags=(c.dataset.tags||"").split(",");
        const matchesText=!text||title.includes(text);
        const matchesTags=filters.length===0||filters.every(f=>tags.includes(f));
        c.style.display=(matchesText&&matchesTags)?"grid":"none";
      }
    }
    const debounce=(fn,d=150)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),d)}}
    q.addEventListener("input", debounce(applyFilters, 200), {passive:true});
    document.getElementById('clearBtn').addEventListener('click', ()=>{ q.value=""; applyFilters(); q.focus(); });

    // URL hydration (supports ?q= and ?used=slug to seed recents)
    (function hydrateFromURL(){
      const u=new URL(location.href);
      const s=u.searchParams.get("q");
      if(s){ q.value=s; }
      const used=u.searchParams.get("used");
      if(used) pushRecent(used);
    })();

    // Featured section mount
    (function mountFeatured(){
      const feat = [
        { slug:"income-tax-tool", title:"Income Tax Calculator", icon:"üßÆ", desc:"FY 2024-25 (AY 2025-26), New vs Old.", href:"/income-tax-tool/", tags:["tax","finance"] },
        { slug:"gst-calculator",    title:"GST Calculator",        icon:"üßæ", desc:"Add/remove GST from totals.",      href:"/gst-calculator/",    tags:["tax","finance"] },
        { slug:"currency-converter",title:"Currency Converter",    icon:"üí±", desc:"Live interbank FX (with fallback).", href:"/currency-converter/", tags:["finance","networking"] },
        { slug:"emi-calculator",    title:"EMI Calculator",        icon:"üí≥", desc:"Plan monthly repayments.",        href:"/emi-calculator/",    tags:["finance"] }
      ];
      const g = document.getElementById('featuredGrid');
      g.innerHTML = ''; // clear skeletons
      const favs = new Set();
      g.innerHTML = feat.map(t=>cardHTML(t, favs)).join('');
      bindInteractions(g);
    })();

    // Initial render
    renderAll(TOOLS);
    renderFavs();
    renderRecent();
    applyFilters();

    // Re-hydrate on pageshow (bfcache restore) so sections update after returning from a tool
    window.addEventListener('pageshow', ()=>{ renderFavs(); renderRecent(); }, {passive:true});

    // BELOW-FOLD spacer collapse
    window.addEventListener('load', ()=> {
      const r = document.getElementById('belowFoldReserve');
      if (r) { r.style.height = '0px'; }
    }, { once: true });

    // Keyboard helpers
    window.addEventListener('keydown', (e)=>{
      if(e.key==='/' && document.activeElement!==q){ e.preventDefault(); q.focus(); }
      if(e.key==='Escape'){ q.blur(); }
    }, {passive:false});
  </script>
</body>
</html>
