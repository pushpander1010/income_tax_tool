<!doctype html>
<html lang="en">

<head>
  <!-- Google Ads (single/async). We reserve space to avoid CLS and show a fallback card if blocked. -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6216304334889617"
    crossorigin="anonymous"></script>
  <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
  <link rel="dns-prefetch" href="//pagead2.googlesyndication.com">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="x-ua-compatible" content="IE=edge" />
  <meta name="color-scheme" content="dark light" />

  <title>BMI Calculator (Metric & US) – Healthy Range, Body Fat %, WHtR, BMR/TDEE | UpTools</title>
  <meta name="description"
    content="Free BMI Calculator with instant results. Works for Metric (cm/kg) and US (ft/in, lb). Shows category (WHO/Asian), healthy weight range, BMI Prime, estimated body fat %, WHtR, BMR & TDEE for calorie planning. Fast, private, offline-friendly." />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <meta name="theme-color" content="#0b1020" />
  <link rel="canonical" href="https://www.uptools.in/bmi-calculator/" />

  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="BMI Calculator – Healthy Range, Body Fat %, WHtR, BMR/TDEE" />
  <meta property="og:description"
    content="Instant BMI with WHO/Asian categories, healthy weight range, BMI Prime, body fat %, WHtR, and calorie targets (BMR/TDEE). Metric & US." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.uptools.in/bmi-calculator/" />
  <meta property="og:site_name" content="UpTools" />
  <meta property="og:image" content="https://www.uptools.in/assets/og/bmi.png" />
  <meta name="twitter:card" content="summary" />

  <!-- Common stylesheet (non-blocking) -->
  <link rel="preload" href="/style.css?v=1.2.1" as="style">
  <link rel="stylesheet" href="/style.css?v=1.2.1" media="print" onload="this.media='all'">
  <noscript>
    <link rel="stylesheet" href="/style.css?v=1.2.1">
  </noscript>

  <!-- Preload shared utils used on every page -->
  <link rel="modulepreload" href="/scripts/utils.js">

  <!-- Small per-page critical CSS -->
  <style>
    :root {
      --accent: #ff8a65;
      --bg: #0f1419;
      --surface: #121826;
      --text: #e6edf3;
      --muted: #9aa4b2;
      --brand: #7aa2ff;
      --radius: .75rem;
      --cardBorder: #263244;
      --sheetH: 70vh;
    }

    * {
      box-sizing: border-box
    }

    html {
      color-scheme: dark light;
      -webkit-text-size-adjust: 100%
    }

    html,
    body {
      margin: 0;
      overflow-x: hidden;
    }

    /* Never show horizontal scroll */
    body {
      background: var(--bg);
      color: var(--text);
      font: 400 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Noto Sans", sans-serif
    }

    img,
    svg,
    video {
      max-width: 100%;
      height: auto
    }

    .wrap {
      padding-inline: 12px
    }

    .container,
    .header-inner {
      max-width: min(1120px, 100vw - 24px);
      width: 100%;
      margin-inline: auto
    }

    a {
      color: var(--brand);
      text-decoration-thickness: .08em;
      text-underline-offset: .18em
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--cardBorder);
      border-radius: var(--radius);
      padding: 1rem
    }

    .btn {
      display: inline-block;
      padding: .65rem .9rem;
      border-radius: var(--radius);
      background: var(--brand);
      color: #0b1020;
      border: 0;
      font-weight: 600
    }

    .btn.secondary {
      background: transparent;
      border: 1px solid #2a3953;
      color: var(--text)
    }

    .btn.ghost {
      background: transparent;
      color: var(--text);
      border: 0
    }

    .site {
      position: sticky;
      top: 0;
      background: linear-gradient(180deg, rgba(10, 14, 22, .9), rgba(10, 14, 22, .7));
      backdrop-filter: saturate(130%) blur(6px);
      z-index: 60;
      border-bottom: 1px solid #1c2536
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: .6rem
    }

    .brand b {
      font-weight: 800;
      letter-spacing: .2px
    }

    .nav-links {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      min-width: 0
    }

    .tool-header {
      display: grid;
      grid-template-columns: auto minmax(0, 1fr);
      gap: .8rem;
      align-items: center;
      margin: 16px 0
    }

    .tool-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent), #ffb199);
      display: grid;
      place-items: center;
      font-weight: 800;
      color: #0b1020;
      border: 1px solid #ffb199;
      flex: 0 0 auto
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px
    }

    .pill {
      border: 1px dashed #2a3953;
      padding: .2rem .5rem;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted)
    }

    /* One-column content; results live in overlay for all screens */
    .layout {
      display: block
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px
    }

    .form-grid .full {
      grid-column: 1/-1
    }

    .label {
      display: block;
      font-size: .9rem;
      color: var(--muted);
      margin-bottom: 4px
    }

    .input {
      width: 100%;
      padding: .65rem .7rem;
      border-radius: .6rem;
      border: 1px solid #243146;
      background: #0b1320;
      color: var(--text)
    }

    .toolbar {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap
    }

    .menu {
      margin-left: auto;
      position: relative;
      min-width: 0
    }

    .menu-list {
      position: absolute;
      right: 0;
      top: calc(100% + 6px);
      display: none;
      min-width: 220px;
      max-width: min(90vw, 320px);
      padding: .4rem;
      overflow-wrap: anywhere
    }

    .menu.open .menu-list {
      display: block
    }

    .menu-list button {
      width: 100%;
      text-align: left;
      padding: .5rem;
      border-radius: .5rem;
      background: transparent;
      border: 0;
      color: var(--text)
    }

    .note {
      color: var(--muted)
    }

    .small {
      font-size: .9rem
    }

    .divider {
      height: 1px;
      background: #1f2a3c;
      margin: .7rem 0
    }

    .badge {
      display: inline-block;
      border-radius: 999px;
      padding: .2rem .55rem;
      background: #0e1626;
      border: 1px solid #27344a
    }

    .kvi {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: .4rem 0;
      border-bottom: 1px dashed #223147
    }

    .kvi:last-child {
      border-bottom: 0
    }

    .amount {
      font-feature-settings: "tnum" 1, "lnum" 1
    }

    .tool-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px
    }

    .tool-link {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: .6rem .7rem;
      border-radius: .6rem;
      border: 1px dashed #2a3953;
      min-width: 0
    }

    .tool-link span:last-child {
      overflow-wrap: anywhere
    }

    .tlogo {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      display: grid;
      place-items: center;
      font-weight: 800;
      letter-spacing: .4px;
      background: #0e1626;
      border: 1px solid #2a3953;
      color: #7aa2ff;
      flex: 0 0 28px
    }

    .ico {
      font-size: 18px
    }

    .embed {
      width: 100%;
      height: 300px;
      border: 0;
      border-radius: .6rem;
      display: block
    }

    .scale {
      position: relative;
      height: 12px;
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid #2a3953;
      background: #0c1320
    }

    .seg {
      height: 100%;
      float: left
    }

    .seg-u {
      background: #60a5fa
    }

    .seg-n {
      background: #22c55e
    }

    .seg-o {
      background: #f59e0b
    }

    .seg-ob {
      background: #ef4444
    }

    .pin {
      position: absolute;
      top: -6px;
      width: 0;
      height: 0;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-bottom: 6px solid var(--accent);
      transform: translateX(-50%)
    }

    .ads-box {
      display: block;
      min-height: 280px;
      width: 100%;
      overflow: hidden
    }

    .ad-fallback {
      display: none
    }

    .hidden {
      display: none !important
    }

    /* Universal Results Toggle (FAB) */
    .sheet-toggle {
      position: fixed;
      right: 12px;
      bottom: 12px;
      z-index: 70;
      border-radius: 999px;
      padding: .7rem .9rem;
      background: var(--brand);
      color: #0b1020;
      border: 0;
      font-weight: 700;
      box-shadow: 0 8px 24px rgba(0, 0, 0, .35)
    }

    .sheet-toggle:focus-visible {
      outline: 2px solid #fff
    }

    /* Overlay sheet: mobile = bottom sheet; desktop = right drawer */
    .sheet {
      position: fixed;
      z-index: 65;
      background: var(--surface);
      border: 1px solid #1f2a3c;
      border-radius: 14px;
      box-shadow: 0 24px 60px rgba(0, 0, 0, .55)
    }

    .sheet .sheet-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px
    }

    .sheet .close-x {
      border: 0;
      background: transparent;
      color: var(--text);
      font-weight: 800;
      font-size: 18px;
      line-height: 1;
      padding: .35rem;
      border-radius: .5rem
    }

    .sheet .close-x:hover {
      background: #1a2436
    }

    /* Mobile: bottom sheet */
    @media (max-width:880px) {
      .sheet {
        left: 0;
        right: 0;
        bottom: 0;
        border-radius: 14px 14px 0 0;
        max-height: var(--sheetH);
        overflow: auto;
        transform: translateY(100%);
        transition: transform .25s ease
      }

      .sheet.open {
        transform: translateY(0)
      }

      .embed {
        height: 210px
      }

      .tool-list {
        grid-template-columns: 1fr
      }

      .header-inner {
        padding: .5rem 0
      }

      body {
        padding-bottom: 70px
      }
    }

    /* Desktop: right drawer */
    @media (min-width:881px) {
      .sheet {
        top: 12px;
        right: 12px;
        bottom: 12px;
        width: min(460px, 95vw);
        border-radius: 14px;
        overflow: auto;
        transform: translateX(calc(100% + 12px));
        transition: transform .25s ease
      }

      .sheet.open {
        transform: translateX(0)
      }

      .form-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr))
      }

      /* better use of width */
      .form-grid .full {
        grid-column: 1/-1
      }
    }

    /* Accessibility & focus */
    :focus-visible {
      outline: 2px solid var(--brand);
      outline-offset: 2px;
      border-radius: 8px
    }

    .sr-only {
      position: absolute;
      left: -9999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden
    }
  </style>

  <!-- Structured data -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[
    {"@type":"ListItem","position":1,"name":"Home","item":"https://www.uptools.in/"},
    {"@type":"ListItem","position":2,"name":"Health Tools","item":"https://www.uptools.in/#tools"},
    {"@type":"ListItem","position":3,"name":"BMI Calculator","item":"https://www.uptools.in/bmi-calculator/"}]}
  </script>
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"FAQPage","mainEntity":[
    {"@type":"Question","name":"What is a healthy BMI?","acceptedAnswer":{"@type":"Answer","text":"Using WHO adult cut-offs: 18.5–24.9 is considered normal. For many Asian populations, 18.5–22.9 is used as the normal range."}},
    {"@type":"Question","name":"Is BMI accurate?","acceptedAnswer":{"@type":"Answer","text":"BMI is a screening tool and does not distinguish fat from muscle. Waist-to-height ratio and body fat % add context."}},
    {"@type":"Question","name":"Does this work for children?","acceptedAnswer":{"@type":"Answer","text":"No. Children require age- and sex-specific percentiles, which this adult calculator does not provide."}}]}
  </script>
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"SoftwareApplication","name":"BMI Calculator","operatingSystem":"Any","applicationCategory":"HealthApplication","offers":{"@type":"Offer","price":"0","priceCurrency":"INR"},"url":"https://www.uptools.in/bmi-calculator/","publisher":{"@type":"Organization","name":"UpTools","url":"https://www.uptools.in/"}}  
  </script>
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"VideoObject","name":"BMI explained","description":"Quick video explaining BMI, categories, and context.","uploadDate":"2023-01-01","thumbnailUrl":"https://i.ytimg.com/vi/eHfIfA9eGmY/hqdefault.jpg","embedUrl":"https://www.youtube-nocookie.com/embed/eHfIfA9eGmY","publisher":{"@type":"Organization","name":"YouTube"}}
  </script>
</head>

<body>
  <a class="sr-only" href="#main">Skip to content</a>

  <!-- Header -->
  <header class="site" role="banner">
    <div class="header-inner">
      <a class="brand" href="/" aria-label="UpTools Home">
        <img src="/assets/logo/uptools-logo.svg" alt="UpTools logo" width="28" height="28" loading="eager">
        <b>UpTools</b>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/#tools">Tools</a>
        <a href="/income-tax-tool/">Income Tax</a>
        <a href="/emi-calculator/">EMI</a>
        <a aria-current="page" href="/bmi-calculator/">BMI</a>
      </nav>
    </div>
  </header>

  <main id="main" class="wrap" role="main">
    <div class="container">
      <section class="tool-header" aria-labelledby="title">
        <div class="tool-icon" aria-hidden="true" title="BMI">BMI</div>
        <div>
          <h1 id="title">BMI Calculator</h1>
          <div class="chips" aria-label="Highlights">
            <span class="pill">⚡ Instant</span>
            <span class="pill">📏 Metric & US</span>
            <span class="pill">🌍 WHO / 🌏 Asian</span>
            <span class="pill">🧮 Body fat % & WHtR</span>
            <span class="pill">🔥 BMR & TDEE</span>
          </div>
        </div>
      </section>

      <!-- In-article ad (fixed slot; fallback shows internal promo if blocked) -->
      <section id="ad-article-1" class="card" style="padding:.5rem">
        <ins class="adsbygoogle ads-box" style="display:block;width:100%;overflow:hidden"
          data-ad-client="ca-pub-6216304334889617" data-ad-slot="4371887963" data-ad-format="auto"
          data-full-width-responsive="true" aria-label="Sponsored"></ins>
        <div class="ad-fallback">
          <a class="tool-link" href="/age-calculator/">
            <span class="tlogo" aria-hidden="true">AC</span>
            <span><b>Try our Age Calculator</b> – exact age, next birthday, working days.</span>
          </a>
        </div>
        <script>(window.adsbygoogle = window.adsbygoogle || []).push({});</script>
      </section>

      <!-- Content column only; results open in overlay -->
      <section class="layout" style="margin-top:12px">
        <div style="display:grid;gap:12px;min-width:0">
          <article class="card" aria-labelledby="form-head">
            <h2 id="form-head">Enter your details</h2>

            <form id="bmiForm" class="form-grid" autocomplete="off">
              <div>
                <label class="label" for="unit">Units</label>
                <select id="unit" class="input" aria-label="Select unit system">
                  <option value="metric">Metric (cm, kg)</option>
                  <option value="us">US/UK (ft/in, lb)</option>
                </select>
              </div>

              <div>
                <label class="label" for="std">Cut-offs</label>
                <select id="std" class="input" aria-label="Select BMI boundaries">
                  <option value="who">WHO (Global)</option>
                  <option value="asian">Asian (SEAR/WPR)</option>
                </select>
              </div>

              <!-- Metric height -->
              <div id="gHeightMetric">
                <label class="label" for="heightCm">Height (cm)</label>
                <input id="heightCm" class="input" type="number" inputmode="decimal" min="0" step="0.1"
                  placeholder="e.g., 170" />
              </div>

              <!-- US height -->
              <div id="gHeightUS" class="hidden">
                <label class="label" for="heightFt">Height (ft &amp; in)</label>
                <div style="display:flex;gap:8px;">
                  <input id="heightFt" class="input" type="number" inputmode="numeric" min="0" step="1" placeholder="ft"
                    aria-label="Height feet" />
                  <input id="heightIn" class="input" type="number" inputmode="decimal" min="0" step="0.1"
                    placeholder="in" aria-label="Height inches" />
                </div>
              </div>

              <!-- Metric weight -->
              <div id="gWeightMetric">
                <label class="label" for="weightKg">Weight (kg)</label>
                <input id="weightKg" class="input" type="number" inputmode="decimal" min="0" step="0.1"
                  placeholder="e.g., 70" />
              </div>

              <!-- US weight -->
              <div id="gWeightUS" class="hidden">
                <label class="label" for="weightLb">Weight (lb)</label>
                <input id="weightLb" class="input" type="number" inputmode="decimal" min="0" step="0.1"
                  placeholder="e.g., 154" />
              </div>

              <div>
                <label class="label" for="age">Age (years, optional)</label>
                <input id="age" class="input" type="number" inputmode="numeric" min="0" step="1"
                  placeholder="e.g., 30" />
              </div>

              <div>
                <label class="label" for="sex">Sex (for body fat %, optional)</label>
                <select id="sex" class="input">
                  <option value="none">Prefer not to say</option>
                  <option value="female">Female</option>
                  <option value="male">Male</option>
                </select>
              </div>

              <div class="full">
                <label class="label" for="waist">Waist circumference (cm, optional)</label>
                <input id="waist" class="input" type="number" inputmode="decimal" min="0" step="0.1"
                  placeholder="Measure at navel level" />
              </div>

              <div class="full toolbar" style="margin-top:4px;">
                <button type="submit" class="btn" id="btnCalc">Calculate</button>
                <button type="button" class="btn secondary" id="btnClear">Clear</button>

                <div class="menu" id="moreMenu">
                  <button type="button" class="btn ghost menu-btn" aria-haspopup="true" aria-expanded="false"
                    aria-controls="moreList">More ▾</button>
                  <div class="menu-list card" id="moreList" role="menu" aria-label="More actions">
                    <button type="button" role="menuitem" id="btnCopy">Copy result</button>
                    <button type="button" role="menuitem" id="btnPermalink">Copy permalink</button>
                    <button type="button" role="menuitem" id="btnExample">Example values</button>
                    <button type="button" role="menuitem" id="btnPrint">Print summary</button>
                  </div>
                </div>
              </div>
            </form>

            <div id="tips" class="note" style="margin-top:8px;" aria-live="polite"></div>
          </article>

          <!-- Education -->
          <section class="card" aria-labelledby="learn">
            <h2 id="learn">Understanding your BMI</h2>
            <p style="overflow-wrap:anywhere">BMI (Body Mass Index) = weight (kg) ÷ height (m)<sup>2</sup>. It’s a quick
              screen—not a diagnosis. Muscular people may read “high” despite low body fat, while some with “normal” BMI
              may still have central obesity.</p>

            <!-- Mini scale -->
            <div id="chart" class="scale" style="margin:12px 0;">
              <div id="pin" class="pin" style="left:0%"></div>
            </div>
            <div class="note small">Your BMI position on the scale above adjusts in real time.</div>

            <div class="chips legend" style="margin-top:8px" aria-label="Legend">
              <span><span class="seg seg-u" style="width:16px;height:10px;border-radius:3px"></span>Under</span>
              <span><span class="seg seg-n" style="width:16px;height:10px;border-radius:3px"></span>Normal</span>
              <span><span class="seg seg-o" style="width:16px;height:10px;border-radius:3px"></span>Over</span>
              <span><span class="seg seg-ob" style="width:16px;height:10px;border-radius:3px"></span>Obese</span>
            </div>

            <p class="note">References: <a
                href="https://www.who.int/news-room/fact-sheets/detail/obesity-and-overweight" rel="nofollow noopener"
                target="_blank">WHO</a>, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4890841/"
                rel="nofollow noopener" target="_blank">Asian BMI cut-offs</a>.</p>

            <!-- SEO image (fixed size to avoid CLS) -->
            <figure style="margin:8px 0">
              <img src="/assets/ui/bmi-explainer.png" alt="BMI categories and healthy weight range explainer"
                width="960" height="540" loading="lazy">
              <figcaption class="note small">Visual explainer: BMI categories & healthy weight range.</figcaption>
            </figure>
          </section>

          <!-- Related tools (textual logos for subpages) -->
          <aside class="card" aria-labelledby="related">
            <h2 id="related">Related tools</h2>
            <ul class="tool-list">
              <li><a class="tool-link accent-amber" href="/age-calculator/"><span class="tlogo"
                    aria-hidden="true">AC</span><span>Age Calculator</span></a></li>
              <li><a class="tool-link accent-green" href="/bmr-calculator/"><span class="tlogo"
                    aria-hidden="true">BMR</span><span>BMR Calculator</span></a></li>
              <li><a class="tool-link accent-indigo" href="/emi-calculator/"><span class="tlogo"
                    aria-hidden="true">EMI</span><span>EMI Calculator</span></a></li>
              <li><a class="tool-link accent-purple" href="/gst-calculator/"><span class="tlogo"
                    aria-hidden="true">GST</span><span>GST Calculator</span></a></li>
              <li><a class="tool-link accent-cyan" href="/currency-converter/"><span class="tlogo"
                    aria-hidden="true">FX</span><span>Currency Converter</span></a></li>
            </ul>
          </aside>

          <!-- FAQs -->
          <section class="card" aria-labelledby="faq">
            <h2 id="faq">FAQs</h2>
            <details>
              <summary>What are Asian BMI cut-offs?</summary>
              <div class="note">Under &lt;18.5, Normal 18.5–22.9, Overweight 23–24.9, Obese ≥25. Choose “Asian” from the
                Cut-offs menu.</div>
            </details>
            <details>
              <summary>What is BMI Prime?</summary>
              <div class="note">BMI Prime = BMI ÷ 25. Values &lt;1.0 are below the global overweight threshold; &gt;1.0
                above.</div>
            </details>
            <details>
              <summary>What is WHtR?</summary>
              <div class="note">Waist-to-height ratio (waist/height). Aim for &lt;0.5; 0.50–0.59 increased risk; ≥0.60
                high risk.</div>
            </details>
          </section>

          <!-- Video with fixed size to avoid layout shift -->
          <section class="card" aria-labelledby="vid">
            <h2 id="vid">Quick explainer 🎥</h2>
            <iframe width="560" height="315" src="https://www.youtube.com/embed/z_3S2_41_FE?si=VOE5aeAS1VsUqoVn"
              title="YouTube video player" frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
          </section>
        </div>
      </section>

      <footer class="note small site-footer" role="contentinfo" style="margin:18px 0">
        © <span id="y"></span> UpTools · <a href="/about/">About</a> · <a href="/contact/">Contact</a> ·
        <a href="/sitemap.xml">Sitemap</a> · <a href="/robots.txt">Robots</a>
      </footer>
    </div>
  </main>

  <!-- UNIVERSAL RESULTS SHEET (works on all screens) -->
  <section id="resultsSheet" class="sheet" aria-label="Results and planner panel" aria-hidden="true">
    <div class="card" style="display:grid;gap:8px">
      <div class="sheet-head">
        <h2 style="margin:0">Your results</h2>
        <button type="button" class="close-x" id="closeSheet" aria-label="Close results">✕</button>
      </div>
      <div id="status" class="badge">—</div>

      <div class="kvi"><span>BMI</span><span id="outBMI" class="amount">—</span></div>
      <div class="kvi"><span>Category</span><span id="outCat" class="amount">—</span></div>
      <div class="kvi"><span>Healthy weight range</span><span id="outRange" class="amount">—</span></div>
      <div class="kvi"><span>BMI Prime</span><span id="outPrime" class="amount">—</span></div>
      <div class="kvi"><span>Body fat % (est.)</span><span id="outBF" class="amount">—</span></div>
      <div class="kvi"><span>Waist-to-height (WHtR)</span><span id="outWHtR" class="amount">—</span></div>

      <div class="divider"></div>
      <div class="btn-group" style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn secondary" id="m_btnCopyOut">Copy</button>
        <button class="btn secondary" id="m_btnReset">Reset</button>
      </div>

      <div class="divider"></div>
      <h3 id="cal-head-m" style="margin:0">Calorie Planner</h3>
      <p class="note small" id="cal-note-m">Get BMR &amp; TDEE based on Mifflin–St Jeor. Add age &amp; sex above for
        accuracy.</p>

      <label class="label" for="activity">Activity level</label>
      <select id="activity" class="input">
        <option value="1.2">Sedentary (little/no exercise)</option>
        <option value="1.375">Light (1–3 days/week)</option>
        <option value="1.55">Moderate (3–5 days/week)</option>
        <option value="1.725">Active (6–7 days/week)</option>
        <option value="1.9">Very active (physical job)</option>
      </select>

      <div class="kvi"><span>BMR</span><span id="outBMR" class="amount">—</span></div>
      <div class="kvi"><span>TDEE</span><span id="outTDEE" class="amount">—</span></div>

      <label class="label" for="goalRate">Goal pace</label>
      <select id="goalRate" class="input" title="Weekly change">
        <option value="0">Maintain</option>
        <option value="-250">Lose ~0.25 kg/wk</option>
        <option value="-500">Lose ~0.5 kg/wk</option>
        <option value="250">Gain ~0.25 kg/wk</option>
        <option value="500">Gain ~0.5 kg/wk</option>
      </select>

      <div class="kvi"><span>Suggested calories</span><span id="outCals" class="amount">—</span></div>

      <div class="divider"></div>
      <label class="label" for="targetBMI">Target BMI</label>
      <input id="targetBMI" class="input" type="number" step="0.1" min="16" max="30" placeholder="e.g., 22.5" />
      <div class="kvi"><span>Target weight</span><span id="outTargetW" class="amount">—</span></div>
      <div class="kvi"><span>Δ from current</span><span id="outDeltaW" class="amount">—</span></div>
    </div>
  </section>

  <!-- Floating toggle button (ALL screens) -->
  <button id="toggleResults" class="sheet-toggle" aria-controls="resultsSheet" aria-expanded="false">Results</button>

  <!-- Logic -->
  <script type="module">
    import { $, $$, fmtNum, debounce, serializeForm, setText, persist, read, clamp, num } from '/scripts/utils.js';

    // Grab nodes (IDs are shared across the page and sheet)
    const E = {
      form: $('#bmiForm'),
      unit: $('#unit'), std: $('#std'),
      heightCm: $('#heightCm'), heightFt: $('#heightFt'), heightIn: $('#heightIn'),
      weightKg: $('#weightKg'), weightLb: $('#weightLb'),
      age: $('#age'), sex: $('#sex'), waist: $('#waist'),
      tips: $('#tips'),

      // Outputs
      status: $('#status'), outBMI: $('#outBMI'), outCat: $('#outCat'),
      outRange: $('#outRange'), outPrime: $('#outPrime'),
      outBF: $('#outBF'), outWHtR: $('#outWHtR'),
      pin: $('#pin'), chart: $('#chart'),

      // Planner
      activity: $('#activity'), goalRate: $('#goalRate'),
      outBMR: $('#outBMR'), outTDEE: $('#outTDEE'), outCals: $('#outCals'),
      targetBMI: $('#targetBMI'), outTargetW: $('#outTargetW'), outDeltaW: $('#outDeltaW'),

      // Actions
      btnCalc: $('#btnCalc'), btnClear: $('#btnClear'),
      btnCopy: $('#btnCopy'), btnPermalink: $('#btnPermalink'),
      btnExample: $('#btnExample'),

      // Sheet controls
      sheet: $('#resultsSheet'), sheetToggle: $('#toggleResults'), sheetClose: $('#closeSheet'),
      mBtnCopyOut: $('#m_btnCopyOut'), mBtnReset: $('#m_btnReset')
    };

    const WHO = { under: 18.5, normalHi: 24.9, overHi: 29.9 };   // obese >=30
    const ASIAN = { under: 18.5, normalHi: 22.9, overHi: 24.9 };  // obese >=25
    const KG_PER_LB = 0.45359237;
    const CM_PER_IN = 2.54;

    const toMetric = () => {
      if (E.unit.value === 'metric') {
        const cm = num(E.heightCm.value);
        const kg = num(E.weightKg.value);
        return { cm, kg };
      } else {
        const ft = num(E.heightFt.value), inch = num(E.heightIn.value);
        const totalIn = ft * 12 + inch;
        const cm = totalIn * CM_PER_IN;
        const kg = num(E.weightLb.value) * KG_PER_LB;
        return { cm, kg };
      }
    };

    const bmiCalc = (kg, cm) => {
      const m = cm / 100;
      if (!kg || !cm || m <= 0) return 0;
      return kg / (m * m);
    };

    const stdCfg = () => (E.std.value === 'asian' ? ASIAN : WHO);

    const catFor = (bmi, std) => {
      if (!bmi) return '—';
      if (bmi < std.under) return 'Underweight';
      if (bmi <= std.normalHi) return 'Normal';
      if (bmi <= std.overHi) return 'Overweight';
      return 'Obese';
    };

    const healthyWeightRange = (cm) => {
      const m = cm / 100;
      const s = stdCfg();
      const lo = 18.5 * m * m;
      const hi = s.normalHi * m * m;
      return { lo, hi };
    };

    const bmiPrime = (bmi) => bmi ? (bmi / 25) : 0;

    const bodyFat = (bmi, age, sex) => {
      if (!bmi || !age || sex === 'none') return null;
      const sx = (sex === 'male') ? 1 : 0;
      const val = 1.20 * bmi + 0.23 * age - 10.8 * sx - 5.4;
      return Math.max(2, Math.min(75, val));
    };

    const whtr = (waistCm, heightCm) => (!waistCm || !heightCm) ? null : (waistCm / heightCm);
    const whtrLabel = (v) => v == null ? '—' : (v < 0.5 ? 'Healthy' : v < 0.6 ? 'Increased risk' : 'High risk');

    const renderScale = () => {
      const s = stdCfg();
      const max = 40;
      E.chart?.querySelectorAll('.seg').forEach(n => n.remove());
      const mk = (w, cls) => {
        const d = document.createElement('div');
        d.className = `seg ${cls}`; d.style.width = (w * 100 / max) + '%'; E.chart.insertBefore(d, $('#pin'));
      };
      mk(s.under, 'seg-u');
      mk(s.normalHi - s.under, 'seg-n');
      mk(s.overHi - s.normalHi, 'seg-o');
      mk(max - s.overHi, 'seg-ob');
    };

    const setStatus = (text, cls = '') => {
      E.status.classList.remove('ok', 'warn', 'err');
      if (cls) E.status.classList.add(cls);
      E.status.textContent = text;
    };

    const fmt1 = (x) => (x == null || !isFinite(x)) ? '—' : Number(x).toFixed(1);
    const updatePin = (bmi) => { const max = 40; const pct = clamp((bmi / max) * 100, 0, 100); $('#pin').style.left = pct + '%'; }

    const updatePermalink = () => {
      const u = new URL(location.href);
      const { cm, kg } = toMetric();
      if (cm) u.searchParams.set('h', String(cm)); else u.searchParams.delete('h');
      if (kg) u.searchParams.set('w', String(kg)); else u.searchParams.delete('w');
      u.searchParams.set('u', E.unit.value);
      u.searchParams.set('s', E.std.value);
      const a = E.age.value.trim(); if (a) u.searchParams.set('a', a); else u.searchParams.delete('a');
      const sx = E.sex.value; if (sx !== 'none') u.searchParams.set('x', sx); else u.searchParams.delete('x');
      const wc = E.waist.value.trim(); if (wc) u.searchParams.set('wc', wc); else u.searchParams.delete('wc');
      history.replaceState(null, '', u.toString());
    };

    const bmr = (kg, cm, age, sex) => {
      if (!kg || !cm || !age || sex === 'none') return null;
      const s = (sex === 'male') ? 5 : -161;
      return (10 * kg) + (6.25 * cm) - (5 * age) + s;
    };

    const updatePlanner = () => {
      const { cm, kg } = toMetric();
      const age = num(E.age.value);
      const sex = E.sex.value;
      const act = Number(E.activity.value || 1.2);
      const base = bmr(kg, cm, age, sex);
      const tdee = base ? base * act : null;

      setText(E.outBMR, base ? Math.round(base) + ' kcal' : '—');
      setText(E.outTDEE, tdee ? Math.round(tdee) + ' kcal' : '—');

      const adj = Number(E.goalRate.value || 0);
      const sug = tdee ? clamp(tdee + adj, 1000, 5000) : null;
      setText(E.outCals, sug ? Math.round(sug) + ' kcal/day' : '—');

      const tBMI = num(E.targetBMI.value);
      if (tBMI && cm) {
        const m = cm / 100;
        const targetKg = tBMI * m * m;
        const isUS = E.unit.value === 'us';
        const outW = isUS ? (targetKg / KG_PER_LB) : targetKg;
        const curW = isUS ? (kg / KG_PER_LB) : kg;
        const delta = (curW && outW) ? (outW - curW) : 0;
        setText(E.outTargetW, (isUS ? outW.toFixed(1) + ' lb' : outW.toFixed(1) + ' kg'));
        setText(E.outDeltaW, (delta > 0 ? '+' : '') + (isUS ? delta.toFixed(1) + ' lb' : delta.toFixed(1) + ' kg'));
      } else {
        setText(E.outTargetW, '—'); setText(E.outDeltaW, '—');
      }
    };

    const calculate = () => {
      const { cm, kg } = toMetric();
      if (!cm || !kg) { setStatus('Enter valid height and weight', 'warn'); return; }
      const bmi = bmiCalc(kg, cm);
      const s = stdCfg();
      const cat = catFor(bmi, s);
      const range = healthyWeightRange(cm);
      const prime = bmiPrime(bmi);
      const bf = bodyFat(bmi, num(E.age.value), E.sex.value);
      const ratio = whtr(num(E.waist.value), cm);

      setText(E.outBMI, fmt1(bmi));
      setText(E.outCat, cat);
      const isUS = E.unit.value === 'us';
      const lo = isUS ? (range.lo / KG_PER_LB) : range.lo;
      const hi = isUS ? (range.hi / KG_PER_LB) : range.hi;
      setText(E.outRange, (isUS ? `${fmt1(lo)}–${fmt1(hi)} lb` : `${fmt1(range.lo)}–${fmt1(range.hi)} kg`));
      setText(E.outPrime, fmt1(prime));
      setText(E.outBF, bf == null ? '—' : `${fmt1(bf)}%`);
      setText(E.outWHtR, ratio == null ? '—' : `${fmt1(ratio)} (${whtrLabel(ratio)})`);

      const cls = (cat === 'Normal') ? 'ok' : (cat === 'Overweight' ? 'warn' : (cat === 'Obese' ? 'err' : 'warn'));
      setStatus(`Result: ${cat}`, cls);
      updatePin(bmi);
      E.tips.innerHTML = [
        (cat !== 'Normal') ? 'Tip: Aim for a healthy BMI range (see range above).' : 'Great! You are in the healthy BMI range.',
        ratio != null ? 'Waist-to-height helps capture central fat; keep it &lt; 0.5.' : 'Add waist to get WHtR risk.',
        (E.sex.value !== 'none' && E.age.value) ? 'Planner shows BMR/TDEE & calories.' : 'Add age & sex to unlock calorie planner.'
      ].join(' ');

      persist('bmi:last', { unit: E.unit.value, std: E.std.value, cm, kg, age: E.age.value, sex: E.sex.value, waist: E.waist.value, ts: Date.now() });
      updatePermalink();
      updatePlanner();
    };

    // Toggle unit blocks
    const toggleUnits = () => {
      const isMetric = E.unit.value === 'metric';
      $('#gHeightMetric').classList.toggle('hidden', !isMetric);
      $('#gHeightUS').classList.toggle('hidden', isMetric);
      $('#gWeightMetric').classList.toggle('hidden', !isMetric);
      $('#gWeightUS').classList.toggle('hidden', isMetric);
    };

    // Menu
    $('.menu-btn').addEventListener('click', () => {
      const menu = $('#moreMenu');
      const open = menu.classList.toggle('open');
      $('.menu-btn').setAttribute('aria-expanded', open ? 'true' : 'false');
    });
    document.addEventListener('click', (e) => {
      const mm = $('#moreMenu');
      if (mm && !mm.contains(e.target)) { mm.classList.remove('open'); $('.menu-btn').setAttribute('aria-expanded', 'false'); }
    });

    // Actions
    const copyOut = () => {
      const text = [
        `BMI: ${$('#outBMI').textContent}`,
        `Category: ${$('#outCat').textContent} (${E.std.value.toUpperCase()})`,
        `Healthy weight range: ${$('#outRange').textContent}`,
        `BMI Prime: ${$('#outPrime').textContent}`,
        `Body fat % (est.): ${$('#outBF').textContent}`,
        `WHtR: ${$('#outWHtR').textContent}`,
        `BMR: ${$('#outBMR').textContent}`,
        `TDEE: ${$('#outTDEE').textContent}`,
        `Suggested calories: ${$('#outCals').textContent}`
      ].join('\n');
      navigator.clipboard.writeText(text).then(() => alert('Copied!')).catch(() => alert('Copy failed'));
    };
    $('#btnCopy').addEventListener('click', copyOut);

    $('#btnPermalink').addEventListener('click', () => { updatePermalink(); navigator.clipboard.writeText(location.href).then(() => alert('Link copied!')); });
    $('#btnExample').addEventListener('click', () => {
      E.unit.value = 'metric'; toggleUnits();
      E.heightCm.value = '170'; E.weightKg.value = '70';
      E.std.value = 'who'; E.age.value = '30'; E.sex.value = 'male'; E.waist.value = '82';
      E.targetBMI.value = '22.5';
      calculate();
    });

    // Events
    E.form.addEventListener('submit', (e) => { e.preventDefault(); calculate(); });
    $('#btnClear').addEventListener('click', () => {
      ['heightCm', 'heightFt', 'heightIn', 'weightKg', 'weightLb', 'age', 'waist'].forEach(id => { const el = $('#' + id); if (el) el.value = ''; });
      E.sex.value = 'none';
      setStatus('Cleared', 'warn');
      ['outBMI', 'outCat', 'outRange', 'outPrime', 'outBF', 'outWHtR', 'outBMR', 'outTDEE', 'outCals', 'outTargetW', 'outDeltaW'].forEach(id => setText($('#' + id), '—'));
      $('#tips').textContent = '';
      updatePermalink();
    });

    // Recalc on change
    [E.heightCm, E.heightFt, E.heightIn, E.weightKg, E.weightLb, E.age, E.sex, E.waist, E.activity, E.goalRate, E.targetBMI].forEach(el => {
      if (!el) return;
      const fn = (el.id === 'activity' || el.id === 'goalRate' || el.id === 'targetBMI') ? updatePlanner : calculate;
      el.addEventListener('input', debounce(fn, 150));
      el.addEventListener('change', fn);
    });

    E.unit.addEventListener('change', () => { toggleUnits(); calculate(); });
    E.std.addEventListener('change', () => { renderScale(); calculate(); });

    // Keyboard: Enter triggers calc
    document.addEventListener('keydown', (e) => { if (e.key === 'Enter' && document.activeElement && document.activeElement.tagName === 'INPUT') { e.preventDefault(); calculate(); } });

    // Load: restore state, params, render
    $('#y').textContent = new Date().getFullYear();
    const last = read('bmi:last', null);
    if (last) {
      E.unit.value = last.unit || 'metric';
      E.std.value = last.std || 'who';
      toggleUnits();
      if (E.unit.value === 'metric') { E.heightCm.value = last.cm || ''; E.weightKg.value = last.kg || ''; }
      else {
        const totalIn = (last.cm || 0) / CM_PER_IN;
        const ft = Math.floor(totalIn / 12);
        const inch = totalIn - ft * 12;
        E.heightFt.value = ft || ''; E.heightIn.value = inch ? inch.toFixed(1) : '';
        E.weightLb.value = last.kg ? (last.kg / KG_PER_LB).toFixed(1) : '';
      }
      E.age.value = last.age || ''; E.sex.value = last.sex || 'none'; E.waist.value = last.waist || '';
    }

    // Apply URL params
    (function applyParams() {
      const u = new URL(location.href);
      const unit = u.searchParams.get('u');
      const std = u.searchParams.get('s');
      if (unit) E.unit.value = unit;
      if (std) E.std.value = std;
      toggleUnits();
      const h = num(u.searchParams.get('h'));
      const w = num(u.searchParams.get('w'));
      if (h) {
        if (E.unit.value === 'metric') { E.heightCm.value = (Number(h)).toFixed(1); }
        else {
          const totalIn = h / CM_PER_IN;
          const ft = Math.floor(totalIn / 12);
          const inch = totalIn - ft * 12;
          E.heightFt.value = ft; E.heightIn.value = (Number(inch)).toFixed(1);
        }
      }
      if (w) {
        if (E.unit.value === 'metric') { E.weightKg.value = (Number(w)).toFixed(1); }
        else { E.weightLb.value = (Number(w / KG_PER_LB)).toFixed(1); }
      }
      const a = u.searchParams.get('a'); if (a) E.age.value = a;
      const x = u.searchParams.get('x'); if (x) E.sex.value = x;
      const wc = u.searchParams.get('wc'); if (wc) E.waist.value = wc;
    })();

    renderScale();
    calculate();

    // Ads fallback (keep slot stable)
    setTimeout(() => {
      const ins = document.querySelector('#ad-article-1 ins.adsbygoogle');
      const fb = document.querySelector('#ad-article-1 .ad-fallback');
      const filled = ins && ins.querySelector('iframe');
      if (!filled && fb) { fb.style.display = 'block'; }
    }, 1200);

    // ---- Universal results sheet controls
    const openSheet = () => { E.sheet.classList.add('open'); E.sheet.setAttribute('aria-hidden', 'false'); E.sheetToggle.setAttribute('aria-expanded', 'true'); }
    const closeSheet = () => { E.sheet.classList.remove('open'); E.sheet.setAttribute('aria-hidden', 'true'); E.sheetToggle.setAttribute('aria-expanded', 'false'); }
    E.sheetToggle.addEventListener('click', () => E.sheet.classList.contains('open') ? closeSheet() : openSheet());
    E.sheetClose.addEventListener('click', closeSheet);
    E.mBtnCopyOut.addEventListener('click', () => copyOut());
    E.mBtnReset.addEventListener('click', () => $('#btnClear').click());

    // Auto-open results after first successful calculation (nice UX)
    let firstOpen = false;
    const maybeOpenAfterCalc = () => {
      if (!firstOpen) { openSheet(); firstOpen = true; }
    };
    E.form.addEventListener('submit', maybeOpenAfterCalc, { once: true });

    // Close drawer when resizing from desktop to mobile if needed (optional)
    window.addEventListener('resize', () => {
      // Keep it simple: do nothing; drawer adapts automatically.
    });
  </script>
</body>

</html>