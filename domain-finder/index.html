<!doctype html>
<html lang="en">
<head>
  <!-- Ads (kept stable to avoid CLS; do NOT insert ad slot if unavailable) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6216304334889617" crossorigin="anonymous"></script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Domain Finder (Available Now + Expiring Soon) for Flipping | UpTools</title>
  <meta name="description" content="Find only REAL opportunities: instantly check which domains are AVAILABLE now and which are EXPIRING soon (with expiry dates). Optional traffic/rank estimate, shortlist, CSV export, and quick-buy links. Free & privacy-first." />
  <meta name="keywords" content="domain flipping, buy domains, available domains, expiring domains, expired domains, domain finder, rdap, domain availability checker, similarweb rank, domain investing tools" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <meta name="theme-color" content="#0b1020" />
  <link rel="canonical" href="https://www.uptools.in/domain-finder/" />

  <!-- Icons -->
  <link rel="icon" type="image/svg+xml" href="/assets/logo/uptools-logo.svg" />
  <link rel="apple-touch-icon" href="/assets/logo/uptools-logo.svg" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Domain Finder (Available + Expiring Soon) | UpTools" />
  <meta property="og:description" content="See only the domains that matter: AVAILABLE now + EXPIRING soon (with dates) and optional traffic rank. Export CSV. Free & fast." />
  <meta property="og:url" content="https://www.uptools.in/domain-finder/" />
  <meta property="og:image" content="/assets/og/domain-finder.png" />
  <meta property="og:site_name" content="UpTools" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Domain Finder (Available + Expiring Soon)" />
  <meta name="twitter:description" content="Only available & expiring domains, with expiry dates and optional traffic rank. Shortlist & export." />
  <meta name="twitter:image" content="/assets/og/domain-finder.png" />

  <!-- Shared brand CSS & Utils -->
  <link rel="preload" href="/style.css?v=1.3.0" as="style">
  <link rel="stylesheet" href="/style.css?v=1.3.0" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="/style.css?v=1.3.0"></noscript>
  <script defer src="/utils.js"></script>

  <!-- JSON-LD: Software + Breadcrumb + FAQ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@graph":[
      {
        "@type":"SoftwareApplication",
        "name":"UpTools Domain Finder",
        "applicationCategory":"BusinessApplication",
        "operatingSystem":"Any",
        "url":"https://www.uptools.in/domain-finder/",
        "image":"https://www.uptools.in/assets/og/domain-finder.png",
        "description":"Find only real opportunities: AVAILABLE domains and EXPIRING soon domains with expiry dates, plus optional traffic/rank estimate.",
        "offers":{"@type":"Offer","price":"0","priceCurrency":"INR"}
      },
      {
        "@type":"BreadcrumbList",
        "itemListElement":[
          {"@type":"ListItem","position":1,"name":"Home","item":"https://www.uptools.in/"},
          {"@type":"ListItem","position":2,"name":"Tools","item":"https://www.uptools.in/#tools"},
          {"@type":"ListItem","position":3,"name":"Domain Finder","item":"https://www.uptools.in/domain-finder/"}
        ]
      },
      {
        "@type":"FAQPage",
        "mainEntity":[
          {"@type":"Question","name":"How do you check availability without exposing me?", "acceptedAnswer":{"@type":"Answer","text":"We use public RDAP endpoints through a privacy-friendly proxy (via your server-side /api?url=) to see if a domain object exists. A 404 usually means the domain is available. If present, we read its expiry event date."}},
          {"@type":"Question","name":"Can I see expiry dates for registered domains?", "acceptedAnswer":{"@type":"Answer","text":"Yes. When the RDAP record includes an expiration event, we show the expiry date and highlight domains expiring within your chosen window (e.g., 7â€“60 days)."}},
          {"@type":"Question","name":"Do you show traffic?", "acceptedAnswer":{"@type":"Answer","text":"Optionally. We try a lightweight public rank/traffic source (like Similarweb data endpoint). If the source is unavailable for a domain or blocked by CORS, we fall back to showing N/A."}}
        ]
      }
    ]
  }
  </script>

  <style>
    /* Page tweaks on top of common /style.css */
    :root{ --content-w: 1100px; }
    body{ background: radial-gradient(1200px 600px at 10% -10%, #0b1020 0, transparent 40%), linear-gradient(135deg,#0a0f1a,#0a1220); }
    .site{ position: sticky; top: 0; z-index: 20; }
    main.page { max-width: var(--content-w); margin: 0 auto; padding: 12px; display: grid; grid-template-columns: 360px 1fr; gap: 12px; min-height: calc(100vh - 64px); }
    @media (max-width: 900px){ main.page{ grid-template-columns: 1fr; } }

    .panel{ background:#101828; border:1px solid var(--border); border-radius:12px; box-shadow: var(--shadow); }
    .panel-header{ padding:.9rem 1rem; border-bottom:1px solid color-mix(in oklab,var(--accent) 20%, #233); display:flex; align-items:center; justify-content:space-between; }
    .panel-title{ display:flex; align-items:center; gap:.6rem; font-weight:800; }
    .pill{ display:inline-grid; place-items:center; width:28px; height:28px; border-radius:8px; background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:#06121a; font-weight:900; }
    .panel-body{ padding: 12px; display: grid; gap: 12px; }

    .row-grid{ display:grid; gap:10px; }
    .row-2{ grid-template-columns:1fr 1fr; }
    .chips{ gap:8px; }
    .chip.active{ border-color: color-mix(in oklab, var(--accent) 70%, white); color:#eafffb; }

    .kbar{ display:flex; align-items:center; gap:8px; font-size:12px; color:var(--muted); }
    .progress{ height:8px; background:#0b1326; border:1px solid var(--border); border-radius:8px; width:100%; overflow:hidden; }
    .progress > span{ display:block; height:100%; width:0%; background:linear-gradient(90deg, var(--accent), var(--accent-2)); transition:width .25s ease; }

    .right{ display:grid; grid-template-rows:auto auto 1fr; gap:12px; min-height: calc(100vh - 110px); }
    .card{ padding: 12px; }
    .card h3{ margin:0 0 6px; display:flex; align-items:center; justify-content:space-between; }
    .badge{ font:700 12px/1 system-ui; border:1px solid var(--border); background:#0b1326; color:#cfe7ff; padding:.25rem .45rem; border-radius:999px; }

    .lists{ display:grid; grid-template-columns:1fr 1fr; gap:12px; height:100%; }
    @media (max-width: 1100px){ .lists{ grid-template-columns:1fr; } }

    .rows{ display:grid; gap:8px; overflow:auto; max-height: 100%; padding-right:2px; }
    .rowi{ display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center; border:1px dashed var(--border); border-radius:10px; padding:8px; background:#0b1326; }
    .meta{ display:flex; gap:8px; flex-wrap:wrap; color:#9ec2ff; font-size:12px; }
    .meta .tag{ border:1px solid var(--border); padding:2px 6px; border-radius:999px; background:#0a1224; }
    .act{ display:flex; gap:6px; flex-wrap:wrap; }
    .act a{ text-decoration:none; }
    .n{ font-weight:800; color:#dffaf2; }
    .score{ color:#aef8e4; font-weight:800; }
    .when{ color:#ffd3a3; font-weight:700; }
    .rank{ color:#cfa9ff; font-weight:700; }
    .muted{ font-size:12px; }

    .video-card .video-frame{ position:relative; width:100%; aspect-ratio:16/9; border:1px solid var(--border); border-radius:10px; overflow:hidden; background:#0b1326; }
    .video-card iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; }
    .thumb{ position:absolute; inset:0; cursor:pointer; display:grid; place-items:center; }
    .thumb img{ width:100%; height:100%; object-fit:cover; }
    .thumb .play{ position:absolute; width:72px; height:72px; border-radius:999px; background:rgba(0,0,0,.5); border:2px solid #fff; display:grid; place-items:center; }
    .thumb .play::after{ content:""; border-left:18px solid #fff; border-top:10px solid transparent; border-bottom:10px solid transparent; margin-left:6px; }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="site" role="banner">
    <div class="header-inner">
      <a class="brand" href="/" aria-label="UpTools Home">
        <img src="/assets/logo/uptools-logo.svg" alt="UpTools logo" width="28" height="28" loading="eager">
        <b>UpTools</b>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/#tools">Tools</a>
        <a href="/income-tax-tool/">Income Tax</a>
        <a href="/emi-calculator/">EMI</a>
        <a href="/gst-calculator/">GST</a>
        <a aria-current="page" href="/domain-finder/">Domains</a>
      </nav>
    </div>
  </header>

  <main class="page">
    <!-- LEFT: Controls -->
    <section class="panel" id="controls">
      <div class="panel-header">
        <div class="panel-title"><span class="pill" title="Subpage textual logo">DF</span> Only-Opportunities Finder</div>
        <button class="btn sm secondary" id="resetBtn">Reset</button>
      </div>

      <div class="panel-body">
        <!-- Mode -->
        <div class="row-grid">
          <label class="label">Search mode</label>
          <div class="chips" role="group" aria-label="Search mode">
            <button type="button" class="chip active" data-mode="generate">Generate ideas</button>
            <button type="button" class="chip" data-mode="paste">Paste domain list</button>
            <button type="button" class="chip" data-mode="csv">Import CSV</button>
          </div>
        </div>

        <!-- Generate -->
        <div id="mode-generate" class="row-grid">
          <label class="label" for="kw">Seed keywords</label>
          <input id="kw" class="input" placeholder="e.g., ai, health, fintech, travel" />
          <div class="row-grid row-2">
            <div>
              <label class="label">TLDs</label>
              <div class="chips" id="tlds">
                <button class="chip active" data-tld=".com">.com</button>
                <button class="chip active" data-tld=".in">.in</button>
                <button class="chip active" data-tld=".co">.co</button>
                <button class="chip" data-tld=".ai">.ai</button>
                <button class="chip" data-tld=".io">.io</button>
                <button class="chip" data-tld=".dev">.dev</button>
                <button class="chip" data-tld=".app">.app</button>
              </div>
            </div>
            <div>
              <label class="label" for="maxLen">Max name length</label>
              <input id="maxLen" type="number" class="input" min="3" max="30" value="14" />
              <label class="label" for="allow">Characters</label>
              <select id="allow" class="input">
                <option value="no">No digits/hyphens</option>
                <option value="digits-ok">Digits OK</option>
                <option value="hyphen-ok">Hyphens OK</option>
                <option value="both-ok">Both OK</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Paste -->
        <div id="mode-paste" class="row-grid hidden">
          <label class="label" for="pasteBox">Paste domains (one per line)</label>
          <textarea id="pasteBox" class="textarea" placeholder="example.com&#10;cool.ai&#10;awesome.co"></textarea>
        </div>

        <!-- CSV -->
        <div id="mode-csv" class="row-grid hidden">
          <label class="label" for="csvFile">Import CSV (domain[,exp_date])</label>
          <input id="csvFile" type="file" class="input" accept=".csv,text/csv" />
        </div>

        <div class="row-grid row-2">
          <div>
            <label class="label" for="expWindow">Expiring within (days)</label>
            <input id="expWindow" class="input" type="number" min="1" max="120" value="30" />
          </div>
          <div>
            <label class="label" for="withTraffic">Traffic estimate</label>
            <select id="withTraffic" class="input">
              <option value="off">Off (faster)</option>
              <option value="expiring">Expiring only</option>
              <option value="all">All domains</option>
            </select>
          </div>
        </div>

        <div class="kbar">
          <button class="btn" id="runBtn">Generate & Check</button>
          <button class="btn secondary" id="exportBtn">Export CSV</button>
        </div>

        <div class="kbar" aria-live="polite">
          <span id="statLabel">Idle</span>
          <div class="progress"><span id="statBar"></span></div>
        </div>

        <div class="note">
          Only <b>Available Now</b> & <b>Expiring Soon</b> are shown. We use RDAP (via your <code>/api?url=</code> proxy) to verify availability and read expiry dates. Traffic rank is best-effort.
        </div>

        <!-- Helpful links -->
        <div class="card">
          <h3 class="muted" style="margin:0 0 6px">Marketplaces & Tools</h3>
          <div class="chips">
            <a class="pill" href="https://auctions.godaddy.com/" target="_blank" rel="noopener">GoDaddy Auctions</a>
            <a class="pill" href="https://www.namejet.com/" target="_blank" rel="noopener">NameJet</a>
            <a class="pill" href="https://www.dropcatch.com/" target="_blank" rel="noopener">DropCatch</a>
            <a class="pill" href="https://www.expireddomains.net/" target="_blank" rel="noopener">ExpiredDomains</a>
            <a class="pill" href="https://lookup.icann.org/en/lookup" target="_blank" rel="noopener">ICANN WHOIS</a>
            <a class="pill" href="https://web.archive.org/" target="_blank" rel="noopener">Archive.org</a>
          </div>
        </div>
      </div>
    </section>

    <!-- RIGHT: Results -->
    <section class="right">
      <article class="card">
        <h3>
          Available Now
          <span class="badge" id="countAvail">0</span>
        </h3>
        <div class="rows" id="listAvail">
          <div class="muted">Run a search to see available domains.</div>
        </div>
      </article>

      <div class="lists">
        <article class="card">
          <h3>
            Expiring Soon
            <span class="badge" id="countExp">0</span>
          </h3>
          <div class="rows" id="listExp">
            <div class="muted">Import CSV or run generate to find domains expiring within your window.</div>
          </div>
        </article>

        <article class="card video-card" aria-labelledby="ytTitle">
          <h3 id="ytTitle">How to Flip Domains (Beginner to Pro)</h3>
          <div class="video-frame" id="ytFrame">
            <!-- click-to-load to avoid CLS -->
            <button class="thumb" id="ytLoad" aria-label="Play tutorial video" data-id="QZp8x6J8T30">
              <img src="https://img.youtube.com/vi/QZp8x6J8T30/hqdefault.jpg" alt="Domain flipping tutorial" width="560" height="315" loading="lazy" decoding="async">
              <div class="play" aria-hidden="true"></div>
            </button>
          </div>
          <p class="note" style="margin:.5rem 0 0">Video is lazy-loaded; layout is fixed with 16:9 frame for zero CLS.</p>
        </article>
      </div>

      <!-- Suggested ad placement: After results (below fold on desktop) to avoid layout shift. Only render if you have an ad slot configured. -->
    </section>
  </main>

  <footer class="center" style="margin: 12px 0 18px">
    <div class="note">Â© UpTools Â· <a href="/#tools">All Tools</a> Â· <a href="/currency-converter/">Currency</a> Â· <a href="/password-generator/">Passwords</a> Â· <a href="/uuid-generator/">UUID</a> Â· <a href="/whatsapp-chat/">WhatsApp Link</a></div>
  </footer>

  <script>
    // ---- utils fallback if /utils.js isn't present during dev ----
    const Utils = (window.Utils) || {
      $: (s, r=document)=>r.querySelector(s),
      $$: (s, r=document)=>[...r.querySelectorAll(s)],
      debounce(fn, d=120){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), d); }; },
      persist:(k,v)=>localStorage.setItem(k, JSON.stringify(v)),
      read:(k,d=null)=>{try{return JSON.parse(localStorage.getItem(k)) ?? d;}catch{return d;}},
      fmtNum:(n,o={})=>(new Intl.NumberFormat('en-IN', {maximumFractionDigits:2, ...o}).format(n??0))
    };
    const {$, $$} = Utils;

    // ---- UI helpers ----
    const tldSet = new Set([".com",".in",".co"]);
    $$('#tlds .chip').forEach(c=> c.addEventListener('click', ()=>{
      c.classList.toggle('active');
      const t=c.dataset.tld;
      if(c.classList.contains('active')) tldSet.add(t); else tldSet.delete(t);
    }));

    // Mode switching
    const modes = { generate: $('#mode-generate'), paste: $('#mode-paste'), csv: $('#mode-csv') };
    $$('.panel-body .chip[data-mode]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        $$('.panel-body .chip[data-mode]').forEach(b=> b.classList.remove('active'));
        btn.classList.add('active');
        const m = btn.dataset.mode;
        Object.entries(modes).forEach(([k,el])=> el.classList.toggle('hidden', k!==m));
      });
    });

    // ---- Brandability score (fast heuristic) ----
    const vowels = new Set('aeiou');
    function brandScore(domain){
      const name = domain.split('.')[0];
      const len = name.length;
      const hasHyphen = /-/.test(name);
      const hasDigit = /\d/.test(name);
      const vc = name.replace(/[^a-z]/g,'').split('').map(c=> vowels.has(c)?'v':'c').join('');
      let s = 100;
      if(len < 4 || len > 14) s -= 20;
      if(hasHyphen) s -= 15;
      if(hasDigit) s -= 10;
      if(/(vv|ccc{3,}|[aeiou]{4,})/.test(vc)) s -= 10;
      if(/(ai|io|ly|ify|hub|labs|base|stack|gen|flow|grid|zone|nest|forge|kit|deck|nova|pulse|mint)$/.test(name)) s += 8;
      if(/^(go|get|try|my|hey|we|use|top|pro)/.test(name)) s += 5;
      return Math.max(0, Math.min(100, s));
    }

    // ---- Candidate generator ----
    const PREFIX = ["go","get","try","my","hey","we","use","top","pro","neo","ultra","swift","true","hyper","omni","mint","clear","alpha","next"];
    const SUFFIX = ["ly","ify","io","hub","labs","base","stack","gen","flow","grid","zone","spot","deck","kit","forge","nest","pilot","vista","pulse","mint"];
    function combos(seed){
      const out = new Set();
      const s = seed.toLowerCase().replace(/[^a-z0-9-]+/g,'');
      if(!s) return out;
      out.add(s);
      PREFIX.forEach(p=> out.add(p+s));
      SUFFIX.forEach(x=> out.add(s+x));
      out.add(s.replace(/[aeiou][^aeiou]*$/,'')); // short blend
      out.add(s.slice(0, Math.max(3, s.length-1)));
      return out;
    }
    function makeCandidates(words, tlds, maxLen, mode){
      const allowHyphen = /hyphen|both/.test(mode);
      const allowDigit  = /digits|both/.test(mode);
      const seeds = new Set();
      words.forEach(w=> combos(w).forEach(x=> seeds.add(x)));
      const out=[];
      seeds.forEach(n=>{
        tlds.forEach(tld=>{
          let name=n;
          if(!allowHyphen) name = name.replace(/-/g,'');
          if(!allowDigit)  name = name.replace(/\d/g,'');
          const d = `${name}${tld}`;
          if(name && d.length <= maxLen + tld.length && /^[a-z0-9-]+(\.[a-z]{2,})$/.test(d)){
            out.push(d);
          }
        });
      });
      // score + dedupe
      const uniq = [...new Map(out.map(d => [d, d])).values()];
      return uniq.slice(0, 250).map(d=>({domain:d, score:brandScore(d)}))
                 .sort((a,b)=> b.score - a.score || a.domain.length - b.domain.length);
    }

    // ---- RDAP lookup (via your CF Worker /api?url= proxy) ----
    async function rdapLookup(domain){
      // rdap.org routes to the right registry. 404 => likely available.
      const url = `/api?url=${encodeURIComponent('https://rdap.org/domain/' + domain)}`;
      try{
        const res = await fetch(url, {cache:'no-store'});
        if(res.status === 404) return { status:'available' };
        if(!res.ok) return { status:'unknown' };
        const j = await res.json();
        const events = Array.isArray(j.events)? j.events : [];
        const exp = events.find(e=> /expir/i.test(e.eventAction || ''))?.eventDate || null;
        // registrar (best-effort)
        let registrar = j.registrarName || '';
        if(!registrar && Array.isArray(j.entities)){
          for(const ent of j.entities){
            if((ent.roles||[]).includes('registrar') && Array.isArray(ent.vcardArray)){
              const card = ent.vcardArray[1] || [];
              const fn = card.find(row => row[0]==='fn');
              if(fn && fn[3]) registrar = fn[3];
            }
          }
        }
        return { status:'registered', expiration: exp, registrar };
      }catch(_e){
        return { status:'error' };
      }
    }

    // ---- Traffic estimate (best-effort; Similarweb public data) ----
    async function trafficEstimate(domain){
      const sw = `/api?url=${encodeURIComponent('https://data.similarweb.com/api/v1/data?domain=' + domain)}`;
      try{
        const r = await fetch(sw, {cache:'no-store'});
        if(!r.ok) return null;
        const j = await r.json();
        const rank = j?.GlobalRank?.Rank ?? null;
        const visits = j?.Engagements?.Visits ?? null;
        return { rank, visits };
      }catch(_e){ return null; }
    }

    // ---- Concurrency control ----
    async function mapLimit(items, limit, worker){
      const ret = [];
      let i = 0;
      const runners = Array(Math.min(limit, items.length)).fill(0).map(async function run(){
        while(i < items.length){
          const cur = i++; ret[cur] = await worker(items[cur], cur);
        }
      });
      await Promise.all(runners);
      return ret;
    }

    // ---- Rendering ----
    const listAvail = $('#listAvail');
    const listExp   = $('#listExp');
    const countAvail = $('#countAvail');
    const countExp = $('#countExp');
    function rowHtml({domain, score, when, rank, registrar}){
      const buy = [
        ["Namecheap", `https://www.namecheap.com/domains/registration/results/?domain=${encodeURIComponent(domain)}`],
        ["Porkbun", `https://porkbun.com/search?q=${encodeURIComponent(domain)}`],
        ["Dynadot", `https://www.dynadot.com/domain/search.html?domain=${encodeURIComponent(domain)}`],
        ["GoDaddy", `https://in.godaddy.com/domainsearch/find?domainToCheck=${encodeURIComponent(domain)}`]
      ];
      const links = buy.map(([t,h])=>`<a class="btn sm ghost" href="${h}" target="_blank" rel="noopener">${t}</a>`).join('');
      const meta = `
        <div class="meta">
          <span class="tag"><b>Score</b> <span class="score">${score}</span></span>
          ${when ? `<span class="tag">Expiry <span class="when">${when}</span></span>`:''}
          ${rank ? `<span class="tag">Traffic rank <span class="rank">#${Utils.fmtNum(rank,{maximumFractionDigits:0})}</span></span>`:''}
          ${registrar ? `<span class="tag">Registrar: ${registrar}</span>`:''}
        </div>`;
      return `<div class="rowi">
        <div>
          <div class="n">${domain}</div>
          ${meta}
        </div>
        <div class="act">${links}</div>
      </div>`;
    }

    function addAvail(item){
      if(listAvail.firstElementChild?.classList.contains('muted')) listAvail.innerHTML='';
      listAvail.insertAdjacentHTML('beforeend', rowHtml(item));
      countAvail.textContent = String(+countAvail.textContent + 1);
    }
    function addExp(item){
      if(listExp.firstElementChild?.classList.contains('muted')) listExp.innerHTML='';
      listExp.insertAdjacentHTML('beforeend', rowHtml(item));
      countExp.textContent = String(+countExp.textContent + 1);
    }

    // ---- Progress UI ----
    function setProgress(done, total, label='Workingâ€¦'){
      $('#statLabel').textContent = `${label} ${done}/${total}`;
      $('#statBar').style.width = total ? `${Math.round(done*100/total)}%` : '0%';
    }

    // ---- CSV helpers ----
    function parseCSV(text){
      const lines = text.split(/\r?\n/).filter(Boolean);
      if(!lines.length) return [];
      const header = lines[0].toLowerCase();
      const hasHeader = /domain|exp/.test(header);
      const rows = hasHeader ? lines.slice(1) : lines;
      return rows.map(line=>{
        const cols = line.split(',').map(s=>s.trim());
        return { domain: cols[0], exp_date: cols[1] || '' };
      }).filter(x=> x.domain && /\./.test(x.domain));
    }
    function exportCSV(){
      const rows = [['domain','score','status','expiry','rank','registrar']];
      $$('#listAvail .rowi, #listExp .rowi').forEach(r=>{
        const domain = r.querySelector('.n')?.textContent?.trim() || '';
        const score = r.querySelector('.score')?.textContent?.trim() || '';
        const when  = r.querySelector('.when')?.textContent?.trim() || '';
        const rank  = r.querySelector('.rank')?.textContent?.replace('#','').trim() || '';
        const status = r.closest('#listExp') ? 'expiring' : 'available';
        const reg = r.querySelector('.meta .tag:nth-child(4)')?.textContent?.replace('Registrar:','').trim() || '';
        rows.push([domain, score, status, when, rank, reg]);
      });
      const csv = rows.map(r=> r.map(x=> `"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
      const a=document.createElement('a');
      a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
      a.download='domain_opportunities.csv'; a.click();
      URL.revokeObjectURL(a.href);
    }

    // ---- Main flow ----
    $('#exportBtn').addEventListener('click', exportCSV);
    $('#resetBtn').addEventListener('click', ()=>{
      listAvail.innerHTML = '<div class="muted">Run a search to see available domains.</div>';
      listExp.innerHTML   = '<div class="muted">Import CSV or run generate to find domains expiring within your window.</div>';
      countAvail.textContent = '0'; countExp.textContent='0';
      setProgress(0,0,'Idle');
    });

    $('#runBtn').addEventListener('click', async ()=>{
      // Reset UI
      listAvail.innerHTML = '<div class="muted">Checkingâ€¦</div>';
      listExp.innerHTML   = '<div class="muted">Checkingâ€¦</div>';
      countAvail.textContent='0'; countExp.textContent='0';
      setProgress(0,0,'Preparingâ€¦');

      // Source set
      let domains = [];
      const mode = $('.panel-body .chip[data-mode].active')?.dataset.mode || 'generate';
      if(mode === 'generate'){
        const words = $('#kw').value.split(/[,\s]+/).map(s=>s.trim()).filter(Boolean).slice(0,8);
        if(!words.length){ alert('Enter at least one keyword.'); return; }
        const maxLen = +$('#maxLen').value || 14;
        const allow = $('#allow').value;
        const tlds = [...tldSet];
        domains = makeCandidates(words, tlds, maxLen, allow).map(x=>x.domain);
      }else if(mode === 'paste'){
        domains = $('#pasteBox').value.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
      }else{
        const f = $('#csvFile').files?.[0];
        if(!f){ alert('Choose a CSV file.'); return; }
        const text = await f.text();
        domains = parseCSV(text).map(r=>r.domain);
      }
      // Deduplicate & limit
      domains = [...new Set(domains)].slice(0, 300);

      const total = domains.length;
      let done = 0; setProgress(done, total, 'Checking RDAP');

      const expWindowDays = Math.max(1, Math.min(120, +$('#expWindow').value || 30));
      const trafficMode = $('#withTraffic').value; // off | expiring | all
      const wantTrafficAll = trafficMode === 'all';
      const wantTrafficExp = trafficMode === 'expiring';

      // Precompute scores
      const scoreMap = new Map(domains.map(d => [d, brandScore(d)]));

      // Lookups with small concurrency
      await mapLimit(domains, 6, async (domain)=>{
        const rd = await rdapLookup(domain);
        let rank = null, visits = null;

        if(rd.status === 'available'){
          if(wantTrafficAll){ const t = await trafficEstimate(domain); rank = t?.rank || null; visits = t?.visits || null; }
          addAvail({ domain, score: scoreMap.get(domain), rank });
        }else if(rd.status === 'registered' && rd.expiration){
          const exp = new Date(rd.expiration);
          const today = new Date();
          const days = Math.ceil((exp - today)/86400000);
          if(days >= 0 && days <= expWindowDays){
            if(wantTrafficAll || wantTrafficExp){
              const t = await trafficEstimate(domain); rank = t?.rank || null; visits = t?.visits || null;
            }
            const when = exp.toISOString().split('T')[0];
            addExp({ domain, score: scoreMap.get(domain), when, rank, registrar: rd.registrar || '' });
          }
        }
        // ignore registered but not expiring within window
        done++; setProgress(done, total, 'Checking RDAP');
      });

      if(+countAvail.textContent === 0) listAvail.innerHTML = '<div class="muted">No immediately available candidates found with current settings.</div>';
      if(+countExp.textContent === 0) listExp.innerHTML = '<div class="muted">No domains expiring within your chosen window.</div>';
    });

    // ---- YouTube lazy loader ----
    $('#ytLoad').addEventListener('click', ()=>{
      const id = $('#ytLoad').dataset.id;
      const ifr = document.createElement('iframe');
      ifr.width=560; ifr.height=315;
      ifr.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
      ifr.referrerPolicy="strict-origin-when-cross-origin";
      ifr.allowFullscreen = true;
      ifr.src = `https://www.youtube-nocookie.com/embed/${encodeURIComponent(id)}?autoplay=1&rel=0`;
      const frame = $('#ytFrame'); frame.innerHTML=''; frame.appendChild(ifr);
    });
  </script>
</body>
</html>