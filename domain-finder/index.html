<!doctype html>
<html lang="en">
<head>
  <!-- Ads (async; if blocked, harmless) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6216304334889617" crossorigin="anonymous"></script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Domain Finder (Available + Expiring) | UpTools</title>
  <meta name="description" content="Find REAL opportunities: show only domains that are AVAILABLE now or EXPIRING soon (with dates). Generate by keywords or by length (permutations & pronounceable patterns), check via RDAP, optional traffic rank, shortlist & export. Free & privacy-first." />
  <meta name="keywords" content="domain finder, available domains, expiring domains, expired domains, RDAP check, domain flipping, permutations, pronounceable domains, domain traffic, brandable names" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <meta name="theme-color" content="#0b1020" />
  <link rel="canonical" href="https://www.uptools.in/domain-finder/" />

  <!-- Icons -->
  <link rel="icon" type="image/svg+xml" href="/assets/logo/uptools-logo.svg" />
  <link rel="apple-touch-icon" href="/assets/logo/uptools-logo.svg" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Domain Finder (Available + Expiring) | UpTools" />
  <meta property="og:description" content="Only available & expiring domains (with expiry dates). Generate by keywords or by length, optional traffic rank. Export CSV. Free & fast." />
  <meta property="og:url" content="https://www.uptools.in/domain-finder/" />
  <meta property="og:image" content="/assets/og/domain-finder.png" />
  <meta property="og:site_name" content="UpTools" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Domain Finder (Available + Expiring)" />
  <meta name="twitter:description" content="Generate domains by keywords or by length (permutations/patterns). Show only AVAILABLE & EXPIRING (with dates), optional traffic rank." />
  <meta name="twitter:image" content="/assets/og/domain-finder.png" />

  <!-- Common CSS & Utils (shared across site) -->
  <link rel="stylesheet" href="/style.css?v=1.3.3" />
  <script defer src="/scripts/utils.js" type="text/javascript"></script>

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@graph":[
      {
        "@type":"SoftwareApplication",
        "name":"UpTools Domain Finder",
        "applicationCategory":"BusinessApplication",
        "operatingSystem":"Any",
        "url":"https://www.uptools.in/domain-finder/",
        "image":"https://www.uptools.in/assets/og/domain-finder.png",
        "description":"Find only real opportunities: AVAILABLE domains and EXPIRING soon domains with expiry dates. Generate by keywords or by character length (permutations & pronounceable patterns).",
        "offers":{"@type":"Offer","price":"0","priceCurrency":"INR"}
      },
      {
        "@type":"BreadcrumbList",
        "itemListElement":[
          {"@type":"ListItem","position":1,"name":"Home","item":"https://www.uptools.in/"},
          {"@type":"ListItem","position":2,"name":"Tools","item":"https://www.uptools.in/#tools"},
          {"@type":"ListItem","position":3,"name":"Domain Finder","item":"https://www.uptools.in/domain-finder/"}
        ]
      }
    ]
  }
  </script>

  <style>
    /* ---------- Safety + base ---------- */
    *,*::before,*::after{ box-sizing:border-box; }
    html,body{ height:100%; }
    img{ max-width:100%; height:auto; }
    :root{
      --header-h: 60px;
      --content-w: 1120px;
      --radius: 12px;
    }
    body{
      background:
        radial-gradient(900px 480px at 12% -10%, #0b1020 0, transparent 50%),
        linear-gradient(135deg,#0a0f1a,#0a1220);
    }

    /* ---------- Header ---------- */
    .site{ position: sticky; top: 0; z-index: 20; background: rgba(8,12,20,.6); backdrop-filter: blur(6px); border-bottom: 1px solid rgba(255,255,255,.06); }
    .header-inner{ max-width: var(--content-w); margin:0 auto; padding:.6rem .8rem; display:flex; justify-content:space-between; align-items:center; min-height: var(--header-h); }
    .brand{ display:flex; gap:.5rem; align-items:center; color:#eaf3ff; text-decoration:none; }
    .nav-links a{ color:#b8c7d9; margin-left:1rem; text-decoration:none; }
    .nav-links a[aria-current="page"]{ color:#fff; font-weight:700; text-decoration:underline; text-underline-offset: 6px; }

    /* ---------- Layout (single page with internal scrollers) ---------- */
    main.page{
      max-width: var(--content-w);
      margin: 0 auto;
      padding: .75rem;
      height: calc(100dvh - var(--header-h));
      display: grid;
      grid-template-columns: 380px 1fr;
      gap: .75rem;
      min-height: 560px;
    }
    @media (max-width: 950px){
      main.page{ grid-template-columns: 1fr; height: auto; min-height: calc(100dvh - var(--header-h)); }
    }

    /* ---------- Panels ---------- */
    .panel, .card{
      background: #0f1726;
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .panel{ display:flex; flex-direction:column; min-height: 0; }
    .panel-header{ padding:.8rem .9rem; border-bottom:1px solid rgba(255,255,255,.08); display:flex; align-items:center; justify-content:space-between; }
    .panel-title{ display:flex; align-items:center; gap:.5rem; font-weight:800; color:#e9f2ff; }
    .pill{
      display:inline-block; padding:.32rem .6rem; border-radius: 10px;
      background: linear-gradient(135deg, var(--accent,#64ffda), var(--accent-2,#41c9a8)); color:#07161a; font-weight:900; line-height:1; white-space:nowrap;
    }
    .panel-body{ padding: .8rem .9rem; display: grid; gap: .75rem; overflow: auto; max-height: calc(100% - 54px); }

    .row-grid{ display:grid; gap:.6rem; }
    .row-2{ grid-template-columns: 1fr 1fr; gap: .6rem; }
    .row-3{ grid-template-columns: repeat(3,1fr); gap: .6rem; }
    @media (max-width: 950px){ .row-2,.row-3{ grid-template-columns:1fr; } }

    /* Inputs */
    label{ color:#c7d6e5; font-size:.95rem; }
    .input, .textarea, select{
      background:#0b1322; border:1px solid #263248; color:#e7f0ff; border-radius:10px; padding:.6rem .75rem; outline:none; width:100%;
    }
    .textarea{ min-height: 120px; resize: vertical; }

    .chips{ display:flex; flex-wrap:wrap; gap:.5rem; }
    .chip{
      padding:.45rem .7rem; border-radius:999px; background:#0b1322; border:1px solid #263248; color:#a9bed4;
      cursor:pointer; user-select:none; transition: .15s ease; position:relative; font-weight:600;
    }
    .chip.active{
      background: linear-gradient(135deg, rgba(100,255,218,.20), rgba(65,201,168,.20));
      border-color:#4bdcb3; color:#eafffb; outline: 2px solid rgba(100,255,218,.25); outline-offset: 1px; box-shadow: 0 0 0 2px rgba(75,220,179,.1) inset;
    }

    .btn{ border:1px solid #2a3a57; background:#122034; color:#d8e7ff; border-radius:10px; padding:.55rem .9rem; font-weight:700; cursor:pointer; }
    .btn.primary{ background:linear-gradient(180deg,#13aa87,#0e8c71); border-color:#0b6b57; }
    .btn.secondary{ background:#10182a; }
    .btn.ghost{ background:transparent; }
    .btn.sm{ padding:.35rem .6rem; font-size:.85rem; white-space:nowrap; }

    .kbar{ display:flex; align-items:center; gap:.6rem; font-size:.9rem; color:#9db2c8; }
    .progress{ height:8px; background:#0b1326; border:1px solid #203052; border-radius:8px; width:100%; overflow:hidden; }
    .progress > span{ display:block; height:100%; width:0%; background:linear-gradient(90deg, var(--accent,#64ffda), var(--accent-2,#41c9a8)); transition:width .25s ease; }

    /* RIGHT */
    .right{ display:grid; grid-template-rows: min-content minmax(0,1fr); gap:.75rem; min-height:0; }
    .lists{ display:grid; grid-template-columns: 1fr 1fr; gap:.75rem; min-height:0; }
    @media (max-width: 950px){ .lists{ grid-template-columns:1fr; } }
    .card h3{ margin:.8rem .9rem; display:flex; align-items:center; justify-content:space-between; }
    .rows{ display:grid; gap:.5rem; overflow:auto; padding: 0 .9rem .9rem; max-height: calc(100% - 48px); }

    .rowi{
      display:grid; grid-template-columns: 1fr auto; gap:.6rem; align-items:center;
      border:1px dashed #253149; border-radius:10px; padding:.7rem .8rem; background:#0b1326; overflow:hidden;
    }
    .n{ font-weight:800; color:#dffaf2; overflow-wrap:anywhere; word-break:break-word; }
    .meta{ display:flex; flex-wrap:wrap; gap:.45rem; margin-top:.35rem; font-size:.85rem; }
    .tag{ border:1px solid #2a3a57; background:#0a1224; color:#b9d0ff; padding:.25rem .55rem; border-radius:999px; }
    .score{ color:#aef8e4; font-weight:800; }
    .when{ color:#ffd3a3; font-weight:800; }
    .rank{ color:#cfa9ff; font-weight:800; }
    .visits{ color:#8ff9ff; font-weight:800; }
    .badge{ font:700 12px/1 system-ui; border:1px solid #203052; background:#0b1326; color:#cfe7ff; padding:.25rem .55rem; border-radius:999px; }

    /* Themed Choose File (improved) */
    .file-row{ display:grid; gap:.5rem; }
    input[type="file"]{ display:none; }
    .filebtn{
      display:inline-flex; align-items:center; gap:.5rem;
      border:1px dashed #2a3a57; background:#0b1322; color:#d8e7ff; border-radius:10px; padding:.55rem .8rem; font-weight:700; cursor:pointer;
    }
    .filebtn:hover{ border-color:#4bdcb3; box-shadow: 0 0 0 2px rgba(75,220,179,.08) inset; }
    .fileinfo{ font-size:.85rem; color:#9db2c8; }

    /* Video */
    .video-card .frame{ position:relative; width:100%; aspect-ratio:16/9; border-top:1px solid rgba(255,255,255,.06); border-bottom-left-radius: var(--radius); border-bottom-right-radius: var(--radius); overflow:hidden; background:#0b1326; }
    .video-card iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; }
    .thumb{ position:absolute; inset:0; cursor:pointer; display:grid; place-items:center; }
    .thumb img{ width:100%; height:100%; object-fit:cover; }
    .thumb .play{ position:absolute; width:72px; height:72px; border-radius:999px; background:rgba(0,0,0,.5); border:2px solid #fff; display:grid; place-items:center; }
    .thumb .play::after{ content:""; border-left:18px solid #fff; border-top:10px solid transparent; border-bottom:10px solid transparent; margin-left:6px; }

    footer{ max-width: var(--content-w); margin: .6rem auto 1rem; color:#9db3c6; text-align:center; }
    footer a{ color:#9ac7ff; text-decoration:none; }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="site" role="banner">
    <div class="header-inner">
      <a class="brand" href="/" aria-label="UpTools Home">
        <img src="/assets/logo/uptools-logo.svg" alt="UpTools logo" width="28" height="28" loading="eager">
        <b>UpTools</b>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/#tools">Tools</a>
        <a href="/income-tax-tool/">Income Tax</a>
        <a href="/emi-calculator/">EMI</a>
        <a href="/gst-calculator/">GST</a>
        <a aria-current="page" href="/domain-finder/">Domains</a>
      </nav>
    </div>
  </header>

  <main class="page">
    <!-- LEFT: Controls -->
    <section class="panel" id="controls">
      <div class="panel-header">
        <div class="panel-title"><span class="pill">DF</span> Only-Opportunities Finder</div>
        <button class="btn sm secondary" id="resetBtn">Reset</button>
      </div>

      <div class="panel-body">
        <!-- Mode -->
        <div class="row-grid">
          <label>Search mode</label>
          <div class="chips" role="group" aria-label="Search mode">
            <button type="button" class="chip active" data-mode="generate" aria-pressed="true">Generate (keywords, optional)</button>
            <button type="button" class="chip" data-mode="length" aria-pressed="false">Length-only (permutations / patterns)</button>
            <button type="button" class="chip" data-mode="paste" aria-pressed="false">Paste list</button>
            <button type="button" class="chip" data-mode="csv" aria-pressed="false">Import CSV</button>
          </div>
        </div>

        <!-- Generate (keywords OPTIONAL now) -->
        <div id="mode-generate" class="row-grid">
          <label for="kw">Seed keywords (optional)</label>
          <input id="kw" class="input" placeholder="e.g., ai, health, fintech, travel â€” or leave empty" />
          <div class="row-grid row-2">
            <div>
              <label>TLDs</label>
              <div class="chips" id="tlds">
                <button class="chip active" data-tld=".com" aria-pressed="true">.com</button>
                <button class="chip active" data-tld=".in" aria-pressed="true">.in</button>
                <button class="chip active" data-tld=".co" aria-pressed="true">.co</button>
                <button class="chip" data-tld=".ai" aria-pressed="false">.ai</button>
                <button class="chip" data-tld=".io" aria-pressed="false">.io</button>
                <button class="chip" data-tld=".dev" aria-pressed="false">.dev</button>
                <button class="chip" data-tld=".app" aria-pressed="false">.app</button>
              </div>
            </div>
            <div>
              <label for="maxLen">Max name length</label>
              <input id="maxLen" type="number" class="input" min="3" max="30" value="14" />
              <label for="allow">Characters</label>
              <select id="allow" class="input">
                <option value="no">No digits/hyphens</option>
                <option value="digits-ok">Digits OK</option>
                <option value="hyphen-ok">Hyphens OK</option>
                <option value="both-ok">Both OK</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Length-only generator -->
        <div id="mode-length" class="row-grid" hidden>
          <div class="row-grid row-3">
            <div>
              <label for="lenN">Target length</label>
              <input id="lenN" type="number" class="input" min="2" max="15" value="6" />
            </div>
            <div>
              <label for="lenKind">Generation</label>
              <select id="lenKind" class="input">
                <option value="pattern" selected>Pronounceable (C/V patterns)</option>
                <option value="perm">Brute-force permutations (small length)</option>
              </select>
            </div>
            <div>
              <label for="lenLimit">Max candidates</label>
              <input id="lenLimit" type="number" class="input" min="10" max="1000" value="200" />
            </div>
          </div>

          <div class="row-grid row-3">
            <div>
              <label>Allowed chars</label>
              <div class="chips" id="lenChars">
                <button class="chip active" data-flag="letters" aria-pressed="true">Letters aâ€“z</button>
                <button class="chip" data-flag="digits" aria-pressed="false">Digits 0â€“9</button>
                <button class="chip" data-flag="hyphen" aria-pressed="false">Hyphen -</button>
              </div>
            </div>
            <div>
              <label>Start with</label>
              <div class="chips" id="lenStart">
                <button class="chip active" data-start="letter" aria-pressed="true">Letter</button>
                <button class="chip" data-start="any" aria-pressed="false">Any</button>
              </div>
            </div>
            <div>
              <label>TLDs</label>
              <div class="chips" id="tlds2">
                <button class="chip active" data-tld=".com" aria-pressed="true">.com</button>
                <button class="chip active" data-tld=".in" aria-pressed="true">.in</button>
                <button class="chip" data-tld=".co" aria-pressed="false">.co</button>
                <button class="chip" data-tld=".io" aria-pressed="false">.io</button>
                <button class="chip" data-tld=".ai" aria-pressed="false">.ai</button>
              </div>
            </div>
          </div>

          <p class="tag">Tip: <b>Permutations</b> explode quickly. For length â‰¤ 3 we try exhaustive; beyond that we sample up to your <b>Max candidates</b>. <b>Pronounceable</b> uses C/V patterns (e.g., CVCV, CVVCV) to generate brandable strings.</p>
        </div>

        <!-- Paste -->
        <div id="mode-paste" class="row-grid" hidden>
          <label for="pasteBox">Paste domains (one per line)</label>
          <textarea id="pasteBox" class="textarea" placeholder="example.com&#10;cool.ai&#10;awesome.co"></textarea>
        </div>

        <!-- CSV (improved themed Choose File) -->
        <div id="mode-csv" class="row-grid" hidden>
          <div class="file-row">
            <input id="csvFile" type="file" accept=".csv,text/csv" />
            <label for="csvFile" class="filebtn" id="fileBtn">ðŸ“„ Choose CSV</label>
            <div class="fileinfo" id="fileInfo">Import CSV as: domain[,exp_date]</div>
          </div>
        </div>

        <!-- Global options -->
        <div class="row-grid row-2">
          <div>
            <label for="expWindow">Expiring within (days)</label>
            <input id="expWindow" class="input" type="number" min="1" max="120" value="30" />
          </div>
          <div>
            <label for="withTraffic">Traffic estimate</label>
            <select id="withTraffic" class="input">
              <option value="expiring" selected>Expiring only (recommended)</option>
              <option value="all">All domains (slower)</option>
              <option value="off">Off (fastest)</option>
            </select>
          </div>
        </div>

        <div class="kbar">
          <button class="btn primary" id="runBtn">Generate & Check</button>
          <button class="btn" id="exportBtn">Export CSV</button>
        </div>

        <div class="kbar" aria-live="polite">
          <span id="statLabel">Idle</span>
          <div class="progress"><span id="statBar"></span></div>
        </div>

        <div class="card" style="padding:.7rem;">
          <div class="row-grid">
            <strong style="color:#e6f1ff;">Marketplaces & Tools</strong>
            <div class="chips">
              <a class="chip" href="https://auctions.godaddy.com/" target="_blank" rel="noopener">GoDaddy Auctions</a>
              <a class="chip" href="https://www.namejet.com/" target="_blank" rel="noopener">NameJet</a>
              <a class="chip" href="https://www.dropcatch.com/" target="_blank" rel="noopener">DropCatch</a>
              <a class="chip" href="https://www.expireddomains.net/" target="_blank" rel="noopener">ExpiredDomains</a>
              <a class="chip" href="https://lookup.icann.org/en/lookup" target="_blank" rel="noopener">ICANN WHOIS</a>
              <a class="chip" href="https://web.archive.org/" target="_blank" rel="noopener">Archive.org</a>
            </div>
            <p class="tag" title="We verify via RDAP through your server-side proxy /api?url=">We verify via <b>RDAP</b> and show <b>expiry dates</b> when the registry exposes them. Traffic is best-effort; if blocked, youâ€™ll see <b>N/A</b>.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- RIGHT: Results -->
    <section class="right">
      <article class="card">
        <h3>Available Now <span class="badge" id="countAvail">0</span></h3>
        <div class="rows" id="listAvail">
          <div class="tag">Run a search to see available domains.</div>
        </div>
      </article>

      <div class="lists">
        <article class="card">
          <h3>Expiring Soon <span class="badge" id="countExp">0</span></h3>
          <div class="rows" id="listExp">
            <div class="tag">Import CSV or run generate to find domains expiring within your window.</div>
          </div>
        </article>

        <article class="card video-card" aria-labelledby="ytTitle">
          <h3 id="ytTitle">How to Flip Domains (Beginner to Pro)</h3>
          <div class="frame" id="ytFrame">
            <!-- Use local OG as placeholder to avoid external thumbnail 404 -->
            <button class="thumb" id="ytLoad" aria-label="Play tutorial video" data-id="dQw4w9WgXcQ">
              <img src="/assets/og/domain-finder.png" alt="Domain flipping tutorial" width="560" height="315" loading="lazy" decoding="async">
              <div class="play" aria-hidden="true"></div>
            </button>
          </div>
        </article>
      </div>
    </section>
  </main>

  <footer>
    Â© UpTools Â· <a href="/#tools">All Tools</a> Â· <a href="/currency-converter/">Currency</a> Â· <a href="/password-generator/">Passwords</a> Â· <a href="/uuid-generator/">UUID</a> Â· <a href="/whatsapp-chat/">WhatsApp Link</a>
  </footer>

  <script>
    // ---- utils fallback if /scripts/utils.js isn't present ----
    const Utils = (window.Utils) || {
      $: (s, r=document)=>r.querySelector(s),
      $$: (s, r=document)=>[...r.querySelectorAll(s)],
      debounce(fn, d=120){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), d); }; },
      fmtNum:(n,o={})=>(new Intl.NumberFormat('en-IN', {maximumFractionDigits:2, ...o}).format(n??0)),
      download(name, data, type="text/csv"){ const blob = new Blob([data], {type}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name; a.click(); URL.revokeObjectURL(a.href); }
    };
    const {$, $$} = Utils;

    // Themed file input UX
    const fileEl = $('#csvFile'), fileBtn = $('#fileBtn'), fileInfo = $('#fileInfo');
    fileEl?.addEventListener('change', e=>{
      const f = fileEl.files?.[0];
      fileInfo.textContent = f ? `Selected: ${f.name} (${Utils.fmtNum(f.size)} bytes)` : 'Import CSV as: domain[,exp_date]';
    });

    // TLD chips (two groups: generate and length)
    function initChipToggle(containerSelector, onToggle){
      $$(containerSelector + ' .chip').forEach(c=>{
        c.addEventListener('click', ()=>{
          c.classList.toggle('active');
          const active=c.classList.contains('active');
          c.setAttribute('aria-pressed', active ? 'true' : 'false');
          onToggle?.(c, active);
        });
      });
    }
    const tldSet = new Set([".com",".in",".co"]);
    const tldSet2 = new Set([".com",".in"]); // length-mode
    initChipToggle('#tlds', (c,active)=>{ const t=c.dataset.tld; if(active) tldSet.add(t); else tldSet.delete(t); });
    initChipToggle('#tlds2', (c,active)=>{ const t=c.dataset.tld; if(active) tldSet2.add(t); else tldSet2.delete(t); });

    // Length-only flags
    const lenFlags = { letters:true, digits:false, hyphen:false, start:'letter' };
    initChipToggle('#lenChars', (c,active)=>{ lenFlags[c.dataset.flag] = active; });
    initChipToggle('#lenStart', (c,active)=>{
      if(active){ // make single-select
        $$('#lenStart .chip').forEach(x=>{ if(x!==c){ x.classList.remove('active'); x.setAttribute('aria-pressed','false'); } });
        lenFlags.start = c.dataset.start;
      }
    });

    // Mode switching
    const modeBtns = $$('.panel-body .chip[data-mode]');
    const modes = {
      generate: $('#mode-generate'),
      length:   $('#mode-length'),
      paste:    $('#mode-paste'),
      csv:      $('#mode-csv')
    };
    modeBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        modeBtns.forEach(b=>{ b.classList.remove('active'); b.setAttribute('aria-pressed','false'); });
        btn.classList.add('active'); btn.setAttribute('aria-pressed','true');
        const m = btn.dataset.mode;
        Object.entries(modes).forEach(([k,el])=> el.hidden = (k!==m));
      });
    });

    // Brandability
    const vowels = new Set('aeiou');
    function brandScore(domain){
      const name = domain.split('.')[0];
      const len = name.length;
      const hasHyphen = /-/.test(name);
      const hasDigit = /\d/.test(name);
      const vc = name.replace(/[^a-z]/g,'').split('').map(c=> vowels.has(c)?'v':'c').join('');
      let s = 100;
      if(len < 4 || len > 14) s -= 20;
      if(hasHyphen) s -= 15;
      if(hasDigit) s -= 10;
      if(/(vv|ccc{3,}|[aeiou]{4,})/.test(vc)) s -= 10;
      if(/(ai|io|ly|ify|hub|labs|base|stack|gen|flow|grid|zone|nest|forge|kit|deck|nova|pulse|mint)$/.test(name)) s += 8;
      if(/^(go|get|try|my|hey|we|use|top|pro)/.test(name)) s += 5;
      return Math.max(0, Math.min(100, s));
    }

    // Keyword generator (seed optional)
    const PREFIX = ["go","get","try","my","hey","we","use","top","pro","neo","ultra","swift","true","hyper","omni","mint","clear","alpha","next"];
    const SUFFIX = ["ly","ify","io","hub","labs","base","stack","gen","flow","grid","zone","spot","deck","kit","forge","nest","pilot","vista","pulse","mint"];
    function combos(seed){
      const out = new Set();
      const s = (seed||'').toLowerCase().replace(/[^a-z0-9-]+/g,'');
      if(!s) return out;
      out.add(s);
      PREFIX.forEach(p=> out.add(p+s));
      SUFFIX.forEach(x=> out.add(s+x));
      out.add(s.replace(/[aeiou][^aeiou]*$/,'')); // short blend
      out.add(s.slice(0, Math.max(3, s.length-1)));
      return out;
    }
    function makeCandidates(words, tlds, maxLen, mode){
      const allowHyphen = /hyphen|both/.test(mode);
      const allowDigit  = /digits|both/.test(mode);
      const seeds = new Set();
      words.forEach(w=> combos(w).forEach(x=> seeds.add(x)));
      const out=[];
      seeds.forEach(n=>{
        tlds.forEach(tld=>{
          let name=n;
          if(!allowHyphen) name = name.replace(/-/g,'');
          if(!allowDigit)  name = name.replace(/\d/g,'');
          const d = `${name}${tld}`;
          if(name && d.length <= maxLen + tld.length && /^[a-z0-9-]+(\.[a-z]{2,})$/.test(d)){
            out.push(d);
          }
        });
      });
      const uniq = [...new Set(out)];
      return uniq.slice(0, 250).map(d=>({domain:d, score:brandScore(d)}))
                 .sort((a,b)=> b.score - a.score || a.domain.length - b.domain.length);
    }

    // Length-only generator (permutations & pronounceable patterns)
    const letters = 'abcdefghijklmnopqrstuvwxyz';
    const digits  = '0123456789';
    function pickCharset(flags){
      let cs = flags.letters ? letters : '';
      if(flags.digits) cs += digits;
      if(flags.hyphen) cs += '-';
      return cs;
    }
    function sanitizeName(name, flags){
      if(!flags.hyphen){
        name = name.replace(/-/g,'');
      }else{
        // no hyphen at start/end or double hyphen
        name = name.replace(/^-+/, '').replace(/-+$/, '').replace(/--+/g, '-');
      }
      if(flags.start==='letter') name = name.replace(/^[^a-z]+/,'');
      return name;
    }
    // Brute-force permutations (returns up to limit items)
    function bruteForceByLength(n, flags, limit){
      const cs = pickCharset(flags);
      if(!cs) return [];
      const N = cs.length ** n;
      const CAP = 15000; // if more, sample instead of full enumerate
      const results = new Set();
      if(N <= CAP){
        // exhaustive (iterative)
        const idx = Array(n).fill(0);
        while(true){
          let s = '';
          for(let i=0;i<n;i++) s += cs[idx[i]];
          s = sanitizeName(s, flags);
          if(s.length===n) results.add(s);
          // increment
          let p=n-1;
          while(p>=0 && ++idx[p]===cs.length){ idx[p]=0; p--; }
          if(p<0) break;
          if(results.size >= limit) break;
        }
      }else{
        // random sampling
        let tries = 0;
        while(results.size < limit && tries < limit*20){
          let s = '';
          for(let i=0;i<n;i++) s += cs[Math.floor(Math.random()*cs.length)];
          s = sanitizeName(s, flags);
          if(s.length===n) results.add(s);
          tries++;
        }
      }
      return [...results];
    }
    // Pronounceable patterns
    const C = 'bcdfghjklmnpqrstvwxyz';
    const V = 'aeiou';
    function buildPatterns(n){
      // create a small set of common patterns close to length n
      const base = ['cv','cvc','cvv','vcv','cvcv','cvvc','vcvc','cvcvc','cvccv','cvcvv','cvvcv','vcvcv','cvcvcv'];
      const filtered = base.filter(p=> p.length===n);
      if(filtered.length) return filtered;
      // extend by repeating
      const out = [];
      let s = 'cvcv';
      while(s.length < n){ s += 'cv'; }
      out.push(s.slice(0,n));
      s = 'cvvcvvcvvcvv';
      while(s.length < n){ s += 'cv'; }
      out.push(s.slice(0,n));
      out.push('c'.repeat(n).replace(/cc/g,'cv')); // rough mix
      return [...new Set(out)];
    }
    function patternCandidates(n, flags, limit){
      const out = new Set();
      const patterns = buildPatterns(n);
      let tries = 0;
      while(out.size < limit && tries < limit*50){
        const pat = patterns[Math.floor(Math.random()*patterns.length)];
        let s = '';
        for(const ch of pat){
          if(ch==='c'){
            s += C[Math.floor(Math.random()*C.length)];
          }else{
            s += V[Math.floor(Math.random()*V.length)];
          }
        }
        // sprinkle digits/hyphens if allowed (rarely to keep brandable)
        if(flags.digits && Math.random()<0.15){
          const pos = 1 + Math.floor(Math.random()*(s.length-2));
          s = s.slice(0,pos) + digits[Math.floor(Math.random()*digits.length)] + s.slice(pos+1);
        }
        if(flags.hyphen && Math.random()<0.1){
          const pos = 2 + Math.floor(Math.random()*(s.length-3));
          s = s.slice(0,pos) + '-' + s.slice(pos);
        }
        s = sanitizeName(s, flags);
        if(flags.start==='letter' && !/^[a-z]/.test(s)) continue;
        if(s.length===n) out.add(s);
        tries++;
      }
      return [...out];
    }
    function makeLengthDomains(n, flags, kind, tlds, limit){
      const names = kind==='perm' ? bruteForceByLength(n, flags, limit) : patternCandidates(n, flags, limit);
      const domains = [];
      names.forEach(name=>{
        tlds.forEach(tld=>{
          const d = `${name}${tld}`;
          if(/^[a-z0-9-]+(\.[a-z]{2,})$/.test(d)) domains.push(d);
        });
      });
      // score + dedupe
      const uniq = [...new Set(domains)];
      return uniq.map(d=>({domain:d, score:brandScore(d)}))
                 .sort((a,b)=> b.score - a.score || a.domain.length - b.domain.length)
                 .slice(0, limit);
    }

    // RDAP + Similarweb
    async function rdapLookup(domain){
      const url = `/api?url=${encodeURIComponent('https://rdap.org/domain/' + domain)}`;
      try{
        const res = await fetch(url, {cache:'no-store'});
        if(res.status === 404) return { status:'available' };
        if(!res.ok) return { status:'unknown' };
        const j = await res.json();
        const events = Array.isArray(j.events)? j.events : [];
        const expEvt = events.find(e=> /(expir|expire)/i.test(e.eventAction || ''));
        const exp = expEvt?.eventDate || null;
        let registrar = j.registrarName || '';
        if(!registrar && Array.isArray(j.entities)){
          for(const ent of j.entities){
            if((ent.roles||[]).includes('registrar') && Array.isArray(ent.vcardArray)){
              const card = ent.vcardArray[1] || [];
              const fn = card.find(row => row[0]==='fn');
              if(fn && fn[3]) registrar = fn[3];
            }
          }
        }
        return { status:'registered', expiration: exp, registrar };
      }catch(_e){ return { status:'error' }; }
    }
    async function trafficEstimate(domain){
      const sw = `/api?url=${encodeURIComponent('https://data.similarweb.com/api/v1/data?domain=' + domain)}`;
      try{
        const r = await fetch(sw, {cache:'no-store'});
        if(!r.ok) return { rank:null, visits:null };
        const j = await r.json();
        const rank = j?.GlobalRank?.Rank ?? null;
        const visits = j?.Engagements?.Visits ?? null;
        return { rank, visits };
      }catch(_e){ return { rank:null, visits:null }; }
    }

    async function mapLimit(items, limit, worker){
      const ret = [];
      let i = 0;
      const runners = Array(Math.min(limit, items.length)).fill(0).map(async function run(){
        while(i < items.length){
          const cur = i++; ret[cur] = await worker(items[cur], cur);
        }
      });
      await Promise.all(runners);
      return ret;
    }

    // Rendering
    const listAvail = $('#listAvail');
    const listExp   = $('#listExp');
    const countAvail = $('#countAvail');
    const countExp = $('#countExp');

    function rowHtml({domain, score, when, rank, visits, registrar}){
      const buy = [
        ["Namecheap", `https://www.namecheap.com/domains/registration/results/?domain=${encodeURIComponent(domain)}`],
        ["Porkbun", `https://porkbun.com/search?q=${encodeURIComponent(domain)}`],
        ["Dynadot", `https://www.dynadot.com/domain/search.html?domain=${encodeURIComponent(domain)}`],
        ["GoDaddy", `https://in.godaddy.com/domainsearch/find?domainToCheck=${encodeURIComponent(domain)}`]
      ];
      const links = buy.map(([t,h])=>`<a class="btn sm ghost" href="${h}" target="_blank" rel="noopener" title="Open ${t} in new tab">${t}</a>`).join('');
      const trafficText = (rank || visits) ? `
        ${rank ? `<span class="tag">Rank <span class="rank">#${Utils.fmtNum(rank,{maximumFractionDigits:0})}</span></span>`:''}
        ${visits ? `<span class="tag">Visits <span class="visits">${Utils.fmtNum(visits,{maximumFractionDigits:0})}</span></span>`:''}
      ` : `<span class="tag" title="Traffic source unavailable or blocked; try later or keep Off for speed.">Traffic: N/A</span>`;
      const expiryText = when ? `<span class="tag">Expiry <span class="when">${when}</span></span>` : '';
      const regText = registrar ? `<span class="tag" title="Registrar">${registrar}</span>` : '';
      return `<div class="rowi">
        <div>
          <div class="n">${domain}</div>
          <div class="meta">
            <span class="tag">Score <span class="score">${score}</span></span>
            ${expiryText}
            ${trafficText}
            ${regText}
          </div>
        </div>
        <div class="act">${links}</div>
      </div>`;
    }
    function addAvail(item){
      if(listAvail.querySelector('.tag') && listAvail.children.length===1) listAvail.innerHTML='';
      listAvail.insertAdjacentHTML('beforeend', rowHtml(item));
      countAvail.textContent = String(+countAvail.textContent + 1);
    }
    function addExp(item){
      if(listExp.querySelector('.tag') && listExp.children.length===1) listExp.innerHTML='';
      listExp.insertAdjacentHTML('beforeend', rowHtml(item));
      countExp.textContent = String(+countExp.textContent + 1);
    }

    // Progress
    function setProgress(done, total, label='Workingâ€¦'){
      $('#statLabel').textContent = `${label} ${done}/${total}`;
      $('#statBar').style.width = total ? `${Math.round(done*100/total)}%` : '0%';
    }

    // CSV helpers
    function parseCSV(text){
      const lines = text.split(/\r?\n/).filter(Boolean);
      if(!lines.length) return [];
      const header = lines[0].toLowerCase();
      const hasHeader = /domain|exp/.test(header);
      const rows = hasHeader ? lines.slice(1) : lines;
      return rows.map(line=>{
        const cols = line.split(',').map(s=>s.trim());
        return { domain: cols[0], exp_date: cols[1] || '' };
      }).filter(x=> x.domain && /\./.test(x.domain));
    }
    function exportCSV(){
      const rows = [['domain','score','status','expiry','rank','visits','registrar']];
      $$('#listAvail .rowi, #listExp .rowi').forEach(r=>{
        const domain = r.querySelector('.n')?.textContent?.trim() || '';
        const score = r.querySelector('.score')?.textContent?.trim() || '';
        const when  = r.querySelector('.when')?.textContent?.trim() || '';
        const rank  = r.querySelector('.rank')?.textContent?.replace('#','').trim() || '';
        const visits= r.querySelector('.visits')?.textContent?.trim() || '';
        const status = r.closest('#listExp') ? 'expiring' : 'available';
        const regTag = [...r.querySelectorAll('.meta .tag')].find(t=> t.title==='Registrar');
        const registrar = regTag ? regTag.textContent.trim() : '';
        rows.push([domain, score, status, when, rank, visits, registrar]);
      });
      const csv = rows.map(r=> r.map(x=> `"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
      Utils.download('domain_opportunities.csv', csv, 'text/csv');
    }

    // Main
    $('#exportBtn').addEventListener('click', exportCSV);
    $('#resetBtn').addEventListener('click', ()=>{
      listAvail.innerHTML = '<div class="tag">Run a search to see available domains.</div>';
      listExp.innerHTML   = '<div class="tag">Import CSV or run generate to find domains expiring within your window.</div>';
      countAvail.textContent = '0'; countExp.textContent='0';
      setProgress(0,0,'Idle');
      $('#kw').value='';
    });

    $('#runBtn').addEventListener('click', async ()=>{
      listAvail.innerHTML = '<div class="tag">Checkingâ€¦</div>';
      listExp.innerHTML   = '<div class="tag">Checkingâ€¦</div>';
      countAvail.textContent='0'; countExp.textContent='0';
      setProgress(0,0,'Preparingâ€¦');

      // Build domain list from chosen mode
      let domains = [];
      const actMode = $('.panel-body .chip[data-mode].active')?.dataset.mode || 'generate';

      if(actMode === 'generate'){
        const wordsRaw = $('#kw').value.trim();
        const words = wordsRaw ? wordsRaw.split(/[,\s]+/).map(s=>s.trim()).filter(Boolean).slice(0,8) : [];
        const maxLen = +$('#maxLen').value || 14;
        const allow = $('#allow').value;
        const tlds = [...tldSet];
        if(words.length){
          domains = makeCandidates(words, tlds, maxLen, allow).map(x=>x.domain);
        }else{
          // Seed optional â†’ fall back to length-only sensible defaults
          const n = Math.min(12, Math.max(3, Math.floor(maxLen/1.2)));
          const flags = { letters:true, digits:/digits|both/.test(allow), hyphen:/hyphen|both/.test(allow), start:'letter' };
          domains = makeLengthDomains(n, flags, 'pattern', tlds, 200).map(x=>x.domain);
        }
      } else if(actMode === 'length'){
        const n = Math.max(2, Math.min(15, +$('#lenN').value || 6));
        const kind = $('#lenKind').value; // pattern | perm
        const limit = Math.max(10, Math.min(1000, +$('#lenLimit').value || 200));
        const flags = { ...lenFlags };
        const tlds = [...tldSet2];
        domains = makeLengthDomains(n, flags, kind, tlds, limit).map(x=>x.domain);
      } else if(actMode === 'paste'){
        domains = $('#pasteBox').value.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
      } else {
        const f = $('#csvFile').files?.[0];
        if(!f){ alert('Choose a CSV file.'); return; }
        const text = await f.text();
        domains = parseCSV(text).map(r=>r.domain);
      }

      domains = [...new Set(domains)].slice(0, 400);
      if(domains.length === 0){ alert('No domains to check.'); return; }

      const total = domains.length;
      let done = 0; setProgress(done, total, 'Checking RDAP');

      const expWindowDays = Math.max(1, Math.min(120, +$('#expWindow').value || 30));
      const trafficMode = $('#withTraffic').value; // expiring | all | off
      const wantTrafficAll = trafficMode === 'all';
      const wantTrafficExp = trafficMode === 'expiring';
      const scoreMap = new Map(domains.map(d => [d, brandScore(d)]));

      await mapLimit(domains, 6, async (domain)=>{
        const rd = await rdapLookup(domain);
        let rank=null, visits=null;

        if(rd.status === 'available'){
          if(wantTrafficAll){ ({rank, visits} = await trafficEstimate(domain)); }
          addAvail({ domain, score: scoreMap.get(domain), rank, visits });
        }else if(rd.status === 'registered' && rd.expiration){
          const exp = new Date(rd.expiration);
          const today = new Date();
          const days = Math.floor((exp - today)/86400000);
          if(days >= 0 && days <= expWindowDays){
            if(wantTrafficAll || wantTrafficExp){ ({rank, visits} = await trafficEstimate(domain)); }
            const when = exp.toISOString().split('T')[0];
            addExp({ domain, score: scoreMap.get(domain), when, rank, visits, registrar: rd.registrar || '' });
          }
        }
        done++; setProgress(done, total, 'Checking RDAP');
      });

      if(+countAvail.textContent === 0) listAvail.innerHTML = '<div class="tag">No immediately available candidates found with current settings.</div>';
      if(+countExp.textContent === 0) listExp.innerHTML = '<div class="tag">No domains expiring within your chosen window.</div>';
    });

    // YouTube lazy loader
    $('#ytLoad').addEventListener('click', ()=>{
      const id = $('#ytLoad').dataset.id;
      const ifr = document.createElement('iframe');
      ifr.width=560; ifr.height=315;
      ifr.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
      ifr.referrerPolicy="strict-origin-when-cross-origin";
      ifr.allowFullscreen = true;
      ifr.src = `https://www.youtube-nocookie.com/embed/${encodeURIComponent(id)}?autoplay=1&rel=0`;
      const frame = $('#ytFrame'); frame.innerHTML=''; frame.appendChild(ifr);
    });
  </script>
</body>
</html>