<!doctype html>
<html lang="en">

<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6216304334889617"
    crossorigin="anonymous"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Income Tax Calculator India 2024-25 | New vs Old Regime Comparison | Free Online Tool</title>
  <meta name="description"
    content="Calculate income tax for FY 2024-25 (AY 2025-26) instantly. Compare New vs Old Regime with 80C, 80D, NPS, HRA, home loan interest. Get monthly TDS breakdown, tax-saving tips & optimal regime recommendation." />
  <meta name="keywords" content="income tax calculator india,tax calculator 2024-25,new vs old regime,80c 80d calculator,hra exemption calculator,tds calculator,tax saving tips,income tax slab rates,standard deduction" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <meta name="theme-color" content="#0f1419" />
  <link rel="canonical" href="https://www.uptools.in/income-tax-tool/" />
    <!-- Favicon -->
  <link rel="icon" sizes="50x50" type="image/svg+xml" href="/assets/logo/uptools-logo.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/logo/uptools-logo.svg">

  <!-- Open Graph -->
  <meta property="og:title" content="Income Tax Calculator India 2024-25 | New vs Old Regime Comparison" />
  <meta property="og:description"
    content="Calculate income tax for FY 2024-25 instantly. Compare New vs Old Regime with 80C, 80D, NPS, HRA. Get monthly TDS breakdown & tax-saving recommendations." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.uptools.in/income-tax-tool/" />
  <meta property="og:site_name" content="UpTools" />
  <meta property="og:image" content="https://www.uptools.in/assets/og/income-tax.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Income Tax Calculator India 2024-25 | Free Online Tool" />
  <meta name="twitter:description" content="Compare New vs Old Regime, calculate 80C/80D/HRA exemptions, get monthly TDS breakdown. Updated for FY 2024-25." />

  <link rel="icon" sizes="50x50" type="image/svg+xml" href="/assets/logo/uptools-logo.svg" />
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/logo/uptools-logo.svg" />
  <link rel="stylesheet" href="/style.css?v=1.2.0" />

  <!-- Schema -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"Income Tax Calculator (India)",
    "applicationCategory":"FinanceApplication",
    "operatingSystem":"Any",
    "url":"https://www.uptools.in/income-tax-tool/",
    "description":"Calculate income tax for FY 2024-25 (AY 2025-26). Compare New vs Old Regime with 80C, 80D, NPS, HRA, home-loan interest, cess, surcharge and monthly TDS.",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"INR"}
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org","@type":"FAQPage","mainEntity":[
      {"@type":"Question","name":"Which is better: New or Old tax regime for FY 2024-25?","acceptedAnswer":{"@type":"Answer","text":"It depends on your deductions. New regime has lower slab rates and ?50,000 standard deduction for salaried/Pensioners, but most deductions like 80C/80D/HRA are not allowed. If your total eligible deductions are high, Old could be better. This calculator compares both instantly."}},
      {"@type":"Question","name":"Is 87A rebate available under both regimes?","acceptedAnswer":{"@type":"Answer","text":"Yes. Under New regime, if total income is up to ?7,00,000, tax after rebate is ?0. Under Old regime, if total income is up to ?5,00,000, tax after rebate is ?0."}},
      {"@type":"Question","name":"Does the New regime allow 80C/80D or HRA?","acceptedAnswer":{"@type":"Answer","text":"No. The New regime disallows most deductions except standard deduction for salaried/pensioners. This tool disables 80C/80D/HRA under New regime automatically."}},
      {"@type":"Question","name":"How is HRA exemption calculated?","acceptedAnswer":{"@type":"Answer","text":"HRA exemption (Old regime only) is the least of: (1) Actual HRA received, (2) Rent paid minus 10% of basic salary, (3) 50% of basic for metro cities (40% for non-metro)."}},
      {"@type":"Question","name":"Is surcharge included?","acceptedAnswer":{"@type":"Answer","text":"You can toggle surcharge. For high income, surcharge applies on tax (plus cess). Highest surcharge under New regime is 25%; under Old it can go up to 37%. This tool estimates based on thresholds."}}
    ]
  }
  </script>
  <!-- 1) Inline ONLY tiny critical rules (below) -->
<style>
  :root{--bg:#0f1419;--surface:#121826;--text:#e6edf3;--muted:#9aa4b2;--brand:#7aa2ff;--radius:.75rem}
  *{box-sizing:border-box}
  html{color-scheme:dark light;-webkit-text-size-adjust:100%}
  body{margin:0;font:400 16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Noto Sans",sans-serif;background:var(--bg);color:var(--text)}
  img,svg,video{max-width:100%;height:auto}
  .container{width:min(100% - 24px,1120px);margin-inline:auto}
  a{color:var(--brand);text-decoration-thickness:.08em;text-underline-offset:.18em}
  .card{background:var(--surface);border:1px solid #212a3a;border-radius:var(--radius);padding:1rem}
  .btn{display:inline-block;padding:.65rem .9rem;border-radius:var(--radius);background:var(--brand);color:#0b1020;border:0;font-weight:600}
</style>

<!-- 2) Load full stylesheet without blocking first paint -->
<link rel="preload" href="/style.css?v=1.2.0" as="style">
<link rel="stylesheet" href="/style.css?v=1.2.0" media="print" onload="this.media='all'">
<noscript><link rel="stylesheet" href="/style.css?v=1.2.0"></noscript>


</head>

<body>
  <!-- small fixed -->
  <ins class="adsbygoogle"
       style="display:inline-block;width:500px;height:50px"
       data-ad-client="ca-pub-6216304334889617"
       data-ad-slot="9810172647"></ins>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
  </script>

  <!-- Same header as homepage -->
  <header class="site" role="banner">
    <div class="header-inner">
      <a class="brand" href="/" aria-label="UpTools Home">
        <img src="/assets/logo/uptools-logo.svg" alt="UpTools logo" width="28" height="28">
        <b>UpTools</b>
      </a>
      <nav class="nav-links" aria-label="Primary">
        <a href="/#tools">Tools</a>
        <a href="/games/">Games</a>
        <a href="/about/">About</a>
        <a href="/contact/">Contact</a>
      </nav>
    </div>
  </header>

  <main class="wrap" id="main">
    <!-- Enhanced Tool Header -->
    <section class="card tool-header">
      <div class="tool-icon" style="background: linear-gradient(135deg, #4CAF50, #2E7D32)">₹</div>
      <div style="flex: 1">
        <h1 style="margin: 0; font-size: 1.75rem; font-weight: 800">Income Tax Calculator India</h1>
        <p class="note" style="margin: .5rem 0 0">FY 2024-25 (AY 2025-26) • Compare New vs Old Regime • Get instant tax calculations with deductions</p>
        <div style="margin-top: .75rem; display: flex; gap: .5rem; flex-wrap: wrap">
          <span class="pill">🆕 Updated for 2024-25</span>
          <span class="pill">⚡ Instant calculation</span>
          <span class="pill">📊 Regime comparison</span>
          <span class="pill">💰 Tax-saving tips</span>
        </div>
      </div>
    </section>

    <!-- Quick Stats Banner -->
    <section class="card" style="background: linear-gradient(135deg, rgba(76, 175, 80, .1), rgba(46, 125, 50, .05)); border-color: rgba(76, 175, 80, .2)">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; text-align: center">
        <div>
          <div style="font-size: 1.5rem; font-weight: 800; color: #4CAF50">₹7,00,000</div>
          <div class="note small">New Regime Tax-Free Limit</div>
        </div>
        <div>
          <div style="font-size: 1.5rem; font-weight: 800; color: #4CAF50">₹5,00,000</div>
          <div class="note small">Old Regime Tax-Free Limit</div>
        </div>
        <div>
          <div style="font-size: 1.5rem; font-weight: 800; color: #4CAF50">₹50,000</div>
          <div class="note small">Standard Deduction</div>
        </div>
        <div>
          <div style="font-size: 1.5rem; font-weight: 800; color: #4CAF50">₹1,50,000</div>
          <div class="note small">Max 80C Deduction</div>
        </div>
      </div>
    </section>

    <!-- Enhanced Input Form -->
    <form id="tax-form" class="card" novalidate>
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem">
        <h2 style="margin: 0; font-size: 1.25rem; font-weight: 800">💰 Enter Your Details</h2>
        <div style="display: flex; gap: .5rem">
          <button type="button" id="quickFillBtn" class="btn" style="background: #9bb8f9; color: #0b1020; padding: .4rem .6rem; font-size: .85rem">Quick Fill Sample</button>
          <button type="button" id="clearAllBtn" class="btn" style="background: #f44336; color: white; padding: .4rem .6rem; font-size: .85rem">Clear All</button>
        </div>
      </div>

      <!-- Income Section -->
      <div class="card" style="background: rgba(76, 175, 80, .05); border-color: rgba(76, 175, 80, .2)">
        <h3 style="margin-top: 0; color: #4CAF50; display: flex; align-items: center; gap: .5rem">
          <span>💵</span> Annual Income
        </h3>
        
        <label class="label" for="annualIncome">
          Annual Gross Income (₹)
          <span class="note small" style="font-weight: normal; margin-left: .5rem">• Before any deductions</span>
        </label>
        <div style="position: relative">
          <input id="annualIncome" class="input" type="number" inputmode="numeric" min="0" step="1000"
            placeholder="e.g., 12,00,000" required style="padding-left: 2rem">
          <span style="position: absolute; left: .75rem; top: 50%; transform: translateY(-50%); color: var(--muted)">₹</span>
        </div>
        
        <!-- Income Range Helper -->
        <div style="margin-top: .5rem; display: flex; gap: .5rem; flex-wrap: wrap">
          <button type="button" class="income-preset" data-amount="500000" style="padding: .25rem .5rem; background: rgba(76, 175, 80, .1); border: 1px solid rgba(76, 175, 80, .3); border-radius: .25rem; font-size: .8rem; cursor: pointer">₹5L</button>
          <button type="button" class="income-preset" data-amount="800000" style="padding: .25rem .5rem; background: rgba(76, 175, 80, .1); border: 1px solid rgba(76, 175, 80, .3); border-radius: .25rem; font-size: .8rem; cursor: pointer">₹8L</button>
          <button type="button" class="income-preset" data-amount="1200000" style="padding: .25rem .5rem; background: rgba(76, 175, 80, .1); border: 1px solid rgba(76, 175, 80, .3); border-radius: .25rem; font-size: .8rem; cursor: pointer">₹12L</button>
          <button type="button" class="income-preset" data-amount="1500000" style="padding: .25rem .5rem; background: rgba(76, 175, 80, .1); border: 1px solid rgba(76, 175, 80, .3); border-radius: .25rem; font-size: .8rem; cursor: pointer">₹15L</button>
          <button type="button" class="income-preset" data-amount="2500000" style="padding: .25rem .5rem; background: rgba(76, 175, 80, .1); border: 1px solid rgba(76, 175, 80, .3); border-radius: .25rem; font-size: .8rem; cursor: pointer">₹25L</button>
        </div>
      </div>

      <!-- Settings Section -->
      <div class="card" style="background: rgba(122, 162, 255, .05); border-color: rgba(122, 162, 255, .2)">
        <h3 style="margin-top: 0; color: var(--brand); display: flex; align-items: center; gap: .5rem">
          <span>⚙️</span> Calculation Settings
        </h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem">
          <label class="check" style="display: flex; align-items: center; gap: .5rem; padding: .75rem; background: rgba(255,255,255,.02); border-radius: .5rem">
            <input id="includeStdDeduction" type="checkbox" checked style="accent-color: var(--brand)">
            <div>
              <span style="font-weight: 600">Standard Deduction (₹50,000)</span>
              <div class="note small">For salaried employees & pensioners</div>
            </div>
          </label>
          
          <label class="check" style="display: flex; align-items: center; gap: .5rem; padding: .75rem; background: rgba(255,255,255,.02); border-radius: .5rem">
            <input id="surchargeToggle" type="checkbox" style="accent-color: var(--brand)">
            <div>
              <span style="font-weight: 600">Apply Surcharge</span>
              <div class="note small">For high income (>₹50L)</div>
            </div>
          </label>
        </div>

        <label class="label" for="regime" style="margin-top: 1rem">Tax Regime Calculation</label>
        <select id="regime" class="input" style="background: rgba(255,255,255,.05)">
          <option value="compare" selected>🔄 Compare New vs Old Regime</option>
          <option value="new">🆕 New Regime Only</option>
          <option value="old">📊 Old Regime Only</option>
        </select>
      </div>

      <!-- Enhanced Deductions Section -->
      <div class="card" id="deductionsSection" style="background: rgba(255, 152, 0, .05); border-color: rgba(255, 152, 0, .2)">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem">
          <h3 style="margin: 0; color: #FF9800; display: flex; align-items: center; gap: .5rem">
            <span>📋</span> Old Regime Deductions
          </h3>
          <button type="button" id="maxDeductionsBtn" class="btn" style="background: #FF9800; color: white; padding: .4rem .6rem; font-size: .85rem">Fill Max Amounts</button>
        </div>
        
        <div class="card" style="background: rgba(255, 193, 7, .1); border-color: rgba(255, 193, 7, .3); margin-bottom: 1rem">
          <p style="margin: 0; font-size: .9rem; display: flex; align-items: center; gap: .5rem">
            <span>⚠️</span> <strong>Note:</strong> These deductions apply only to the Old Regime. They're automatically ignored in New Regime calculations.
          </p>
        </div>

        <!-- Tax Saving Investments -->
        <div class="card" style="background: rgba(255,255,255,.02)">
          <h4 style="margin-top: 0; color: #4CAF50">💰 Tax Saving Investments</h4>
          
          <label class="label" for="sec80c">
            Section 80C (max ₹1,50,000)
            <span class="note small" style="font-weight: normal; margin-left: .5rem">• EPF, PPF, ELSS, Life Insurance, NSC</span>
          </label>
          <div style="position: relative">
            <input id="sec80c" class="input" type="number" min="0" max="150000" step="1000"
              placeholder="e.g., 1,50,000" style="padding-left: 2rem">
            <span style="position: absolute; left: .75rem; top: 50%; transform: translateY(-50%); color: var(--muted)">₹</span>
          </div>
          <div style="margin-top: .25rem; font-size: .8rem; color: var(--muted)">
            <span id="sec80cRemaining">Remaining: ₹1,50,000</span>
          </div>

          <label class="label" for="sec80d" style="margin-top: 1rem">
            Section 80D - Health Insurance
            <span class="note small" style="font-weight: normal; margin-left: .5rem">• Self, family, parents premium</span>
          </label>
          <div style="position: relative">
            <input id="sec80d" class="input" type="number" min="0" step="1000" placeholder="e.g., 25,000" style="padding-left: 2rem">
            <span style="position: absolute; left: .75rem; top: 50%; transform: translateY(-50%); color: var(--muted)">₹</span>
          </div>

          <label class="label" for="nps1b" style="margin-top: 1rem">
            NPS Additional (80CCD(1B)) (max ₹50,000)
            <span class="note small" style="font-weight: normal; margin-left: .5rem">• Over & above 80C limit</span>
          </label>
          <div style="position: relative">
            <input id="nps1b" class="input" type="number" min="0" max="50000" step="1000" placeholder="e.g., 50,000" style="padding-left: 2rem">
            <span style="position: absolute; left: .75rem; top: 50%; transform: translateY(-50%); color: var(--muted)">₹</span>
          </div>
        </div>

        <!-- HRA Section -->
        <div class="card" style="background: rgba(255,255,255,.02)">
          <h4 style="margin-top: 0; color: #2196F3">🏠 HRA Exemption</h4>
          <p class="note small" style="margin-top: 0">Fill if you receive HRA and pay rent. We'll calculate the exempt amount automatically.</p>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem">
            <div>
              <label class="label" for="basic">Basic Salary (₹/year)</label>
              <div style="position: relative">
                <input id="basic" class="input" type="number" min="0" step="1000" placeholder="e.g., 6,00,000" style="padding-left: 2rem">
                <span style="position: absolute; left: .75rem; top: 50%; transform: translateY(-50%); color: var(--muted)">₹</span>
              </div>
            </div>
            
            <div>
              <label class="label" for="hraRecv">HRA Received (₹/year)</label>
              <div style="position: relative">
                <input id="hraRecv" class="input" type="number" min="0" step="1000" placeholder="e.g., 2,40,000" style="padding-left: 2rem">
                <span style="position: absolute; left: .75rem; top: 50%; transform: translateY(-50%); color: var(--muted)">₹</span>
              </div>
            </div>
            
            <div>
              <label class="label" for="rentPaid">Rent Paid (₹/year)</label>
              <div style="position: relative">
                <input id="rentPaid" class="input" type="number" min="0" step="1000" placeholder="e.g., 1,80,000" style="padding-left: 2rem">
                <span style="position: absolute; left: .75rem; top: 50%; transform: translateY(-50%); color: var(--muted)">₹</span>
              </div>
            </div>
          </div>

          <label class="check" style="display: flex; align-items: center; gap: .5rem; margin-top: 1rem; padding: .5rem; background: rgba(255,255,255,.02); border-radius: .5rem">
            <input id="isMetro" type="checkbox" style="accent-color: #2196F3">
            <div>
              <span style="font-weight: 600">Metro City</span>
              <div class="note small">50% of basic salary limit (40% for non-metro)</div>
            </div>
          </label>
          
          <div id="hraCalculation" style="margin-top: .5rem; padding: .5rem; background: rgba(33, 150, 243, .1); border-radius: .5rem; display: none">
            <div class="note small" style="color: #2196F3; font-weight: 600">HRA Exemption: ₹<span id="hraExemptAmount">0</span></div>
          </div>
        </div>

        <!-- Home Loan Section -->
        <div class="card" style="background: rgba(255,255,255,.02)">
          <h4 style="margin-top: 0; color: #9C27B0">🏡 Home Loan Interest</h4>
          <p class="note small" style="margin-top: 0">For self-occupied property. Maximum deduction: ₹2,00,000 per year.</p>
          
          <label class="label" for="homeLoanInt">Interest Paid (₹/year)</label>
          <div style="position: relative">
            <input id="homeLoanInt" class="input" type="number" min="0" max="200000" step="1000" placeholder="e.g., 1,50,000" style="padding-left: 2rem">
            <span style="position: absolute; left: .75rem; top: 50%; transform: translateY(-50%); color: var(--muted)">₹</span>
          </div>
          <div style="margin-top: .25rem; font-size: .8rem; color: var(--muted)">
            <span id="homeLoanRemaining">Remaining: ₹2,00,000</span>
          </div>
        </div>

        <!-- Total Deductions Summary -->
        <div id="deductionsSummary" class="card" style="background: linear-gradient(135deg, rgba(76, 175, 80, .1), rgba(46, 125, 50, .05)); border-color: rgba(76, 175, 80, .3); margin-top: 1rem">
          <h4 style="margin-top: 0; color: #4CAF50">📊 Total Deductions Summary</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: .75rem; text-align: center">
            <div>
              <div style="font-size: 1.2rem; font-weight: 800; color: #4CAF50">₹<span id="totalDeductions">0</span></div>
              <div class="note small">Total Deductions</div>
            </div>
            <div>
              <div style="font-size: 1.2rem; font-weight: 800; color: #4CAF50">₹<span id="taxableIncome">0</span></div>
              <div class="note small">Taxable Income</div>
            </div>
            <div>
              <div style="font-size: 1.2rem; font-weight: 800; color: #4CAF50"><span id="taxSavings">0</span>%</div>
              <div class="note small">Tax Savings</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Action Buttons -->
      <div class="card" style="background: linear-gradient(135deg, rgba(122, 162, 255, .1), rgba(122, 162, 255, .05)); border-color: rgba(122, 162, 255, .2); margin-top: 1rem">
        <div style="display: flex; flex-wrap: wrap; gap: .75rem; justify-content: center">
          <button id="calcBtn" class="btn" type="button" aria-controls="results" style="background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; font-weight: 800; padding: .75rem 1.5rem">
            🧮 Calculate Tax
          </button>
          <button id="resetBtn" class="btn" type="button" style="background: #f44336; color: white; padding: .75rem 1rem">
            🔄 Reset All
          </button>
          <button id="shareBtn" class="btn" type="button" style="background: #2dd4bf; color: #0b1020; padding: .75rem 1rem">
            🔗 Share Results
          </button>
          <button id="csvBtn" class="btn" type="button" style="background: #9bb8f9; color: #0b1020; padding: .75rem 1rem">
            📊 Download Report
          </button>
          <button id="printBtn" class="btn" type="button" style="background: #FF9800; color: white; padding: .75rem 1rem">
            🖨️ Print
          </button>
        </div>
        
        <!-- Auto-calculate toggle -->
        <div style="margin-top: 1rem; text-align: center">
          <label class="check" style="display: inline-flex; align-items: center; gap: .5rem; padding: .5rem; background: rgba(255,255,255,.05); border-radius: .5rem">
            <input id="autoCalculate" type="checkbox" checked style="accent-color: var(--brand)">
            <span style="font-weight: 600">⚡ Auto-calculate on input change</span>
          </label>
        </div>
      </div>
    </form>

    <!-- Results -->
    <section id="results" class="card" aria-live="polite" style="margin-top:16px"></section>

    <!-- Tax Saving Tips -->
    <section class="card" style="background: linear-gradient(135deg, rgba(76, 175, 80, .1), rgba(46, 125, 50, .05)); border-color: rgba(76, 175, 80, .2)">
      <h2 style="margin-top: 0; color: #4CAF50; display: flex; align-items: center; gap: .5rem">
        <span>💡</span> Smart Tax Saving Tips for FY 2024-25
      </h2>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem">
        <div class="card" style="background: rgba(255,255,255,.02)">
          <h3 style="margin-top: 0; color: #4CAF50">🎯 Section 80C Investments</h3>
          <ul class="note" style="line-height: 1.6; margin: .5rem 0 0 1.5rem">
            <li><strong>ELSS Mutual Funds:</strong> 3-year lock-in, potential for higher returns</li>
            <li><strong>PPF:</strong> 15-year lock-in, tax-free returns (~7-8%)</li>
            <li><strong>EPF:</strong> Automatic deduction, employer matching</li>
            <li><strong>NSC:</strong> 5-year lock-in, guaranteed returns</li>
            <li><strong>Life Insurance:</strong> Term + investment combo</li>
          </ul>
        </div>
        
        <div class="card" style="background: rgba(255,255,255,.02)">
          <h3 style="margin-top: 0; color: #2196F3">🏥 Health Insurance (80D)</h3>
          <ul class="note" style="line-height: 1.6; margin: .5rem 0 0 1.5rem">
            <li><strong>Self & Family:</strong> Up to ₹25,000 (₹50,000 if senior citizen)</li>
            <li><strong>Parents:</strong> Additional ₹25,000 (₹50,000 if senior citizen)</li>
            <li><strong>Preventive Health Check:</strong> Extra ₹5,000 deduction</li>
            <li><strong>Total Max:</strong> Up to ₹1,00,000 for senior citizen families</li>
          </ul>
        </div>
        
        <div class="card" style="background: rgba(255,255,255,.02)">
          <h3 style="margin-top: 0; color: #9C27B0">🏠 Home Loan Benefits</h3>
          <ul class="note" style="line-height: 1.6; margin: .5rem 0 0 1.5rem">
            <li><strong>Principal (80C):</strong> Up to ₹1,50,000</li>
            <li><strong>Interest (24b):</strong> Up to ₹2,00,000 (self-occupied)</li>
            <li><strong>First-time Buyer (80EE):</strong> Additional ₹50,000 interest</li>
            <li><strong>Affordable Housing (80EEA):</strong> Additional ₹1,50,000</li>
          </ul>
        </div>
        
        <div class="card" style="background: rgba(255,255,255,.02)">
          <h3 style="margin-top: 0; color: #FF9800">💰 Additional Deductions</h3>
          <ul class="note" style="line-height: 1.6; margin: .5rem 0 0 1.5rem">
            <li><strong>NPS (80CCD(1B)):</strong> Extra ₹50,000 over 80C</li>
            <li><strong>Education Loan (80E):</strong> Full interest amount</li>
            <li><strong>Donations (80G):</strong> 50-100% of donation amount</li>
            <li><strong>Disability (80U):</strong> ₹75,000-₹1,25,000</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Regime Comparison Guide -->
    <section class="card" style="background: rgba(122, 162, 255, .05); border-color: rgba(122, 162, 255, .2)">
      <h2 style="margin-top: 0; color: var(--brand); display: flex; align-items: center; gap: .5rem">
        <span>⚖️</span> New vs Old Regime: Which Should You Choose?
      </h2>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem">
        <div class="card" style="background: rgba(76, 175, 80, .1); border-color: rgba(76, 175, 80, .3)">
          <h3 style="margin-top: 0; color: #4CAF50">🆕 Choose New Regime If:</h3>
          <ul class="note" style="line-height: 1.6; margin: .5rem 0 0 1.5rem">
            <li>Your total deductions are less than ₹2,50,000</li>
            <li>You don't have home loan or major investments</li>
            <li>You prefer simplicity in tax filing</li>
            <li>Your income is between ₹7-15 lakhs</li>
            <li>You're a young professional with minimal investments</li>
          </ul>
          <div style="margin-top: 1rem; padding: .75rem; background: rgba(76, 175, 80, .2); border-radius: .5rem">
            <strong style="color: #4CAF50">Key Benefits:</strong>
            <div class="note small">Lower tax rates, ₹50,000 standard deduction, ₹7L tax-free income</div>
          </div>
        </div>
        
        <div class="card" style="background: rgba(255, 152, 0, .1); border-color: rgba(255, 152, 0, .3)">
          <h3 style="margin-top: 0; color: #FF9800">📊 Choose Old Regime If:</h3>
          <ul class="note" style="line-height: 1.6; margin: .5rem 0 0 1.5rem">
            <li>Your total deductions exceed ₹2,50,000</li>
            <li>You have home loan with high interest</li>
            <li>You invest heavily in 80C instruments</li>
            <li>You pay high HRA or have medical expenses</li>
            <li>You're in higher income brackets (>₹15L)</li>
          </ul>
          <div style="margin-top: 1rem; padding: .75rem; background: rgba(255, 152, 0, .2); border-radius: .5rem">
            <strong style="color: #FF9800">Key Benefits:</strong>
            <div class="note small">Multiple deductions, HRA exemption, home loan benefits</div>
          </div>
        </div>
      </div>
      
      <div class="card" style="background: rgba(255, 193, 7, .1); border-color: rgba(255, 193, 7, .3); margin-top: 1rem">
        <h3 style="margin-top: 0; color: #FFC107">💡 Pro Tip</h3>
        <p class="note" style="margin: 0">You can switch between regimes every year, but once you choose the new regime, you cannot claim deductions like HRA, 80C, etc. Use this calculator to compare both regimes with your actual numbers before deciding!</p>
      </div>
    </section>

    <!-- Tax Slabs Comparison -->
    <section class="card">
      <h2 style="margin-top: 0; display: flex; align-items: center; gap: .5rem">
        <span>📊</span> Income Tax Slabs FY 2024-25 (AY 2025-26)
      </h2>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem">
        <div class="card" style="background: rgba(76, 175, 80, .05); border-color: rgba(76, 175, 80, .2)">
          <h3 style="margin-top: 0; color: #4CAF50">🆕 New Regime Tax Slabs</h3>
          <div style="display: grid; gap: .5rem">
            <div style="display: flex; justify-content: space-between; padding: .5rem; background: rgba(255,255,255,.02); border-radius: .25rem">
              <span>₹0 - ₹3,00,000</span><strong style="color: #4CAF50">0%</strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: .5rem; background: rgba(255,255,255,.02); border-radius: .25rem">
              <span>₹3,00,001 - ₹6,00,000</span><strong style="color: #4CAF50">5%</strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: .5rem; background: rgba(255,255,255,.02); border-radius: .25rem">
              <span>₹6,00,001 - ₹9,00,000</span><strong style="color: #FF9800">10%</strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: .5rem; background: rgba(255,255,255,.02); border-radius: .25rem">
              <span>₹9,00,001 - ₹12,00,000</span><strong style="color: #FF9800">15%</strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: .5rem; background: rgba(255,255,255,.02); border-radius: .25rem">
              <span>₹12,00,001 - ₹15,00,000</span><strong style="color: #f44336">20%</strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: .5rem; background: rgba(255,255,255,.02); border-radius: .25rem">
              <span>Above ₹15,00,000</span><strong style="color: #f44336">30%</strong>
            </div>
          </div>
          <div class="note small" style="margin-top: .5rem; color: #4CAF50">
            <strong>Rebate:</strong> No tax if total income ≤ ₹7,00,000
          </div>
        </div>
        
        <div class="card" style="background: rgba(255, 152, 0, .05); border-color: rgba(255, 152, 0, .2)">
          <h3 style="margin-top: 0; color: #FF9800">📊 Old Regime Tax Slabs</h3>
          <div style="display: grid; gap: .5rem">
            <div style="display: flex; justify-content: space-between; padding: .5rem; background: rgba(255,255,255,.02); border-radius: .25rem">
              <span>₹0 - ₹2,50,000</span><strong style="color: #4CAF50">0%</strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: .5rem; background: rgba(255,255,255,.02); border-radius: .25rem">
              <span>₹2,50,001 - ₹5,00,000</span><strong style="color: #4CAF50">5%</strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: .5rem; background: rgba(255,255,255,.02); border-radius: .25rem">
              <span>₹5,00,001 - ₹10,00,000</span><strong style="color: #f44336">20%</strong>
            </div>
            <div style="display: flex; justify-content: space-between; padding: .5rem; background: rgba(255,255,255,.02); border-radius: .25rem">
              <span>Above ₹10,00,000</span><strong style="color: #f44336">30%</strong>
            </div>
          </div>
          <div class="note small" style="margin-top: .5rem; color: #FF9800">
            <strong>Rebate:</strong> No tax if total income ≤ ₹5,00,000<br>
            <strong>Plus:</strong> All deductions (80C, 80D, HRA, etc.)
          </div>
        </div>
      </div>
      
      <div class="card" style="background: rgba(255, 193, 7, .1); border-color: rgba(255, 193, 7, .3); margin-top: 1rem">
        <p class="note" style="margin: 0; text-align: center">
          <strong>Additional:</strong> 4% Health & Education Cess on total tax + surcharge (if applicable)
        </p>
      </div>
    </section>

    <!-- Important Notes -->
    <section class="card" style="background: rgba(255, 193, 7, .05); border-color: rgba(255, 193, 7, .2)">
      <h2 style="margin-top: 0; color: #FFC107; display: flex; align-items: center; gap: .5rem">
        <span>⚠️</span> Important Notes & Disclaimers
      </h2>
      <ul class="note" style="line-height: 1.6; margin: .5rem 0 0 1.5rem">
        <li>This calculator uses FY 2024-25 (AY 2025-26) tax slabs and rates</li>
        <li>4% Health & Education Cess applies on tax amount plus surcharge</li>
        <li>Section 87A rebate: ₹7,00,000 limit for New Regime, ₹5,00,000 for Old Regime</li>
        <li>Old regime deductions are capped per Income Tax rules (80C: ₹1.5L, NPS 80CCD(1B): ₹50K, etc.)</li>
        <li>HRA exemption calculated as minimum of: actual HRA, rent paid - 10% of basic, 50%/40% of basic</li>
        <li>Home loan interest deduction limited to ₹2,00,000 for self-occupied property</li>
        <li>Surcharge rates: 10% (₹50L-₹1Cr), 15% (₹1Cr-₹2Cr), 25% (₹2Cr-₹5Cr), 37%/25% (>₹5Cr)</li>
        <li><strong>Calculations are indicative only.</strong> Consult a tax professional for accurate filing</li>
      </ul>
    </section>

    <footer class="note small site-footer" role="contentinfo">� <span id="y"></span> UpTools � <a href="/sitemap.xml">Sitemap</a></footer>
  <section class="card" style="margin-top:16px">
  <h2>How this Income Tax calculator works</h2>
  <p>This calculator estimates your India income tax for FY 2024�25 (AY 2025�26) under both the New and Old regimes. Enter your annual gross income, choose whether to include the standard deduction (?50,000 for salaried/pensioners), and optionally toggle surcharge for high incomes. For the Old regime you may enter deductions such as Section 80C (up to ?1,50,000), Section 80D (eligible health insurance premiums), additional NPS under Section 80CCD(1B) (up to ?50,000), HRA details to compute the exempt portion, and home-loan interest (self-occupied: up to ?2,00,000 set-off). The tool compares total tax in New vs Old and shows monthly TDS and effective tax rate.</p>
  <p><b>New regime slabs:</b> 0�?3L: 0%; ?3�6L: 5%; ?6�9L: 10%; ?9�12L: 15%; ?12�15L: 20%; >?15L: 30%. <b>Old regime slabs:</b> 0�?2.5L: 0%; ?2.5�5L: 5%; ?5�10L: 20%; >?10L: 30%. Health & Education Cess of 4% applies on tax plus surcharge. Section 87A rebate makes tax ?0 when total income is up to ?7,00,000 (New) or up to ?5,00,000 (Old). Surcharge, if enabled, applies above ?50L, ?1cr, ?2cr and ?5cr (with a 25% cap in the New regime).</p>
  <h3>Examples</h3>
  <p><b>Example 1:</b> Income ?7,20,000, salaried, standard deduction on, no other deductions. New regime taxable = ?6,70,000 ? 87A rebate not available (above ?7L threshold), tax per slabs + 4% cess. Old regime taxable = ?6,70,000 after standard deduction; basic tax computed per old slabs; compare totals to choose the lower.</p>
  <p><b>Example 2:</b> Income ?12,00,000 with Old-regime deductions: 80C ?1,50,000, 80D ?25,000, NPS 80CCD(1B) ?50,000, HRA exemption ?1,20,000, home-loan interest ?2,00,000. Old regime taxable income reduces substantially; New regime disallows most of these (only standard deduction), so Old may be lower. Use �Compare New vs Old� to see which wins.</p>
  <h3>FAQs</h3>
  <details><summary><b>Which regime should I choose?</b></summary><p>If your total eligible deductions (80C, 80D, NPS 1B, HRA, home-loan interest) are high, the Old regime often results in lower tax. If deductions are minimal, the New regime�s lower rate structure and standard deduction can be better. This tool compares both.</p></details>
  <details><summary><b>Is HRA allowed in the New regime?</b></summary><p>No. Most deductions, including HRA, are not allowed in the New regime (only the standard deduction for salaried/pensioners is applied when selected). HRA exemption (Old only) is the least of: actual HRA received; rent paid - 10% of basic; 50% of basic for metro (40% non-metro).</p></details>
  <details><summary><b>Are results exact?</b></summary><p>They are indicative for planning. Personal nuances (perquisites, set-offs, multiple incomes, rounding, TDS/TCS timing) may alter outcomes. Consult a tax professional for your filing.</p></details>
</section>
</main>

  <script>document.getElementById('y').textContent = new Date().getFullYear();</script>

  <!-- Enhanced Interactive Features -->
  <script type="module">
    // Enhanced UI interactions and features
    document.addEventListener('DOMContentLoaded', () => {
      // Income preset buttons
      document.querySelectorAll('.income-preset').forEach(btn => {
        btn.addEventListener('click', () => {
          const amount = btn.dataset.amount;
          document.getElementById('annualIncome').value = amount;
          if (document.getElementById('autoCalculate').checked) {
            setTimeout(() => document.getElementById('calcBtn').click(), 100);
          }
          updateDeductionsSummary();
        });
      });

      // Quick fill sample data
      document.getElementById('quickFillBtn').addEventListener('click', () => {
        document.getElementById('annualIncome').value = '1200000';
        document.getElementById('sec80c').value = '150000';
        document.getElementById('sec80d').value = '25000';
        document.getElementById('nps1b').value = '50000';
        document.getElementById('basic').value = '600000';
        document.getElementById('hraRecv').value = '240000';
        document.getElementById('rentPaid').value = '180000';
        document.getElementById('isMetro').checked = true;
        document.getElementById('homeLoanInt').value = '150000';
        updateDeductionsSummary();
        updateHRACalculation();
        if (document.getElementById('autoCalculate').checked) {
          setTimeout(() => document.getElementById('calcBtn').click(), 200);
        }
      });

      // Clear all button
      document.getElementById('clearAllBtn').addEventListener('click', () => {
        if (confirm('Clear all entered data?')) {
          document.getElementById('tax-form').reset();
          document.getElementById('results').innerHTML = '';
          updateDeductionsSummary();
          updateHRACalculation();
        }
      });

      // Max deductions button
      document.getElementById('maxDeductionsBtn').addEventListener('click', () => {
        document.getElementById('sec80c').value = '150000';
        document.getElementById('nps1b').value = '50000';
        document.getElementById('homeLoanInt').value = '200000';
        updateDeductionsSummary();
        if (document.getElementById('autoCalculate').checked) {
          setTimeout(() => document.getElementById('calcBtn').click(), 100);
        }
      });

      // Real-time updates for deduction limits
      document.getElementById('sec80c').addEventListener('input', (e) => {
        const val = parseInt(e.target.value) || 0;
        const remaining = Math.max(0, 150000 - val);
        document.getElementById('sec80cRemaining').textContent = `Remaining: ₹${remaining.toLocaleString()}`;
        if (val > 150000) {
          e.target.style.borderColor = '#f44336';
          e.target.title = 'Maximum limit is ₹1,50,000';
        } else {
          e.target.style.borderColor = '';
          e.target.title = '';
        }
        updateDeductionsSummary();
      });

      document.getElementById('homeLoanInt').addEventListener('input', (e) => {
        const val = parseInt(e.target.value) || 0;
        const remaining = Math.max(0, 200000 - val);
        document.getElementById('homeLoanRemaining').textContent = `Remaining: ₹${remaining.toLocaleString()}`;
        if (val > 200000) {
          e.target.style.borderColor = '#f44336';
          e.target.title = 'Maximum limit is ₹2,00,000';
        } else {
          e.target.style.borderColor = '';
          e.target.title = '';
        }
        updateDeductionsSummary();
      });

      // HRA calculation
      function updateHRACalculation() {
        const basic = parseInt(document.getElementById('basic').value) || 0;
        const hraRecv = parseInt(document.getElementById('hraRecv').value) || 0;
        const rentPaid = parseInt(document.getElementById('rentPaid').value) || 0;
        const isMetro = document.getElementById('isMetro').checked;
        
        if (basic && hraRecv && rentPaid) {
          const metroPercent = isMetro ? 0.5 : 0.4;
          const hraExempt = Math.min(
            hraRecv,
            rentPaid - (basic * 0.1),
            basic * metroPercent
          );
          const exemptAmount = Math.max(0, hraExempt);
          document.getElementById('hraExemptAmount').textContent = exemptAmount.toLocaleString();
          document.getElementById('hraCalculation').style.display = 'block';
        } else {
          document.getElementById('hraCalculation').style.display = 'none';
        }
        updateDeductionsSummary();
      }

      // Update HRA on input changes
      ['basic', 'hraRecv', 'rentPaid', 'isMetro'].forEach(id => {
        document.getElementById(id).addEventListener('input', updateHRACalculation);
        document.getElementById(id).addEventListener('change', updateHRACalculation);
      });

      // Update deductions summary
      function updateDeductionsSummary() {
        const income = parseInt(document.getElementById('annualIncome').value) || 0;
        const sec80c = Math.min(parseInt(document.getElementById('sec80c').value) || 0, 150000);
        const sec80d = parseInt(document.getElementById('sec80d').value) || 0;
        const nps1b = Math.min(parseInt(document.getElementById('nps1b').value) || 0, 50000);
        const homeLoan = Math.min(parseInt(document.getElementById('homeLoanInt').value) || 0, 200000);
        
        // Calculate HRA exemption
        const basic = parseInt(document.getElementById('basic').value) || 0;
        const hraRecv = parseInt(document.getElementById('hraRecv').value) || 0;
        const rentPaid = parseInt(document.getElementById('rentPaid').value) || 0;
        const isMetro = document.getElementById('isMetro').checked;
        let hraExempt = 0;
        
        if (basic && hraRecv && rentPaid) {
          const metroPercent = isMetro ? 0.5 : 0.4;
          hraExempt = Math.max(0, Math.min(
            hraRecv,
            rentPaid - (basic * 0.1),
            basic * metroPercent
          ));
        }

        const totalDeductions = sec80c + sec80d + nps1b + homeLoan + hraExempt;
        const stdDeduction = document.getElementById('includeStdDeduction').checked ? 50000 : 0;
        const taxableIncome = Math.max(0, income - totalDeductions - stdDeduction);
        const taxSavings = income > 0 ? ((totalDeductions + stdDeduction) / income * 100) : 0;

        document.getElementById('totalDeductions').textContent = totalDeductions.toLocaleString();
        document.getElementById('taxableIncome').textContent = taxableIncome.toLocaleString();
        document.getElementById('taxSavings').textContent = taxSavings.toFixed(1);
      }

      // Auto-calculate functionality
      const autoCalculateInputs = ['annualIncome', 'sec80c', 'sec80d', 'nps1b', 'basic', 'hraRecv', 'rentPaid', 'homeLoanInt'];
      autoCalculateInputs.forEach(id => {
        document.getElementById(id).addEventListener('input', debounce(() => {
          updateDeductionsSummary();
          if (document.getElementById('autoCalculate').checked) {
            document.getElementById('calcBtn').click();
          }
        }, 500));
      });

      // Print functionality
      document.getElementById('printBtn').addEventListener('click', () => {
        window.print();
      });

      // Initialize
      updateDeductionsSummary();
      updateHRACalculation();
    });

    // Debounce utility
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
  </script>

  <script  type="module">
    import { $, $$, debounce, clamp, num, fmtNum } from '/scripts/utils.js';
    // --- Config: FY 2024-25 (AY 2025-26) ---
    const SLABS = {
      new: [
        { upTo: 300000, rate: 0 },
        { upTo: 600000, rate: 5 },
        { upTo: 900000, rate: 10 },
        { upTo: 1200000, rate: 15 },
        { upTo: 1500000, rate: 20 },
        { upTo: Infinity, rate: 30 }
      ],
      old: [
        { upTo: 250000, rate: 0 },
        { upTo: 500000, rate: 5 },
        { upTo: 1000000, rate: 20 },
        { upTo: Infinity, rate: 30 }
      ]
    };
    const STD_DED = 50000;       // standard deduction (salaried/pension)
    const CESS = 0.04;           // 4%
    const REBATE_NEW_LIMIT = 700000; // 87A threshold (new)
    const REBATE_OLD_LIMIT = 500000; // 87A threshold (old)

    // Surcharge thresholds (approx, India)
    // Note: Highest surcharge under NEW regime capped at 25%.
    const SURCHARGE_BRACKETS = [
      { over: 5000000, rateOld: 0.10, rateNew: 0.10 }, // > ₹50L
      { over: 10000000, rateOld: 0.15, rateNew: 0.15 }, // > ₹1cr
      { over: 20000000, rateOld: 0.25, rateNew: 0.25 }, // > ₹2cr
      { over: 50000000, rateOld: 0.37, rateNew: 0.25 }  // > ₹5cr (Old 37%, New capped 25%)
    ];

    const rs = n => new Intl.NumberFormat('en-IN', { maximumFractionDigits: 0 }).format(Math.round(n || 0));

    const getVal = id => +(document.getElementById(id).value || 0);

    function calcSlabTax(income, slabs) {
      let tax = 0, prev = 0, remaining = income;
      for (const s of slabs) {
        const width = Math.min(remaining, s.upTo - prev);
        if (width > 0) tax += width * (s.rate / 100);
        remaining -= width;
        prev = s.upTo;
        if (remaining <= 0) break;
      }
      return tax;
    }

    function rebateAmt(totalIncome, regime) {
      if (regime === 'new' && totalIncome <= REBATE_NEW_LIMIT) return Infinity; // wipe tax
      if (regime === 'old' && totalIncome <= REBATE_OLD_LIMIT) return Infinity;
      return 0;
    }

    function calcHRAExemption({ basic = 0, hraRecv = 0, rentPaid = 0, isMetro = false } = {}) {
      if (!basic || !hraRecv || !rentPaid) return 0;
      const perc = isMetro ? 0.50 : 0.40;
      const a = hraRecv;
      const b = Math.max(0, rentPaid - 0.10 * basic);
      const c = perc * basic;
      return Math.max(0, Math.min(a, b, c));
    }

    function cap(val, max) { return Math.max(0, Math.min(val || 0, max)); }

    function calcOldDeductions() {
      // 80C (max 1.5L), 80D (no complex per-age logic here), NPS 1B (50k),
      // HRA exemption (computed), home-loan interest (cap 2L)
      const sec80c = cap(getVal('sec80c'), 150000);
      const sec80d = Math.max(0, getVal('sec80d')); // You may add age-based caps later
      const nps1b = cap(getVal('nps1b'), 50000);
      const hra = calcHRAExemption({
        basic: getVal('basic'),
        hraRecv: getVal('hraRecv'),
        rentPaid: getVal('rentPaid'),
        isMetro: $('#isMetro').checked
      });
      const homeLoan = cap(getVal('homeLoanInt'), 200000);
      return { sec80c, sec80d, nps1b, hra, homeLoan };
    }

    function surchargeRate(taxableIncome, regime) {
      let rate = 0;
      for (const b of SURCHARGE_BRACKETS) {
        if (taxableIncome > b.over) {
          rate = (regime === 'new') ? b.rateNew : b.rateOld;
        }
      }
      return rate;
    }

    function compute({ income, includeStd, regimeMode, applySurcharge }) {
      const baseIncome = Math.max(0, income || 0);

      // New regime taxable
      let newTaxable = baseIncome;
      if (includeStd) newTaxable -= STD_DED;
      newTaxable = Math.max(0, newTaxable);

      // Old regime taxable (apply deductions)
      const d = calcOldDeductions();
      let oldTaxable = baseIncome;
      // HRA exemption reduces taxable salary component
      oldTaxable -= d.hra;
      // Section deductions
      oldTaxable -= (d.sec80c + d.sec80d + d.nps1b);
      // Home loan interest (self-occupied set-off)
      oldTaxable -= d.homeLoan;
      // Standard deduction (if chosen)
      if (includeStd) oldTaxable -= STD_DED;
      oldTaxable = Math.max(0, oldTaxable);

      // Regime-specific computations
      const out = {};

      // New regime
      if (regimeMode !== 'old') {
        let tax = calcSlabTax(newTaxable, SLABS.new);
        // 87A rebate
        if (rebateAmt(newTaxable, 'new') === Infinity) tax = 0;
        // surcharge
        let surcharge = 0;
        if (applySurcharge) {
          const r = surchargeRate(newTaxable, 'new');
          surcharge = tax * r;
        }
        const cess = (tax + surcharge) * CESS;
        const total = tax + surcharge + cess;
        out.new = {
          taxable: newTaxable, basicTax: tax, surcharge, cess, total,
          mtds: total / 12, effRate: income ? (total / income * 100) : 0
        };
      }

      // Old regime
      if (regimeMode !== 'new') {
        let tax = calcSlabTax(oldTaxable, SLABS.old);
        if (rebateAmt(oldTaxable, 'old') === Infinity) tax = 0;
        let surcharge = 0;
        if (applySurcharge) {
          const r = surchargeRate(oldTaxable, 'old');
          surcharge = tax * r;
        }
        const cess = (tax + surcharge) * CESS;
        const total = tax + surcharge + cess;
        out.old = {
          taxable: oldTaxable, basicTax: tax, surcharge, cess, total,
          mtds: total / 12, effRate: income ? (total / income * 100) : 0,
          deductions: d
        };
      }
      return out;
    }

    function render(results, income, includeStd, regimeMode) {
      const el = $('#results');
      if (!income) { el.innerHTML = '<p class="note">Enter your annual income and click Calculate.</p>'; return; }

      let compare = '';
      if (regimeMode === 'compare' && results.new && results.old) {
        const better = results.new.total < results.old.total ? 'new' : 'old';
        const tag = better === 'new' ? 'New Regime is lower tax' : 'Old Regime is lower tax';
        compare = `
        <div class="row" style="margin-top:0">
          <strong>Best Option:</strong>
          <span class="amount">${tag}</span>
        </div>`;
      }

      const newCard = results.new ? `
      <div class="card" style="margin-top:12px">
        <h3 style="margin-top:0">New Regime</h3>
        <div class="row"><span>Taxable Income</span><span>₹${rs(results.new.taxable)}</span></div>
        <div class="row"><span>Basic Tax</span><span>₹${rs(results.new.basicTax)}</span></div>
        ${results.new.surcharge ? `<div class="row"><span>Surcharge</span><span>₹${rs(results.new.surcharge)}</span></div>` : ''}
        <div class="row"><span>Cess (4%)</span><span>₹${rs(results.new.cess)}</span></div>
        <div class="row total"><span>Total Tax</span><span>₹${rs(results.new.total)}</span></div>
        <div class="row"><span>Monthly TDS</span><span>₹${rs(results.new.mtds)}</span></div>
        <div class="row"><span>Effective Tax Rate</span><span>${results.new.effRate.toFixed(2)}%</span></div>
      </div>` : '';

      const oldD = results.old?.deductions;
      const oldCard = results.old ? `
      <div class="card" style="margin-top:12px">
        <h3 style="margin-top:0">Old Regime</h3>
        <div class="row"><span>Taxable Income</span><span>₹${rs(results.old.taxable)}</span></div>
        <div class="row"><span>Basic Tax</span><span>₹${rs(results.old.basicTax)}</span></div>
        ${results.old.surcharge ? `<div class="row"><span>Surcharge</span><span>₹${rs(results.old.surcharge)}</span></div>` : ''}
        <div class="row"><span>Cess (4%)</span><span>₹${rs(results.old.cess)}</span></div>
        <div class="row total"><span>Total Tax</span><span>₹${rs(results.old.total)}</span></div>
        <div class="row"><span>Monthly TDS</span><span>₹${rs(results.old.mtds)}</span></div>
        <div class="row"><span>Effective Tax Rate</span><span>${results.old.effRate.toFixed(2)}%</span></div>
        <div class="note" style="margin-top:8px">
          <strong>Deductions used (Old):</strong>
          <ul style="margin:6px 0 0 18px">
            <li>80C: ₹${rs(oldD.sec80c)} (max 1,50,000)</li>
            <li>80D: ₹${rs(oldD.sec80d)}</li>
            <li>NPS 80CCD(1B): ₹${rs(oldD.nps1b)} (max 50,000)</li>
            <li>HRA exemption: ₹${rs(oldD.hra)}</li>
            <li>Home-loan interest set-off: ₹${rs(oldD.homeLoan)}</li>
            ${includeStd ? `<li>Standard deduction: ₹${rs(STD_DED)}</li>` : ``}
          </ul>
        </div>
      </div>` : '';

      el.innerHTML = `
      <div class="card" style="margin-top:0">
        <h3 style="margin-top:0">Summary</h3>
        <div class="row"><span>Gross Income</span><span>₹${rs(income)}</span></div>
        ${includeStd ? `<div class="row"><span>Standard Deduction</span><span>₹${rs(STD_DED)}</span></div>` : ''}
        ${compare}
      </div>
      <div style="display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">
        ${newCard}
        ${oldCard}
      </div>
    `;
    }

    function toCSV(results, income) {
      const rows = [["Field", "New Regime", "Old Regime"]];
      const pick = (obj, k) => obj ? obj[k] : '';
      const fmt = v => typeof v === "number" ? Math.round(v) : v;
      rows.push(["Gross Income", fmt(income), fmt(income)]);
      rows.push(["Taxable Income", fmt(pick(results.new, 'taxable')), fmt(pick(results.old, 'taxable'))]);
      rows.push(["Basic Tax", fmt(pick(results.new, 'basicTax')), fmt(pick(results.old, 'basicTax'))]);
      rows.push(["Surcharge", fmt(pick(results.new, 'surcharge')), fmt(pick(results.old, 'surcharge'))]);
      rows.push(["Cess", fmt(pick(results.new, 'cess')), fmt(pick(results.old, 'cess'))]);
      rows.push(["Total Tax", fmt(pick(results.new, 'total')), fmt(pick(results.old, 'total'))]);
      rows.push(["Monthly TDS", fmt(pick(results.new, 'mtds')), fmt(pick(results.old, 'mtds'))]);
      rows.push(["Effective Rate (%)", pick(results.new, 'effRate')?.toFixed?.(2) || '', pick(results.old, 'effRate')?.toFixed?.(2) || '']);
      return rows.map(r => r.join(',')).join('\n');
    }

    function syncURL() {
      const params = new URLSearchParams();
      const fields = ['annualIncome', 'sec80c', 'sec80d', 'nps1b', 'basic', 'hraRecv', 'rentPaid', 'homeLoanInt'];
      for (const id of fields) { params.set(id, document.getElementById(id).value || ''); }
      params.set('std', $('#includeStdDeduction').checked);
      params.set('metro', $('#isMetro').checked);
      params.set('srchg', $('#surchargeToggle').checked);
      params.set('mode', $('#regime').value);
      history.replaceState({}, '', location.pathname + '?' + params.toString());
      localStorage.setItem('itc:last', params.toString());
    }

    function loadFromURLOrMemory() {
      const q = new URLSearchParams(location.search || localStorage.getItem('itc:last') || '');
      const set = (id, v) => { const el = document.getElementById(id); if (el) el.value = v ?? ''; };
      set('annualIncome', q.get('annualIncome'));
      set('sec80c', q.get('sec80c'));
      set('sec80d', q.get('sec80d'));
      set('nps1b', q.get('nps1b'));
      set('basic', q.get('basic'));
      set('hraRecv', q.get('hraRecv'));
      set('rentPaid', q.get('rentPaid'));
      set('homeLoanInt', q.get('homeLoanInt'));
      if (q.has('std')) $('#includeStdDeduction').checked = q.get('std') === 'true';
      if (q.has('metro')) $('#isMetro').checked = q.get('metro') === 'true';
      if (q.has('srchg')) $('#surchargeToggle').checked = q.get('srchg') === 'true';
      if (q.has('mode')) $('#regime').value = q.get('mode');
    }

    function shareLink() {
      syncURL();
      const url = location.href;
      if (navigator.share) { navigator.share({ title: 'Income Tax Calculator - UpTools', url }).catch(() => { }); }
      else {
        navigator.clipboard?.writeText(url);
        alert('Link copied to clipboard:\n' + url);
      }
    }

    function resetAll() {
      document.getElementById('tax-form').reset();
      $('#includeStdDeduction').checked = true;
      $('#isMetro').checked = false;
      $('#surchargeToggle').checked = false;
      $('#regime').value = 'compare';
      history.replaceState({}, '', location.pathname);
      localStorage.removeItem('itc:last');
      $('#results').innerHTML = '';
    }

    // Bind
    document.addEventListener('DOMContentLoaded', () => {
      loadFromURLOrMemory();

      const calc = () => {
        const income = getVal('annualIncome');
        const includeStd = $('#includeStdDeduction').checked;
        const regimeMode = $('#regime').value;
        const applySurcharge = $('#surchargeToggle').checked;

        const results = compute({ income, includeStd, regimeMode, applySurcharge });
        render(results, income, includeStd, regimeMode);
        syncURL();
      };

      document.getElementById('calcBtn').addEventListener('click', calc);
      ['annualIncome', 'sec80c', 'sec80d', 'nps1b', 'basic', 'hraRecv', 'rentPaid', 'homeLoanInt'].forEach(id => {
        document.getElementById(id).addEventListener('input', calc);
      });
      ['includeStdDeduction', 'isMetro', 'surchargeToggle', 'regime'].forEach(id => {
        document.getElementById(id).addEventListener('change', calc);
      });

      document.getElementById('csvBtn').addEventListener('click', () => {
        const income = getVal('annualIncome');
        if (!income) return alert('Please enter income first.');
        const includeStd = $('#includeStdDeduction').checked;
        const regimeMode = $('#regime').value;
        const applySurcharge = $('#surchargeToggle').checked;
        const results = compute({ income, includeStd, regimeMode, applySurcharge });
        const csv = toCSV(results, income);
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'income-tax-calculation.csv';
        a.click();
        URL.revokeObjectURL(a.href);
      });

      document.getElementById('shareBtn').addEventListener('click', shareLink);
      document.getElementById('resetBtn').addEventListener('click', resetAll);

      // Auto-calc on load if income given
      if (getVal('annualIncome')) calc();
    });
  </script>
</body>

</html>
